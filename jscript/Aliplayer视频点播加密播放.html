<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Aliplayer视频点播加密播放' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Aliplayer视频点播加密播放</center></div><div class='banquan'>原文出处:本文由博客园博主下落香樟树提供。<br/>
原文连接:https://www.cnblogs.com/zxk5211/p/web_18.html</div><br>
    <h1 id="aliplayer视频播放器填坑">Aliplayer视频播放器填坑</h1>
<p><strong>aliplayer</strong>视频点播分为<strong>Flash</strong>和<strong>HTML5</strong>两个版本，移动端不支持Flash播放器。<br /><strong>Flash</strong>播放器兼容<strong>IE8+</strong>，<strong>HTML5</strong>播发器支持比较新的浏览器，对浏览器的版本要求较<strong>Flash</strong>播放器对浏览器的版本的要求要高一些。<br />其中：<br /><strong>h5</strong>播放器在移动端不支持<strong>flv</strong>和<strong>rtmp</strong>的播放<br />播放<strong>flv</strong>、<strong>m3u8</strong>视频，<strong>PC</strong>端支持的浏览器，需要启用<a href="https://help.aliyun.com/document_detail/62950.html">允许跨域访问</a></p>
<h3 id="hls标准加密与mps私有加密对比">HLS标准加密与MPS私有加密对比</h3>
<table>
<thead>
<tr class="header">
<th>加密类型/设备环境</th>
<th><strong>iOS</strong></th>
<th><strong>Android</strong></th>
<th><strong>PC</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>标准加密 <strong>HLS</strong></td>
<td>√</td>
<td>√</td>
<td>Chrome<br />Firefox<br />Safari<br />Edge<br />IE 11+for Windows8.1+</td>
</tr>
<tr class="even">
<td>私有加密 <strong>MPS</strong></td>
<td>×</td>
<td>Chrome for Android</td>
<td>Chrome<br />Firefox<br />Safari<br />Edge<br />IE 11+for Windows8.1+</td>
</tr>
</tbody>
</table>
<h4 id="aliplayer播放器demo">Aliplayer播放器Demo</h4>
<p>注：<a href="https://player.alicdn.com/aliplayer/index.html">Aliplayer在线配置网址</a><br />HTML代码：</p>
<pre><code><code>&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no&quot; /&gt;
        &lt;title&gt;用户测试用例&lt;/title&gt;
        &lt;!-- aliplayer样式表 --&gt;
        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://g.alicdn.com/de/prismplayer/2.8.2/skins/default/aliplayer-min.css&quot; /&gt;
        &lt;!-- aliplayer Flash版&amp;HTML5版 --&gt;
        &lt;script src=&quot;https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
        &lt;!-- Flash版 --&gt;
        &lt;script src=&quot;https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-flash-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
        &lt;!-- HTML5版 --&gt;
        &lt;script src=&quot;https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-h5-min.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div class=&quot;prism-player&quot; id=&quot;J_prismPlayer&quot;&gt;&lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
<p>JavaScript代码：</p>
<pre class="javascript"><code>var player = new Aliplayer({
    id: &#39;J_prismPlayer&#39;,
    width: &#39;100%&#39;,
    autoplay: true,
    //支持播放地址播放,此播放优先级最高
    source: &#39;播放url&#39;,
    
    //播放方式二：点播用户推荐
    vid: &#39;&#39;,
    playauth: &#39;ddd&#39;,
    cover: &#39;logo.png&#39;,
    
    //播放方式三：仅MPS用户使用（私有加密播放）
    vid: &#39;&#39;,
    accId: &#39;dd&#39;,
    accSecret: &#39;dd&#39;,
    stsToken: &#39;dd&#39;,
    domainRegion: &#39;dd&#39;,
    authInfo: &#39;dd&#39;,
    
    //播放方式四：使用STS方式播放
    vid: &#39;&#39;,
    accessKeyId: &#39;dd&#39;,
    securityToken: &#39;dd&#39;,
    accessKeySecret: &#39;dd&#39;,
    region: &#39;cn-shanghai&#39;,
}, function(player) {
    console.log(&#39;播放器创建好了。&#39;)
});</code></pre>
<p><strong>注：</strong><a href="https://help.aliyun.com/document_detail/62941.html?spm=a2c4g.11186623.4.1.6a391c4cya8wTA">aliplayer属性和接口使用说明</a></p>
<h4 id="vue中使用aliplayer播发器">Vue中使用Aliplayer播发器</h4>
<p><strong>注</strong>：现在<strong>index.html</strong>中引入<strong>aliplayer</strong>的<strong>css</strong>和<strong>js</strong>，或者在当前<strong>vue</strong>文件中引入<strong>aliplayer</strong>的<strong>css</strong>和<strong>js</strong>。</p>
<pre><code><code>&lt;template&gt;
  ...
  &lt;!-- 引入aliplayer播放器 --&gt;
  &lt;div class=&quot;prism-player&quot; id=&quot;player-con&quot;&gt;&lt;/div&gt;
  ...
&lt;/template&gt;</code></pre>
<p>初始化<strong>aliplayer</strong>播发器</p>
<pre class="javascript"><code>export default {
    data() {
        return {
            player: {},
            timer: null
        };
    },
    created() {
        this.loading = this.$loading({
            background: &quot;rgba(0, 0, 0, 0.5)&quot;,
            text: &quot;拼命加载中&quot;
        });
    },
    methods: {
        // 销毁和重建aliplayer
        changePlayer(dt) {
            this.player.dispose();
            this.initPlayer(dt);
        },
        // 获取视频播放信息
        getKeyInfo(videoId, flag) {
            this.$axios.post(
                &quot;XXXXXToken&quot;,
                qs.stringify({
                    videoId
                })
            ).then(res =&gt; {
                let data = res.data;
                if (data.code == 1) {
                    let dt = data.result_data;
                    // 是否初次创建？初次创建播放器：销毁和重建播发器
                    flag ? this.initPlayer(dt) : this.changePlayer(dt);
                }
            });
        },
        // 初始化视频播放器
        initPlayer(data) {
            // 清空dom节点
            document.getElementById(&quot;player-con&quot;).innerHTML = &quot;&quot;;
            // 改变this指向，使其指向当前this指向。
            let _this = this,
                token = sessionStorage.getItem(&quot;token&quot;),
                userId = sessionStorage.getItem(&quot;userId&quot;),
                isConfirm = sessionStorage.getItem(&quot;isConfirm&quot;);
            this.player = new Aliplayer({
                    id: &quot;player-con&quot;, // 播放器id
                    format: &quot;m3u8&quot;, // 视频格式
                    width: &quot;100%&quot;,
                    height: &quot;450px&quot;,
                    playsinline: true,
                    preload: true,
                    encryptType: 1,
                    // HLS标准加密为0（默认）,MPS私有视频加密为1
                    controlBarVisibility: &quot;always&quot;,
                    useH5Prism: true,
                    // 视频底部状态工具栏设置，默认为false，全显示
                    skinLayout: [{
                            name: &quot;bigPlayButton&quot;,
                            align: &quot;blabs&quot;,
                            x: 30,
                            y: 80
                        },
                        {
                            name: &quot;H5Loading&quot;,
                            align: &quot;cc&quot;
                        },
                        {
                            name: &quot;errorDisplay&quot;,
                            align: &quot;tlabs&quot;,
                            x: 0,
                            y: 0
                        },
                        {
                            name: &quot;infoDisplay&quot;
                        },
                        {
                            name: &quot;tooltip&quot;,
                            align: &quot;blabs&quot;,
                            x: 0,
                            y: 56
                        },
                        {
                            name: &quot;thumbnail&quot;
                        },
                        {
                            name: &quot;controlBar&quot;,
                            align: &quot;blabs&quot;,
                            x: 0,
                            y: 0,
                            children: [{
                                    name: &quot;progress&quot;,
                                    align: &quot;blabs&quot;,
                                    x: 0,
                                    y: 44
                                },
                                {
                                    name: &quot;playButton&quot;,
                                    align: &quot;tl&quot;,
                                    x: 15,
                                    y: 12
                                },
                                {
                                    name: &quot;timeDisplay&quot;,
                                    align: &quot;tl&quot;,
                                    x: 10,
                                    y: 7
                                },
                                {
                                    name: &quot;fullScreenButton&quot;,
                                    align: &quot;tr&quot;,
                                    x: 10,
                                    y: 12
                                },
                                {
                                    name: &quot;volume&quot;,
                                    align: &quot;tr&quot;,
                                    x: 5,
                                    y: 10
                                }
                            ]
                        }
                    ],
                    // MPS
                    vid: &#39;vid&#39;,
                    accId: &#39;accId&#39;,
                    accSecret: &#39;accSecret&#39;,
                    stsToken: &#39;stsToken&#39;,
                    domainRegion: &quot;cn-beijing&quot;,
                    authInfo: &#39;{&quot;ExpireTime&quot;: &quot;&#39; +
                        expireTime +
                        &#39;&quot;,&quot;MediaId&quot;: &quot;&#39; +
                        videoId +
                        &#39;&quot;,&quot;Signature&quot;: &quot;&#39; +
                        signature +
                        &#39;&quot;}&#39;
                },
                function(player) {
                    // html5版本的视频事件写在当前callback中
                    player.play();

                    // 定时器
                    let clear = () =&gt; {
                        if (_this.timer) {
                            clearTimeout(_this.timer);
                            _this.timer = null;
                        }
                    };

                    // 获取播放时间
                    let getTimes = () =&gt; {
                        if (player.getCurrentTime() &gt;= 60) {
                            if (isConfirm == 0) {
                                player.pause();
                                player.fullscreenService.cancelFullScreen();
                            }
                        }
                        // 递归回调，计算播放时间
                        _this.timer = setTimeout(getTimes, 1000);
                    };

                    player.on(&quot;ready&quot;, function(e) {
                        // 首次播放
                        clear();
                        getTimes();
                        player.on(&quot;play&quot;, function(e) {
                            // 播放视频
                            clear();
                            getTimes();
                        });
                        player.on(&quot;pause&quot;, function(e) {
                            // 暂停视频播放
                            clear();
                        });
                        player.on(&quot;ended&quot;, function(e) {
                            // 视频播放结束
                            clear();
                        });
                        player.on(&quot;error&quot;, function(e) {
                            // 视频播放失败
                            clear();
                        });
                    });
                }
            );
        },
        // 切换视频播放源：使用函数截流，防止多次触发影响数据展示
        switchVideo: Debounce(function(index, videoId, isPerchase) {
            this.mark = index;
            this.getKeyInfo(videoId);
            this.isPerchase = isPerchase == undefined ? true : isPerchase;
        }, 500)
    },
    // 生命周期钩子函数：销毁
    destroyed() {
        // 清除定时器
        clearInterval(this.timer);
        this.timer = null;
        let play = this.player,
            len = Object.keys(play);
        if (!len) return;
        // 销毁播放器
        play.dispose();
    }
};</code></pre>
<p>注：播放器中隐藏了画中画、画质切换、视频下载等功能。<br />
<strong><em>同时需要注意的是，aliplayerH5视频点播 在iOS移动端是不支持的，苹果移动端不支持aliplayer的私有加密播放方式！</em></strong></p>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>