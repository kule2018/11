<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Vue.js 学习笔记 第7章 组件详解' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Vue.js 学习笔记 第7章 组件详解</center></div><div class='banquan'>原文出处:本文由博客园博主张董提供。<br/>
原文连接:https://www.cnblogs.com/geeksss/p/10810698.html</div><br>
    <p>&nbsp;</p>
<blockquote>
<h2>本篇目录：</h2>
<p><a href="#menu-7-1">7.1 组件与复用</a></p>
<p><a href="#menu-7-2">7.2 使用props传递数据</a></p>
<p><a href="#menu-7-3">7.3 组件通讯</a></p>
<p><a href="#menu-7-4">7.4 使用slot分发内容</a></p>
<p><a href="#menu-7-5">7.5 组件高级用法</a></p>
<p><a href="#menu-7-6">7.6 其他</a></p>
<p><a href="#menu-7-7">7.7 实战：两个常用组件的开发</a></p>
</blockquote>
<p>&nbsp;</p>
<p>组件(Component)是Vue.js最核心的功能，也是整个框架设计最精彩的地方，当然也是最难掌握的。<br />
本章将带领你由浅入深地学习组件的全部内容，并通过几个实战项目熟练使用Vue组件。</p>
<h2 id="toc_0"><a name="menu-7-1"></a>7.1 组件与复用</h2>
<h3 id="toc_1">7.1.1 为什么使用组件</h3>
<p>在正式介绍组件前，我们先来看一个简单的场景，如图7-1所示：<br />
<img class="mw_img_center" style="width: 400px; display: block; clear: both; margin: 0 auto;" src="./images/Vue.js 学习笔记 第7章 组件详解0.png" alt="" />￼</p>
<p>图7-1中是一个很常见的聊天界面，有一些标准的控件，比如右上角的关闭按钮、输入框、发送按钮等。</p>
<p>你可能要问了，这有什么难的，不就是几个<code>&lt;div&gt;</code>、<code>&lt;input&gt;</code>吗？<br />
好，那现在需求升级了，这几个控件还有别的地方要用到。<br />
没问题，复制粘贴呗。</p>
<p>那如果输入框要带数据验证，按钮的图标支持自定义呢？<br />
这样用JavaScript封装后一起复制吧。</p>
<p>那等到项目快完结时，产品经理说，所有使用输入框的地方，都要改成支持回车键提交。<br />
好吧，给我一天的事件，我一个一个加上去。</p>
<p>上面的需求虽然有点变态，但却是业务中很常见的，那就是一些控件、JavaScript能力的复用。<br />
没错，Vue.js的组件就是提高重用性的，让代码可重用。<br />
当学习完组件后，上面的问题就可以分分钟搞定了，再也不用害怕铲平经理的奇葩需求。</p>
<p>我们先看一下图7-1中的示例用组件来编写是怎么的，示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Card </span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">="width:350px;"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p </span><span style="color: #ff0000;">slot</span><span style="color: #0000ff;">="title"</span><span style="color: #0000ff;">&gt;</span>与 xxx 聊天中<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="#"</span><span style="color: #ff0000;"> slot</span><span style="color: #0000ff;">="extra"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Icon </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="android-close"</span><span style="color: #ff0000;"> size</span><span style="color: #0000ff;">="18"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">Icon</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">="height:100px;"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">Row </span><span style="color: #ff0000;">:gutter</span><span style="color: #0000ff;">="16"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">i-col </span><span style="color: #ff0000;">span</span><span style="color: #0000ff;">="17"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>                 <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">i-input </span><span style="color: #ff0000;">v-model</span><span style="color: #0000ff;">="value"</span><span style="color: #ff0000;"> placeholder</span><span style="color: #0000ff;">="请输入..."</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">i-input</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>             <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">i-col</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">i-col </span><span style="color: #ff0000;">span</span><span style="color: #0000ff;">="4"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>                 <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">i-button </span><span style="color: #ff0000;">v-model</span><span style="color: #0000ff;">="primary"</span><span style="color: #ff0000;"> icon</span><span style="color: #0000ff;">="paper-airplane"</span><span style="color: #0000ff;">&gt;</span>发送<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">i-button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>             <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">i-col</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Row</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">Card</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>是不是很奇怪，有很多我们从来都没有见过的标签，比如<code>&lt;Card&gt;</code>、<code>&lt;Row&gt;</code>、<code>&lt;i-col&gt;</code>、<code>&lt;input&gt;</code>和<code>&lt;i-button&gt;</code>等。<br />
而且整段代码除了内联的几个样式外，一句CSS代码也没有，但最终实现的UI就是图7-1的效果。</p>
<p>这些没见过的自定义标签就是组件，每个标签代表一个组件，在任何使用Vue的地方都可以直接使用。<br />
接下来，我们就看看组件的具体用法。</p>
<h3 id="toc_2">7.1.2 组件用法</h3>
<p>回顾一下我们创建Vue实例的方法：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">var</span> app = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Vue({
</span><span style="color: #008080;">2</span>     el: "#app"
<span style="color: #008080;">3</span> });</pre>
</div>
<p>&nbsp;</p>
<p>组件与之类似，需要注册之后才可以使用。注册有全局注册和局部注册两种方式。<br />
全局注册后，任何Vue实例都可以使用。全局注册示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> Vue.component("my-component"<span style="color: #000000;">, {
</span><span style="color: #008080;">2</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 选项</span>
<span style="color: #008080;">3</span> });</pre>
</div>
<p>&nbsp;</p>
<p><code>my-component</code>就是注册的组件自定义标签名称，推荐使用小写加减号分割的形式命名。</p>
<p>要在父实例中使用这个组件，必须要在实例创建前注册。<br />
之后就可以用<code>&lt;my-component&gt;&lt;/my-component&gt;</code>的形式来使用组件了。<br />
实例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 选项</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;"> 9</span>     
<span style="color: #008080;">10</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>此时打开页面还是空白的，因为我们注册的组件没有任何内容。<br />
在组件选项中添加<code>template</code>就可以显示组件内容了。<br />
实例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> Vue.component("my-component"<span style="color: #000000;">, {
</span><span style="color: #008080;">2</span>     template: "&lt;div&gt;这里是组件的内容&lt;/div&gt;"
<span style="color: #008080;">3</span> });</pre>
</div>
<p>&nbsp;</p>
<p>渲染后的结果是：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>这里是组件的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><code>template</code>的DOM结构必须被一个元素包含，如果直接写成&ldquo;这里是组件的内容&rdquo;，不带<code>&lt;div&gt;&lt;/div&gt;</code>是无法渲染的。</p>
<p>在Vue实例中，使用<code>components</code>选项可以局部注册组件，注册后的组件只有在该实例作用域下有效。<br />
组件也可以使用<code>components</code>选项来注册组件，该组件可以嵌套。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> Child </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;局部注册组件的内容&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;"> 9</span>     
<span style="color: #008080;">10</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">        components: {
</span><span style="color: #008080;">13</span>             <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">: Child
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>Vue组件的模板在某些情况下回收到HTML的限制，比如<code>&lt;table&gt;</code>内规定只允许是<code>&lt;tr&gt;</code>、<code>&lt;td&gt;</code>、<code>&lt;th&gt;</code>等这些表格元素，所以在<code>&lt;table&gt;</code>内直接使用组件是无效的。<br />
这种情况下，可以使用特殊的<code>is</code>属性来挂载组件，示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">table</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">tbody </span><span style="color: #ff0000;">is</span><span style="color: #0000ff;">="my-component"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">tbody</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">table</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;这里是组件的内容&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">11</span>     
<span style="color: #008080;">12</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><code>&lt;tbody&gt;</code>在渲染时，会被替换为组件的内容。<br />
常见的限制元素还有<code>&lt;ul&gt;</code>、<code>&lt;ol&gt;</code>、<code>&lt;select&gt;</code>。</p>
<blockquote>
<p>提示：<br />
如果使用的是字符串模板，是不受限制的，比如后面章节介绍的<code>.vue</code>单文件用法等。</p>

</blockquote>
<p>除了<code>template</code>选项外，组件还可以像Vue实例那样使用其他的选项，比如<code>data</code>、<code>computed</code>、<code>method</code>等。<br />
但是在使用<code>data</code>时，和实例稍有区别，<code>data</code>必须是函数，然后将数据<code>return</code>出去。<br />
例如：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;{{message}}&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;"> 9</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">                message: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">组件内容</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">            };
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">14</span>     
<span style="color: #008080;">15</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">18</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>JavaScript对象是引用关系，所以如果<code>return</code>出的对象引用了外部的一个对象，那这个对象就是共享的，任何一方修改都会同步。<br />
比如下面的示例：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> data </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        counter: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;">11</span>     
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;button @click='counter++'&gt;{{counter}}&lt;/button&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">15</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> data;
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">18</span>     
<span style="color: #008080;">19</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">22</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>组件使用了3次，但是点击任意一个<code>&lt;button&gt;</code>，3个按钮的数字都会加1。<br />
那是因为组件的<code>data</code>引用的是外部的对象，这肯定不是我们期望的效果。<br />
所以给组件返回一个新的<code>data</code>对象来独立，示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;button @click='counter++'&gt;{{counter}}&lt;/button&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">11</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">                counter: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">            };
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">16</span>     
<span style="color: #008080;">17</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">20</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>这样，点击3个按钮就互不影响了，完全达到复用的目的。</p>
<h2 id="toc_3"><a name="menu-7-2"></a>7.2 使用props传递数据</h2>
<h3 id="toc_4">7.2.1 基本用法</h3>
<p>组件不仅仅是要把模板的内容进行复用，更重要的是组件间要进行通信。<br />
通常父组件的模板中包含子组件，父组件要正向地向子组件传递数据或参数，子组件接收到后根据参数的不同来渲染不同的内容或执行操作。<br />
这个正向传递数据的过程就是通过<code>props</code>来实现的。</p>
<p>在组件中，使用选项<code>props</code>来声明需要从父级接收的数据。<br />
<code>props</code>的值可以是两种，一种是字符串数组，一种是对象，本小节先介绍数组的用法。<br />
比如我们构造一个数组，接收一个来自父级的数据<code>message</code>，并把它在组件模板中渲染，示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">message</span><span style="color: #0000ff;">="来自父组件的数据"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        props: [</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">message</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">],
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;{{message}}&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">10</span>     
<span style="color: #008080;">11</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>渲染后的结果为：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>来自父组件的数据<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><code>props</code>中声明的数据与组件<code>data</code>函数<code>return</code>的数据主要区别就是<code>props</code>的来自父级，而<code>data</code>中的是组件自己的数据，作用域是组件本身，这两种数据都可以在模板<code>template</code>及计算属性<code>computed</code>和方法<code>methods</code>中使用。<br />
上例的数据<code>message</code>就是通过<code>props</code>从父级传递过来的，在组件的自定义标签上直接写该<code>props</code>的名称，如果要传递多个数据，在<code>props</code>数组中添加项即可。</p>
<p>由于HTML特性不区分大小写，当使用DOM模板时，驼峰命名(camelCase)的<code>props</code>名称要转为短横分隔命名(kebab-case)。例如：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">warning-text</span><span style="color: #0000ff;">="提示信息"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        props: [</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">warningText</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">],
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;{{warningText}}&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">10</span>     
<span style="color: #008080;">11</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<blockquote>
<p>提示：<br />
如果使用的是字符串模板，仍然可以忽略这些限制。</p>

</blockquote>
<p>有时候，传递的数据并不是直接写死的，而是来自父级的动态数据，这是可以使用指令<code>v-bind</code>来动态绑定<code>props</code>的值，当父组件的数据变化时，也会传递给子组件。示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> v-model</span><span style="color: #0000ff;">="parentMessage"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">:message</span><span style="color: #0000ff;">="parentMessage"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        props: [</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">message</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">],
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;{{message}}&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">11</span>     
<span style="color: #008080;">12</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">            parentMessage: </span><span style="background-color: #f5f5f5; color: #000000;">""</span>
<span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">18</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>这里用<code>v-model</code>绑定了父级的数据<code>parentMessage</code>。<br />
当通过输入框任意输入时，子组件接收的<code>props</code>(<code>message</code>)也会实时响应，并更新组件模板。</p>
<blockquote>
<p>提示：<br />
注意，如果你要直接传递数字、布尔值、数组、对象，而且不使用<code>v-bind</code>，传递的仅仅是字符串，尝试下面的示例来对比。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">message</span><span style="color: #0000ff;">="[1,2,3]"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">:message</span><span style="color: #0000ff;">="[1,2,3]"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        props: [</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">message</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">],
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;{{message.length}}&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">10</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">13</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>同一个组件使用了两次，区别仅仅是第二个使用的是<code>v-bind</code>。</p>
<p>渲染后的结果：第一个是7，第二个才是数组的长度3。</p>
</blockquote>
<h3 id="toc_5">7.2.2 单向数据流</h3>
<p>Vue 2.x与Vue 1.x比较大的一个改变就是，Vue 2.x通过<code>props</code>传递数据是单向的了，也就是父组件数据变化时会传递给子组件，但是反过来不行。<br />
而在Vue 1.x里提供了<code>.sync</code>修饰符来支持双向绑定。<br />
之所以这样设计，是尽可能将父子组件解耦，避免子组件无意中修改了父组件的状态。</p>
<p>业务中经常用到两种需要改变<code>prop</code>的情况，一种是父组件传递初始值进来，子组件将它作为初始值保存起来，在自己的作用域下可以随意使用和修改。<br />
何种情况可以在组件<code>data</code>内再声明一个数据，引用父组件的<code>prop</code>，实例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">:init-count</span><span style="color: #0000ff;">="1"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        props: [</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">initCount</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">],
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;{{count}}&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">10</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">                count: </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.initCount
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            };
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">15</span>     
<span style="color: #008080;">16</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">19</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>组件中声明了数据<code>count</code>，它在组件初始化时会获取来自父组件的<code>initCount</code>，之后就与之无关了，只用维护<code>count</code>，这样就可以避免直接操作<code>initCount</code>。</p>
<p>另一种情况就是<code>prop</code>作为需要转变的原始值传入。<br />
这种情况用计算属性就可以了，示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">:width</span><span style="color: #0000ff;">="100"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        props: [</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">width</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">],
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div :style='style'&gt;组件内容&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        computed: {
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">            style: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">11</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">                    width: </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.width </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">px</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">                };
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">17</span>     
<span style="color: #008080;">18</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">21</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>因为用CSS传递宽度要带单位(px)，但是每次都写太麻烦，而且数值计算一般是不带单位的，所以统一在组件内使用计算属性就可以了。</p>
<blockquote>
<p>提示：<br />
注意，在JavaScript中对象和数组是引用类型，指向同一个内存空间，所以<code>props</code>是对象和数组时，在子组件内改变时会影响父组件的。</p>

</blockquote>
<h3 id="toc_6">7.2.3 数据验证</h3>
<p>我们上面所介绍的<code>props</code>选项的值都是一个数组，一开始也介绍过，除了数组外，还可以是对象，当<code>prop</code>需要验证时，就需要对象写法。</p>
<p>一般当你的组件需要提供给别人使用时，推荐都进行数据验证。<br />
比如某个数据必须是数字类型，如果传入字符串，就会在控制台弹出警告。</p>
<p>一下是几个<code>prop</code>的示例：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("my-component"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    props: {
</span><span style="color: #008080;"> 3</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 必须是数字类型</span>
<span style="color: #008080;"> 4</span> <span style="color: #000000;">        propA: Number,
</span><span style="color: #008080;"> 5</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 必须是字符串或数字类型</span>
<span style="color: #008080;"> 6</span> <span style="color: #000000;">        propB: [String, Number],
</span><span style="color: #008080;"> 7</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 布尔值,如果没有定义,默认值就是true</span>
<span style="color: #008080;"> 8</span> <span style="color: #000000;">        propC: {
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">            type: Boolean,
</span><span style="color: #008080;">10</span>             <span style="color: #0000ff;">default</span>: <span style="color: #0000ff;">true</span>
<span style="color: #008080;">11</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">12</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 数字,而且是必传</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">        propD: {
</span><span style="color: #008080;">14</span> <span style="color: #000000;">            type: Number,
</span><span style="color: #008080;">15</span>             required: <span style="color: #0000ff;">true</span>
<span style="color: #008080;">16</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">17</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 如果是数组或对象,默认值必须是一个函数来返回</span>
<span style="color: #008080;">18</span> <span style="color: #000000;">        propE: {
</span><span style="color: #008080;">19</span> <span style="color: #000000;">            type: Array,
</span><span style="color: #008080;">20</span>             <span style="color: #0000ff;">default</span>: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">21</span> <span style="color: #000000;">                rturn[];
</span><span style="color: #008080;">22</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">23</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">24</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 自定义一个验证函数</span>
<span style="color: #008080;">25</span> <span style="color: #000000;">        propF: {
</span><span style="color: #008080;">26</span>             validator: <span style="color: #0000ff;">function</span><span style="color: #000000;">(value) {
</span><span style="color: #008080;">27</span>                 <span style="color: #0000ff;">return</span> value &gt; 10<span style="color: #000000;">;
</span><span style="color: #008080;">28</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">29</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">30</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">31</span> });</pre>
</div>
<p>&nbsp;</p>
<p>验证的<code>type</code>类型可以是：</p>
<ul>
<li>String</li>
<li>Number</li>
<li>Boolean</li>
<li>Object</li>
<li>Array</li>
<li>Function</li>
</ul>
<p><code>type</code>也可以是一个自定义构造器，使用<code>instanceof</code>检测。<br />
当<code>prop</code>验证失败时，在开发版本下会在控制台抛出一条警告。</p>
<h2 id="toc_7"><a name="menu-7-3"></a>7.3 组件通信</h2>
<p>我们已经知道，从父组件向子组件通信，通过<code>props</code>传递数据就可以了。<br />
但Vue组件通信的场景不止有这一种，归纳起来，组件之间通信可以用图7-2表示。<br />
<img class="mw_img_center" style="width: 600px; display: block; clear: both; margin: 0 auto;" src="./images/Vue.js 学习笔记 第7章 组件详解1.png" alt="" />￼</p>
<p>组件关系可分为父子组件通信、兄弟组件通信、跨级组件通信。<br />
本节将介绍组中组件之间通信的方法。</p>
<h3 id="toc_8">7.3.1 自定义事件</h3>
<p>当子组件需要向父组件传递数据时，就要用到自定义事件。<br />
我们在介绍指令 v-on 时有提到，<code>v-on</code>除了监昕DOM事件外，还可以用于组件之间的自定义事件。</p>
<p>如果你了解过JavaScript的设计模式一一观察者模式，一定知道<code>dispatchEvent</code>和<code>addEventListener</code>这两个方法。<br />
Vue组件也有与之类似的一套模式，子组件用<code>$emit()</code>来触发事件，父组件用<code>$on()</code>来监昕子组件的事件。</p>
<p>父组件也可以直接在子组件的自定义标签上使用<code>v-on</code>来监昕子组件触发的自定义事件，示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>总数：{{total}}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">@increase</span><span style="color: #0000ff;">="handleGetTotal"</span><span style="color: #ff0000;"> @reduce</span><span style="color: #0000ff;">="handleGetTotal"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;&lt;button @click='handleIncrease'&gt;+1&lt;/button&gt;&lt;button @click='handleReduce'&gt;-1&lt;/button&gt;&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">10</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">                counter: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">            handleIncrease: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">16</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.counter</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">17</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$emit(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">increase</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.counter);
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">            },
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">            handleReduce: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">20</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.counter</span><span style="background-color: #f5f5f5; color: #000000;">--</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">21</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$emit(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">reduce</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.counter);
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">25</span>     
<span style="color: #008080;">26</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">            total: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">30</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">31</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">32</span> <span style="background-color: #f5f5f5; color: #000000;">            handleGetTotal: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">(total) {
</span><span style="color: #008080;">33</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.total </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> total;
</span><span style="color: #008080;">34</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">35</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">36</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">37</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>上面示例中，子组件有两个按钮，分别实现加1和减1的效果，在改变组件的<code>data</code>(<code>counter</code>)后，通过<code>$emit()</code>再把它传递给父组件，父组件用<code>v-on:increase</code>和<code>v-on:reduce</code>(示例使用的是语法糖)。<br />
<code>$emit()</code>方法的第一个参数是自定义事件的名称，例如示例的<code>increase</code>和<code>reduce</code>后面的参数都是要传递的数据，可以不填或填写多个。</p>
<p>除了用<code>v-on</code>在组件上监听自定义事件外，也可以监听DOM事件，这时可以使用<code>.native</code>修饰符表示监听的是一个原生事件，监听的是该组件的根元素，实例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">v-on:click.native</span><span style="color: #0000ff;">="handleClick"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<h3 id="toc_9">7.3.2 使用v-model</h3>
<p>Vue 2.x可以在自定义组件上使用<code>v-model</code>指令，我们先来看一个示例：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>总数：{{total}}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">v-model</span><span style="color: #0000ff;">="total"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;button @click='handleClick'&gt;+1&lt;/button&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">10</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">                counter: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">            handleClick: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">16</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.counter</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">17</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$emit(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">input</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.counter);
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">21</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">            total: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">27</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>仍然是点击按钮加1的效果，不过这次组件<code>$emit()</code>的事件名是特殊的<code>input</code>，在使用组件的父级，并没有在<code>&lt;my-component&gt;</code>上使用<code>@input='handler'</code>，而是直接用了<code>v-model</code>绑定的一个数据<code>total</code>。<br />
这也可以称作是一个语法糖，因为上面的示例可以间接地用自定义事件来实现：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>总数：{{total}}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">@input</span><span style="color: #0000ff;">="handleGetTotal"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;button @click='handleClick'&gt;+1&lt;/button&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">10</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">                counter: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">            handleClick: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">16</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.counter</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">17</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$emit(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">input</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.counter);
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">21</span>     
<span style="color: #008080;">22</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">            total: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">            handleGetTotal: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">(total) {
</span><span style="color: #008080;">29</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.total </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> total;
</span><span style="color: #008080;">30</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">31</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">32</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">33</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><code>v-model</code>还可以用来创建自定义的表单输入组件，进行数据双向绑定，例如：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>总数：{{total}}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component </span><span style="color: #ff0000;">v-model</span><span style="color: #0000ff;">="total"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">@click</span><span style="color: #0000ff;">="handleReduce"</span><span style="color: #0000ff;">&gt;</span>-1<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        props: [</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">value</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">],
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;input :value='value' @input='updateValue'&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            updateValue: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">(event) {
</span><span style="color: #008080;">13</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$emit(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">input</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, event.target.value);
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">17</span>     
<span style="color: #008080;">18</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">            total: </span><span style="background-color: #f5f5f5; color: #000000;">0</span>
<span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">            handleReduce: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">25</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.total</span><span style="background-color: #f5f5f5; color: #000000;">--</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">29</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>实现这样一个具有双向绑定的<code>v-model</code>组件要满足下面两个要求：</p>
<ul>
<li>接收一个<code>value</code>属性。</li>
<li>在有新的<code>value</code>时触发<code>input</code>事件。</li>
</ul>
<h3 id="toc_10">7.3.3 非父子组件通信</h3>
<p>在实际业务中，除了父子组件通信外，还有很多非父子组件通信的场景，非父子组件一般有两种：兄弟组件和跨多级组件。<br />
为了更加彻底地了解Vue.js 2.x中的通信方法，我们先来看一下在Vue.js 1.x中是如何实现的，这样便于我们了解Vue.js的设计思想。</p>
<p>在Vue.js 1.x中，除了<code>$emit()</code>方法外，还提供了<code>$dispatch()</code>和<code>$broadcast()</code>这两个方法。<br />
<code>$dispatch()</code>用于向上级派发事件，只要是它的父级(一般或多级以上)，都可以在Vue实例的<code>events</code>选项内接收，示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 注意：该示例需要使用Vue.js 1.x的版本 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #000000;">    {{message}}
</span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;button @click='handleDispatch'&gt;源发事件&lt;/button&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">            handleDispatch: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">12</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$dispatch(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">on-message</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">来自内部组件的数据</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">16</span>     
<span style="color: #008080;">17</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">            message: </span><span style="background-color: #f5f5f5; color: #000000;">""</span>
<span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">23</span>             <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">on-message</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">(msg) {
</span><span style="color: #008080;">24</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.message </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> msg;
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">28</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>同理，<code>$broadcast()</code>是由上级向下级广播事件的，用法完全一致，只是方向相反。</p>
<p>这两种方法一旦发出事件后，任何组件都是可以接收到的，就近原则，而且会在第一次接收到后停止冒泡，除非返回<code>true</code>。</p>
<p>这两个方法虽然看起来很好用，但是在Vue.js 2.x中都废弃了，因为基于组件树结构的事件流方式让人难以理解，并且在组件结构扩展的过程中会变得越来越脆弱，并且不能解决兄弟组件通信的问题。</p>
<p>在Vue.js 2.x中，推荐使用一个空的Vue实例作为中央事件总线(bus)，也就是一个中介。<br />
为了更形象地了解它，我们举一个生活中的例子。</p>
<p>比如你需要租房子，你可能会找房产中介来等级你的需求，然后中介把你的信息发给满足要求的出租者，出租者再把报价和看房时间告诉中介，由中介再转达给你。<br />
整个过程中，买家和卖家并没有任何交流，都是通过中间人来传话的。</p>
<p>或者你最近可能要换房了，你会找房产中介登记你的信息，订阅与你找房需求相关的资讯。<br />
一旦有符合你的房子出现时，中介会通知你，并传达你房子的具体信息。</p>
<p>这两个例子中，你和出租者担任的就是两个跨级的组件，而房产中介就是这个中央事件总线(bus)。<br />
比如下面的示例代码：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #000000;">    {{message}}
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component-a</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component-a</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> bus </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue();
</span><span style="color: #008080;"> 8</span>     
<span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component-a</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;button @click='handleEvent'&gt;传递事件&lt;/button&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            handleEvent: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">                bus.$emit(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">on-message</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">来自组件 component-a 的内容</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">17</span>     
<span style="color: #008080;">18</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">            message: </span><span style="background-color: #f5f5f5; color: #000000;">""</span>
<span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        mounted: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">24</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> _this </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">25</span>             <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 在实例初始化时,监听来自bus示例的事件</span>
<span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">            bus.$on(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">on-message</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">(msg) {
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">                _this.message </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> msg;
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">            });
</span><span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">30</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">31</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>首先创建了一个名为<code>bus</code>的空Vue实例，里面没有任何内容；然后全局定义了组件<code>component-a</code>；最后创建Vue实例<code>app</code>。<br />
在<code>app</code>初始化时，也就是在生命周期<code>mounted</code>钩子函数里监听了来自<code>bus</code>的事件<code>on-message</code>，<br />
而在组件<code>component-a</code>中，点击按钮会通过<code>bus</code>把事件<code>on-message</code>发出去，<br />
此时<code>app</code>就会接受到来自<code>bus</code>的事件，进而在回调里完成自己的业务逻辑。</p>
<p>这种方法巧妙而清凉地实现了任何组件间的通信，包括父子、兄弟、跨级，而且Vue 1.x和Vue 2.x都适用。<br />
如果深入使用，可以扩展<code>bus</code>实例，给它添加<code>data</code>、<code>methods</code>、<code>computed</code>等选项，这些都是可以公用的。<br />
在业务中，尤其是协同开发时非常有用，因为经常需要共享一些通用的信息。<br />
比如用户登录的昵称、性别、邮箱等，还有用户的授权token等，只需在初始化时让<code>bus</code>获取一次，任何时间、任何组件就可以从中直接使用了，在单页面富应用(SPA)中会很实用，我们会在进阶篇中逐步介绍这些内容。</p>
<p>当你的项目比较大，有更多的小伙伴参与开发时，也可以你选择更好的状态管理解决方案vuex，在进阶篇里会详细介绍关于它的用法。</p>
<p>除了中央事件总线<code>bus</code>外，还有两种方法可以实现组件间通信：父链和子组件索引。</p>
<h4 id="toc_11">父链</h4>
<p>在子组件中，使用<code>this.$parent</code>可以直接访问该组件的父实例或组件，父组件也可以通过<code>this.$children</code>访问它所有的子组件，而且可以递归向上或向下无限访问，直到根实例或最内层的组件。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #000000;">    {{message}}
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component-a</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component-a</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component-a</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;button @click='handleEvent'&gt;通过父链直接修改数据&lt;/button&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">            handleEvent: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">11</span>                 <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 访问到父链后,可以做任何操作,比如直接修改数据</span>
<span style="color: #008080;">12</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$parent.message </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">来自组件 component-a 的内容</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">16</span>     
<span style="color: #008080;">17</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">            message: </span><span style="background-color: #f5f5f5; color: #000000;">""</span>
<span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">23</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>尽管Vue允许这样操作，但在业务中，子组件应该尽可能地避免依赖父组件的数据，更不应该去主动修改它的数据，因为这样使得父子组件紧耦合，只看父组件，很难理解父组件的状态，因为它可能被任意组件修改，理想情况下，只有组件自己能修改它的状态。<br />
父子组件最好还是通过<code>props</code>和<code>$emit()</code>来通信。</p>
<h4 id="toc_12">子组件索引</h4>
<p>当子组件较多时，通过<code>this.$children</code>来一一遍历我们需要的一个组件实例是比较困难的，尤其是组件动态渲染时，它们的序列是不固定的。Vue提供了子组件索引的方法，用特殊的属性<code>ref</code>来为子组件指定一个索引名称。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">@click</span><span style="color: #0000ff;">="handleRef"</span><span style="color: #0000ff;">&gt;</span>通过ref获取子组件实例<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">component-a </span><span style="color: #ff0000;">ref</span><span style="color: #0000ff;">="comA"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">component-a</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">component-a</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;子组件&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">10</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">                message: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">子组件内容</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            };
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">15</span>     
<span style="color: #008080;">16</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">            handleRef: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">20</span>                 <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 通过$refs来访问指定的实例</span>
<span style="color: #008080;">21</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> msg </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$refs.comA.message;
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">                console.log(msg);
</span><span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">26</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>在父组件模板中，子组件标签上使用<code>ref</code>指定一个名称，并在父组件内通过<code>this.$refs</code>来访问指定名称的子组件。</p>
<blockquote>
<p>提示：<br />
\(refs只在组件渲染完成后才填充，并且它是非响应式的。<br />
它仅仅作为一个直接访问子组件的应急方案，应当避免在模板或计算属性中使用\)refs。</p>

</blockquote>
<p>与Vue 1.x不同的是，Vue 2.x将<code>v-el</code>和<code>v-ref</code>合并为了<code>ref</code>，Vue会自动去判断是普通标签还是组件。<br />
可以尝试补全下面的代码，分别打印出两个<code>ref</code>看看都是什么：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p </span><span style="color: #ff0000;">ref</span><span style="color: #0000ff;">="p"</span><span style="color: #0000ff;">&gt;</span>内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component </span><span style="color: #ff0000;">ref</span><span style="color: #0000ff;">="child"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<h2 id="toc_13"><a name="menu-7-4"></a>7.4 使用slot分发内容</h2>
<h3 id="toc_14">7.4.1 什么是slot</h3>
<p>我们先看一个比较常规的网站布局，如图7-3所示。<br />
<img class="mw_img_center" style="width: 600px; display: block; clear: both; margin: 0 auto;" src="./images/Vue.js 学习笔记 第7章 组件详解2.png" alt="" />￼</p>
<p>这个网站由一级导航、二级导航、左侧列表、正文以及底部版权信息5个模块组成。<br />
如果要将它们都组件化，这个结构可能会是：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">app</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">menu-main</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">menu-main</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">menu-sub</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">menu-sub</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">5</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">menu-left</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">menu-left</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">6</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">container</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">container</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">7</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">8</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">app-footer</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">app-footer</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">9</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">app</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>当需要让组件组合使用，混合父组件的内容与子组件的模板时，就会用到<code>slot</code>，这个过程叫做内容分发(transclusion)。<br />
以<code>&lt;app&gt;</code>为例，它有两个特点：</p>
<ul>
<li><code>&lt;app&gt;</code>组件不知道它的挂载点会有什么内容。挂载点的内容是由<code>&lt;app&gt;</code>的父组件决定的。</li>
<li><code>&lt;app&gt;</code>组件很可能有它自己的模板。</li>

</ul>
<p><code>props</code>传递数据、<code>events</code>触发事件和<code>slot</code>内容分发就构成了Vue组件的3个API来源，再复杂的组件也是由这3部分构成的。</p>
<h3 id="toc_15">7.4.2 作用域</h3>
<p>正式介绍<code>slot</code>前，需要先知道一个概念：编译的作用域。<br />
比如父组件有如下模板：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span> <span style="color: #000000;">    {{message}}
</span><span style="color: #008080;">3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>这里的<code>message</code>就是一个<code>slot</code>。<br />
但是它绑定的是父组件的数据，而不是组件<code>&lt;child-component&gt;</code>的数据。</p>
<p>父组件模板的内容是在父组件作用域内编译，子组件模板的内容是在子组件作用域内编译。<br />
例如下面的代码示例：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component </span><span style="color: #ff0000;">v-show</span><span style="color: #0000ff;">="showChild"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;子组件&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;"> 9</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            showChild: </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span>
<span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">    })
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>这里的状态<code>showChild</code>绑定的是父组件的数据，如果想在子组件上绑定，那应该是：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div v-show='showChild'&gt;子组件&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;"> 9</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">                showChild: </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span>
<span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">            };
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">14</span>     
<span style="color: #008080;">15</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">    })
</span><span style="color: #008080;">18</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>因此，<code>slot</code>分发的内容，作用域是在父组件上的。</p>
<h3 id="toc_16">7.4.3 solt用法</h3>
<h4 id="toc_17">单个Slot</h4>
<p>在子组件内使用特殊的<code>&lt;slot&gt;</code>元素就可以为这个子组件开启一个slot(插槽)，在父组件模板里，插入子组件标签内的所有内容将替代子组件的<code>&lt;slot&gt;</code>标签及它的内容。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>分发的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>更多分发的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="template"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>如果父组件没有插入内容，我将作为默认出现<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#template</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">20</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">    })
</span><span style="color: #008080;">23</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>子组件<code>child-component</code>的模板内定义了一个<code>&lt;slot&gt;</code>元素，并且用一个<code>&lt;p&gt;</code>作为默认的内容，在父组件没有使用<code>slot</code>时，会渲染这段默认的文本；如果写入了<code>slot</code>，那就回替换整个<code>&lt;slot&gt;</code>。<br />
所以上例渲染后的结果为：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>分发的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>更多分发的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">5</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">6</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<blockquote>
<p>提示：<br />
注意，子组件<code>&lt;slot&gt;</code>内的备用内容，它的作用域是子组件本身。</p>

</blockquote>
<h4 id="toc_18">具名Slot</h4>
<p>给<code>&lt;slot&gt;</code>元素指定一个<code>name</code>后可以分发多个内容，具名Slot可以与单个Slot共存。<br />
例如下面的示例：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h2 </span><span style="color: #ff0000;">slot</span><span style="color: #0000ff;">="header"</span><span style="color: #0000ff;">&gt;</span>标题<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>正文内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>更多的正文内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">slot</span><span style="color: #0000ff;">="footer"</span><span style="color: #0000ff;">&gt;</span>底部信息<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="template"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="header"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="header"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="main"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">18</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="footer"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">19</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="footer"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">20</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">21</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">22</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#template</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">28</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">30</span> <span style="background-color: #f5f5f5; color: #000000;">    })
</span><span style="color: #008080;">31</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>子组件内声明了3个<code>&lt;slot&gt;</code>元素，其中在<code>&lt;div name="main"&gt;</code>内的<code>&lt;slot&gt;</code>没有使用<code>name</code>特性，它将作为默认slot出现，父组件没有使用slot特性的元素与内容都将会出现在这里。</p>
<p>如果没有指定默认的匿名slot，父组件内多余的内容片断都将被抛弃。</p>
<p>上例最终渲染后的结果为：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="header"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>标题<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="main"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>正文内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>更多的正文内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="footer"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>底部信息<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>在组合使用组件时，内容分发API至关重要。</p>
<h3 id="toc_19">7.4.4 作用域插槽</h3>
<p>作用域插槽是一种特殊的slot，使用一个可以复用的模板替换已渲染元素。<br />
概念比较难理解，我们先看一个简单的示例来了解它的基本用法。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template </span><span style="color: #ff0000;">scope</span><span style="color: #0000ff;">="props"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>来自父组件的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>{{props.msg}}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="template"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot </span><span style="color: #ff0000;">msg</span><span style="color: #0000ff;">="来自子组件的内容"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span> 
<span style="color: #008080;">16</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#template</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">20</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">    })
</span><span style="color: #008080;">23</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>观察子组件的模板，在<code>&lt;slot&gt;</code>元素上有一个类似<code>props</code>传递数据给组件的写法<code>msg="xxx"</code>，数据传到了插槽。<br />
父组件中使用了<code>&lt;template&gt;</code>元素，而且拥有一个<code>scope="props"</code>的特性，这里的<code>props</code>只是一个临时变量，就像<code>v-for="item in items"</code>里面的<code>item</code>一样。<br />
<code>template</code>内可以通过临时变量<code>props</code>访问来自子组件插槽的数据<code>msg</code>。</p>
<p>将上面的示例渲染后的最终结果为：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>来自父组件的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>来自子组件的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">5</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">6</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>作用域插槽根据代表性的用力是列表组件，允许组件自定义应该如何渲染列表每一项。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-list </span><span style="color: #ff0000;">v-bind:books</span><span style="color: #0000ff;">="books"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template </span><span style="color: #ff0000;">slot</span><span style="color: #0000ff;">="book"</span><span style="color: #ff0000;"> scope</span><span style="color: #0000ff;">="props"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span>{{props.bookName}}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">my-list</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="template"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="book"</span><span style="color: #ff0000;"> v-for</span><span style="color: #0000ff;">="book in books"</span><span style="color: #ff0000;"> v-bind:book-name</span><span style="color: #0000ff;">="book.name"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>             <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> 这里也可以写默认slot内容 </span><span style="color: #008000;">--&gt;</span>
<span style="color: #008080;">13</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span> 
<span style="color: #008080;">17</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-list</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        props: {
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">            books: {
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">                type: Array,
</span><span style="color: #008080;">22</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">default</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">23</span>                     <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {};
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">                }
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#template</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">29</span>     
<span style="color: #008080;">30</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">31</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">32</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">33</span> <span style="background-color: #f5f5f5; color: #000000;">            books: [
</span><span style="color: #008080;">34</span> <span style="background-color: #f5f5f5; color: #000000;">                {name:</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">《Vue.js实战》</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">},
</span><span style="color: #008080;">35</span> <span style="background-color: #f5f5f5; color: #000000;">                {name:</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">《JavaScript语言精粹》</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">},
</span><span style="color: #008080;">36</span> <span style="background-color: #f5f5f5; color: #000000;">                {name:</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">《JavaScript高级程序设计》</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">}
</span><span style="color: #008080;">37</span> <span style="background-color: #f5f5f5; color: #000000;">            ]
</span><span style="color: #008080;">38</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">39</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">40</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>子组件<code>my-list</code>接收一个来自父级的<code>prop</code>数组<code>books</code>，并且将它在<code>name</code>为<code>book</code>的<code>slot</code>上使用<code>v-for</code>指令循环，同时暴露一个变量<code>bookName</code>。</p>
<p>如果你仔细揣摩上面的用法，你可能会产生这样的疑问：我直接在父组件用<code>v-for</code>不就好了吗？为什么还要绕一步，在子组件里面循环呢？<br />
的确，如果只是针对上面的示例，这样写是多此一举的。此例的用意主要是介绍作用域插槽的用法，并没有加入使用场景，而作用域插槽的适用场景就是既可以复用子组件的slot，又可以使slot内容不一致。<br />
如果上例还在其他组件内使用，<code>&lt;li&gt;</code>的内容渲染权是由使用者掌握的，而数据却可以通过临时变量(比如<code>props</code>)子组件内获取。</p>
<h3 id="toc_20">7.4.5 访问slot</h3>
<p>在Vue.js 1.x中，想要获取某个slot是比较麻烦的，需要用<code>v-el</code>间接获取。<br />
而Vue.js 2.x提供了用来访问被slot分发的内容的方法<code>$slots</code>，请看下面的示例：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h2 </span><span style="color: #ff0000;">slot</span><span style="color: #0000ff;">="header"</span><span style="color: #0000ff;">&gt;</span>标题<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>正文内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>更多的正文内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">slot</span><span style="color: #0000ff;">="footer"</span><span style="color: #0000ff;">&gt;</span>底部信息<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="template"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="header"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="header"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="main"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">18</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="footer"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">19</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">slot </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="footer"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">slot</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">20</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">21</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">22</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">23</span> 
<span style="color: #008080;">24</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#template</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">        mounted: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">28</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> header </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$slots.header;
</span><span style="color: #008080;">29</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> main </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$slots.main;
</span><span style="color: #008080;">30</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> footer </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$slots.footer;
</span><span style="color: #008080;">31</span> <span style="background-color: #f5f5f5; color: #000000;">            console.log(footer);
</span><span style="color: #008080;">32</span> <span style="background-color: #f5f5f5; color: #000000;">            console.log(footer[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">].elm.innerHTML);
</span><span style="color: #008080;">33</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">34</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">35</span>     
<span style="color: #008080;">36</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">37</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">38</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">39</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>通过<code>$slots</code>可以访问某个具名slot，<code>this.$slots.default</code>包括了所有没有被包含在具名slot中的节点。<br />
尝试编写代码，查看两个console打印的内容。</p>
<p><code>$slots</code>在业务中几乎用不到，在用<code>render</code>函数(进阶篇中将介绍)创建组件时会比较有用，但主要还是用于独立组件开发中。</p>
<h2 id="toc_21"><a name="menu-7-5"></a>7.5 组件高级用法</h2>
<p>本节会介绍组件的一些高级用法，这些用法在实际业务中不是很常用，但会独立组件开发时可能会用到。<br />
如果你感觉以上内容已经足骨完成你的业务开发了，可以跳过本节；如果你想继续探索Vue组件的奥秘，读完本节会对你有很大的启发。</p>
<h3 id="toc_22">7.5.1 递归组件</h3>
<p>组件在它的模板内可以递归地调用自己，只要给组件设置<code>name</code>的选项就可以了。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component </span><span style="color: #ff0000;">v-bind:count</span><span style="color: #0000ff;">="1"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="template"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="child"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component </span><span style="color: #ff0000;">v-bind:count</span><span style="color: #0000ff;">="count+1"</span><span style="color: #ff0000;"> v-if</span><span style="color: #0000ff;">="count&lt;3"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        name: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        props: {
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">            count: {
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">                type: Number,
</span><span style="color: #008080;">17</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">default</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #000000;">1</span>
<span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#template</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">22</span>     
<span style="color: #008080;">23</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">26</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>设置<code>name</code>后，在组件模板内就可以递归使用了。<br />
不过需要注意的是，必须给一个条件来限制递归数量，否则会抛出错误：<code>max stack size exceeded</code>。</p>
<p>组件递归使用可以用来开发一些具有未知层级关系的阻力组件，比如级联选择器和树形控件等。<br />
如图7-4和图7-5所示：<br />
<img class="mw_img_center" style="width: 250px; display: block; clear: both; margin: 0 auto;" src="./images/Vue.js 学习笔记 第7章 组件详解3.png" alt="" />￼</p>
<p><img class="mw_img_center" style="width: 200px; display: block; clear: both; margin: 0 auto;" src="./images/Vue.js 学习笔记 第7章 组件详解4.png" alt="" />￼</p>
<p>在实战篇里，我们会详细介绍级联选择器的实现。<br />
&nbsp;</p>
<h3 id="toc_23">7.5.2 内联模板</h3>
<p>组件的模板一般都是在<code>template</code>选项内自定义的，Vue提供了一个内联模板的功能，在使用组件时，给组件标签使用<code>inline-template</code>特性，组件就会把它的内容当做模板，而不是把它当内容分发，这让模板更灵活。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component </span><span style="color: #ff0000;">inline-template :data</span><span style="color: #0000ff;">="message"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>在父组件中定义了组件的模板<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>{{data}}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>{{msg}}<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span> 
<span style="color: #008080;">11</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        props: [</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">data</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">],
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">15</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">                msg: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">在子组件声明的数据</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">            };
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">20</span>     
<span style="color: #008080;">21</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">            message: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">在父组件声明的数据</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">27</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>渲染后的结果为：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span>在父组件中定义了组件的模板<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h2</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>在父组件声明的数据<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">5</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>在子组件声明的数据<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">6</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">7</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<h3 id="toc_24">7.5.3 动态组件</h3>
<p>Vue.js提供了一个特殊的元素<code>&lt;component&gt;</code>用来动态地挂载不同的组件，使用<code>is</code>特性来选择要挂载的组件。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> placeholder</span><span style="color: #0000ff;">="请输入组件名称: A/B/C"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">@click</span><span style="color: #0000ff;">="handleChangeView"</span><span style="color: #0000ff;">&gt;</span>确定切换<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">component </span><span style="color: #ff0000;">v-bind:is</span><span style="color: #0000ff;">="currentView"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        components: {
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">            comA: {
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">                template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;组件A&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">            },
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">            comB: {
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">                template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;组件B&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">            },
</span><span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">            comC: {
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">                template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;组件C&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">            currentView: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">comA</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">23</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">            handleChangeView: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">26</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> value </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.querySelector(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">input</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">).value;
</span><span style="color: #008080;">27</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.currentView </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">com</span><span style="background-color: #f5f5f5; color: #000000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> value;
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">29</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">30</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">31</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>动态地改变<code>currentView</code>的值就可以动态挂载组件了。<br />
也可以直接绑定在组件对象上：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">component </span><span style="color: #ff0000;">v-bind:is</span><span style="color: #0000ff;">="currentView"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> Home </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;p&gt;Welcome home!&lt;/p&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">    };
</span><span style="color: #008080;"> 9</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">            currentView: Home
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<h3 id="toc_25">7.5.4 异步组件</h3>
<p>当你的工程足够大，使用的组件足够多时，是时候考虑下性能的问题了，因为一开始把所有的组件都加载是没必要的一笔开销。<br />
好在Vue.js允许将组件定义为一个工厂函数，动态地解析组件。<br />
Vue.js值在组件需要渲染时触发工厂函数，并且把结果缓存起来，用于后面的再次渲染。<br />
例如下面的示例：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">child-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">child-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">(resolve, reject) {
</span><span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        window.setTimeout(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">            resolve({
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">                template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;我是异步渲染的&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">            });
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        }, </span><span style="background-color: #f5f5f5; color: #000000;">2000</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">13</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">16</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>工厂函数接收一个<code>resolve</code>回调，在收到从服务器下载的组件定义时调用。<br />
也可以调用<code>reject(reason)</code>指示加载失败。<br />
这里<code>setTimeout</code>只是为了演示异步，具体的下载逻辑可以自己决定，比如把组件配置写成一个对象配置，通过Ajax来请求，然后调用<code>resolve</code>传入配置选项。</p>
<p>在进阶篇里，我们还会介绍主流的打包编译工具webpack和.vue单文件的用法，更优雅地实现异步组件(路由)。</p>
<h2 id="toc_26"><a name="menu-7-6"></a>7.6 其他</h2>
<h3 id="toc_27">7.6.1 $nextTick</h3>
<p>我们先来看这样一个场景：<br />
有一个div，默认用<code>v-if</code>将它隐藏，点击一个按钮后，改变<code>v-if</code>的值，让它显示出来，同时拿到这个div的文本内容。<br />
如果<code>v-if</code>的值是<code>false</code>，直接去获取div的内容是获取不到的，因为此时div还没有被创建出来。<br />
那么应该在点击按钮后，改变<code>v-if</code>的值为<code>true</code>, div才会被创建，此时再去获取。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="div"</span><span style="color: #ff0000;"> v-if</span><span style="color: #0000ff;">="showDiv"</span><span style="color: #0000ff;">&gt;</span>这是一段文本<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">v-on:click</span><span style="color: #0000ff;">="getText"</span><span style="color: #0000ff;">&gt;</span>获取div内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">            showDiv: </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span>
<span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">            getText: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">14</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.showDiv </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">15</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> text </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">div</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">).innerHTML;
</span><span style="color: #008080;">16</span> <span style="background-color: #f5f5f5; color: #000000;">                console.log(text);
</span><span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">20</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>这段代码并不难理解，但是运行后在控制台会抛出一个错误：<code>Cannot read property 'innerHTML' of null</code>。意思就是获取不到div元素。这里就涉及Vue一个重要的概念：异步更新队列。</p>
<p>Vue在观察到数据变化时并不是直接更新DOM，从而避免不必要的计算和DOM操作。<br />
然后，在下一个事件循环tick中，Vue刷新队列并执行实际(已去重的)工作。<br />
所以如果你用一个for循环来动态改变数据100次，其实它只会应用最后一次改变，如果没有这种机制，DOM就要重绘100次，这固然是一个很大的开销。</p>
<p>Vue会根据当前浏览器环境优先使用原生的<code>Promise.then</code>和<code>MutationObserver</code>，如果都不支持，就会采用<code>setTimeout</code>代替。</p>
<p>知道了Vue异步更新DOM的原理，上面示例的报错也就不难理解了。<br />
事实上，在执行<code>this.showDiv=true</code>时，div仍然还是没有被创建出来，直到下一个Vue事件循环时，才开始创建。<br />
<code>$nextTick</code>就是用来知道什么时候DOM更新完成的，所以上面的示例代码需要修改为：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="div"</span><span style="color: #ff0000;"> v-if</span><span style="color: #0000ff;">="showDiv"</span><span style="color: #0000ff;">&gt;</span>这是一段文本<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">v-on:click</span><span style="color: #0000ff;">="getText"</span><span style="color: #0000ff;">&gt;</span>获取div内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span> 
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        data: {
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">            showDiv: </span><span style="background-color: #f5f5f5; color: #0000ff;">false</span>
<span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        },
</span><span style="color: #008080;">12</span> <span style="background-color: #f5f5f5; color: #000000;">        methods: {
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">            getText: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">14</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.showDiv </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">;
</span><span style="color: #008080;">15</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$nextTick(</span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;">16</span>                     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> text </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">div</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">).innerHTML;
</span><span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">                    console.log(text);
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">                });
</span><span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">21</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">22</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>这时再点击按钮，控制台就打印出div的内容&ldquo;这时一段文本了&rdquo;。</p>
<p>理论上，我们应该不用去主动操作DOM，因为Vue的核心思想就是数据驱动DOM，但在很多业务里，我们避免不了会使用一些第三方库，比如<a href="https://popper.js.org">popper.js</a>、<a href="http://idangero.us/swiper">swiper</a>等，这些基于原生JavaScript的库都有创建和更新及销毁的完整生命周期，与Vue配合使用时，就要利用好<code>$nextTick</code>。</p>
<h3 id="toc_28">7.6.2 X-Templates</h3>
<p>如果你没有使用webpack、gulp等工具，试想一下你的组件<code>template</code>的内容很冗长、复杂，如果都在JavaScript里拼接字符串，效率是很低的，因为不能像写HTML那样舒服。<br />
Vue提供了另一种定义模板的方式，在<code>&lt;script&gt;</code>标签里使用<code>text/x-template</code>类型，并且指定一个<code>id</code>，将这个<code>id</code>赋给<code>template</code>。示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">my-component</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/x-template"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="my-component"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>         <span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">div</span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">这是组件的内容</span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">div&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">    Vue.component(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, {
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#my-component</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">12</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">13</span> <span style="background-color: #f5f5f5; color: #000000;">        el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">14</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>在<code>&lt;script&gt;</code>标签里，你可以愉快地编写HTML代码，不用考虑执行等问题。</p>
<p>很多刚接触Vue开发的新手会非常喜欢这个功能，因为用它，再加上组件知识，就可以很轻松地完成交互相对复杂的页面和应用了。如果再配合一些构建工具(gulp)组织好代码结构，开发一些中小型产品是没有问题的。<br />
不过，Vue的初衷并不是滥用它，因为它将模板和组件的其他定义隔离了。<br />
在进阶篇里，我们会介绍如何使用webpack来编译.vue的单文件，从而优雅地解决HTML书写的问题。</p>
<h3 id="toc_29">7.6.3 手动挂载实例</h3>
<p>我们现在所创建的实例都是通过<code>new Vue()</code>的形式创建出来的。<br />
在一些非常特殊的情况下，我们需要动态地去创建Vue实例，Vue提供了<code>Vue.extend</code>和<code>$mount</code>两个方法来手动挂载一个实例。</p>
<p><code>Vue.extend</code>是基础Vue构造器，创建一个&ldquo;子类&rdquo;，参数是一个包含组件选项的对象。</p>
<p>如果Vue实例在实例化时没有收到<code>el</code>选项，它就处于&ldquo;未挂载&rdquo;状态，没有关联的DOM元素。<br />
可以使用<code>$mount()</code>手动地挂载一个未挂载的实例。<br />
这个方法返回实例自身，因而可以链式调用其他实例方法。<br />
示例代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="mount-div"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> MyComponent </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> Vue.extend({
</span><span style="color: #008080;"> 5</span> <span style="background-color: #f5f5f5; color: #000000;">        template: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">&lt;div&gt;Hello: {{name}}&lt;/div&gt;</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">        data: </span><span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;">() {
</span><span style="color: #008080;"> 7</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">                name: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">Jack</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">            };
</span><span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">    });
</span><span style="color: #008080;">12</span>     
<span style="color: #008080;">13</span>     <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> MyComponent().$mount(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#mount-div</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">);
</span><span style="color: #008080;">14</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>运行后，<code>id</code>为<code>mount-div</code>的div元素会被替换为组件<code>MyComponent</code>的<code>template</code>的内容：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>Hello: Jack<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>除了这种写法外，以下两种写法也是可以的：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">new</span> MyComponent().$mount("#mount-div"<span style="color: #000000;">);
</span><span style="color: #008080;">2</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 同上</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> MyComponent({
</span><span style="color: #008080;">4</span>     el: "#mount-div"
<span style="color: #008080;">5</span> <span style="color: #000000;">});
</span><span style="color: #008080;">6</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 或者,在文档之外渲染并且随后挂载</span>
<span style="color: #008080;">7</span> <span style="color: #0000ff;">var</span> component = <span style="color: #0000ff;">new</span><span style="color: #000000;"> MyComponent().$mount();
</span><span style="color: #008080;">8</span> document.getElementById("mount-div").appendChild(component.$el);</pre>
</div>
<p>&nbsp;</p>
<p>手动挂载实例(组件)是一种比较极端的高级用法，在业务中几乎用不到，只是开发一些复杂的独立组件时可能会使用，所以只做了解就好。</p>
<h2 id="toc_30"><a name="menu-7-7"></a>7.7 实战：两个常用组件的开发</h2>
<p>本节以组件知识为基础，整合指令、事件等前面两章的内容，开发两个业务中常用的组件，即数字输入框和标签页。</p>
<h3 id="toc_31">7.7.1 开发一个数字输入框组件</h3>
<p>数字输入框时对普通输入框的扩展，用来快捷输入一个标准的数字。<br />
如图7-6所示：<br />
<img class="mw_img_center" style="width: 250px; display: block; clear: both; margin: 0 auto;" src="./images/Vue.js 学习笔记 第7章 组件详解5.png" alt="" />￼</p>
<p>数字输入框只能输入数字，而且有两个快捷按钮，可以直接减1或加1.<br />
除此之外，还可以设置初始值、最大值、最小值，在数值改变时，触发一个自定义事件来通知父组件。</p>
<p>了解了基本需求后，我们先定义目录文件：</p>
<ul>
<li>index.html 入口页</li>
<li>input-number.js 数字输入框组件</li>
<li>index.js 根实例</li>

</ul>
<blockquote>
<p>因为该示例是以交互功能为主，所以就不写CSS美化样式了。</p>

</blockquote>
<p>首先写入基本的结构代码，初始化项目。</p>
<h4 id="toc_32">index.html:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="zh"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">http-equiv</span><span style="color: #0000ff;">="X-UA-Compatible"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="ie=edge"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>数字输入框组件<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>     
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="vue.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="input-number.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="index.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_33">index.js:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">var</span> app = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Vue({
</span><span style="color: #008080;">2</span>     el: "#app"
<span style="color: #008080;">3</span> });</pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_34">input-number.js:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("input-number"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        &lt;div class='input-number'&gt; \
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">            \
</span><span style="color: #008080;"> 5</span>         &lt;/div&gt;"<span style="color: #000000;">,
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    props: {
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">        max: {
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            type: Number,
</span><span style="color: #008080;"> 9</span>             <span style="color: #0000ff;">default</span><span style="color: #000000;">: Infinity
</span><span style="color: #008080;">10</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">11</span> <span style="color: #000000;">        min: {
</span><span style="color: #008080;">12</span> <span style="color: #000000;">            type: Number,
</span><span style="color: #008080;">13</span>             <span style="color: #0000ff;">default</span>: -<span style="color: #000000;">Infinity
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">15</span> <span style="color: #000000;">        value: {
</span><span style="color: #008080;">16</span> <span style="color: #000000;">            type: Number,
</span><span style="color: #008080;">17</span>             <span style="color: #0000ff;">default</span>: 0
<span style="color: #008080;">18</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">19</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">20</span> });</pre>
</div>
<p>&nbsp;</p>
<p>该示例的主角是<code>input-number.js</code>，所有的组件配置都在这里面定义。<br />
现在<code>template</code>里面定义了组件的根节点，因为是独立组件，所以应该对每个prop进行校验。<br />
这里面根据需求有最大值、最小值、默认值(也就是绑定值)3个prop，<code>max</code>和<code>min</code>都是数字类型，默认值是正无限大和负无限大；<code>value</code>也是数字类型，默认值是0。</p>
<p>接下来，我们先在父组件引入<code>input-number</code>组件，并给它一个默认值5，最大值10，最小值0。</p>
<h4 id="toc_35">index.js:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">var</span> app = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Vue({
</span><span style="color: #008080;">2</span>     el: "#app"<span style="color: #000000;">,
</span><span style="color: #008080;">3</span> <span style="color: #000000;">    data: {
</span><span style="color: #008080;">4</span>         value: 5
<span style="color: #008080;">5</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">6</span> });</pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_36">index.html:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input-number </span><span style="color: #ff0000;">v-model</span><span style="color: #0000ff;">="value"</span><span style="color: #ff0000;"> :max</span><span style="color: #0000ff;">="10"</span><span style="color: #ff0000;"> :min</span><span style="color: #0000ff;">="0"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">input-number</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">3</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><code>value</code>是一个关键的绑定至，所以用了<code>v-model</code>，这样既优雅地实现了双向绑定，也让API看起来很合理。<br />
大多数的表单类组件都应该有一个<code>v-model</code>，比如输入框、单选框、多选框、下拉选择器等。</p>
<p>剩余的代码量就都聚焦到了<code>input-number.js</code>上。</p>
<p>我们之前介绍过，Vue组件是单向数据流，所以无法从组件内部直接修改prop:<code>value</code>的值。<br />
解决办法也介绍过，就是给组件声明一个<code>data</code>，默认引用<code>value</code>的值，然后在组件内部维护这个<code>data</code>：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> Vue.component("input-number"<span style="color: #000000;">, {
</span><span style="color: #008080;">2</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> ...</span>
<span style="color: #008080;">3</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">4</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">5</span>             currentValue: <span style="color: #0000ff;">this</span><span style="color: #000000;">.value
</span><span style="color: #008080;">6</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">7</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">8</span> });</pre>
</div>
<p>&nbsp;</p>
<p>这样只解决了初始化时引用父组件<code>value</code>的问题。<br />
但是如果从父组件修改了<code>value</code>，input-number组件的<code>currentValue</code>也要一起更新。<br />
为了实现这个功能，我们需要用到一个新的概念，监听(watch)。</p>
<p><code>watch</code>选项用来监听某个prop或data的改变，当他们发生变化时，就会触发<code>watch</code>配置的函数，从而完成我们的业务逻辑。<br />
在本例中，我们要监听两个量：<code>value</code>和<code>currentValue</code>。<br />
监听<code>value</code>是要知晓从父组件修改了<code>value</code>，监听<code>currentValue</code>是为了当<code>currentValue</code>改变时，更新<code>value</code>。<br />
相关代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("input-number"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> ...</span>
<span style="color: #008080;"> 3</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 5</span>             currentValue: <span style="color: #0000ff;">this</span><span style="color: #000000;">.value
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    watch: {
</span><span style="color: #008080;"> 9</span>         currentValue: <span style="color: #0000ff;">function</span><span style="color: #000000;">(val) {
</span><span style="color: #008080;">10</span>             <span style="color: #0000ff;">this</span>.$emit("input"<span style="color: #000000;">, val);
</span><span style="color: #008080;">11</span>             <span style="color: #0000ff;">this</span>.$emit("on-change"<span style="color: #000000;">, val);
</span><span style="color: #008080;">12</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">13</span>         value: <span style="color: #0000ff;">function</span><span style="color: #000000;">(val) {
</span><span style="color: #008080;">14</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.updateValue(val);
</span><span style="color: #008080;">15</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">16</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    methods: {
</span><span style="color: #008080;">18</span>         updateValue: <span style="color: #0000ff;">function</span><span style="color: #000000;">(val) {
</span><span style="color: #008080;">19</span>             <span style="color: #0000ff;">if</span> (val &gt; <span style="color: #0000ff;">this</span><span style="color: #000000;">.max) {
</span><span style="color: #008080;">20</span>                 val = <span style="color: #0000ff;">this</span><span style="color: #000000;">.max;
</span><span style="color: #008080;">21</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span>             <span style="color: #0000ff;">if</span> (val &lt; <span style="color: #0000ff;">this</span><span style="color: #000000;">.min) {
</span><span style="color: #008080;">24</span>                 val = <span style="color: #0000ff;">this</span><span style="color: #000000;">.min;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">26</span> 
<span style="color: #008080;">27</span>             <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> val;
</span><span style="color: #008080;">28</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">29</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">30</span>     mounted: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">31</span>         <span style="color: #0000ff;">this</span>.updateValue(<span style="color: #0000ff;">this</span><span style="color: #000000;">.value);
</span><span style="color: #008080;">32</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">33</span> });</pre>
</div>
<p>&nbsp;</p>
<p>从父组件传递过来的<code>value</code>有可能是不符合当前条件的(大于max或小于min)，所以在选项<code>methods</code>里写了一个方法<code>updateValue</code>，用来过滤出一个正确的<code>currentValue</code>。</p>
<p><code>watch</code>监听的数据的回调函数有2个参数可用，第一个是新的智，第二个是旧的值，这里没有太复杂的逻辑，就只用了第一个参数。<br />
再回调函数里，<code>this</code>是指向当前组件实例的，所以可以直接调用<code>this.updateValue()</code>，因为Vue代理了<code>props</code>、<code>data</code>、<code>computed</code>及<code>methods</code>。</p>
<p>监听<code>currentValue</code>的回调里：</p>
<ul>
<li><code>this.$emit("input", val)</code>是在使用<code>v-model</code>时改变<code>value</code>的；</li>
<li><code>this.$emit("on-change", val)</code>是触发自定义事件<code>on-change</code>，用于告知父组件数字输入框的值有所改变(示例中没有使用该事件〉。</li>

</ul>
<p>在生命周期<code>mounted</code>钩子里也调用了<code>updateValue()</code>方法，是因为第一次初始化时，也对<code>value</code>进行了过滤。<br />
这里也有另一种写法，在<code>data</code>选项返回对象前进行过滤：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("input-number"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> ...</span>
<span style="color: #008080;"> 3</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">var</span> val = <span style="color: #0000ff;">this</span><span style="color: #000000;">.value;
</span><span style="color: #008080;"> 5</span>         
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">if</span> (val &gt; <span style="color: #0000ff;">this</span><span style="color: #000000;">.max) {
</span><span style="color: #008080;"> 7</span>             val = <span style="color: #0000ff;">this</span><span style="color: #000000;">.max;
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        }
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span>         <span style="color: #0000ff;">if</span> (val &lt; <span style="color: #0000ff;">this</span><span style="color: #000000;">.min) {
</span><span style="color: #008080;">11</span>             val = <span style="color: #0000ff;">this</span><span style="color: #000000;">.min;
</span><span style="color: #008080;">12</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">13</span>         
<span style="color: #008080;">14</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">15</span> <span style="color: #000000;">          currentValue: val
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">17</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">18</span> });</pre>
</div>
<p>&nbsp;</p>
<p>实现的效果是一样的。</p>
<p>最后剩余的就是补全模板<code>template</code>，内容是一个输入框和两个按钮。<br />
相关代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> isValueNumber(value) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">return</span> (/(^-?[0-9]+\.(1)\d+$)|(^-?[1-9][0-9]*$)|(^-?0{1})/.test(value + ""<span style="color: #000000;">));
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> Vue.component("input-number"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 6</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> ...</span>
<span style="color: #008080;"> 7</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        &lt;div class='input-number'&gt; \
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">            &lt;input type='text' :value='currentValue' @change='handleChange'/&gt; \
</span><span style="color: #008080;">10</span> <span style="color: #000000;">            &lt;button @click='handleDown' :disabled='currentValue&lt;=min'&gt;-&lt;/button&gt; \
</span><span style="color: #008080;">11</span> <span style="color: #000000;">            &lt;button @click='handleUp' :disabled='currentValue&gt;=max'&gt;+&lt;/button&gt; \
</span><span style="color: #008080;">12</span>         &lt;/div&gt;"<span style="color: #000000;">,
</span><span style="color: #008080;">13</span> <span style="color: #000000;">    methods: {
</span><span style="color: #008080;">14</span>         handleDown: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">15</span>             <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>.currentValue &lt;= <span style="color: #0000ff;">this</span><span style="color: #000000;">.min) {
</span><span style="color: #008080;">16</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">17</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">18</span>             <span style="color: #0000ff;">this</span>.currentValue -= 1<span style="color: #000000;">;
</span><span style="color: #008080;">19</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">20</span>         handleUp: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">21</span>             <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>.currentValue &gt;= <span style="color: #0000ff;">this</span><span style="color: #000000;">.max) {
</span><span style="color: #008080;">22</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">23</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">24</span>             <span style="color: #0000ff;">this</span>.currentValue += 1<span style="color: #000000;">;
</span><span style="color: #008080;">25</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">26</span>         handleChange: <span style="color: #0000ff;">function</span><span style="color: #000000;">(event) {
</span><span style="color: #008080;">27</span>             <span style="color: #0000ff;">var</span> val =<span style="color: #000000;"> event.target.value.trim();
</span><span style="color: #008080;">28</span>             <span style="color: #0000ff;">var</span> max = <span style="color: #0000ff;">this</span><span style="color: #000000;">.max;
</span><span style="color: #008080;">29</span>             <span style="color: #0000ff;">var</span> min = <span style="color: #0000ff;">this</span><span style="color: #000000;">.min;
</span><span style="color: #008080;">30</span> 
<span style="color: #008080;">31</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (isValueNumber(val)) {
</span><span style="color: #008080;">32</span>                 val =<span style="color: #000000;"> Number(val);
</span><span style="color: #008080;">33</span>                 <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> val;
</span><span style="color: #008080;">34</span>                 <span style="color: #0000ff;">if</span> (val &gt;<span style="color: #000000;"> max) {
</span><span style="color: #008080;">35</span>                     <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> max;
</span><span style="color: #008080;">36</span>                 } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (val &lt;<span style="color: #000000;"> min) {
</span><span style="color: #008080;">37</span>                     <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> min;
</span><span style="color: #008080;">38</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">39</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">40</span>                 event.target.value = <span style="color: #0000ff;">this</span><span style="color: #000000;">.currentValue;
</span><span style="color: #008080;">41</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">42</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">43</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">44</span> });</pre>
</div>
<p>&nbsp;</p>
<p>input绑定了数据<code>currentValue</code>和原生的change事件，在句柄<code>handleChange</code>函数中，判断了当前输入的是否是数字。<br />
注意，这里绑定的<code>currentValue</code>也是单向数据流，并没有用<code>v-model</code>，所以在输入时，<code>currentValue</code>的值并没有实时改变。<br />
如果输入的不是数字(比如英文和汉字等〉，就将输入的内容重置为之前的<code>currentValue。<br />
如果输入的是符合要求的数字，就把输入的值赋给</code>currentValue`。</p>
<p>数字输入框组件的核心逻辑就是这些。<br />
回顾一下我们设计一个通用组件的思路，首先，在写代码前一定要明确需求，然后规划好API。<br />
一个Vue组件的API只来自<code>props</code>、<code>events</code>和<code>slots</code>，确定好这3部分的命名、规则，剩下的逻辑即使第一版没有做好，后续也可以迭代完善。但是API如果没有设计好，后续再改对使用者成本就很大了。</p>
<p>完整的示例代码如下：</p>
<h4 id="toc_37">index.html:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="zh"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">http-equiv</span><span style="color: #0000ff;">="X-UA-Compatible"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="ie=edge"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>数字输入框组件<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input-number </span><span style="color: #ff0000;">v-model</span><span style="color: #0000ff;">="value"</span><span style="color: #ff0000;"> :max</span><span style="color: #0000ff;">="10"</span><span style="color: #ff0000;"> :min</span><span style="color: #0000ff;">="0"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">input-number</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>     
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="vue.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="input-number.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="index.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">18</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_38">index.js:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">var</span> app = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Vue({
</span><span style="color: #008080;">2</span>     el: "#app"<span style="color: #000000;">,
</span><span style="color: #008080;">3</span> <span style="color: #000000;">    data: {
</span><span style="color: #008080;">4</span>         value: 5
<span style="color: #008080;">5</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">6</span> });</pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_39">input-number.js:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> isValueNumber(value) {
</span><span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">return</span> (/(^-?[0-9]+\.(1)\d+$)|(^-?[1-9][0-9]*$)|(^-?0{1})/.test(value + ""<span style="color: #000000;">));
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span> Vue.component("input-number"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 6</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">        &lt;div class='input-number'&gt; \
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">            &lt;input type='text' :value='currentValue' @change='handleChange'/&gt; \
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">            &lt;button @click='handleDown' :disabled='currentValue&lt;=min'&gt;-&lt;/button&gt; \
</span><span style="color: #008080;">10</span> <span style="color: #000000;">            &lt;button @click='handleUp' :disabled='currentValue&gt;=max'&gt;+&lt;/button&gt; \
</span><span style="color: #008080;">11</span>         &lt;/div&gt;"<span style="color: #000000;">,
</span><span style="color: #008080;">12</span> <span style="color: #000000;">    props: {
</span><span style="color: #008080;">13</span> <span style="color: #000000;">        max: {
</span><span style="color: #008080;">14</span> <span style="color: #000000;">            type: Number,
</span><span style="color: #008080;">15</span>             <span style="color: #0000ff;">default</span><span style="color: #000000;">: Infinity
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">17</span> <span style="color: #000000;">        min: {
</span><span style="color: #008080;">18</span> <span style="color: #000000;">            type: Number,
</span><span style="color: #008080;">19</span>             <span style="color: #0000ff;">default</span>: -<span style="color: #000000;">Infinity
</span><span style="color: #008080;">20</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">21</span> <span style="color: #000000;">        value: {
</span><span style="color: #008080;">22</span> <span style="color: #000000;">            type: Number,
</span><span style="color: #008080;">23</span>             <span style="color: #0000ff;">default</span>: 0
<span style="color: #008080;">24</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">25</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">26</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">27</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">28</span>             currentValue: <span style="color: #0000ff;">this</span><span style="color: #000000;">.value
</span><span style="color: #008080;">29</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">30</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">31</span> <span style="color: #000000;">    watch: {
</span><span style="color: #008080;">32</span>         currentValue: <span style="color: #0000ff;">function</span><span style="color: #000000;">(val) {
</span><span style="color: #008080;">33</span>             <span style="color: #0000ff;">this</span>.$emit("input"<span style="color: #000000;">, val);
</span><span style="color: #008080;">34</span>             <span style="color: #0000ff;">this</span>.$emit("on-change"<span style="color: #000000;">, val);
</span><span style="color: #008080;">35</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">36</span>         value: <span style="color: #0000ff;">function</span><span style="color: #000000;">(val) {
</span><span style="color: #008080;">37</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.updateValue(val);
</span><span style="color: #008080;">38</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">39</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">40</span> <span style="color: #000000;">    methods: {
</span><span style="color: #008080;">41</span>         handleDown: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">42</span>             <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>.currentValue &lt;= <span style="color: #0000ff;">this</span><span style="color: #000000;">.min) {
</span><span style="color: #008080;">43</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">44</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">45</span>             <span style="color: #0000ff;">this</span>.currentValue -= 1<span style="color: #000000;">;
</span><span style="color: #008080;">46</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">47</span>         handleUp: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">48</span>             <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">this</span>.currentValue &gt;= <span style="color: #0000ff;">this</span><span style="color: #000000;">.max) {
</span><span style="color: #008080;">49</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">50</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">51</span>             <span style="color: #0000ff;">this</span>.currentValue += 1<span style="color: #000000;">;
</span><span style="color: #008080;">52</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">53</span>         handleChange: <span style="color: #0000ff;">function</span><span style="color: #000000;">(event) {
</span><span style="color: #008080;">54</span>             <span style="color: #0000ff;">var</span> val =<span style="color: #000000;"> event.target.value.trim();
</span><span style="color: #008080;">55</span>             <span style="color: #0000ff;">var</span> max = <span style="color: #0000ff;">this</span><span style="color: #000000;">.max;
</span><span style="color: #008080;">56</span>             <span style="color: #0000ff;">var</span> min = <span style="color: #0000ff;">this</span><span style="color: #000000;">.min;
</span><span style="color: #008080;">57</span> 
<span style="color: #008080;">58</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (isValueNumber(val)) {
</span><span style="color: #008080;">59</span>                 val =<span style="color: #000000;"> Number(val);
</span><span style="color: #008080;">60</span>                 <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> val;
</span><span style="color: #008080;">61</span>                 <span style="color: #0000ff;">if</span> (val &gt;<span style="color: #000000;"> max) {
</span><span style="color: #008080;">62</span>                     <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> max;
</span><span style="color: #008080;">63</span>                 } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (val &lt;<span style="color: #000000;"> min) {
</span><span style="color: #008080;">64</span>                     <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> min;
</span><span style="color: #008080;">65</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">66</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">67</span>                 event.target.value = <span style="color: #0000ff;">this</span><span style="color: #000000;">.currentValue;
</span><span style="color: #008080;">68</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">69</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">70</span>         updateValue: <span style="color: #0000ff;">function</span><span style="color: #000000;">(val) {
</span><span style="color: #008080;">71</span>             <span style="color: #0000ff;">if</span> (val &gt; <span style="color: #0000ff;">this</span><span style="color: #000000;">.max) {
</span><span style="color: #008080;">72</span>                 val = <span style="color: #0000ff;">this</span><span style="color: #000000;">.max;
</span><span style="color: #008080;">73</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">74</span> 
<span style="color: #008080;">75</span>             <span style="color: #0000ff;">if</span> (val &lt; <span style="color: #0000ff;">this</span><span style="color: #000000;">.min) {
</span><span style="color: #008080;">76</span>                 val = <span style="color: #0000ff;">this</span><span style="color: #000000;">.min;
</span><span style="color: #008080;">77</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">78</span> 
<span style="color: #008080;">79</span>             <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> val;
</span><span style="color: #008080;">80</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">81</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">82</span>     mounted: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">83</span>         <span style="color: #0000ff;">this</span>.updateValue(<span style="color: #0000ff;">this</span><span style="color: #000000;">.value);
</span><span style="color: #008080;">84</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">85</span> });</pre>
</div>
<p>&nbsp;</p>
<ul>
<li><strong>练习1：</strong> 在输入框聚焦时，增加对键盘上下键的支持，相当于加1和减1；</li>
<li><strong>练习2：</strong> 增加一个控制步伐的prop:step，比如设置为10，点击加号按钮，一次增加10。</li>
</ul>
<h3 id="toc_40">7.7.2 开发一个标签组件</h3>
<p>本小节将开发一个比较有挑战的组件：标签页组件。<br />
标签页(即选项卡切换组件)是网页和布局中经常用到的元素，常用于平级区域大块内容的收纳和展现。<br />
如图7-7所示：<br />
<img class="mw_img_center" style="width: 200px; display: block; clear: both; margin: 0 auto;" src="./images/Vue.js 学习笔记 第7章 组件详解6.png" alt="" />￼</p>
<p>根据上个示例的经验，我们先分析业务需求，制定出API，这样不至于一上来就无从下手。</p>
<p>每个标签页的主体内容肯定是由使用组件的父级控制的，所以这部分是一个slot，而且slot的数量决定了标签切换按钮的数量。<br />
假设我们有3个标签页，点击每个标签按钮时，另外两个标签对应的slot应该被隐藏。<br />
一般这个时候，比较容易想到的解决办法是，在slot里写3个div，在接收到切换通知时，显示和隐藏相关div。<br />
这样设计没有问题，只不过提现不出组件的价值来，因为我们还是一些了一些与业务无关的业务逻辑，而这部分逻辑最好组件本身帮忙处理了，我们只用聚焦在slot内容本身，这才是我们业务最相关的。<br />
这种情况下，我们在定义一个子组件panel，嵌套在标签页组件tabs里，我们的业务代码都放在panel的slot内，而3个panel组件作为整体成为tabs的slot。</p>
<p>由于tabs和panel两个组件是分离的，但是tabs组件上的标题应该由panel组件来定义，因为slot是卸载panel里，因此在组件初始化(及标签标题动态改变)时，tabs要从panel里获取标题，并保存起来，自己使用。</p>
<p>确定好了结构，我们先创建所需的文件：</p>
<ul>
<li>index.html 入口页</li>
<li>style.css 样式表</li>
<li>tabs.js 标签页外层的组件 tabs</li>
<li>panel.js 标签页嵌套的组件 panel</li>

</ul>
<p>先初始化各个文件：</p>
<h4 id="toc_41">index.html:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="zh"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">http-equiv</span><span style="color: #0000ff;">="X-UA-Compatible"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="ie=edge"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>标签页组件<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="style.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span> 
<span style="color: #008080;">13</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="vue.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="panel.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="tabs.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">                el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">            });
</span><span style="color: #008080;">20</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">21</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">22</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_42">tabs.js:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("tabs"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        &lt;div class='tabs'&gt; \
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">            &lt;div class='tabs-bar'&gt; \
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">                &lt;!-- 标签页标题，这里要用v-for --&gt; \
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">            &lt;/div&gt; \
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">            &lt;div class='tabs-content'&gt; \
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">                &lt;!-- 这里的slot就是嵌套的panel --&gt; \
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">                &lt;slot&gt;&lt;/slot&gt; \
</span><span style="color: #008080;">10</span> <span style="color: #000000;">            &lt;/div&gt; \
</span><span style="color: #008080;">11</span>         &lt;/div&gt;"
<span style="color: #008080;">12</span> });</pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_43">panel.js</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> Vue.component("panel"<span style="color: #000000;">, {
</span><span style="color: #008080;">2</span>     name: "panel"<span style="color: #000000;">,
</span><span style="color: #008080;">3</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;">4</span> <span style="color: #000000;">        &lt;div class='panel'&gt; \
</span><span style="color: #008080;">5</span> <span style="color: #000000;">            &lt;slot&gt;&lt;/slot&gt; \
</span><span style="color: #008080;">6</span>         &lt;/div&gt;"
<span style="color: #008080;">7</span> });</pre>
</div>
<p>&nbsp;</p>
<p>panel需要控制标签页内容的显示与隐藏。<br />
设置一个data:<code>show</code>，并且用<code>v-show</code>指令来控制元素：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("panel"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     name: "panel"<span style="color: #000000;">,
</span><span style="color: #008080;"> 3</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        &lt;div class='panel' v-show='show'&gt; \
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">            &lt;slot&gt;&lt;/slot&gt; \
</span><span style="color: #008080;"> 6</span>         &lt;/div&gt;"<span style="color: #000000;">,
</span><span style="color: #008080;"> 7</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 9</span>             show: <span style="color: #0000ff;">true</span>
<span style="color: #008080;">10</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">12</span> });</pre>
</div>
<p>&nbsp;</p>
<p>当点击到这个panel对应的标签页标题按钮时，此panel的<code>show</code>值设置为<code>true</code>，否则应该是<code>false</code>。<br />
这步操作是在tabs组件完成的，我们稍后再介绍。</p>
<p>既然要单击对应的标签页标题按钮，那应该有一个唯一的值来标识这个panel，我们可以设置一个prop:<code>name</code>让用户来设置，但它不是必须的，如果使用者不设置，可以默认从0开始自动设置，这不操作仍然是tabs执行的，因为panel本身并不知道自己是第几个。<br />
除了<code>name</code>，还需要标签页标题的prop:<code>label</code>，tabs组件需要将它显示在标签页标题里。<br />
这部分代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #000000;">props: {
</span><span style="color: #008080;">2</span> <span style="color: #000000;">    name: {
</span><span style="color: #008080;">3</span> <span style="color: #000000;">        type: String
</span><span style="color: #008080;">4</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">5</span> <span style="color: #000000;">    label: {
</span><span style="color: #008080;">6</span> <span style="color: #000000;">        type: String,
</span><span style="color: #008080;">7</span>         <span style="color: #0000ff;">default</span>: ""
<span style="color: #008080;">8</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">9</span> }</pre>
</div>
<p>&nbsp;</p>
<p>上面的prop:<code>label</code>用户是可以动态调整的，所以在panel初始化以及<code>label</code>更新时，都要通知父组件也更新，因为是独立组件，所以不能依赖像bus.js或vuex这样的状态管理办法，我们可以直接通过<code>this.$parent</code>访问tabs组件的实例来调用它的方法更新标题，该方法暂定为<code>updateNav</code>。<br />
注意，在业务中尽可能不要使用<code>$parent</code>来操作父链，这种方法适合于标签页这样的独立组件。<br />
这部分代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #000000;">methods: {
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    updateNav() {
</span><span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.$parent.updateNav();
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">},
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">watch: {
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    label() {
</span><span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.updateNav();
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">10</span> <span style="color: #000000;">},
</span><span style="color: #008080;">11</span> <span style="color: #000000;">mounted() {
</span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">this</span><span style="color: #000000;">.updateNav();
</span><span style="color: #008080;">13</span> }</pre>
</div>
<p>&nbsp;</p>
<p>在生命周期<code>mounted</code>，也就是panel初始化时，调用一遍tabs的<code>updateNav</code>方法。<br />
同时监听了prop:<code>label</code>，在<code>label</code>更新时，同样调用。</p>
<p>剩余任务就是完成tabs.js组件。</p>
<p>首先需要把panel组件设置的标题动态渲染出来，也就是当panel触发tabs的<code>updateNav</code>方法时，更新标题内容。<br />
我们先看一下这部分的代码：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("tabs"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> ...</span>
<span style="color: #008080;"> 3</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 5</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 用于渲染tabs的标题</span>
<span style="color: #008080;"> 6</span> <span style="color: #000000;">            navList: []
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">        };
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    },
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    methods: {
</span><span style="color: #008080;">10</span> <span style="color: #000000;">        getTabs() {
</span><span style="color: #008080;">11</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 通过遍历子组件，得到所有的panel组件</span>
<span style="color: #008080;">12</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.$children.filter(<span style="color: #0000ff;">function</span><span style="color: #000000;">(item) {
</span><span style="color: #008080;">13</span>                 <span style="color: #0000ff;">return</span> item.$options.name === "panel"<span style="color: #000000;">;
</span><span style="color: #008080;">14</span> <span style="color: #000000;">            });
</span><span style="color: #008080;">15</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        updateNav() {
</span><span style="color: #008080;">17</span>             <span style="color: #0000ff;">this</span>.navList =<span style="color: #000000;"> [];
</span><span style="color: #008080;">18</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 设置对this的引用，在function回调里，this指向的并不是Vue实例</span>
<span style="color: #008080;">19</span>             <span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">20</span>             <span style="color: #0000ff;">this</span>.getTabs().forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(panel, index) {
</span><span style="color: #008080;">21</span> <span style="color: #000000;">                _this.navList.push({
</span><span style="color: #008080;">22</span> <span style="color: #000000;">                    label: panel.label,
</span><span style="color: #008080;">23</span>                     name: panel.name ||<span style="color: #000000;"> index
</span><span style="color: #008080;">24</span> <span style="color: #000000;">                });
</span><span style="color: #008080;">25</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 如果没有给panel设置name，默认设置它的索引</span>
<span style="color: #008080;">26</span>                 <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">panel.name) {
</span><span style="color: #008080;">27</span>                     panel.name =<span style="color: #000000;"> index;
</span><span style="color: #008080;">28</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">29</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 设置当前选中的tab的索引，在后面介绍</span>
<span style="color: #008080;">30</span>                 <span style="color: #0000ff;">if</span> (index === 0<span style="color: #000000;">) {
</span><span style="color: #008080;">31</span>                     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">_this.currentValue) {
</span><span style="color: #008080;">32</span>                         _this.currentValue = panel.name ||<span style="color: #000000;"> index;
</span><span style="color: #008080;">33</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">34</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">35</span> <span style="color: #000000;">            });
</span><span style="color: #008080;">36</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">37</span> <span style="color: #000000;">        updateStatus() {
</span><span style="color: #008080;">38</span>             <span style="color: #0000ff;">var</span> tabs = <span style="color: #0000ff;">this</span><span style="color: #000000;">.getTabs();
</span><span style="color: #008080;">39</span>             <span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">40</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 显示当前选中的tab对应的panel组件，隐藏没有选中的</span>
<span style="color: #008080;">41</span>             tabs.forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(tab) {
</span><span style="color: #008080;">42</span>                 <span style="color: #0000ff;">return</span> tab.show = tab.name ===<span style="color: #000000;"> _this.currentValue;
</span><span style="color: #008080;">43</span> <span style="color: #000000;">            });
</span><span style="color: #008080;">44</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">45</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">46</span> });</pre>
</div>
<p>&nbsp;</p>
<p><code>getTabs</code>是一个公用的方法，使用<code>this.$children</code>来拿到所有的panel组件实例。</p>
<p>需要注意的是，在<code>methods</code>里使用了有function回调的方法时(例如遍历数组的方法<code>forEach</code>)，在回调内的<code>this</code>不再执行当前的Vue实例，也就是tabs组件本身，所以要在外层设置一个<code>_this=this</code>的局部变量来间接使用<code>this</code>。<br />
如果你熟悉ES2015，也可以直接使用箭头函数<code>=&gt;</code>，我们会在实战篇里介绍相关的用法。</p>
<p>遍历了每一个panel组件后，把它的<code>label</code>和<code>name</code>提取出来，构成一个Object并添加到数据<code>navList</code>数组里，后面我们会在<code>template</code>里用到它。</p>
<p>设置完<code>navList</code>数组后，我们调用了<code>updateStatus</code>方法，又将panel组件遍历了以便，不过这时是为了将当前选中的tab对应的panel组件内容显示出来，把没有选中的隐藏掉。<br />
因为在上一步操作里，我们有可能需要设置<code>currentValue</code>来标识当前选中项的<code>name</code>(在用户没有设置<code>value</code>时，才会自动设置)，所以必须要遍历2次才可以。</p>
<p>拿到<code>navList</code>后，就需要对它用<code>v-for</code>指令把tab的标题渲染出来，并且判断每个tab当前的状态。<br />
这部分代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("tabs"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        &lt;div class='tabs'&gt; \
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">            &lt;div class='tabs-bar'&gt; \
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">                &lt;div :class='tabCls(item)' v-for='(item,index) in navList' @click='handleChange(index)'&gt;{{item.label}}&lt;/div&gt; \
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">            &lt;/div&gt; \
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">            &lt;div class='tabs-content'&gt; \
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">                &lt;slot&gt;&lt;/slot&gt; \
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">            &lt;/div&gt; \
</span><span style="color: #008080;">10</span>         &lt;/div&gt;"<span style="color: #000000;">,
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    props: {
</span><span style="color: #008080;">12</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 这里的value是为了可以使用v-model</span>
<span style="color: #008080;">13</span> <span style="color: #000000;">        value: {
</span><span style="color: #008080;">14</span> <span style="color: #000000;">            type: [String, Number]
</span><span style="color: #008080;">15</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">16</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">17</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">18</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">19</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 因为不能修改value，所以复制一份自己维护</span>
<span style="color: #008080;">20</span>             currentValue: <span style="color: #0000ff;">this</span><span style="color: #000000;">.value,
</span><span style="color: #008080;">21</span> <span style="color: #000000;">            navList: []
</span><span style="color: #008080;">22</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">23</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">24</span> <span style="color: #000000;">    methods: {
</span><span style="color: #008080;">25</span>         tabCls: <span style="color: #0000ff;">function</span><span style="color: #000000;">(item) {
</span><span style="color: #008080;">26</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> [
</span><span style="color: #008080;">27</span>                 "tabs-tab"<span style="color: #000000;">,
</span><span style="color: #008080;">28</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">29</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 给当前选中的tab加一个class</span>
<span style="color: #008080;">30</span>                     "tabs-tab-active": item.name === <span style="color: #0000ff;">this</span><span style="color: #000000;">.currentValue
</span><span style="color: #008080;">31</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">32</span> <span style="color: #000000;">            ];
</span><span style="color: #008080;">33</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">34</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 点击tab标题时触发</span>
<span style="color: #008080;">35</span>         handleChange: <span style="color: #0000ff;">function</span><span style="color: #000000;">(index) {
</span><span style="color: #008080;">36</span>             <span style="color: #0000ff;">var</span> nav = <span style="color: #0000ff;">this</span><span style="color: #000000;">.navList[index];
</span><span style="color: #008080;">37</span>             <span style="color: #0000ff;">var</span> name =<span style="color: #000000;"> nav.name;
</span><span style="color: #008080;">38</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 改变当前选中的tab，并触发下面的watch</span>
<span style="color: #008080;">39</span>             <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> name;
</span><span style="color: #008080;">40</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 更新value</span>
<span style="color: #008080;">41</span>             <span style="color: #0000ff;">this</span>.$emit("input"<span style="color: #000000;">, name);
</span><span style="color: #008080;">42</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 触发一个自定义事件，供父级使用</span>
<span style="color: #008080;">43</span>             <span style="color: #0000ff;">this</span>.$emit("on-click"<span style="color: #000000;">, name);
</span><span style="color: #008080;">44</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">45</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">46</span> <span style="color: #000000;">    watch: {
</span><span style="color: #008080;">47</span>         value: <span style="color: #0000ff;">function</span><span style="color: #000000;">(val) {
</span><span style="color: #008080;">48</span>             <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> val;
</span><span style="color: #008080;">49</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">50</span>         currentValue: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">51</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 在当前选中的tab发生变化时，更新panel的显示状态</span>
<span style="color: #008080;">52</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.updateStatus();
</span><span style="color: #008080;">53</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">54</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">55</span> });</pre>
</div>
<p>&nbsp;</p>
<p>在使用<code>v-for</code>指令循环显示tab标题时，使用<code>v-bind:class</code>指向了一个名为<code>tabCls</code>的<code>methods</code>来动态设置<code>class</code>名称。<br />
因为计算属性不能接收参数，无法知道当前tab是否是选中的，所以这里我们才用到methods。<br />
不过要知道，methods是不缓存的，可以回顾关于计算属性的章节。</p>
<p>点击每个tab标题时，会触发<code>handleChange</code>方法来改变当前选中tab的索引，也就是panel组件的name。<br />
在watch选项里，我们监听了<code>currentValue</code>，当其发生变化时，触发<code>updateStatus</code>方法来更新panel组件的显示状态。</p>
<p>以上就是标签页组件的核心代码分解。<br />
总结一下该示例的技术难点：</p>
<ul>
<li>使用了组件嵌套的方式，将一系列panel组件作为tabs组件的slot；</li>
<li>tabs组件和panel组件通信上，使用了<code>$parent</code>和<code>$children</code>的方法访问父链和子链；</li>
<li>定义了prop:<code>value</code>和data:<code>currentValue</code>，使用<code>$emit("input")</code>来实现<code>v-model</code>的用法。</li>

</ul>
<p>以下是标签页组件的完整代码：</p>
<h4 id="toc_44">index.html:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="zh"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 4</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">name</span><span style="color: #0000ff;">="viewport"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="width=device-width, initial-scale=1.0"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">http-equiv</span><span style="color: #0000ff;">="X-UA-Compatible"</span><span style="color: #ff0000;"> content</span><span style="color: #0000ff;">="ie=edge"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>标签页组件<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">link </span><span style="color: #ff0000;">rel</span><span style="color: #0000ff;">="stylesheet"</span><span style="color: #ff0000;"> type</span><span style="color: #0000ff;">="text/css"</span><span style="color: #ff0000;"> href</span><span style="color: #0000ff;">="style.css"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 9</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="app"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">12</span>             <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">tabs </span><span style="color: #ff0000;">v-model</span><span style="color: #0000ff;">="activeKey"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">13</span>                 <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">panel </span><span style="color: #ff0000;">label</span><span style="color: #0000ff;">="标签一"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="1"</span><span style="color: #0000ff;">&gt;</span>标签一的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">panel</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>                 <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">panel </span><span style="color: #ff0000;">label</span><span style="color: #0000ff;">="标签二"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="2"</span><span style="color: #0000ff;">&gt;</span>标签二的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">panel</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">15</span>                 <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">panel </span><span style="color: #ff0000;">label</span><span style="color: #0000ff;">="标签三"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="3"</span><span style="color: #0000ff;">&gt;</span>标签三的内容<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">panel</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">16</span>             <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">tabs</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">18</span> 
<span style="color: #008080;">19</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="vue.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">20</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="panel.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">21</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">src</span><span style="color: #0000ff;">="tabs.js"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">22</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">23</span>             <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> app </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Vue({
</span><span style="color: #008080;">24</span> <span style="background-color: #f5f5f5; color: #000000;">                el: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">#app</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
</span><span style="color: #008080;">25</span> <span style="background-color: #f5f5f5; color: #000000;">                data: {
</span><span style="color: #008080;">26</span> <span style="background-color: #f5f5f5; color: #000000;">                    activeKey: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">"</span>
<span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">                }
</span><span style="color: #008080;">28</span> <span style="background-color: #f5f5f5; color: #000000;">            });
</span><span style="color: #008080;">29</span>         <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">30</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">31</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_45">panel.js:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("panel"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     name: "panel"<span style="color: #000000;">,
</span><span style="color: #008080;"> 3</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        &lt;div class='panel' v-show='show'&gt; \
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">            &lt;slot&gt;&lt;/slot&gt; \
</span><span style="color: #008080;"> 6</span>         &lt;/div&gt;"<span style="color: #000000;">,
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    props: {
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        name: {
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">            type: String
</span><span style="color: #008080;">10</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">11</span> <span style="color: #000000;">        label: {
</span><span style="color: #008080;">12</span> <span style="color: #000000;">            type: String,
</span><span style="color: #008080;">13</span>             <span style="color: #0000ff;">default</span>: ""
<span style="color: #008080;">14</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">16</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">18</span>             show: <span style="color: #0000ff;">true</span>
<span style="color: #008080;">19</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">20</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    methods: {
</span><span style="color: #008080;">22</span> <span style="color: #000000;">        updateNav() {
</span><span style="color: #008080;">23</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.$parent.updateNav();
</span><span style="color: #008080;">24</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">25</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">26</span> <span style="color: #000000;">    watch: {
</span><span style="color: #008080;">27</span> <span style="color: #000000;">        label() {
</span><span style="color: #008080;">28</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.updateNav();
</span><span style="color: #008080;">29</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">30</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">31</span> <span style="color: #000000;">    mounted() {
</span><span style="color: #008080;">32</span>         <span style="color: #0000ff;">this</span><span style="color: #000000;">.updateNav();
</span><span style="color: #008080;">33</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">34</span> });</pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_46">tabs.js:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> Vue.component("tabs"<span style="color: #000000;">, {
</span><span style="color: #008080;"> 2</span>     template: "<span style="color: #000000;">\
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        &lt;div class='tabs'&gt; \
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">            &lt;div class='tabs-bar'&gt; \
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">                &lt;div :class='tabCls(item)' v-for='(item,index) in navList' @click='handleChange(index)'&gt;{{item.label}}&lt;/div&gt; \
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">            &lt;/div&gt; \
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">            &lt;div class='tabs-content'&gt; \
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">                &lt;slot&gt;&lt;/slot&gt; \
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">            &lt;/div&gt; \
</span><span style="color: #008080;">10</span>         &lt;/div&gt;"<span style="color: #000000;">,
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    props: {
</span><span style="color: #008080;">12</span> <span style="color: #000000;">        value: {
</span><span style="color: #008080;">13</span> <span style="color: #000000;">            type: [String, Number]
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">16</span>     data: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">17</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">18</span>             currentValue: <span style="color: #0000ff;">this</span><span style="color: #000000;">.value,
</span><span style="color: #008080;">19</span> <span style="color: #000000;">            navList: []
</span><span style="color: #008080;">20</span> <span style="color: #000000;">        };
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">22</span> <span style="color: #000000;">    methods: {
</span><span style="color: #008080;">23</span>         tabCls: <span style="color: #0000ff;">function</span><span style="color: #000000;">(item) {
</span><span style="color: #008080;">24</span>             <span style="color: #0000ff;">return</span><span style="color: #000000;"> [
</span><span style="color: #008080;">25</span>                 "tabs-tab"<span style="color: #000000;">,
</span><span style="color: #008080;">26</span> <span style="color: #000000;">                {
</span><span style="color: #008080;">27</span>                     "tabs-tab-active": item.name === <span style="color: #0000ff;">this</span><span style="color: #000000;">.currentValue
</span><span style="color: #008080;">28</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">29</span> <span style="color: #000000;">            ];
</span><span style="color: #008080;">30</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">31</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> 点击tab标题时触发</span>
<span style="color: #008080;">32</span>         handleChange: <span style="color: #0000ff;">function</span><span style="color: #000000;">(index) {
</span><span style="color: #008080;">33</span>             <span style="color: #0000ff;">var</span> nav = <span style="color: #0000ff;">this</span><span style="color: #000000;">.navList[index];
</span><span style="color: #008080;">34</span>             <span style="color: #0000ff;">var</span> name =<span style="color: #000000;"> nav.name;
</span><span style="color: #008080;">35</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 改变当前选中的tab，并触发下面的watch</span>
<span style="color: #008080;">36</span>             <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> name;
</span><span style="color: #008080;">37</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 更新value</span>
<span style="color: #008080;">38</span>             <span style="color: #0000ff;">this</span>.$emit("input"<span style="color: #000000;">, name);
</span><span style="color: #008080;">39</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 触发一个自定义事件，供父级使用</span>
<span style="color: #008080;">40</span>             <span style="color: #0000ff;">this</span>.$emit("on-click"<span style="color: #000000;">, name);
</span><span style="color: #008080;">41</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">42</span> <span style="color: #000000;">        getTabs() {
</span><span style="color: #008080;">43</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 通过遍历子组件，得到所有的panel组件</span>
<span style="color: #008080;">44</span>             <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span>.$children.filter(<span style="color: #0000ff;">function</span><span style="color: #000000;">(item) {
</span><span style="color: #008080;">45</span>                 <span style="color: #0000ff;">return</span> item.$options.name === "panel"<span style="color: #000000;">;
</span><span style="color: #008080;">46</span> <span style="color: #000000;">            });
</span><span style="color: #008080;">47</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">48</span> <span style="color: #000000;">        updateNav() {
</span><span style="color: #008080;">49</span>             <span style="color: #0000ff;">this</span>.navList =<span style="color: #000000;"> [];
</span><span style="color: #008080;">50</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 设置对this的引用，在function回调里，this指向的并不是Vue实例</span>
<span style="color: #008080;">51</span>             <span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">52</span>             <span style="color: #0000ff;">this</span>.getTabs().forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(panel, index) {
</span><span style="color: #008080;">53</span> <span style="color: #000000;">                _this.navList.push({
</span><span style="color: #008080;">54</span> <span style="color: #000000;">                    label: panel.label,
</span><span style="color: #008080;">55</span>                     name: panel.name ||<span style="color: #000000;"> index
</span><span style="color: #008080;">56</span> <span style="color: #000000;">                });
</span><span style="color: #008080;">57</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 如果没有给panel设置name，默认设置它的索引</span>
<span style="color: #008080;">58</span>                 <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">panel.name) {
</span><span style="color: #008080;">59</span>                     panel.name =<span style="color: #000000;"> index;
</span><span style="color: #008080;">60</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">61</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> 设置当前选中的tab的索引，在后面介绍</span>
<span style="color: #008080;">62</span>                 <span style="color: #0000ff;">if</span> (index === 0<span style="color: #000000;">) {
</span><span style="color: #008080;">63</span>                     <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">_this.currentValue) {
</span><span style="color: #008080;">64</span>                         _this.currentValue = panel.name ||<span style="color: #000000;"> index;
</span><span style="color: #008080;">65</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">66</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">67</span> <span style="color: #000000;">            });
</span><span style="color: #008080;">68</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">69</span> <span style="color: #000000;">        updateStatus() {
</span><span style="color: #008080;">70</span>             <span style="color: #0000ff;">var</span> tabs = <span style="color: #0000ff;">this</span><span style="color: #000000;">.getTabs();
</span><span style="color: #008080;">71</span>             <span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">72</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 显示当前选中的tab对应的panel组件，隐藏没有选中的</span>
<span style="color: #008080;">73</span>             tabs.forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(tab) {
</span><span style="color: #008080;">74</span>                 <span style="color: #0000ff;">return</span> tab.show = tab.name ===<span style="color: #000000;"> _this.currentValue;
</span><span style="color: #008080;">75</span> <span style="color: #000000;">            });
</span><span style="color: #008080;">76</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">77</span> <span style="color: #000000;">    },
</span><span style="color: #008080;">78</span> <span style="color: #000000;">    watch: {
</span><span style="color: #008080;">79</span>         value: <span style="color: #0000ff;">function</span><span style="color: #000000;">(val) {
</span><span style="color: #008080;">80</span>             <span style="color: #0000ff;">this</span>.currentValue =<span style="color: #000000;"> val;
</span><span style="color: #008080;">81</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">82</span>         currentValue: <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">83</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 在当前选中的tab发生变化时，更新panel的显示状态</span>
<span style="color: #008080;">84</span>             <span style="color: #0000ff;">this</span><span style="color: #000000;">.updateStatus();
</span><span style="color: #008080;">85</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">86</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">87</span> });</pre>
</div>
<p>&nbsp;</p>
<h4 id="toc_47">style.css:</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #800000;">[v-cloak]</span>{<span style="color: #ff0000;">display</span>:<span style="color: #0000ff;">none</span>;}
<span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> <span style="color: #800000;">.tabs</span>{<span style="color: #ff0000;">font-size</span>:<span style="color: #0000ff;">14px</span>;<span style="color: #ff0000;"> color</span>:<span style="color: #0000ff;">#657180</span>;}
<span style="color: #008080;"> 4</span> <span style="color: #800000;">.tabs-bar:after</span>{
<span style="color: #008080;"> 5</span> <span style="color: #ff0000;">    content</span>:<span style="color: #0000ff;">""</span>;<span style="color: #ff0000;"> display</span>:<span style="color: #0000ff;">block</span>; 
<span style="color: #008080;"> 6</span> <span style="color: #ff0000;">    width</span>:<span style="color: #0000ff;">100%</span>;<span style="color: #ff0000;"> height</span>:<span style="color: #0000ff;">1px</span>; 
<span style="color: #008080;"> 7</span> <span style="color: #ff0000;">    background</span>:<span style="color: #0000ff;">#D7DDE4</span>;<span style="color: #ff0000;"> margin-top</span>:<span style="color: #0000ff;">-1px</span>;
<span style="color: #008080;"> 8</span> }
<span style="color: #008080;"> 9</span> <span style="color: #800000;">.tabs-tab</span>{
<span style="color: #008080;">10</span> <span style="color: #ff0000;">    display</span>:<span style="color: #0000ff;">inline-block</span>;<span style="color: #ff0000;"> cursor</span>:<span style="color: #0000ff;">pointer</span>;<span style="color: #ff0000;"> position</span>:<span style="color: #0000ff;">relative</span>;
<span style="color: #008080;">11</span> <span style="color: #ff0000;">    padding</span>:<span style="color: #0000ff;">4px 16px</span>;<span style="color: #ff0000;"> margin-right</span>:<span style="color: #0000ff;">6px</span>; 
<span style="color: #008080;">12</span> <span style="color: #ff0000;">    background</span>:<span style="color: #0000ff;">#FFF</span>;<span style="color: #ff0000;"> border</span>:<span style="color: #0000ff;">1px solid #D7DDE4</span>;
<span style="color: #008080;">13</span> }
<span style="color: #008080;">14</span> <span style="color: #800000;">.tabs-tab-active</span>{
<span style="color: #008080;">15</span> <span style="color: #ff0000;">    cursor</span>:<span style="color: #0000ff;">#3399FF</span>; 
<span style="color: #008080;">16</span> <span style="color: #ff0000;">    border-top</span>:<span style="color: #0000ff;">1px solid #3399FF</span>;<span style="color: #ff0000;"> border-bottom</span>:<span style="color: #0000ff;">1px solid #FFF</span>;
<span style="color: #008080;">17</span> }
<span style="color: #008080;">18</span> <span style="color: #800000;">.tabs-tab-active:before</span>{
<span style="color: #008080;">19</span> <span style="color: #ff0000;">    content</span>:<span style="color: #0000ff;">""</span>;<span style="color: #ff0000;"> display</span>:<span style="color: #0000ff;">block</span>;<span style="color: #ff0000;"> height</span>:<span style="color: #0000ff;">1px</span>;<span style="color: #ff0000;"> background</span>:<span style="color: #0000ff;">#3399FF</span>; 
<span style="color: #008080;">20</span> <span style="color: #ff0000;">    position</span>:<span style="color: #0000ff;">absolute</span>;<span style="color: #ff0000;"> top</span>:<span style="color: #0000ff;">0</span>;<span style="color: #ff0000;"> left</span>:<span style="color: #0000ff;">0</span>;<span style="color: #ff0000;"> right</span>:<span style="color: #0000ff;">0</span>;
<span style="color: #008080;">21</span> }
<span style="color: #008080;">22</span> <span style="color: #800000;">.tabs-content</span>{<span style="color: #ff0000;">padding</span>:<span style="color: #0000ff;">8px 0</span>;}</pre>
</div>
<p>&nbsp;</p>
<p><strong>练习1：</strong> 给panel组件新增一个prop:<code>closable</code>的布尔值，来支持是否可以关闭这个panel，如果开启，在tabs的标签标题上会有一个关闭的按钮；</p>
<blockquote>
<p>提示：<br />
在初始化panel时，我们是在mounted里通知的。<br />
关闭时，你会用到beforeDestroy。</p>

</blockquote>
<p><strong>练习2：</strong> 尝试在切换panel的显示与隐藏时，使用滑动的动画。提示：可以使用CSS3的<code>transform:translateX</code>。</p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>