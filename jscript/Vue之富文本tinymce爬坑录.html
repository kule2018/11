<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Vue之富文本tinymce爬坑录' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Vue之富文本tinymce爬坑录</center></div><div class='banquan'>原文出处:本文由博客园博主努力的阿洋提供。<br/>
原文连接:https://www.cnblogs.com/yubingyang/p/11561517.html</div><br>
    <h1>前言</h1><div data-v-648672b2="" data-id="5d83431c5188250d7e55b67c" itemprop="articleBody" style="word-break: break-word; line-height: 1.75; font-size: 15px; overflow-x: hidden; color: #333333; font-family: -apple-system, system-ui, BlinkMacSystemFont, &quot;Helvetica Neue&quot;, &quot;PingFang SC&quot;, &quot;Hiragino Sans GB&quot;, &quot;Microsoft YaHei&quot;, Arial, sans-serif; background-color: #ffffff;"><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">最近因业务需求在项目中嵌入了<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">tinymce</a>这个富文本编辑器，用于满足平台给用户编辑各类新闻内容什么的业务需求，前后也花了不少时间体验和对比了市面上各类开源编辑器。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">*案例demo版本：<a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fleishihong%2Fvue-tinymce-demo" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">vue-tinymce-demo</a></p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">在线预览：<a href="https://link.juejin.im/?target=https%3A%2F%2Fvue-tinymce-demo.netlify.com%2F%23%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">vue-tinymce-demo.netlify.com/#/</a></p><h2>各大WYSIWYG编辑器的简单比较</h2><h4>1、UEditor</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">因为已经不再维护了，需要大量修改源码，很多都是专门为jsp等服务器渲染项目写的代码需要删除， 然后越删越害怕越删越不敢用，依赖<code>jquery</code>，需要专门用js去parse编辑完成的内容，parse完的内容还可能污染全局css，兼容老浏览器还不错， 但是，我们不怎么考虑兼容IE。所以，告辞。</p><h4>2、wangEditor</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">中文文档，上手快，依赖<code>jquery</code>，功能少点要花时间去写插件，需要单独为图片上传功能写个接口，老项目忙着上线临时用过，感觉并不适合当前业务这么重的编辑功能于是放弃了。</p><h4>3、Quill</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">api友好, 功能少，需要特定的css去解析文本（这点我不大喜欢），ui好看，适合作为论坛回帖功能使用。</p><h4>4、CKEditor</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">CKEditor目前主流的还是<code>4.x</code>的版本，但是文档看着很瞎眼实在是提不起兴致去配置，草草用了下就放弃了，<code>5.x</code>版本刚从beta结束，需要指定专门的node以及npm版本，虽然功能强大配置灵活ui漂亮不过目前糟糕的兼容性基本是不可能出现在大众视野了。</p><h4>5、KingEditor</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">丑，不喜欢，不爱用</p><h4>6、Draft-js</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">知乎最近刚改的文本编辑器就是在draft的基础上开发的，依赖<code>react</code>， 弃。</p><h4>7、Medium-editor：</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">虽然看着感觉很酷炫，但是，不适合我们的业务场景啊， api也简陋可怕。</p><h4>8、trix：</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">嗯，又一个小而美，放弃</p><h4>9、Slate</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><code>react</code>，放弃</p><h4>10、Bootstrap-wysiwyg：</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><code>bootstrap, jquery</code>, 放弃</p><h4>11、vue-quill-editor</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">轻量级，工具条配置少，IE10+ 根据quillJs封装。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">扩展使用：<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.jianshu.com%2Fp%2Fdc2492160c68" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">www.jianshu.com/p/dc2492160&#8230;</a></p><h4>12、tinymce</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">文档好，功能强，bug少，无外部依赖，大家用了都说好，嗯，没错就是它了。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">编辑器配置方面只要能看得懂英文耍起来还是比较简单的，适配中碰到的大部分问题都可以通过看文档解决，即便看文档解决不了网上也有大量的文章能告诉你怎么配置能解决。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">当然了，主要是我这里需要解决一些别人觉得超简单自己一想都很烦人的需求，比如：</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><br /></p><blockquote style="margin: 22px 0px; border-left-width: 4px; border-left-color: #cbcbcb; padding: 1px 23px; color: #666666; background-color: #f8f8f8;"><ol style="padding-left: 28px;"><li style="list-style: inherit; margin-bottom: 0px; padding-left: 6px;">word文档粘贴进来要带格式</li><li style="list-style: inherit; margin-bottom: 0px; padding-left: 6px;">兼容移动端</li><li style="list-style: inherit; margin-bottom: 0px; padding-left: 6px;">word文档粘贴进来要正常显示并且还要兼容移动端</li><li style="list-style: inherit; margin-bottom: 0px; padding-left: 6px;">电脑网页里粘贴进来内容要正常显示并且排版还不能乱</li><li style="list-style: inherit; margin-bottom: 0px; padding-left: 6px;">电脑网页拷过来的内容还要兼容到移动端</li></ol></blockquote><h2>高级使用方式</h2><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">你可能还想要通过一些更高级的方式来使用tinyMCE。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">比如npm: npm install tinymce</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">bower: bowerinstall tinymce 或者</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">bower install tinymce-src=git://github.com/tinymce/tinymce</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">composer: php composer.phar require"tinymce/tinymce" "&gt;= 4"</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">nuget: Install-PackageTinyMCE</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">sdk: 你可以在这里下载：<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdownload%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">www.tinymce.com/download/</a></p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">jQuery: 如果你希望得到一个jQuery插件形式的tinyMCE，你可以在这里定制：<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdownload%2Fcustom-builds%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">www.tinymce.com/download/cu&#8230;</a>。你可以根据你的意愿，定制你需要的功能。这样，你可以得到一个尽可能小的适用的tinyMCE。</p><h3>1、插件</h3><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">tinyMCE有很多插件可以使用，比如代码编辑模式、高亮模式，图片上传等等。插件拓展或新增了tinyMCE的功能。或者，你也可以自定义一些插件。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">关于插件的内容过多，不进行翻译，后续一些插件也以挂出官网的链接形式展示。</p><h3>2、自主义UI</h3><h4>1、主题和皮肤</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">你可以定制主题和皮肤，通过threm和spin来配置它们。</p><h4>2、尺寸</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">这些配置帮助你定制尺寸，width、height、min_width、max_width、min_height、max_height。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">你可能还需要自适应尺寸（<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdocs%2Fplugins%2Fautoresize%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">www.tinymce.com/docs/plugin&#8230;</a>）的插件来帮助你使尺寸更智能。或者，你可以使用resize配置。</p><h4>3、样式</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">content_css 可用帮助你定制主体区域的样式。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">statusbar 设为false可以隐藏状态栏。</p><h4>4、源码模式</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdocs%2Fget-started%2Fcustomize-ui%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">www.tinymce.com/docs/get-st&#8230;</a>。页尾。</p><h4>5、上传图片</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdocs%2Fget-started%2Fupload-images%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">https://www.tinymce.com/docs/get-started/upload-images/</a></p><h4>6、拼写检查</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdocs%2Fget-started%2Fspell-checking%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">www.tinymce.com/docs/get-st&#8230;</a></p><h4>7、内容过滤</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdocs%2Fget-started%2Ffilter-content%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">https://www.tinymce.com/docs/get-started/filter-content/</a></p><h2>兼容性</h2><h4>移动端：</h4><h4>PC端：</h4><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><img alt="image.png" title="image.png" inited=""  loaded"="" data-src="./images/Vue之富文本tinymce爬坑录0.png" data-width="1280" data-height="481" src="./images/Vue之富文本tinymce爬坑录0.png" style="width: auto; height: auto; max-height: none; margin: 0px; max-width: 100%; visibility: visible; background-color: transparent; background-position: 50% center; background-repeat: no-repeat; background-image: none; cursor: zoom-in;" /><br /></p><h2>初始化</h2><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">因为tinymce的<code>Plugins</code>是按需加载的</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">为了能先快速上手这个编辑器</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">就先在<a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fvue-cli" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">vue-cli</a>的index.html中默认塞入一条在线cdn地址</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">&lt;script src=<span style="color: #dd1144;">"https://cdn.bootcss.com/tinymce/4.7.4/tinymce.min.js"</span>&gt;&lt;/script&gt;<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">记得去下载<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdownload%2Flanguage-packages%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">语言包</a>到本地,</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后就在文件内引入</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">import <span style="color: #dd1144;">'./zh_CN.js'</span><span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">后面有机会再写下单独打包的事项，毕竟这货体积还不小。</p><h2>插入vue组件模板</h2><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">&lt;template&gt;   &lt;div&gt;     &lt;textarea :id= <span style="color: #dd1144;">"Id"</span>&gt;&lt;/textarea&gt;   &lt;/div&gt; &lt;/template&gt;<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">记得一定要在<code>textarea</code>外面包一层div，不然...你自己试试看就知道了。</p><h2>组件基础配置</h2><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">将tinymce通过指定的selector挂载到组件中</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">&lt;template&gt;   &lt;div&gt;     &lt;textarea :id= <span style="color: #dd1144;">"Id"</span>&gt;&lt;/textarea&gt;   &lt;/div&gt; &lt;/template&gt; &lt;script&gt;   import <span style="color: #dd1144;">'./zh_CN.js'</span>   <span style="color: #0086b3;">export</span> default {     <span style="color: #990000; font-weight: 700;">data</span> () {       const Id = Date.now()       <span style="color: #0086b3;">return</span> {         Id: Id,         Editor: null,         DefaultConfig: {}       }     },     props: {       value: {         default: <span style="color: #dd1144;">''</span>,         <span style="color: #0086b3;">type</span>: String       },       config: {         <span style="color: #0086b3;">type</span>: Object,         default: () =&gt; {           <span style="color: #0086b3;">return</span> {             theme: <span style="color: #dd1144;">'modern'</span>,             height: 300           }         }       }     },     <span style="color: #990000; font-weight: 700;">mounted</span> () {       this.init()     },     <span style="color: #990000; font-weight: 700;">beforeDestroy</span> () {       // 销毁tinymce       this.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'on-destroy'</span>)       window.tinymce.remove(`<span style="color: #999988;">#${this.Id}`)</span>     },     methods: {        <span style="color: #990000; font-weight: 700;">init</span> () {         const self = this         this.Editor = window.tinymce.init({           // 默认配置           ...this.DefaultConfig,                      // prop内传入的的config           ...this.config,                       // 挂载的DOM对象           selector: `<span style="color: #999988;">#${this.Id}`,</span>                      setup: (editor) =&gt; {             // 抛出 <span style="color: #dd1144;">'on-ready'</span> 事件钩子             editor.on(               <span style="color: #dd1144;">'init'</span>, () =&gt; {                 self.loading = <span style="color: teal;">false</span>                 self.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'on-ready'</span>)                 editor.setContent(self.value)               }             )             // 抛出 <span style="color: #dd1144;">'input'</span> 事件钩子，同步value数据             editor.on(               <span style="color: #dd1144;">'input change undo redo'</span>, () =&gt; {                 self.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'input'</span>, editor.getContent())               }             )           }         })       }     }   } &lt;/script&gt;<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">好了，组件基本的初始化完成，后面正式开始踩坑之旅</p><h2>API</h2><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">具体内容看<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdocs%2Fdemo%2F" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">官网的API</a>就行，英语不好的用chrome翻译下对照着demo也能看个七七八八，当然主要原因还是我比较懒。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">我这边根据自身业务需求在组件的<code>data</code>内写了个<code>默认配置</code></p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">DefaultConfig: {   // GLOBAL   height: 500,   theme: <span style="color: #dd1144;">'modern'</span>,   menubar: <span style="color: teal;">false</span>,   toolbar: `styleselect | fontselect | formatselect | fontsizeselect | forecolor backcolor | bold italic underline strikethrough | image  media | table | alignleft aligncenter alignright alignjustify | outdent indent | numlist bullist | preview removeformat  hr | paste code  link | undo redo | fullscreen `,   plugins: `     paste     importcss     image     code     table     advlist     fullscreen     link     media     lists     textcolor     colorpicker     hr     preview   `,      // CONFIG   forced_root_block: <span style="color: #dd1144;">'p'</span>,   force_p_newlines: <span style="color: teal;">true</span>,   importcss_append: <span style="color: teal;">true</span>,  // CONFIG: ContentStyle 这块很重要， 在最后呈现的页面也要写入这个基本样式保证前后一致， `table`和`img`的问题基本就靠这个来填坑了   content_style: `     *                         { padding:0; margin:0; }     html, body                { height:100%; }     img                       { max-width:100%; display:block;height:auto; }     a                         { text-decoration: none; }     iframe                    { width: 100%; }     p                         { line-height:1.6; margin: 0px; }     table                     { word-wrap:<span style="color: #0086b3;">break</span>-word; word-break:<span style="color: #0086b3;">break</span>-all; max-width:100%; border:none; border-color:<span style="color: #999988;">#999; }</span>     .mce-object-iframe        { width:100%; box-sizing:border-box; margin:0; padding:0; }     ul,ol                     { list-style-position:inside; }   `,   insert_button_items: <span style="color: #dd1144;">'image link | inserttable'</span>,   // CONFIG: Paste   paste_retain_style_properties: <span style="color: #dd1144;">'all'</span>,   paste_word_valid_elements: <span style="color: #dd1144;">'*[*]'</span>,        // word需要它   paste_data_images: <span style="color: teal;">true</span>,                  // 粘贴的同时能把内容里的图片自动上传，非常强力的功能   paste_convert_word_fake_lists: <span style="color: teal;">false</span>,     // 插入word文档需要该属性   paste_webkit_styles: <span style="color: #dd1144;">'all'</span>,   paste_merge_formats: <span style="color: teal;">true</span>,   nonbreaking_force_tab: <span style="color: teal;">false</span>,   paste_auto_cleanup_on_paste: <span style="color: teal;">false</span>,   // CONFIG: Font   fontsize_formats: <span style="color: #dd1144;">'10px 11px 12px 14px 16px 18px 20px 24px'</span>,   // CONFIG: StyleSelect   style_formats: [     {       title: <span style="color: #dd1144;">'首行缩进'</span>,       block: <span style="color: #dd1144;">'p'</span>,       styles: { <span style="color: #dd1144;">'text-indent'</span>: <span style="color: #dd1144;">'2em'</span> }     },     {       title: <span style="color: #dd1144;">'行高'</span>,       items: [         {title: <span style="color: #dd1144;">'1'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'1'</span> }, inline: <span style="color: #dd1144;">'span'</span>},         {title: <span style="color: #dd1144;">'1.5'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'1.5'</span> }, inline: <span style="color: #dd1144;">'span'</span>},         {title: <span style="color: #dd1144;">'2'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'2'</span> }, inline: <span style="color: #dd1144;">'span'</span>},         {title: <span style="color: #dd1144;">'2.5'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'2.5'</span> }, inline: <span style="color: #dd1144;">'span'</span>},         {title: <span style="color: #dd1144;">'3'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'3'</span> }, inline: <span style="color: #dd1144;">'span'</span>}       ]     }   ],   // FontSelect   font_formats: `     微软雅黑=微软雅黑;     宋体=宋体;     黑体=黑体;     仿宋=仿宋;     楷体=楷体;     隶书=隶书;     幼圆=幼圆;     Andale Mono=andale mono,<span style="color: #0086b3;">times</span>;     Arial=arial, helvetica,     sans-serif;     Arial Black=arial black, avant garde;     Book Antiqua=book antiqua,palatino;     Comic Sans MS=comic sans ms,sans-serif;     Courier New=courier new,courier;     Georgia=georgia,palatino;     Helvetica=helvetica;     Impact=impact,chicago;     Symbol=symbol;     Tahoma=tahoma,arial,helvetica,sans-serif;     Terminal=terminal,monaco;     Times New Roman=<span style="color: #0086b3;">times</span> new roman,<span style="color: #0086b3;">times</span>;     Trebuchet MS=trebuchet ms,geneva;     Verdana=verdana,geneva;     Webdings=webdings;     Wingdings=wingdings,zapf dingbats`,   // Tab   tabfocus_elements: <span style="color: #dd1144;">':prev,:next'</span>,   object_resizing: <span style="color: teal;">true</span>,   // Image   imagetools_toolbar: <span style="color: #dd1144;">'rotateleft rotateright | flipv fliph | editimage imageoptions'</span> }<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">因为本人比较懒，以上配置导出的代码可能会有代码注入的风险，建议保存的时候再前后端都做下注入过滤，不过一般数据安全问题主要还是服务器那边的事情?。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">后面的图片上传可以单独拆出来做个小配置，直接写到<code>props</code>里好了。</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">url: {     default: <span style="color: #dd1144;">''</span>,     <span style="color: #0086b3;">type</span>: String   },   accept: {     default: <span style="color: #dd1144;">'image/jpeg, image/png'</span>,     <span style="color: #0086b3;">type</span>: String   },   maxSize: {     default: 2097152,     <span style="color: #0086b3;">type</span>: Number   },   withCredentials: {     default: <span style="color: teal;">false</span>,     <span style="color: #0086b3;">type</span>: Boolean   }<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后把这套东西塞到<code>init</code>配置里</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">// 图片上传   images_upload_handler: <span style="font-weight: 700;">function</span> (blobInfo, success, failure) {     <span style="font-weight: 700;">if</span> (blobInfo.blob().size &gt; self.maxSize) {       failure(<span style="color: #dd1144;">'文件体积过大'</span>)     }          <span style="font-weight: 700;">if</span> (self.accept.indexOf(blobInfo.blob().type) &gt;= 0) {       uploadPic()     } <span style="font-weight: 700;">else</span> {       failure(<span style="color: #dd1144;">'图片格式错误'</span>)     }     <span style="font-weight: 700;">function</span> <span style="color: #990000; font-weight: 700;">uploadPic</span> () {       const xhr = new XMLHttpRequest()       const formData = new FormData()       xhr.withCredentials = self.withCredentials       xhr.open(<span style="color: #dd1144;">'POST'</span>, self.url)       xhr.onload = <span style="color: #990000; font-weight: 700;">function</span> () {         <span style="font-weight: 700;">if</span> (xhr.status !== 200) {           // 抛出 <span style="color: #dd1144;">'on-upload-fail'</span> 钩子           self.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'on-upload-fail'</span>)           failure(<span style="color: #dd1144;">'上传失败: '</span> + xhr.status)           <span style="color: #0086b3;">return</span>         }         const json = JSON.parse(xhr.responseText)         // 抛出 <span style="color: #dd1144;">'on-upload-success'</span> 钩子         self.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'on-upload-complete'</span> , [           json, success, failure         ])       }       formData.append(<span style="color: #dd1144;">'file'</span>, blobInfo.blob())       xhr.send(formData)     }   }<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">至此， 一个组件的封装基本算是完成了</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">看下初阶成果</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">&lt;template&gt;   &lt;div&gt;     &lt;textarea :id= <span style="color: #dd1144;">"Id"</span>&gt;&lt;/textarea&gt;   &lt;/div&gt; &lt;/template&gt; &lt;script&gt;   import <span style="color: #dd1144;">'./zh_CN.js'</span>   <span style="color: #0086b3;">export</span> default {     <span style="color: #990000; font-weight: 700;">data</span> () {       const Id = Date.now()       <span style="color: #0086b3;">return</span> {         Id: Id,         Editor: null,         DefaultConfig: {           // GLOBAL           height: 500,           theme: <span style="color: #dd1144;">'modern'</span>,           menubar: <span style="color: teal;">false</span>,           toolbar: `styleselect | fontselect | formatselect | fontsizeselect | forecolor backcolor | bold italic underline strikethrough | image  media | table | alignleft aligncenter alignright alignjustify | outdent indent | numlist bullist | preview removeformat  hr | paste code  link | undo redo | fullscreen `,           plugins: `             paste             importcss             image             code             table             advlist             fullscreen             link             media             lists             textcolor             colorpicker             hr             preview           `,                      // CONFIG           forced_root_block: <span style="color: #dd1144;">'p'</span>,           force_p_newlines: <span style="color: teal;">true</span>,           importcss_append: <span style="color: teal;">true</span>,         // CONFIG: ContentStyle 这块很重要， 在最后呈现的页面也要写入这个基本样式保证前后一致， `table`和`img`的问题基本就靠这个来填坑了           content_style: `             *                         { padding:0; margin:0; }             html, body                { height:100%; }             img                       { max-width:100%; display:block;height:auto; }             a                         { text-decoration: none; }             iframe                    { width: 100%; }             p                         { line-height:1.6; margin: 0px; }             table                     { word-wrap:<span style="color: #0086b3;">break</span>-word; word-break:<span style="color: #0086b3;">break</span>-all; max-width:100%; border:none; border-color:<span style="color: #999988;">#999; }</span>             .mce-object-iframe        { width:100%; box-sizing:border-box; margin:0; padding:0; }             ul,ol                     { list-style-position:inside; }           `,           insert_button_items: <span style="color: #dd1144;">'image link | inserttable'</span>,           // CONFIG: Paste           paste_retain_style_properties: <span style="color: #dd1144;">'all'</span>,           paste_word_valid_elements: <span style="color: #dd1144;">'*[*]'</span>,        // word需要它           paste_data_images: <span style="color: teal;">true</span>,                  // 粘贴的同时能把内容里的图片自动上传，非常强力的功能           paste_convert_word_fake_lists: <span style="color: teal;">false</span>,     // 插入word文档需要该属性           paste_webkit_styles: <span style="color: #dd1144;">'all'</span>,           paste_merge_formats: <span style="color: teal;">true</span>,           nonbreaking_force_tab: <span style="color: teal;">false</span>,           paste_auto_cleanup_on_paste: <span style="color: teal;">false</span>,           // CONFIG: Font           fontsize_formats: <span style="color: #dd1144;">'10px 11px 12px 14px 16px 18px 20px 24px'</span>,           // CONFIG: StyleSelect           style_formats: [             {               title: <span style="color: #dd1144;">'首行缩进'</span>,               block: <span style="color: #dd1144;">'p'</span>,               styles: { <span style="color: #dd1144;">'text-indent'</span>: <span style="color: #dd1144;">'2em'</span> }             },             {               title: <span style="color: #dd1144;">'行高'</span>,               items: [                 {title: <span style="color: #dd1144;">'1'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'1'</span> }, inline: <span style="color: #dd1144;">'span'</span>},                 {title: <span style="color: #dd1144;">'1.5'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'1.5'</span> }, inline: <span style="color: #dd1144;">'span'</span>},                 {title: <span style="color: #dd1144;">'2'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'2'</span> }, inline: <span style="color: #dd1144;">'span'</span>},                 {title: <span style="color: #dd1144;">'2.5'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'2.5'</span> }, inline: <span style="color: #dd1144;">'span'</span>},                 {title: <span style="color: #dd1144;">'3'</span>, styles: { <span style="color: #dd1144;">'line-height'</span>: <span style="color: #dd1144;">'3'</span> }, inline: <span style="color: #dd1144;">'span'</span>}               ]             }           ],           // FontSelect           font_formats: `             微软雅黑=微软雅黑;             宋体=宋体;             黑体=黑体;             仿宋=仿宋;             楷体=楷体;             隶书=隶书;             幼圆=幼圆;             Andale Mono=andale mono,<span style="color: #0086b3;">times</span>;             Arial=arial, helvetica,             sans-serif;             Arial Black=arial black, avant garde;             Book Antiqua=book antiqua,palatino;             Comic Sans MS=comic sans ms,sans-serif;             Courier New=courier new,courier;             Georgia=georgia,palatino;             Helvetica=helvetica;             Impact=impact,chicago;             Symbol=symbol;             Tahoma=tahoma,arial,helvetica,sans-serif;             Terminal=terminal,monaco;             Times New Roman=<span style="color: #0086b3;">times</span> new roman,<span style="color: #0086b3;">times</span>;             Trebuchet MS=trebuchet ms,geneva;             Verdana=verdana,geneva;             Webdings=webdings;             Wingdings=wingdings,zapf dingbats`,           // Tab           tabfocus_elements: <span style="color: #dd1144;">':prev,:next'</span>,           object_resizing: <span style="color: teal;">true</span>,           // Image           imagetools_toolbar: <span style="color: #dd1144;">'rotateleft rotateright | flipv fliph | editimage imageoptions'</span>         }       }     },     props: {       value: {         default: <span style="color: #dd1144;">''</span>,         <span style="color: #0086b3;">type</span>: String       },       config: {         <span style="color: #0086b3;">type</span>: Object,         default: () =&gt; {           <span style="color: #0086b3;">return</span> {             theme: <span style="color: #dd1144;">'modern'</span>,             height: 300           }         }       },       url: {         default: <span style="color: #dd1144;">''</span>,         <span style="color: #0086b3;">type</span>: String       },       accept: {         default: <span style="color: #dd1144;">'image/jpeg, image/png'</span>,         <span style="color: #0086b3;">type</span>: String       },       maxSize: {         default: 2097152,         <span style="color: #0086b3;">type</span>: Number       },       withCredentials: {         default: <span style="color: teal;">false</span>,         <span style="color: #0086b3;">type</span>: Boolean       }     },     <span style="color: #990000; font-weight: 700;">mounted</span> () {       this.init()     },     <span style="color: #990000; font-weight: 700;">beforeDestroy</span> () {       // 销毁tinymce       this.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'on-destroy'</span>)       window.tinymce.remove(`<span style="color: teal;">$#</span>{this.Id}`)     },     methods: {        <span style="color: #990000; font-weight: 700;">init</span> () {         const self = this                  this.Editor = window.tinymce.init({           // 默认配置           ...this.DefaultConfig,                      // 图片上传           images_upload_handler: <span style="font-weight: 700;">function</span> (blobInfo, success, failure) {             <span style="font-weight: 700;">if</span> (blobInfo.blob().size &gt; self.maxSize) {               failure(<span style="color: #dd1144;">'文件体积过大'</span>)             }                          <span style="font-weight: 700;">if</span> (self.accept.indexOf(blobInfo.blob().type) &gt;= 0) {               uploadPic()             } <span style="font-weight: 700;">else</span> {               failure(<span style="color: #dd1144;">'图片格式错误'</span>)             }             <span style="font-weight: 700;">function</span> <span style="color: #990000; font-weight: 700;">uploadPic</span> () {               const xhr = new XMLHttpRequest()               const formData = new FormData()               xhr.withCredentials = self.withCredentials               xhr.open(<span style="color: #dd1144;">'POST'</span>, self.url)               xhr.onload = <span style="color: #990000; font-weight: 700;">function</span> () {                 <span style="font-weight: 700;">if</span> (xhr.status !== 200) {                   // 抛出 <span style="color: #dd1144;">'on-upload-fail'</span> 钩子                   self.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'on-upload-fail'</span>)                   failure(<span style="color: #dd1144;">'上传失败: '</span> + xhr.status)                   <span style="color: #0086b3;">return</span>                 }                 const json = JSON.parse(xhr.responseText)                 // 抛出 <span style="color: #dd1144;">'on-upload-complete'</span> 钩子                 self.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'on-upload-complete'</span> , [                   json, success, failure                 ])               }               formData.append(<span style="color: #dd1144;">'file'</span>, blobInfo.blob())               xhr.send(formData)             }           },           // prop内传入的的config           ...this.config,                       // 挂载的DOM对象           selector: `<span style="color: #999988;">#${this.Id}`,</span>           setup: (editor) =&gt; {             // 抛出 <span style="color: #dd1144;">'on-ready'</span> 事件钩子             editor.on(               <span style="color: #dd1144;">'init'</span>, () =&gt; {                 self.loading = <span style="color: teal;">false</span>                 self.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'on-ready'</span>)                 editor.setContent(self.value)               }             )             // 抛出 <span style="color: #dd1144;">'input'</span> 事件钩子，同步value数据             editor.on(               <span style="color: #dd1144;">'input change undo redo'</span>, () =&gt; {                 self.<span style="color: teal;">$emit</span>(<span style="color: #dd1144;">'input'</span>, editor.getContent())               }             )           }         })       }     }   } &lt;/script&gt;<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">直接引入组件调用就行了</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">&lt;template&gt;   &lt;mce-editor      :config           = <span style="color: #dd1144;">"Config"</span>      v-model          = <span style="color: #dd1144;">"Value"</span>     :url              = <span style="color: #dd1144;">"Url"</span>     :max-size         = <span style="color: #dd1144;">"MaxSize"</span>     :accept           = <span style="color: #dd1144;">"Accept"</span>     :with-credentials = <span style="color: teal;">false</span>     @on-ready         = <span style="color: #dd1144;">"onEditorReady"</span>     @on-destroy       = <span style="color: #dd1144;">"onEditorDestroy"</span>     @on-upload-success= <span style="color: #dd1144;">"onEditorUploadComplete"</span>     @on-upload-fail   = <span style="color: #dd1144;">"onEditorUploadFail"</span>   &gt;&lt;/mce-editor&gt; &lt;/template&gt;<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">但是作为一名优秀的程序员，这怎么可能够嘛。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">下面说下打包的事情</p><h2>塞入webpack</h2><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">为了加快页面载入速度就要首先解决载入文件过多的问题，而大部分时间用户并不需要每次打开页面都先加载一遍editor的核心文件，而editor本身也要按需加载内容，一开始想把每个plugin都搞成独立组件模块按需载入，但是这就要涉及到修改编辑器本身源码，或者说对window.tinymce删掉点特性，这些都太麻烦也都有风险，对后面的代码维护影响也大，索性就都先留着。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">后面边做边改吧</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">还是以<a href="https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fvuejs%2Fvue-cli" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">vue-cli</a>为例</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">把官网下载的包塞到<code>stataic</code>文件夹中</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后删掉<code>index.html</code>模版中的cdn代码吧不需要了</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">当然这里有俩选择</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">要么做成一个<a href="https://link.juejin.im/?target=https%3A%2F%2Fcn.vuejs.org%2Fv2%2Fguide%2Fcomponents.html%23%25E5%25BC%2582%25E6%25AD%25A5%25E7%25BB%2584%25E4%25BB%25B6" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">异步组件</a>，单独打包，按需载入</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">要么直接引入到<code>main.js</code>中将包打成为一个巨无霸</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">所以我选择前者，</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">首先老规矩 引入编辑器主体</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">import <span style="color: #dd1144;">'../../static/tinymce/tinymce.min.js'</span><span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后刷新下页面，不出意外应该是报这么个错<code>Uncaught SyntaxError: Unexpected token &lt;</code></p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">眼尖的朋友应该知道是怎么回事了<code>theme.js:1</code></p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">在默认配置下， tinymce载入的theme的路径居然是这个</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;"><code>Request URL:http://localhost:8080/themes/modern/theme.js</code></p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后我跑去官网搜了下api 只搜到一个叫<a href="https://link.juejin.im/?target=https%3A%2F%2Fwww.tinymce.com%2Fdocs%2Fconfigure%2Furl-handling%2F%23document_base_url" target="_blank" rel="nofollow noopener noreferrer" style="margin: initial; background-color: transparent; text-decoration-line: none; cursor: pointer; color: #0269c8; border-bottom: 1px solid #d1e9ff;">document_base_url</a>的api，但是根据多年程序员的直觉经验告诉我 不是这货（嗯，我在这里卡住了），网上翻了下各地文献，都没有啊，</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">那怎么办呢</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">于是我就跑去看源码...但是4万行...算了...</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后我就在控台打印了下tinymce对象，然后发现了一个叫<code>baseURL</code>的<code>string</code>对象，嗯，有希望了。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">在源码里搜了下baseURL</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">蹦出来这段代码 .... 算了有很多段...</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">大致思想就是通过当前URI拆出来个baseURL,改掉就行了</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">window.tinymce.baseURL = <span style="color: #dd1144;">'/static/tinymce'</span><span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">如果需要载入的地址是另一个比如自己公司的cdn的路径，那改成全路径就行了</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">window.tinymce.baseURL = <span style="color: #dd1144;">'http://cdn.xxx.com/static/tinymce'</span><span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">貌似路径的问题解决了</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">但是新的问题又出现了，</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">插件下过来都是带min的，但默认载入的插件都是不带min的，一定是我源码没看仔细，</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后我又搜了一下代码</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;"><span style="font-weight: 700;">if</span> (!baseURL &amp;&amp; document.currentScript) {   src = document.currentScript.src;   <span style="font-weight: 700;">if</span> (src.indexOf(<span style="color: #dd1144;">'.min'</span>) != -1) {     suffix = <span style="color: #dd1144;">'.min'</span>;   }   baseURL = src.substring(0, src.lastIndexOf(<span style="color: #dd1144;">'/'</span>)); }<span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">希望就在眼前，貌似是业务我载入的方式是直接导入到模块的，于是一个叫<code>suffix</code>的默认值为空了，于是我去又加了行代码：</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">window.tinymce.suffix = <span style="color: #dd1144;">'.min'</span><span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">成功！</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">你看嘛，超级简单的是不是，根本不用改源码，网上说的动不动就去改源码什么的不要信啊不要信，大部分面向对象的事情改个默认值就行了。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">对了,还记得前面的语言包嘛，</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">下过来塞到<code>/static/tinymce/langs</code>文件夹里</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后删掉</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">import <span style="color: #dd1144;">'./zh_CN.js'</span><span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">这行代码</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">在<code>DefaultConfig</code>中放入一个新配置项</p><div><pre><code><code bash=""  copyable"="" style="font-family: Menlo, Monaco, Consolas, &quot;Courier New&quot;, monospace; font-size: 1rem; padding: 18px 15px 12px; word-break: normal; background: #f8f8f8; border-radius: 2px; overflow-x: auto; margin: 0px; display: block;">language: <span style="color: #dd1144;">'zh_CN'</span><span style="position: absolute; top: 6px; right: 15px; font-size: 12px; line-height: 1; cursor: pointer; color: rgba(140, 140, 140, 0.8); transition: color 0.1s ease 0s;">复制代码</span></code></pre></div><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">好了，后面就是模块打包的事情了,</p><h2>打包</h2><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">前面打的包有一个问题是默认配置是载入tinyMce本体，那么就会造成这个包大概有500k的体积，如果这个组件不做异步载入的处理，那么对于某些业务来说就是灾难。虽然这么做打开只用载入一个文件，业务比较稳定。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">但我觉得这样不优雅所以最后还是把它单独拎出来了。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">同理，根据这个库本身的特性，我们完全可以把这么多个必须的<code>plugin</code>按需要直接统一打成一个包，直接载入。这样，我们就又多了一个几百k的plugins包。</p><p style="line-height: inherit; margin-top: 22px; margin-bottom: 22px;">然后把<code>plugins包和tinyMce主体包</code>在不阻塞页面加载的情况下，做个懒加载提前缓存好文件方便后面使用，而组件本身在挂载前做个监听window.tinymce全局变量的方法，然后cdn控制下文件的过期时间即可。</p></div>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>