<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题</center></div><div class='banquan'>原文出处:本文由博客园博主TDX提供。<br/>
原文连接:https://www.cnblogs.com/tandaxia/p/11368789.html</div><br>
    <p>　　在react页面内嵌&ldquo;微信二维码&rdquo;，实现PC端通过微信扫码进行登录。首先去<a href="https://open.weixin.qq.com/" target="_blank">微信开放平台</a>注册一个账号，创建一个网站应用，提交网站备案审核，获取appid和appsecret；其他开发流程根据<a href="https://open.weixin.qq.com/cgi-bin/showdocument?action=dir_list&amp;t=resource/res_list&amp;verify=1&amp;id=open1419316505&amp;token=2260fc0522c846fd91ab81ca5c8004366a950679&amp;lang=zh_CN" target="_blank">微信文档</a>来进行操作。</p>
<p>react页面部分代码，引入内嵌二维码脚本，设置iframe标签支持跨域，自定义二维码样式：</p>
<p><img src="./images/react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题0.png" alt="" /></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('a24d115e-a0c1-47e7-974a-ad9389a435d3')"><img id="code_img_closed_a24d115e-a0c1-47e7-974a-ad9389a435d3" class="code_img_closed" src="./images/react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题1.png" alt="" /><img id="code_img_opened_a24d115e-a0c1-47e7-974a-ad9389a435d3" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a24d115e-a0c1-47e7-974a-ad9389a435d3',event)" src="./images/react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题2.png" alt="" />
<div id="cnblogs_code_open_a24d115e-a0c1-47e7-974a-ad9389a435d3" class="cnblogs_code_hide">
<pre><code><span style="color: #000000;">componentWillMount(){
        </span><span style="color: #008000;">//</span><span style="color: #008000;">引入&ldquo;微信内嵌二维码&rdquo;脚本</span>
        <span style="color: #0000ff;">var</span> script = document.createElement('script'<span style="color: #000000;">);
        script.type </span>= 'text/javascript'<span style="color: #000000;">;
        script.async </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
        script.src </span>= 'https://res.wx.qq.com/connect/zh_CN/htmledition/js/wxLogin.js'<span style="color: #000000;">;
        document.head.appendChild(script);
    }

    componentDidMount(){
        </span><span style="color: #008000;">/*</span><span style="color: #008000;">*
         * ... other code
         * </span><span style="color: #008000;">*/</span>

        <span style="color: #008000;">//</span><span style="color: #008000;">加载微信二维码</span>
        setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;">() {
            </span><span style="color: #008000;">/*</span><span style="color: #008000;">*
             * 微信内嵌二维码自定义样式有两种方式实现
             * 第一种是把自定义样式写在一个css文件里面，部署到一个https链接上
             * 第二种是把自定义样式通过base64加密后设置在href上
             * </span><span style="color: #008000;">*/</span>
            <span style="color: #0000ff;">var</span> customeStyle = "data:text/css;base64,Lnd4X3FyY29kZSBpZnJhbWUgeyB3aWR0aDogMTYwcHg7IGhlaWdodDogMTYwcHg7IG1hcmdpbjogMDsgcGFkZGluZzogMDsgfQ0KLmxvZ2luUGFuZWwgeyBtYXJnaW46MDsgcGFkZGluZzogMDsgfQ0KLmxvZ2luUGFuZWwgLnRpdGxlLCAubG9naW5QYW5lbCAuaW5mbyB7IGRpc3BsYXk6IG5vbmU7IH0NCi5pbXBvd2VyQm94IC5xcmNvZGUgeyBtYXJnaW46IDA7IHdpZHRoOiAxNjBweDsgYm9yZGVyOiBub25lOyB9"<span style="color: #000000;">;

            </span><span style="color: #0000ff;">new</span><span style="color: #000000;"> WxLogin({
                self_redirect: </span><span style="color: #0000ff;">false</span><span style="color: #000000;">,
                id: </span>"wx_login_container"<span style="color: #000000;">,
                appid: </span>"wx0*************", <span style="color: #008000;">//</span><span style="color: #008000;">微信开放平台网站应用appid</span>
                scope: "snsapi_login"<span style="color: #000000;">,
                redirect_uri: encodeURI(location.origin), </span><span style="color: #008000;">//</span><span style="color: #008000;">设置扫码成功后回调页面</span>
                state: "" + (<span style="color: #0000ff;">new</span><span style="color: #000000;"> Date()).getTime(),
                style: </span>"black"<span style="color: #000000;">,
                href: customeStyle, </span><span style="color: #008000;">//</span><span style="color: #008000;">location.origin + "/css/wx_qrcode.css", //自定义微信二维码样式文件</span>
<span style="color: #000000;">            });

            </span><span style="color: #008000;">//</span><span style="color: #008000;">设置iframe标签可以进行跨域跳转</span>
            <span style="color: #0000ff;">var</span> qrcodeBox = document.getElementById("wx_login_container"<span style="color: #000000;">);
            </span><span style="color: #0000ff;">var</span> iframes = qrcodeBox.getElementsByTagName("iframe"<span style="color: #000000;">);

            </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (iframes.length){
                </span><span style="color: #0000ff;">var</span> ifr = iframe[0<span style="color: #000000;">];
                ifr.setAttribute(</span>"sandbox", "allow-scripts allow-top-navigation allow-same-origin"<span style="color: #000000;">);
            }
        }, </span>1000<span style="color: #000000;">)
    }</span></pre>
</div>
<span class="cnblogs_code_collapse">View Code</span></div>
<p>因为默认内嵌二维码的尺寸固定，有头部标题，还是底部提示文字，所以如果想修改二维码尺寸和隐藏标题和提示文字，需要自定义样式来控制。微信接口也提供了一个href属性来进行自定义样式。</p>
<p>自定义样式有两种方式：</p>
<pre><code>* 第一种是把自定义样式写在一个css文件里面，部署到一个https链接上<br />* 第二种是把自定义样式通过base64加密后设置在href上</pre>
<p><img src="./images/react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题3.png" alt="" /></p>
<pre><code>相对而言，第二种方式更方便。</pre>
<p>最后效果图</p>
<p><img src="./images/react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题4.png" alt="" /></p>
<p>&nbsp;</p>
<p>另外，如果有要求对于同一个微信用户，不管他是在PC端扫码登录，还是在微信网页授权登录，必须识别成同一个用户，则需要把<a href="https://open.weixin.qq.com" target="_blank">微信开放平台</a>和<a href="https://mp.weixin.qq.com/" target="_blank">微信公众平台</a>账号关联起来。</p>
<p>&nbsp;对于微信授权登录的用户，微信提供的唯一标识符就是unionId, 对于这个需求，在<a href="https://mp.weixin.qq.com/wiki?t=resource/res_main&amp;id=mp1421140842" target="_blank">公众平台文档</a>上有提到：</p>
<p>&nbsp;<img src="./images/react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题5.png" alt="" /></p>
<p><img src="./images/react页面内嵌微信二维码 和 自定义样式 以及 微信网页共用unionId问题6.png" alt="" /></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>