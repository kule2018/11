<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）</center></div><div class='banquan'>原文出处:本文由博客园博主resirben提供。<br/>
原文连接:https://www.cnblogs.com/lamian77/p/11596698.html</div><br>
    <p><span style="font-family: 'Microsoft YaHei';"><span style="font-size: 16px;"><strong>瀑布流&nbsp;</strong></span>又称瀑布流式布局，是比较流行的一种网站页面布局方式。即多行等宽元素排列，后面的元素依次添加到其后，等宽不等高，根据图片原比例缩放直至宽度达到我们的要求，依次按照规则放入指定位置。</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><img src="./images/关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）0.png" alt="" /></span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-size: 16px; font-family: 'Microsoft YaHei';"><strong>为什么使用瀑布流</strong></span></p>
<p><span style="font-family: 'Microsoft YaHei';">瀑布流布局在我们现在的前端页面中经常会用的到，它可以有效的降低页面的复杂度，节省很多的空间，对于整个页面不需要太多的操作，只需要下拉就可以浏览用户需要看到的数据；并且，在当前这个APP至上的时代，瀑布流可以提供很好的用户体验，通过结合下拉刷新，上拉加载进行数据的懒加载等操作，对于用户的体验感来说是接近于满分的！</span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-size: 16px; font-family: 'Microsoft YaHei';"><strong>瀑布流的特点</strong></span></p>
<p><span style="font-family: 'Microsoft YaHei';">其实瀑布流的特点就是参差不齐的排列方式，以及流式布局的扩展性，可以通过界面展示给用户多条数据，并且让用户可以有向下浏览的冲动。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-size: 16px; font-family: 'Microsoft YaHei';"><strong>瀑布流的代码实现</strong></span></p>
<p><span style="font-family: 'Microsoft YaHei';"><strong>1.纯 css 瀑布流：（ multi-columns 方法 ）</strong></span></p>
<p><span style="font-size: 13px; font-family: 'Microsoft YaHei';">// 这里是第一次接触到 column-columns 这个属性，这是一个可以设置将div元素中的文本分成几列</span></p>
<p><span style="font-size: 13px; font-family: 'Microsoft YaHei';">//默认值是：auto</span></p>
<p><span style="font-size: 13px; font-family: 'Microsoft YaHei';">//写法：</span></p>
<p><span style="font-size: 13px; font-family: 'Microsoft YaHei';">column-count:3;</span></p>
<p><span style="font-size: 13px; font-family: 'Microsoft YaHei';">-moz-column-count:3; /* Firefox */</span></p>
<p><span style="font-size: 13px; font-family: 'Microsoft YaHei';">-webkit-column-count:3; /* Safari and Chrome */</span></p>
<p><span style="font-size: 13px; font-family: 'Microsoft YaHei';">/* 注意：IE9及更早 IE 版本浏览器不支持 column-count 属性 */</span></p>
<p><span style="font-size: 13px; font-family: 'Microsoft YaHei';">//这里还会用到另一个属性 column-gap，用来调整边距，实现瀑布流布局</span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-family: 'Microsoft YaHei';">html结构代码如下：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-family: 'Microsoft YaHei';"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="demo-1"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;"> 2</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-lar"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="height:100px;"</span> <span style="color: #0000ff;">&gt;</span> 1<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;"> 6</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-sma"</span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">="height:150px;"</span> <span style="color: #0000ff;">&gt;</span> 2<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 8</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;"> 9</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-mid"</span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">="height:50px;"</span> <span style="color: #0000ff;">&gt;</span> 3<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">10</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">11</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">12</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-sma"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="height:200px;"</span> <span style="color: #0000ff;">&gt;</span> 4<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">13</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">14</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">15</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-mid"</span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">="height:60px;"</span> <span style="color: #0000ff;">&gt;</span> 5 <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">16</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">17</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">18</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-lar"</span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">="height:90px;"</span> <span style="color: #0000ff;">&gt;</span> 6<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">19</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">20</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">21</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-sma"</span><span style="color: #0000ff;">&gt;</span> 7<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">22</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">23</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">24</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-lar"</span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">="height:120px;"</span> <span style="color: #0000ff;">&gt;</span> 8<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">25</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">26</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">27</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-lar"</span><span style="color: #0000ff;">&gt;</span> 9<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">28</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">29</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">30</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-sma"</span><span style="color: #ff0000;"> style</span><span style="color: #0000ff;">="height:100px;"</span> <span style="color: #0000ff;">&gt;</span> 10 <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">31</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">32</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">33</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-mid"</span><span style="color: #0000ff;">&gt;</span> 11 <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">34</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">35</span>     <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item"</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">36</span>         <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="item_content content-mid"</span><span style="color: #ff0000;">style</span><span style="color: #0000ff;">="height:100px;"</span> <span style="color: #0000ff;">&gt;</span> 12<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span> 
<span style="color: #008080;">37</span>     <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;">38</span>     <span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> more items </span><span style="color: #008000;">--&gt;</span> 
<span style="color: #008080;">39</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span></span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-family: 'Microsoft YaHei';">CSS代码如下：</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-family: 'Microsoft YaHei';"><span style="color: #008080;"> 1</span> <span style="color: #000000;">.demo-1{ 
</span><span style="color: #008080;"> 2</span> <span style="color: #000000;">       -moz-column-count:3; /* Firefox */
</span><span style="color: #008080;"> 3</span> <span style="color: #000000;">       -webkit-column-count:3; /* Safari 和 Chrome */
</span><span style="color: #008080;"> 4</span> <span style="color: #000000;">       column-count:3;
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">       -moz-column-gap: 1em;
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">       -webkit-column-gap: 1em;
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">       column-gap: 1em;
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">       width: 80%;
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">       margin:0 auto;
</span><span style="color: #008080;">10</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">11</span> <span style="color: #000000;">    .item { 
</span><span style="color: #008080;">12</span> <span style="color: #000000;">        padding: 2em;
</span><span style="color: #008080;">13</span> <span style="color: #000000;">        margin-bottom: 2em;
</span><span style="color: #008080;">14</span> <span style="color: #000000;">        -webkit-column-break-inside: avoid;
</span><span style="color: #008080;">15</span> <span style="color: #000000;">        break-inside: avoid; /*防止断点*/
</span><span style="color: #008080;">16</span> <span style="color: #000000;">        background: #ccc;
</span><span style="color: #008080;">17</span> <span style="color: #000000;">        text-align: center;
</span><span style="color: #008080;">18</span>     }</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-family: 'Microsoft YaHei';">效果图：</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><img src="./images/关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）1.png" alt="" /></span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-family: 'Microsoft YaHei';">这里有个弊端，这并不符合瀑布流的原理，如果使用纯css写瀑布流，则每一块都是从上往下排列，不能做到从左到右排列，并且不会识别哪一块图片放在哪个地方合适，若是再配合动态加载，效果会特别不好，所以只能通过JS来实现瀑布流。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">那么这里用图片来分析一下我们想要的瀑布流是什么样的。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><strong><span style="font-size: 16px;">瀑布流的位置分析图解</span></strong></span></p>
<p><span style="font-size: 14px; font-family: 'Microsoft YaHei';">如下方图片。假设一排放5张图片。当第一排排满足够多的等宽图片时，显示的是这样的。那么假如我们要放第6张图片的时候，应该放在什么位置呢？</span></p>
<p><span style="font-size: 14px; font-family: 'Microsoft YaHei';"><img src="./images/关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）2.png" alt="" /></span></p>
<p><span style="font-family: 'Microsoft YaHei';">如果按照我们的正常逻辑来想，应该是放在第一张图片下面，依次水平排列过去（如下图）</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><img src="./images/关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）3.png" alt="" /></span></p>
<p><span style="font-family: 'Microsoft YaHei';">但现实并非如此！在瀑布流中，从第2行开始，接下去的每一张图片都会放在上行中高度最低的那一列图片下方。（如下图）</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><img src="./images/关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）4.png" alt="" /></span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-family: 'Microsoft YaHei';">为什么呢？因为放置它之前，这一列的高度为所有列中最小，所以会放置在这个地方。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">那么如果再继续放置下去，第七张图片应该放在第三列图片下方，以此类推。</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><img src="./images/关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）5.png" alt="" /></span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-family: 'Microsoft YaHei';">所以每次加载图片时，会需要判断哪一列的图片累计的高度最小，那么下一张图片就放在哪一列，即瀑布流算法去判断图片的确定位置。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-size: 16px; font-family: 'Microsoft YaHei';"><strong>JS代码实现</strong></span></p>
<p><span style="font-family: 'Microsoft YaHei';">实现思路：</span></p>
<ol>
<li><span style="font-family: 'Microsoft YaHei';">　　设定每一列图片的宽度和间距</span></li>
<li><span style="font-family: 'Microsoft YaHei';">　　获取当前窗口的总宽度，从而根据图片宽度去旁段分成几列</span></li>
<li><span style="font-family: 'Microsoft YaHei';">　　获取所有图片元素，定义一个空数组来保存高度</span></li>
<li><span style="font-family: 'Microsoft YaHei';">　　遍历所有容器，开始判断　　当页面加载完成，或页面宽度发生变化时，调用函数。</span>
<ul>
<li>如果当前处于第一行时： 直接设置图片位置【 即 top为间距的大小，left为（当前图片的宽度+间距） * 当前图片的值+间距大小 】，并保存当前元素高度。</li>
<li>如果当前不处于第一行时：进行高度对比，通过遍历循环，拿到最小高度和相对应的索引，设置图片位置【 即 top为最小高度值+间距*2，left为 （当前图片的宽度+间距） *&nbsp;索引 值+间距大小）】，并修改当前索引的高度为当前元素高度。</li>
</ul>
</li>
<li>　　当页面加载完成，或页面宽度发生变化时，调用函数。</li>
</ol>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
<p><span style="font-family: 'Microsoft YaHei';">代码实现</span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text/javascript"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #008080;"> 2</span>     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 定义瀑布流算法函数</span>
<span style="color: #008080;"> 3</span>     <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> fall() {
</span><span style="color: #008080;"> 4</span> <span style="background-color: #f5f5f5; color: #000000;">        const minGap </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">20</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 最小间距，让每一列的最小空隙可以自定义，避免太过拥挤的情况发生。但是，会通过计算得到真实的间距。</span>
<span style="color: #008080;"> 5</span> <span style="background-color: #f5f5f5; color: #000000;">        const itemWidth </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">300</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 每一项的宽度，即当前每一个图片容器的宽度。保证每一列都是等宽不等高的。</span>
<span style="color: #008080;"> 6</span> <span style="background-color: #f5f5f5; color: #000000;">        const scrollBarWidth </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> getScrollbarWidth();    </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 获取滚动条的宽度</span>
<span style="color: #008080;"> 7</span> <span style="background-color: #f5f5f5; color: #000000;">        const pageWidth </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> window.innerWidth </span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;"> scrollBarWidth; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 获取当前页面的宽度 = window.innerWidth - 滚动条的宽度</span>
<span style="color: #008080;"> 8</span> <span style="background-color: #f5f5f5; color: #000000;">        const column </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> Math.floor(pageWidth </span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;"> (itemWidth </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> minGap)); </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 实际列数=页面宽度/(图片宽度+最小间距)</span>
<span style="color: #008080;"> 9</span> <span style="background-color: #f5f5f5; color: #000000;">        const gap </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> (pageWidth </span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;"> itemWidth </span><span style="background-color: #f5f5f5; color: #000000;">*</span><span style="background-color: #f5f5f5; color: #000000;"> column) </span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;"> column</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">2; </span><span style="color: #339966;"><span style="background-color: #f5f5f5;">/</span><span style="background-color: #f5f5f5;">/</span><span style="background-color: #f5f5f5;"> 计算真实间距 </span><span style="background-color: #f5f5f5;">=</span><span style="background-color: #f5f5f5;"> (页面宽度</span><span style="background-color: #f5f5f5;">-</span><span style="background-color: #f5f5f5;"> 图片宽度</span><span style="background-color: #f5f5f5;">*</span><span style="background-color: #f5f5f5;">实际列数)</span><span style="background-color: #f5f5f5;">/</span><span style="background-color: #f5f5f5;">实际列数</span><span style="background-color: #f5f5f5;">/</span><span style="background-color: #f5f5f5;">2</span></span>
<span style="color: #008080;">10</span> <span style="background-color: #f5f5f5; color: #000000;">        const items </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.querySelectorAll(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">img</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">); </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 获取所有的外层元素</span>
<span style="color: #008080;">11</span> <span style="background-color: #f5f5f5; color: #000000;">        const heightArr </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> []; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 定义一个空数组，保存最低高度。</span>
<span style="color: #008080;">12</span>         
<span style="color: #008080;">13</span>         <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 获取滚动条的宽度</span>
<span style="color: #008080;">14</span>         <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> getScrollbarWidth() {
</span><span style="color: #008080;">15</span> <span style="background-color: #f5f5f5; color: #000000;">            const oDiv </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.createElement(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">div</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);</span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">创建一个div</span>
<span style="color: #008080;">16</span>             <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 给div设置样式。随便定义宽高，只要能获取到滚动条就可以</span>
<span style="color: #008080;">17</span> <span style="background-color: #f5f5f5; color: #000000;">            oDiv.style.cssText </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> `width: 50px;height: 50px;overflowY: scroll;` 
</span><span style="color: #008080;">18</span> <span style="background-color: #f5f5f5; color: #000000;">            document.body.appendChild(oDiv);</span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">把div添加到body中</span>
<span style="color: #008080;">19</span> <span style="background-color: #f5f5f5; color: #000000;">            const scrollbarWidth </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> oDiv.offsetWidth </span><span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;"> oDiv.clientWidth;</span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 使最大宽度和可视宽度相减，获得到滚动条宽度。</span>
<span style="color: #008080;">20</span> <span style="background-color: #f5f5f5; color: #000000;">            oDiv.remove();</span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">移除创建的div</span>
<span style="color: #008080;">21</span>             <span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> scrollbarWidth;</span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">返回滚动条宽度</span>
<span style="color: #008080;">22</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">23</span>         
<span style="color: #008080;">24</span>         
<span style="color: #008080;">25</span>         <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (let i </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> items.length; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
</span><span style="color: #008080;">26</span>             <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 遍历所有的外层容器</span>
<span style="color: #008080;">27</span> <span style="background-color: #f5f5f5; color: #000000;">            const height </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> items[i].offsetHeight;
</span><span style="color: #008080;">28</span>             <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 如果当前处在第一行</span>
<span style="color: #008080;">29</span>             <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> column) {
</span><span style="color: #008080;">30</span>                 <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 直接设置元素距离上部的位置和距离左边的距离。</span>
<span style="color: #008080;">31</span> <span style="background-color: #f5f5f5; color: #000000;">                items[i].style.cssText </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> `top: ${gap}px;left: ${(itemWidth </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> gap) </span><span style="background-color: #f5f5f5; color: #000000;">*</span><span style="background-color: #f5f5f5; color: #000000;"> i </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> gap}px`;
</span><span style="color: #008080;">32</span>                 <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 保存当前元素的高度。</span>
<span style="color: #008080;">33</span> <span style="background-color: #f5f5f5; color: #000000;">                heightArr.push(height);
</span><span style="color: #008080;">34</span> <span style="background-color: #f5f5f5; color: #000000;">            } </span><span style="background-color: #f5f5f5; color: #0000ff;">else</span><span style="background-color: #f5f5f5; color: #000000;"> {
</span><span style="color: #008080;">35</span>                 <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 不是第一行的话，就进行比对。</span>
<span style="color: #008080;">36</span> <span style="background-color: #f5f5f5; color: #000000;">                let minHeight </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> heightArr[</span><span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">]; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 先保存第一项的高度</span>
<span style="color: #008080;">37</span> <span style="background-color: #f5f5f5; color: #000000;">                let minIndex </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 保存第一项的索引值</span>
<span style="color: #008080;">38</span>                 <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (let j </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; j </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> heightArr.length; j</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
</span><span style="color: #008080;">39</span>                     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 通过循环遍历比对，拿到最小值和最小值的索引。</span>
<span style="color: #008080;">40</span>                     <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (minHeight </span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;"> heightArr[j]) {
</span><span style="color: #008080;">41</span> <span style="background-color: #f5f5f5; color: #000000;">                        minHeight </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> heightArr[j];
</span><span style="color: #008080;">42</span> <span style="background-color: #f5f5f5; color: #000000;">                        minIndex </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> j;
</span><span style="color: #008080;">43</span> <span style="background-color: #f5f5f5; color: #000000;">                    }
</span><span style="color: #008080;">44</span> <span style="background-color: #f5f5f5; color: #000000;">                }
</span><span style="color: #008080;">45</span>                 <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 通过最小值为当前元素设置top值，通过索引为当前元素设置left值。</span>
<span style="color: #008080;">46</span> <span style="background-color: #f5f5f5; color: #000000;">                items[i].style.cssText </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> `top: ${minHeight </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> gap </span><span style="background-color: #f5f5f5; color: #000000;">*</span><span style="background-color: #f5f5f5; color: #000000;">2</span><span style="background-color: #f5f5f5; color: #000000;">}px; left: ${(itemWidth </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> gap) </span><span style="background-color: #f5f5f5; color: #000000;">*</span><span style="background-color: #f5f5f5; color: #000000;"> minIndex </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> gap}px`;
</span><span style="color: #008080;">47</span>                 <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 并修改当前索引的高度为当前元素的高度</span>
<span style="color: #008080;">48</span> <span style="background-color: #f5f5f5; color: #000000;">                heightArr[minIndex] </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> minHeight </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> gap </span><span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> height;
</span><span style="color: #008080;">49</span> <span style="background-color: #f5f5f5; color: #000000;">            }
</span><span style="color: #008080;">50</span> <span style="background-color: #f5f5f5; color: #000000;">        }
</span><span style="color: #008080;">51</span> <span style="background-color: #f5f5f5; color: #000000;">    }
</span><span style="color: #008080;">52</span>     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 页面加载完成调用一次。</span>
<span style="color: #008080;">53</span> <span style="background-color: #f5f5f5; color: #000000;">    window.onload </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> fall;
</span><span style="color: #008080;">54</span>     <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 页面尺寸发生改变再次调用。</span>
<span style="color: #008080;">55</span> <span style="background-color: #f5f5f5; color: #000000;">    window.onresize </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> fall;
</span><span style="color: #008080;">56</span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family: 'Microsoft YaHei';">最终效果图：</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><img src="./images/关于瀑布流的布局原理分析（纯CSS瀑布流与JS瀑布流）6.png" alt="" />&nbsp;</span></p>
<p><span style="font-size: 16px; font-family: 'Microsoft YaHei';"><strong>总结瀑布流布局原理</strong></span></p>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">设置图片宽度一致</span></li>
<li><span style="font-family: 'Microsoft YaHei';">根据浏览器宽度以及每列宽度计算出列表个数，列表默认0</span></li>
<li><span style="font-family: 'Microsoft YaHei';">当图片加载完成，所有图片依次放置在最小的列数下面</span></li>
<li><span style="font-family: 'Microsoft YaHei';">父容器高度取列表数组的最大值</span></li>
</ul>
<p><span style="font-size: 16px; font-family: 'Microsoft YaHei';"><strong>引申知识点</strong></span></p>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">let，const以及var三者的区别</span></li>
<li><span style="font-family: 'Microsoft YaHei';">滚动加载图片（懒加载原理）</span></li>
<li><span style="font-family: 'Microsoft YaHei';">反撇号（`）基础知识</span></li>
<li><span style="font-family: 'Microsoft YaHei';">style和style.cssTest 的区别</span></li>
</ul>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;</span></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>