<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别</center></div><div class='banquan'>原文出处:本文由博客园博主RopeHuo提供。<br/>
原文连接:https://www.cnblogs.com/rope/p/10726134.html</div><br>
    <h1><strong><span style="font-family: 宋体;">一、</span>Express<span style="font-family: 宋体;">框架</span></strong></h1>
<h2><strong>1.1<span style="font-family: 宋体;">基本使用</span></strong></h2>
<p><span style="font-family: 宋体;">创建</span>http<span style="font-family: 宋体;">服务器特别麻烦，</span><span style="font-family: Consolas;">express</span><span style="font-family: 宋体;">框架解决了这个的问题。</span></p>
<p>Express<span style="font-family: 宋体;">在</span><span style="font-family: Consolas;">node</span><span style="font-family: 宋体;">界的地位，就相当于</span><span style="font-family: Consolas;">jQuery</span><span style="font-family: 宋体;">在</span><span style="font-family: Consolas;">DOM</span><span style="font-family: 宋体;">界的地位。</span><span style="font-family: Consolas;">jQuery</span><span style="font-family: 宋体;">的核心就是&ldquo;批量&rdquo;，</span><span style="font-family: Consolas;">1</span><span style="font-family: 宋体;">个</span><span style="font-family: Consolas;">jQuery</span><span style="font-family: 宋体;">对象中可以封装多个原生对象。</span><span style="font-family: Consolas;">Express</span><span style="font-family: 宋体;">的核心就是中间件，</span><span style="font-family: Consolas;">Express</span><span style="font-family: 宋体;">说大真心不大，主要是因为他做的事儿大，而不是这个框架的功能多。</span></p>
<p><span style="font-family: 宋体;"><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别0.png" alt="" /></span></p>
<p>&nbsp;</p>
<p>中文官网（实际上也是英语的）：<a href="http://www.expressjs.com.cn/"><span style="text-decoration: underline;">http://www.expressjs.com.cn/</span></a></p>
<p><span style="font-family: 宋体;">基于</span> Node.js <span style="font-family: 宋体;">平台，快速、开放、极简的 </span><span style="font-family: Consolas;">web </span><span style="font-family: 宋体;">开发框架。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">以后的项目都先创建项目身份证，记录依赖：
npm init
安装依赖：
npm install express </span>--save</pre>
</div>
<p>&nbsp;</p>
<p>express<span style="font-family: 宋体;">框架的</span><span style="font-family: Consolas;">API</span><span style="font-family: 宋体;">非常简单</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> express = require("express"); <span style="color: #008000;">//</span><span style="color: #008000;">返回的是一个函数</span>
<span style="color: #0000ff;">var</span> app = express();        <span style="color: #008000;">//</span><span style="color: #008000;">创建app，express函数执行返回一个app对象</span>

<span style="color: #008000;">//</span><span style="color: #008000;">当用户get请求访问/的时候</span>
app.get("/", (req,res)=&gt;<span style="color: #000000;">{
    </span><span style="color: #008000;">//</span><span style="color: #008000;">输出可用end()或send()方法，而且不用设置字符集，因为express封装好了</span>
    res.send("&lt;h1&gt;首页&lt;/h1&gt;"<span style="color: #000000;">);
})

</span><span style="color: #008000;">//</span><span style="color: #008000;">当用户get请求访问/music的时候</span>
app.get("/music", (req,res)=&gt;<span style="color: #000000;">{
    res.send(</span>"&lt;h1&gt;音乐频道&lt;/h1&gt;"<span style="color: #000000;">);
})

app.listen(</span>3000, <span style="color: #0000ff;">function</span><span style="color: #000000;">(err){
    console.log(</span>"3000端口"<span style="color: #000000;">)
})</span></pre>
</div>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别1.png" alt="" /><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别2.png" alt="" /></p>
<hr />
<h2><strong>1.2<span style="font-family: 宋体;">路由设计</span></strong></h2>
<p><span style="font-family: 宋体;">在路由字符串中</span>&ldquo;<span style="font-family: Consolas;">:</span><span style="font-family: 宋体;">&rdquo;开头表示一个待定文本（用户决定）：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">当用户get请求访问/music的时候</span>
app.get("/music/<span style="color: #ff0000;">:bianhao</span>", (req,res)=&gt;<span style="color: #000000;">{
    </span><span style="color: #ff0000;">var bh =</span><span style="color: #000000;"><span style="color: #ff0000;"> req.params.bianhao;</span>
    console.log(bh)
    res.send(</span>"&lt;h1&gt;编号为"+ <span style="color: #ff0000;">bh</span> +"音乐信息&lt;/h1&gt;"<span style="color: #000000;">);
})</span></pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别3.png" alt="" /></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code>app.get("<span style="color: #ff0000;">/:username</span>/follower", (req,res)=&gt;<span style="color: #000000;">{
    </span><span style="color: #ff0000;">var user =</span><span style="color: #000000;"><span style="color: #ff0000;"> req.params.username;</span>
    res.send(</span>"&lt;h1&gt;关注"+ user +"的人如下&lt;/h1&gt;"<span style="color: #000000;">);
})</span></pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别4.png" alt="" /></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code>app.get("/student/:banji/:bianhao", (req,res)=&gt;<span style="color: #000000;">{
    </span><span style="color: #0000ff;">var</span> banji =<span style="color: #000000;"> req.params.banji;
    </span><span style="color: #0000ff;">var</span> bianhao =<span style="color: #000000;"> req.params.bianhao;
    res.send(</span>"&lt;h1&gt;"+ banji +"班的"+ bianhao +"号学生信息&lt;/h1&gt;"<span style="color: #000000;">);
})</span></pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别5.png" alt="" /></p>
<p>&nbsp;</p>
<p>看以下两个路由：冲突时</p>
<div class="cnblogs_code">
<pre><code>app.get('/music/*', <span style="color: #0000ff;">function</span><span style="color: #000000;">(req, res){
    res.send(</span>'&lt;h1&gt;音乐频道子页面&lt;/h1&gt;'<span style="color: #000000;">);
});

</span><span style="color: #008000;">//</span><span style="color: #008000;">当用户get请求访问/music/xxx的时候</span>
app.get('/music/:bianhao', <span style="color: #0000ff;">function</span><span style="color: #000000;">(req, res){
    </span><span style="color: #0000ff;">var</span> bh =<span style="color: #000000;"> req.params.bianhao;
    res.send(</span>"&lt;h1&gt;编号为"+ bh +"音乐信息&lt;/h1&gt;"<span style="color: #000000;">);
});</span></pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别6.png" alt="" /></p>
<p><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">描述：如果中间件请求类型一样，而且</span>url<span style="font-family: 宋体;">一样，那么前者会覆盖后者，先写的就会拦截请求，不会让请求流向下执行。</span></strong></span></p>
<p>&nbsp;</p>
<p>注意：</p>
<p>l&nbsp;<span style="font-family: 宋体;">如果遇见覆盖问题，可以使用</span>next()<span style="font-family: 宋体;">方法，而且覆盖的函数不能有</span><span style="font-family: Consolas;">res.send()</span></p>
<p>l&nbsp;<span style="font-family: 宋体;">带一些数据</span>/xxx/:username/:xuehao <span style="font-family: 宋体;">获取的时候用</span><span style="font-family: Consolas;">req.params</span><span style="font-family: 宋体;">得到</span><span style="font-family: Consolas;">url</span></p>
<hr />
<h2><strong>1.3<span style="font-family: 宋体;">中间件</span></strong></h2>
<p>express<span style="font-family: 宋体;">可以非常方便的使用动词来描述用户访问这个</span><span style="font-family: Consolas;">url</span><span style="font-family: 宋体;">的请求类型，实际上是</span><span style="font-family: Consolas;">Nodejs</span><span style="font-family: 宋体;">原生的</span><span style="font-family: Consolas;">req.method</span><span style="font-family: 宋体;">属性封装的。</span></p>
<p><span style="font-family: 宋体;">概述：</span>app.<span style="font-family: 宋体;">动词（上行请求类型），一共</span><span style="font-family: Consolas;">26</span><span style="font-family: 宋体;">种</span></p>
<p>&nbsp;<a href="http://www.expressjs.com.cn/4x/api.html#app.METHOD"><span>http://www.expressjs.com.cn/4x/api.html#app.METHOD</span></a></p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别7.png" alt="" /></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> express = require("express"); <span style="color: #008000;">//</span><span style="color: #008000;">返回一个函数</span>
<span style="color: #0000ff;">var</span> app = express();    <span style="color: #008000;">//</span><span style="color: #008000;">创建app，express函数执行返回一个app对象</span>

<span style="color: #008000;">//</span><span style="color: #008000;">当用户get请求访问/的时候</span>
app.get('/', <span style="color: #0000ff;">function</span><span style="color: #000000;">(req, res){
    res.send(</span>'&lt;h1&gt;我是GET请求&lt;/h1&gt;'<span style="color: #000000;">);
});

</span><span style="color: #008000;">//</span><span style="color: #008000;">拦截前端发过来的各种请求</span><span style="color: #008000;">
//</span><span style="color: #008000;">拦截POST请求</span>
app.post('/tijiao', <span style="color: #0000ff;">function</span><span style="color: #000000;">(req, res){
    res.send(</span>'&lt;h1&gt;我是POST请求&lt;/h1&gt;'<span style="color: #000000;">);
});

</span><span style="color: #008000;">//</span><span style="color: #008000;">删除请求</span>
app.<span style="color: #0000ff;">delete</span>('/del', <span style="color: #0000ff;">function</span><span style="color: #000000;">(req, res){
    res.send(</span>'&lt;h1&gt;我是delete请求&lt;/h1&gt;'<span style="color: #000000;">);
});

</span><span style="color: #008000;">//</span><span style="color: #008000;">更新某一条数据的请求</span>
app.patch('/update', <span style="color: #0000ff;">function</span><span style="color: #000000;">(req, res){
    res.send(</span>'&lt;h1&gt;我是patch请求&lt;/h1&gt;'<span style="color: #000000;">);
});

</span><span style="color: #008000;">//</span><span style="color: #008000;">更新全部数据的请求</span>
app.checkout('/updates', <span style="color: #0000ff;">function</span><span style="color: #000000;">(req, res){
    res.send(</span>'&lt;h1&gt;我是checkout请求&lt;/h1&gt;'<span style="color: #000000;">);
});

app.listen(</span>3000,<span style="color: #0000ff;">function</span><span style="color: #000000;">(err){
    console.log(</span>"3000端口"<span style="color: #000000;">)
});</span></pre>
</div>
<hr />
<h2><strong>1.4<span style="font-family: 宋体;">响应输出方法</span></strong></h2>
<p><span style="font-family: 宋体;">以下是</span>node<span style="font-family: 宋体;">中响应输出的所有方法：</span></p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别8.png" alt="" /></p>
<div class="cnblogs_code">
<pre><code>app.get('/', <span style="color: #0000ff;">function</span><span style="color: #000000;">(req, res){
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> res.send('&lt;h1&gt;第一个输出方法&lt;/h1&gt;');</span>

    <span style="color: #008000;">//</span><span style="color: #008000;">输出JSON格式的数据</span>
    <span style="color: #008000;">//</span><span style="color: #008000;"> res.json({name:"小明", age:12, hobby:["吃饭","睡觉"]});</span>

    <span style="color: #008000;">//</span><span style="color: #008000;">输出JSONP格式的数据</span>
    <span style="color: #008000;">//</span><span style="color: #008000;"> res.jsonp({name:"小明", age:12, hobby:["吃饭","睡觉"]});</span>

    <span style="color: #008000;">//</span><span style="color: #008000;">重定向</span>
    res.redirect("http://www.baidu.com/"<span style="color: #000000;">);
});</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">前面学习过</span>fs<span style="font-family: 宋体;">模块，它主要是文件操作：</span></p>
<div class="cnblogs_code">
<pre><code>fs.readFile(path, <span style="color: #0000ff;">function</span><span style="color: #000000;">(err,data){

})</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">在</span>express<span style="font-family: 宋体;">中封装了一个函数叫</span><span style="font-family: Consolas;">sendFile()</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">渲染一个文件</span>
app.get("/ddd",(req,res)=&gt;<span style="color: #000000;">{
    console.log(__dirname);  </span><span style="color: #008000;">//</span><span style="color: #008000;">表示当前文件的绝对路径</span>
  <span style="color: #ff0000;">  res.sendFile(__dirname + "/images/1.jpg"</span><span style="color: #000000;"><span style="color: #ff0000;">);</span>
})</span></pre>
</div>
<hr />
<h2><strong>1.5<span style="font-family: 宋体;">静态资源服务</span></strong></h2>
<p><span style="font-family: 宋体;">概述：</span>express<span style="font-family: 宋体;">框架提供了一个方法，可以静态出一个文件夹</span><span style="font-family: Consolas;">(</span><span style="font-family: 宋体;">自动路由</span><span style="font-family: Consolas;">)</span><span style="font-family: 宋体;">；含义就是静态出去的文件夹当中文件之间，你可以使用相对路径，最爽的一件事，是静态出去的文件夹中的全部的文件你可以不用写路由了，因为</span><span style="font-family: Consolas;">express</span><span style="font-family: 宋体;">已经帮你做完了；</span></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">现在项目中有一个</span>www<span style="font-family: 宋体;">文件夹，此时要提供自动静态化路由：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> express = require("express"); <span style="color: #008000;">//</span><span style="color: #008000;">返回的是一个函数</span>
<span style="color: #0000ff;">var</span> app = express();        <span style="color: #008000;">//</span><span style="color: #008000;">创建app，express函数执行返回一个app对象</span>

<span style="color: #008000;">//</span><span style="color: #008000;">静态化一个文件夹（提供自动路由）</span>
app.use(express.static("www"<span style="color: #000000;">))

app.listen(</span>3000, ()=&gt;<span style="color: #000000;">{
    console.log(</span>"3000端口"<span style="color: #000000;">)
})</span></pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别9.png" alt="" /></p>
<p>&nbsp;</p>
<p>还可以给它改名：</p>
<div class="cnblogs_code">
<pre><code>app.use("/web", express.static("www"))</pre>
</div>
<p class="MsoNormal"><a href="http://127.0.0.1:3000/web/"><span style="text-decoration: underline;"><span class="15" style="font-family: 宋体; color: #0000ff;">http://127.0.0.1:3000/web/</span></span></a></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> express = require("express"); <span style="color: #008000;">//</span><span style="color: #008000;">返回的是一个函数</span>
<span style="color: #0000ff;">var</span> app = express();        <span style="color: #008000;">//</span><span style="color: #008000;">创建app，express函数执行返回一个app对象</span>

<span style="color: #008000;">//</span><span style="color: #008000;">静态化一个文件夹（提供自动路由）</span><span style="color: #008000;">
//</span><span style="color: #008000;"> app.use(express.static("www"))</span>
<span style="color: #ff0000;">app.use("/web", express.static("www"</span><span style="color: #000000;"><span style="color: #ff0000;">))</span>

app.get(</span>"/", (req,res)=&gt;<span style="color: #000000;">{
    res.send(</span>"&lt;h1&gt;首页&lt;/h1&gt;"<span style="color: #000000;">)
})

app.listen(</span>3000)</pre>
</div>
<hr />
<h1><strong><span style="font-family: 宋体; font-size: 18pt;"><span style="font-family: 宋体;">二、</span>ejs<span style="font-family: 宋体;">模板引擎</span></span></strong></h1>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;">ejs<span style="font-family: 宋体;">是</span><span style="font-family: Consolas;">JavaScript</span><span style="font-family: 宋体;">模板库，用来从</span><span style="font-family: Consolas;">JSON</span><span style="font-family: 宋体;">数据中生成</span><span style="font-family: Consolas;">HTML</span><span style="font-family: 宋体;">字符串。</span></span></p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;"><span style="font-family: 宋体;">问题：我们可以呈递一个</span>HTML<span style="font-family: 宋体;">页面，通过静态化</span><span style="font-family: Consolas;">www</span><span style="font-family: 宋体;">文件夹，</span><span style="font-family: Consolas;">sendFile</span><span style="font-family: 宋体;">。如果</span><span style="font-family: Consolas;">HTML</span><span style="font-family: 宋体;">页面上有待定的内容，怎么办？</span></span></p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;">&nbsp;</span></p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;"><span style="font-family: 宋体;">使用模板引擎，模板引擎叫</span>ejs<span style="font-family: 宋体;">（</span><span style="font-family: Consolas;">embed.js</span><span style="font-family: 宋体;">，嵌入式</span><span style="font-family: Consolas;">js</span><span style="font-family: 宋体;">）</span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">npm init
npm install </span>--<span style="color: #000000;">save express
npm install </span>--save ejs</pre>
</div>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">┣ views
┃ ┣ index.ejs
┣ app.js</span></pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;"><span style="font-family: 宋体;">准备</span>JSON<span style="font-family: 宋体;">数据：</span></span></p>
<p class="MsoNormal"><strong><span style="font-family: 宋体; font-size: 10.5pt;">data.json<span style="font-family: 宋体;">：</span></span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">[
    {
        </span>"name" : "小明"<span style="color: #000000;">,
        </span>"url" : "xiaoming"<span style="color: #000000;">
    }
.....
]</span></pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;">app.js：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> express = require("express"<span style="color: #000000;">);
</span><span style="color: #0000ff;">var</span> app =<span style="color: #000000;"> express();

</span><span style="color: #008000;">//</span><span style="color: #008000;">设置默认使用的模板引擎</span>
<span style="color: #ff0000;">app.set("view engine", "ejs"</span><span style="color: #000000;"><span style="color: #ff0000;">);</span>

app.get(</span>"/", (req,res)=&gt;<span style="color: #000000;">{
    <span style="color: #ff0000;">res.render(</span></span><span style="color: #ff0000;">"index");</span> <span style="color: #008000;">//</span><span style="color: #008000;">不需要写res.render("./views/index.ejs");</span>
<span style="color: #000000;">})

app.listen(</span>3000, ()=&gt;<span style="color: #000000;">{
    console.log(</span>"3000端口"<span style="color: #000000;">)
})</span></pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;">views/index.ejs<span style="font-family: 宋体;">文件：</span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html </span><span style="color: #ff0000;">lang</span><span style="color: #0000ff;">="en"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">meta </span><span style="color: #ff0000;">charset</span><span style="color: #0000ff;">="UTF-8"</span> <span style="color: #0000ff;">/&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>Document<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h1</span><span style="color: #0000ff;">&gt;</span>我是首页!!!!<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h1</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;">注意：</span></p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;"><span style="font-family: 宋体;">扩展名必须是</span>ejs<span style="font-family: 宋体;">，不是</span><span style="font-family: Consolas;">html</span></span></p>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;"><span style="font-family: 宋体;">文件夹必须叫</span>views<span style="font-family: 宋体;">，如果想改名，用以下方法：</span></span></p>
<div class="cnblogs_code">
<pre><code>app.set("views", "shitu");</pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;">ejs<span style="font-family: 宋体;">的使用类似</span><span style="font-family: Consolas;">underscore</span><span style="font-family: 宋体;">的模板标记</span><span style="font-family: Consolas;">&lt;% %&gt;</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">&lt;%= %&gt;</span><span style="font-family: 宋体;">来当做模板，与现有的</span><span style="font-family: Consolas;">html</span><span style="font-family: 宋体;">标记混用。和</span><span style="font-family: Consolas;">php</span><span style="font-family: 宋体;">干的事情是一样的。</span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>首页<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h1</span><span style="color: #0000ff;">&gt;</span>你好，我是首页<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h1</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>
        <span style="background-color: #ffff00; color: #000000;">&lt;%</span>
           <span style="color: #ff0000;"> <span style="background-color: #f5f5f5;">for</span><span style="background-color: #f5f5f5;">(var i </span><span style="background-color: #f5f5f5;">=</span> <span style="background-color: #f5f5f5;">0</span><span style="background-color: #f5f5f5;">; i </span><span style="background-color: #f5f5f5;">&lt;</span><span style="background-color: #f5f5f5;"> students.length; i</span><span style="background-color: #f5f5f5;">++</span><span style="background-color: #f5f5f5;">){
        </span></span><span style="background-color: #ffff00; color: #000000;">%&gt;</span>
           <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span><span style="background-color: #ffff00; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> students[i] </span><span style="background-color: #ffff00; color: #000000;">%&gt;</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span>
        <span style="background-color: #ffff00; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #ff0000;">
            }
        </span><span style="background-color: #ffff00; color: #000000;">%&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">ul</span><span style="color: #0000ff;">&gt;</span>

    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span>
        <span style="background-color: #ffff00; color: #000000;">&lt;%</span>
            <span style="color: #ff0000;"><span style="background-color: #f5f5f5;">for</span><span style="background-color: #f5f5f5;">(var i </span><span style="background-color: #f5f5f5;">=</span><span style="background-color: #f5f5f5;"> start; i </span><span style="background-color: #f5f5f5;">&lt;=</span> <span style="background-color: #f5f5f5;">end</span><span style="background-color: #f5f5f5;">; i</span><span style="background-color: #f5f5f5;">++</span><span style="background-color: #f5f5f5;">){
        </span></span><span style="background-color: #ffff00; color: #000000;">%&gt;</span>
            <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">option </span><span style="color: #ff0000;">value</span><span style="color: #0000ff;">="&lt;%= i %&gt;"</span><span style="color: #0000ff;">&gt;</span><span style="color: #ff0000;"><span style="background-color: #ffff00;">&lt;%</span><span style="background-color: #f5f5f5;">=</span><span style="background-color: #f5f5f5;"> i </span><span style="background-color: #ffff00;">%&gt;</span></span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">option</span><span style="color: #0000ff;">&gt;</span>
        <span style="background-color: #ffff00; color: #000000;">&lt;%</span><span style="background-color: #f5f5f5; color: #ff0000;">
            }
        </span><span style="background-color: #ffff00; color: #000000;">%&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">select</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;"><span style="font-family: 宋体;">此时</span>render<span style="font-family: 宋体;">的时候要模板传递数据：</span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">设置默认使用的模板引擎</span>
app.set("view engine" , "ejs"<span style="color: #000000;">);

app.get(</span>"/",(req,res)=&gt;<span style="color: #000000;">{
    res.render(</span>"index"<span style="color: #000000;">,<span style="color: #ff0000;">{
        </span></span><span style="color: #ff0000;">"students" : ["小明","小红","小强","小钢炮"],
        "start" :1970,
    　　"end" : 2018</span><span style="color: #000000;"><span style="color: #ff0000;">
    }</span>);   
});

app.listen(</span>3000,()=&gt;<span style="color: #000000;">{
    console.log(</span>3000<span style="color: #000000;">);
});</span></pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><span style="mso-spacerun: 'yes'; font-family: 宋体; mso-ascii-font-family: Consolas; mso-hansi-font-family: Consolas; mso-bidi-font-family: 'Times New Roman'; font-size: 10.5000pt; mso-font-kerning: 1.0000pt;"><span style="font-family: 宋体;">有时候</span>render<span style="font-family: 宋体;">之前需要查数据，此时有点</span><span style="font-family: Consolas;">MVC</span><span style="font-family: 宋体;">的感觉了：</span></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> fs = require("fs"<span style="color: #000000;">);
app.get(</span>"/",(req,res)=&gt;<span style="color: #000000;">{
    </span><span style="color: #008000;">//</span><span style="color: #008000;">先去读取&ldquo;模拟数据库&rdquo;</span>
    fs.readFile("./data/users.json",(err,data)=&gt;<span style="color: #000000;">{
        </span><span style="color: #008000;">//</span><span style="color: #008000;">得到了数据</span>
        <span style="color: #0000ff;">var</span> arr =<span style="color: #000000;"> JSON.parse(data.toString());
        </span><span style="color: #008000;">//</span><span style="color: #008000;">呈递页面</span>
       <span style="color: #ff0000;"> res.render("index",{
            "students"</span><span style="color: #000000;"><span style="color: #ff0000;"> : arr 
        });</span> 
    });
});

app.get(</span>"/:username",(req,res)=&gt;<span style="color: #000000;">{
    </span><span style="color: #008000;">//</span><span style="color: #008000;">得到待定用户名</span>
  <span style="color: #ff0000;">  var username = req.params.username;
    </span><span style="color: #008000;">//</span><span style="color: #008000;">先去读取&ldquo;模拟数据库&rdquo;</span>
    <span style="color: #ff0000;">fs.readFile("./data/users.json",(err,data)=&gt;{
        </span><span style="color: #008000;">//</span><span style="color: #008000;">得到了JSON数据</span>
        <span style="color: #ff0000;">var arr = JSON.parse(data.toString());
        </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历，看看谁的url和当前username相同</span>
        arr.forEach((item)=&gt;<span style="color: #000000;">{
            </span><span style="color: #0000ff;">if</span>(item.url ==<span style="color: #000000;"> username){
            </span><span style="color: #008000;">//</span><span style="color: #008000;">呈递页面渲染</span>
               <span style="color: #ff0000;"> res.render("myhome",{
                    "name"</span><span style="color: #000000;"><span style="color: #ff0000;"> : item.name
                });</span>
            }
        });
    });
});</span></pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><strong><span style="font-family: 宋体; font-size: 10.5pt;">data.json<span style="font-family: 宋体;">：</span></span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">[
    {
        </span>"name" : "小明"<span style="color: #000000;">,
        </span>"url" : "xiaoming"<span style="color: #000000;">
    }
]</span></pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><strong><span style="font-family: 宋体; font-size: 10.5pt;">myhome.ejs <span style="font-family: 宋体;">：</span></span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="container"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h1</span><span style="color: #0000ff;">&gt;</span><span style="color: #ff0000;"><span style="background-color: #ffff00;">&lt;%</span><span style="background-color: #f5f5f5;">=</span><span style="background-color: #f5f5f5;"> name </span><span style="background-color: #ffff00;">%&gt;</span></span>的小家<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h1</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p class="MsoNormal">&nbsp;</p>
<p class="MsoNormal"><strong><span style="font-family: 宋体; font-size: 10.5pt;">index.ejs<span style="font-family: 宋体;">：</span></span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;&lt;</span><span style="color: #800000;">a </span><span style="color: #ff0000;">href</span><span style="color: #0000ff;">="<span style="color: #ff0000;">&lt;%= students[i].url %&gt;</span>"</span><span style="color: #0000ff;">&gt;</span> <span style="color: #ff0000;"><span style="background-color: #ffff00;">&lt;%</span><span style="background-color: #f5f5f5;">=</span><span style="background-color: #f5f5f5;"> students[i].name </span><span style="background-color: #ffff00;">%&gt;</span></span> <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">a</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">li</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<hr />
<h1><!--[if !supportLists]-->三、<!--[endif]--><strong>复习</strong></h1>
<h1><span style="font-size: 14pt;">npm常用命令：</span></h1>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">　　npm init                        
　　　　创建一个package.json文件
　　npm install --save xxx  　　　
　　　　从npm下载包，自动安装到当前目录的node_modules文件夹，并添加依赖到package.json的dependencies对象<span style="color: #ff0000;">（--save可简写为-S）</span>
　　npm install --save-dev xxx     
　　　　从npm下载包，自动安装到当前目录的node_modules文件夹，并添加依赖到package.json的devDependencies对象<span style="color: #ff0000;">(--save-dev可简写为 -D）</span>
　　npm install xxx -g                
　　　　安装在全局环境中
　　npm root -g                    
　　　　查看全局路径
　　npm install                    
　　　　自动安装package.json的dependencies对象列出的所有依赖包<span style="color: #ff0000;">（install可简写为i）</span>
　　npm uninstall express --save    
　　　　卸载指定的模块
　　npm update express --save        
　　　　更新指定的模块
　　npm cache                         
　　　　管理模块的缓存
　　npm cache clean                  
　　　　清除模块缓存

另外，要学会使用淘宝镜像，会自己研究各种包的API。
cnpm install express --save</span></pre>
</div>
<hr />
<h2><strong>Express<span style="font-family: 宋体;">框架</span></strong></h2>
<p><span style="font-family: 宋体;">之前用</span>fs.readFile()<span style="font-family: 宋体;">配合</span><span style="font-family: Consolas;">if(req.url)</span><span style="font-family: 宋体;">来读取静态文件。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">if</span>(req.url == "/aaa"<span style="color: #000000;">){
    fs.readFile(</span>"./images/ddd.png" , <span style="color: #0000ff;">function</span><span style="color: #000000;">(err , data){
        res.end(data)
    });
}</span></pre>
</div>
<p>&nbsp;</p>
<p>Express<span style="font-family: 宋体;">框架，提供了</span><span style="font-family: Consolas;">http</span><span style="font-family: 宋体;">服务器和很多中间件，并且简化了路由表的编写。</span></p>
<p>现在只需要一条语句就可以将一个文件夹自动提供路由。</p>
<div class="cnblogs_code">
<pre><code>app.use(express.static("www"));</pre>
</div>
<p>www<span style="font-family: 宋体;">表示需要自动提供路由的那个文件夹，类似于</span><span style="font-family: Consolas;">Apache</span><span style="font-family: 宋体;">的根目录。</span></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">在</span>url<span style="font-family: 宋体;">中用冒号开头引导一个变量，可以立刻用</span><strong>req.params.<span style="font-family: 宋体;">变量</span></strong>来得到待定值</p>
<div class="cnblogs_code">
<pre><code>app.get("/<span style="color: #ff0000;">:nian</span>/<span style="color: #ff0000;">:yue</span>/<span style="color: #ff0000;">:ri</span>" , <span style="color: #0000ff;">function</span><span style="color: #000000;">(req,res){
    </span><span style="color: #0000ff;">var</span> nian =<span style="color: #000000;"><span style="color: #ff0000;"> req.params.nian</span>;
    </span><span style="color: #0000ff;">var</span> yue =<span style="color: #000000;"><span style="color: #ff0000;"> req.params.yue</span>;
    </span><span style="color: #0000ff;">var</span> ri =<span style="color: #000000;"><span style="color: #ff0000;"> req.params.ri</span>;
    res.send(nian </span>+ "年" + yue + "月" + ri + "日"<span style="color: #000000;">);
});</span></pre>
</div>
<hr />
<h2>&nbsp;</h2>
<h2><strong>版本号</strong></h2>
<div class="cnblogs_code">
<pre><code>{ "dependencies"<span style="color: #000000;"> :
  { </span>"foo" : "^1.0.0",              <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;固定住了1代大本版号，小版本号随意</span>
    "bar" : "&gt;2.1.2",             <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;必须大于2.1.2版本号</span>
    "baz" : "&gt;1.0.2 &lt;=2.3.4",  <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;且</span>
    "boo" : "2.0.1",               <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;必须完全匹配这个版本号，下载的就是2.0.0</span>
    "qux" : "&lt;1.0.0 || &gt;=2.3.1 &lt;2.4.5 || &gt;=2.5.2 &lt;3.0.0",  <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;三个区间随便选</span>
    "asd" : "http://asdf.com/asdf.tar.gz",  <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;指定一个地址</span>
    "til" : "~1.2",           <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;近似找到1.2，能多近就多近，能找到1.2就用1.2，不能就尽量近</span>
    "elf" : "~1.2.3"<span style="color: #000000;">,
    </span>"thr" : "3.3.x",          <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;3.3必须固定，最后一位随意</span>
    "lat" : "latest",      <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;最新版本</span>
    "dyl" : "*",              <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;任意版本，随意！,</span>
    "xxx" : "1.0.0 - 2.9999.9999",   <span style="color: #008000;">//</span><span style="color: #008000;">&rarr;大于等于且小于等于</span>
<span style="color: #000000;">  }
}</span></pre>
</div>
<hr />
<p>&nbsp;</p>
<h1>四、<strong>Nodejs<span style="font-family: 宋体;">请求识别</span></strong></h1>
<h2><strong>4.1 GET<span style="font-family: 宋体;">和</span><span style="font-family: 华文中宋;">POST</span><span style="font-family: 宋体;">请求介绍</span></strong></h2>
<p>比如请求一个报名表的网页，一般情况下访问时，服务器都返回相同内容</p>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别10.png" alt="" /></p>
<p>l&nbsp;想要访问一个页面，返回不同的内容，如何解决？</p>
<p>&nbsp;</p>
<p>比如希望男生和女生得到的报名表不同，最简单的办法就是请求不同的网页地址：</p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别11.png" alt="" /></p>
<p>因为性别只有两个，所以请求不同的页面感觉不出复杂，但如果是不同的国籍，全球有190<span style="font-family: 宋体;">多个国家，那么页面就太多了。</span></p>
<p>&nbsp;</p>
<p><strong>解决办法有两种：</strong></p>
<p><strong><span style="font-family: 宋体;">第一种：用</span>GET<span style="font-family: 宋体;">请求，通过</span><span style="font-family: Consolas;">URL</span><span style="font-family: 宋体;">地址加上</span><span style="font-family: Consolas;">?</span><span style="font-family: 宋体;">引导的</span><span style="font-family: Consolas;">k=v&amp;k=v</span><span style="font-family: 宋体;">，将自己的个性化数据告诉服务器</span></strong></p>
<p><strong>GET<span style="font-family: 宋体;">是得到的意思，指的是希望以一些参数，得到丰富的网页信息。</span></strong></p>
<p><strong><span style="font-family: 宋体;"><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别12.png" alt="" /></span></strong></p>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别13.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong>第二种：</strong><strong>POST<span style="font-family: 宋体;">请求携带报文体</span></strong></p>
<p><strong>POST<span style="font-family: 宋体;">请求使用</span><span style="font-family: Consolas;">http</span><span style="font-family: 宋体;">请求的报文体来携带数据，传给服务器。</span></strong></p>
<p><strong>POST<span style="font-family: 宋体;">的意思是&ldquo;投递&rdquo;的意思，此时语义上，我们发出</span><span style="font-family: Consolas;">POST</span><span style="font-family: 宋体;">请求希望服务器持久这些数据。</span></strong></p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别14.png" alt="" /></p>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别15.png" alt="" /></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">淘宝买东西，你就是浏览器，卖家是服务器，你要将收货信息告诉卖家，有两种方式：
方法1：收货地址：广州天河区棠东东路御富科贸园D座108室（来了不要打电话直接放前台打电话也不接否则就差评谢谢）
如同GET请求
方法2：收货地址：广州天河区棠东东路御富科贸园D座108室
        留言：（来了不要打电话直接放前台打电话也不接否则就差评谢谢）
    如同POST请求</span></pre>
</div>
<hr />
<h2><strong>4.2 GET<span style="font-family: 宋体;">请求（使用</span><span style="font-family: 华文中宋;">express</span><span style="font-family: 宋体;">）</span></strong></h2>
<p>GET<span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">POST</span><span style="font-family: 宋体;">请求，都是上行请求，都是把数据从浏览器带向服务器的方式。</span></p>
<p><span style="font-family: 宋体;">现在不是如何发送请求，表单和</span>Ajax<span style="font-family: 宋体;">都能发送</span><span style="font-family: Consolas;">GET</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">POST</span><span style="font-family: 宋体;">请求。现在问题是如何用</span><span style="font-family: Consolas;">node</span><span style="font-family: 宋体;">识别浏览器发送过来的请求（识别传递过来的参数）。</span></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">写一个路由，希望用</span>get<span style="font-family: 宋体;">请求单独得到某一个用户的信息：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> url = require("url"<span style="color: #000000;">);
</span><span style="color: #ff0000;">var express = require("express");
var app = express();

</span><span style="color: #008000;">//</span><span style="color: #008000;">静态化www文件夹，可以在www中写前端代码</span><span style="color: #008000;">
//</span><span style="color: #008000;"> app.use(express.static("www"));</span>
<span style="color: #0000ff;">var</span> arr =<span style="color: #000000;"> [
    {</span>"id" : 10001, "name":"小明", "sex":"男"<span style="color: #000000;">},
    {</span>"id" : 10002, "name":"小红", "sex":"女"<span style="color: #000000;">},
    {</span>"id" : 10003, "name":"小黑", "sex":"男"<span style="color: #000000;">}
]

app.get(</span>"/people" , <span style="color: #0000ff;">function</span><span style="color: #000000;">(req,res){
    <span style="color: #ff0000;">console.log(req.url)</span>
})

app.listen(</span>3000);</pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别16.png" alt="" /></p>
<p>&nbsp;</p>
<p>为了得到GET<span style="font-family: 宋体;">请求的</span><span style="font-family: Consolas;">id</span><span style="font-family: 宋体;">参数，使用</span><span style="font-family: Consolas;">nodejs</span><span style="font-family: 宋体;">提供的</span><span style="font-family: Consolas;">url</span><span style="font-family: 宋体;">模块的</span><span style="font-family: Consolas;">url.parse()</span><span style="font-family: 宋体;">方法：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">当用户用get请求访问people的时候</span>
app.get("/people" , <span style="color: #0000ff;">function</span><span style="color: #000000;">(req,res){
    </span><span style="color: #008000;">//</span><span style="color: #008000;">得到get请求的参数</span>
   <span style="color: #ff0000;"> var id = url.parse(req.url, true).query.id;

     </span><span style="color: #008000;">//</span><span style="color: #008000;">如果用户没有传id参数，则显示所有人信息</span>
    <span style="color: #0000ff;">if</span>(!<span style="color: #000000;">id){
        res.json(arr);
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历数组，得到id和url的id参数相同的人</span>
    <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">var</span> i = 0;i &lt; arr.length;i++<span style="color: #000000;">){
        </span><span style="color: #0000ff;">if</span>(arr[i].id ==<span style="color: #000000;"> id){
       <span style="color: #ff0000;">     res.json(arr[i])
            </span></span><span style="color: #008000;">//</span><span style="color: #008000;"> res.send("我是服务器已经收到请求，返回的数据是：" + arr[i].name)</span>
<span style="color: #000000;">        }
}

</span><span style="color: #008000;">//</span><span style="color: #008000;">存储前端提交的数据到数组</span>
<span style="color: #000000;">arr.push(obj);
console.log(arr)
})</span></pre>
</div>
<p>这个叫做接口，所谓的<strong><span style="text-decoration: underline;"><span style="font-family: 宋体;">接口就是显示</span>JSON<span style="font-family: 宋体;">数据，而不是显示</span><span style="font-family: Consolas;">HTML</span><span style="font-family: 宋体;">界面的网页</span></span></strong></p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别17.png" alt="" /></p>
<p>没有传id<span style="font-family: 宋体;">参数，则显示所有人</span></p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别18.png" alt="" /></p>
<p>接口不是给人看的，是返回给前端的，前端用来发出Ajax<span style="font-family: 宋体;">请求调用得到，得到数据后渲染在页面中。</span></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">前端可以借助</span>Ajax<span style="font-family: 宋体;">发出请求调用接口地址，拿到数据。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> id</span><span style="color: #0000ff;">="idTxt"</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>GET请求-查询<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">

//点击发起查询请求
$("button").eq(0).click(function(){
   $.get("/people",{id:$("#idTxt").val() }, function(data){
       console.log(data)
   })
});</span></pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别19.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong>升级一下案例：</strong></p>
<p>www/index.html<span style="font-family: 宋体;">前端主页</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>I D ：<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="idTxt"</span> <span style="color: #0000ff;">/&gt;&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>姓名：<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="text"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="name"</span> <span style="color: #0000ff;">/&gt;&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">性别：
        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="radio"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="sex"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="男"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="sex"</span> <span style="color: #0000ff;">/&gt;</span><span style="color: #000000;">男
        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="radio"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">="sex"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="女"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="sex"</span> <span style="color: #0000ff;">/&gt;</span><span style="color: #000000;">女
</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">
    爱好：
        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="checkbox"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="hobby"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="游泳"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">游泳
        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="checkbox"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="hobby"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="看书"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">看书
        </span><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="checkbox"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="hobby"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="打球"</span><span style="color: #0000ff;">&gt;</span><span style="color: #000000;">打球
</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>GET请求-提交保存<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">前端提交的时候，复选框要写</span>IIFE<span style="font-family: 宋体;">才能遍历多选的数组：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">点击提交到后端，存储信息</span>
$("button").eq(1).click(<span style="color: #0000ff;">function</span><span style="color: #000000;">(){
   </span><span style="color: #0000ff;">var</span> id = $(".idTxt"<span style="color: #000000;">).val();
   </span><span style="color: #0000ff;">var</span> name = $(".name"<span style="color: #000000;">).val();
   </span><span style="color: #0000ff;">var</span> sex = $(".sex:checked"<span style="color: #000000;">).val();
   </span><span style="color: #0000ff;">var</span> hobby = (<span style="color: #0000ff;">function</span><span style="color: #000000;">(){
       </span><span style="color: #0000ff;">var</span> arr =<span style="color: #000000;"> [];
       $(</span>".hobby:checked").each(<span style="color: #0000ff;">function</span><span style="color: #000000;">(){
           arr.push($(</span><span style="color: #0000ff;">this</span><span style="color: #000000;">).val())
       })
       </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> arr;
   })();
   </span><span style="color: #008000;">//</span><span style="color: #008000;">发起请求</span>
   $.get("/people",{id:id,name:name,sex:sex,hobby:<span style="color: #ff0000;">JSON.stringify(hobby)</span>}, <span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
        console.log(data)
   })
});</span></pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别20.png" alt="" /></p>
<p>&nbsp;</p>
<p>数组中jQuery<span style="font-family: 宋体;">中发送</span><span style="font-family: Consolas;">Ajax</span><span style="font-family: 宋体;">的时候，会自作主张的给键名加上</span><span style="font-family: Consolas;">[]</span><span style="font-family: 宋体;">后缀：</span></p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别21.png" alt="" /></p>
<p>解决方法两种：</p>
<p>1、<span style="font-family: 宋体;">前端提交</span>JSON.stringify(<span style="font-family: 宋体;">数组</span><span style="font-family: Consolas;">); </span><span style="font-family: 宋体;">后端</span><span style="font-family: Consolas;">JSON.parse(</span><span style="font-family: 宋体;">数组</span><span style="font-family: Consolas;">);</span></p>
<div class="cnblogs_code">
<pre><code>"hobby":JSON.stringify(hobbys)</pre>
</div>
<p>&nbsp;</p>
<p>2、<span style="font-family: 宋体;">使用</span>jquery<span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">ajax()</span><span style="font-family: 宋体;">函数的</span><span style="font-family: Consolas;">traditional</span><span style="font-family: 宋体;">参数</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">$.ajax({
    url:</span>"/people"<span style="color: #000000;">,
    data: {id:id, name:name, sex:sex, hobby:hobby},
    success:</span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
       console.log(data)
    },
    <span style="color: #ff0000;">traditional:</span></span><span style="color: #ff0000;">true</span><span style="color: #000000;">
 })</span></pre>
</div>
<p><span style="font-family: 宋体;">前端是</span>JS<span style="font-family: 宋体;">，后端也是</span><span style="font-family: Consolas;">JS</span><span style="font-family: 宋体;">，</span><span style="font-family: Consolas;">Ajax</span><span style="font-family: 宋体;">提交的参数，不变形。</span></p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别22.png" alt="" /></p>
<hr />
<h2><strong>4.3 POST<span style="font-family: 宋体;">请求（使用</span><span style="font-family: 华文中宋;">express</span><span style="font-family: 宋体;">）</span></strong></h2>
<p>POST<span style="font-family: 宋体;">请求的信息不在</span><span style="font-family: Consolas;">URL</span><span style="font-family: 宋体;">中，而是在请求的报文体中，所以不能通过</span><span style="font-family: Consolas;">req.url</span><span style="font-family: 宋体;">的形式得到数据，此时使用</span><span style="font-family: Consolas;">formidable</span><span style="font-family: 宋体;">模块。</span></p>
<p>POST<span style="font-family: 宋体;">请求是用来发送大量的数据给服务器，希望服务器持久这些数据，表单的提交的。</span><span style="font-family: Consolas;">Nodejs</span><span style="font-family: 宋体;">非常害怕大内容，因为如果你上传</span><span style="font-family: Consolas;">1G</span><span style="font-family: 宋体;">的内容，此时会把进程阻塞，</span><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">但是</span>Nodejs<span style="font-family: 宋体;">很聪明，它把浏览器传来的大内容分成一个个包来进行传输，一个包传输完毕，就是一个切断点，</span><span style="font-family: Consolas;">nodejs</span><span style="font-family: 宋体;">就能给别的人提供服务</span></strong>。</span></p>
<p>&nbsp;<span><a href="https://www.npmjs.com/package/formidable">https://www.npmjs.com/package/formidable</a></span></p>
<div class="cnblogs_code">
<pre><code>npm install --save formidable</pre>
</div>
<p>&nbsp;</p>
<p>app.js<span style="font-family: 宋体;">后端，使用</span><span style="font-family: Consolas;">formidable</span><span style="font-family: 宋体;">包的标准语法：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">拦截前端发送的POST请求</span>
app.post("/tijiao" , <span style="color: #0000ff;">function</span><span style="color: #000000;">(req,res){
     </span><span style="color: #008000;">//</span><span style="color: #008000;">下面两行代码是标准语法</span>
     <span style="color: #008000;">//</span><span style="color: #008000;">这是formidable的构造函数，产生一个form表单对象</span>
    <span style="color: #ff0000;"> var form = new formidable.IncomingForm();
     form.parse(req, function(err, data){
        arr.push(data); //将前端提交的数据存储到数组中
        res.send("ok"); //告诉前端
</span><span style="color: #000000;"><span style="color: #ff0000;">     });</span>
});</span></pre>
</div>
<p><img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别23.png" alt="" /></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">前端发出</span>POST<span style="font-family: 宋体;">请求</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">************** POST请求 *****************</span>
$("button").eq(2).click(<span style="color: #0000ff;">function</span><span style="color: #000000;">(){
   </span><span style="color: #0000ff;">var</span> id = $(".idTxt"<span style="color: #000000;">).val();
   </span><span style="color: #0000ff;">var</span> name = $(".name"<span style="color: #000000;">).val();
   </span><span style="color: #0000ff;">var</span> sex = $(".sex:checked"<span style="color: #000000;">).val();

   $.ajax({
       url:</span>"/tijiao"<span style="color: #000000;">,
       type:</span>"post"<span style="color: #000000;">,
       data: {id:id, name:name, sex:sex},
       success:</span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
           </span><span style="color: #0000ff;">if</span>(data == "ok"<span style="color: #000000;">){
               alert(</span>"添加成功"<span style="color: #000000;">);
           }
       },
       traditional:</span><span style="color: #0000ff;">true</span><span style="color: #000000;">
   })
});</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>formidable<span style="font-family: 宋体;">还能处理文件的上传，它使用链路层协议进行传输，比</span><span style="font-family: Consolas;">HTTP</span><span style="font-family: 宋体;">快很多：</span></strong></p>
<div class="cnblogs_code">
<pre><code>app.post("/tijiao" , <span style="color: #0000ff;">function</span><span style="color: #000000;">(req,res){
     </span><span style="color: #0000ff;">var</span> form = <span style="color: #0000ff;">new</span><span style="color: #000000;"> formidable.IncomingForm();
     </span><span style="color: #008000;">//</span><span style="color: #008000;">设置上传的文件目录</span>
     <span style="color: #ff0000;">form.uploadDir = "./uploads";
     </span><span style="color: #008000;">//</span><span style="color: #008000;">保留文件扩展名</span>
     <span style="color: #ff0000;">form.keepExtensions = true</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>

     form.parse(req, </span><span style="color: #0000ff;">function</span><span style="color: #000000;">(err, fields, files) {
        arr.push(fields);         </span><span style="color: #008000;">//</span><span style="color: #008000;">存储数据</span>
        console.log(fields); <span style="color: #008000;">//</span><span style="color: #008000;">fields表示普通文本（文本、单选、复选等）</span>
        console.log(files);  <span style="color: #008000;">//</span><span style="color: #008000;">files表示文件</span>
        res.send("ok"); <span style="color: #008000;">//</span><span style="color: #008000;">告诉前端</span>
<span style="color: #000000;">     });
});</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">用</span>form<span style="font-family: 宋体;">表单提交，前端表单加上</span><span style="font-family: Consolas;">enctype</span><span style="font-family: 宋体;">属性，文件控件要有</span><span style="font-family: Consolas;">name</span><span style="font-family: 宋体;">属性。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">form </span><span style="color: #ff0000;">action</span><span style="color: #0000ff;">="/tijiao"</span><span style="color: #ff0000;"> method</span><span style="color: #0000ff;">="post"</span> <span style="color: #ff0000;">enctype="multipart/form-data"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="file"</span> <span style="color: #ff0000;">name="files"</span> <span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="submit"</span><span style="color: #ff0000;"> value</span><span style="color: #0000ff;">="提交"</span> <span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">p</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">form</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>给上传成功的文件改名：</strong></p>
<div class="cnblogs_code">
<pre><code>app.post("/tijiao" , <span style="color: #0000ff;">function</span><span style="color: #000000;">(req,res){
     </span><span style="color: #0000ff;">var</span> form = <span style="color: #0000ff;">new</span><span style="color: #000000;"> formidable.IncomingForm();
     </span><span style="color: #008000;">//</span><span style="color: #008000;">设置上传的文件目录</span>
     form.uploadDir = "./uploads"<span style="color: #000000;">;
     </span><span style="color: #008000;">//</span><span style="color: #008000;">保留文件扩展名</span>
     form.keepExtensions = <span style="color: #0000ff;">true</span><span style="color: #000000;">;

     form.parse(req, </span><span style="color: #0000ff;">function</span><span style="color: #000000;">(err, fields, files) {
        </span><span style="color: #ff0000;">if(files.files.name == ''){//如果表单不存在
            res.send("请上传文件");
            return;
        }

        </span><span style="color: #008000;">//</span><span style="color: #008000;">改名函数fs.rename(原路径,新路径,callback)</span>
        <span style="color: #ff0000;">fs.rename("./"+ files.files.path, "./"+files.files.path + files.files.name,function(err){
            </span><span style="color: #0000ff;">if</span><span style="color: #000000;">(err){
                res.send(</span>"重命名失败！"<span style="color: #000000;">)
            }</span><span style="color: #0000ff;">else</span><span style="color: #000000;">{
                res.send(</span>"重命名完成！"<span style="color: #000000;">)
            }
       <span style="color: #ff0000;"> });</span>
     });
});</span></pre>
</div>
<hr />
<h2><strong>4.4<span style="font-family: 宋体;">其他请求识别</span></strong></h2>
<p>jquery<span style="font-family: 宋体;">特别符合</span><span style="font-family: Consolas;">w3c</span><span style="font-family: 宋体;">规范，</span><span style="font-family: Consolas;">express</span><span style="font-family: 宋体;">也特别符合。它们配合可以用不同的请求类型：</span></p>
<p>&nbsp;<img src="./images/前端笔记之NodeJS（三）Express&amp;ejs模板引擎&amp;请求识别24.png" alt="" /></p>
<div class="cnblogs_code">
<pre><code>$("button").eq(3).click(<span style="color: #0000ff;">function</span><span style="color: #000000;">(){
   $.ajax({
     <span style="color: #ff0000;">  type : </span></span><span style="color: #ff0000;">"checkout",
       url : "/update"</span><span style="color: #000000;"><span style="color: #ff0000;">,</span>
       data : {</span>"id":10001<span style="color: #000000;">},
       success : </span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
           </span><span style="color: #0000ff;">if</span>(data == "ok"<span style="color: #000000;">){
               alert(</span>"更新成功！"<span style="color: #000000;">);
           }
       }
   })
});
$(</span>"button").eq(4).click(<span style="color: #0000ff;">function</span><span style="color: #000000;">(){
   $.ajax({
       <span style="color: #ff0000;">type : </span></span><span style="color: #ff0000;">"delete",
       url : "/remove"</span><span style="color: #000000;"><span style="color: #ff0000;">,</span>
       data : {</span>"id":10001<span style="color: #000000;">},
       success : </span><span style="color: #0000ff;">function</span><span style="color: #000000;">(data){
           </span><span style="color: #0000ff;">if</span>(data == "ok"<span style="color: #000000;">){
               alert(</span>"删除成功！"<span style="color: #000000;">);
           }
       }
   })
});</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">后端</span>app.js</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;"> 其他请求</span>
app.<span style="color: #ff0000;">checkout</span>("/<span style="color: #ff0000;">update</span>", <span style="color: #0000ff;">function</span><span style="color: #000000;">(req,res){
    res.send(</span>"ok"); <span style="color: #008000;">//</span><span style="color: #008000;">告诉前端</span>
<span style="color: #000000;">});

app.</span><span style="color: #ff0000;">delete</span>("/<span style="color: #ff0000;">remove</span>", <span style="color: #0000ff;">function</span><span style="color: #000000;">(req,res){
    res.send(</span>"ok"); <span style="color: #008000;">//</span><span style="color: #008000;">告诉前端</span>
});</pre>
</div>
<p>总结：</p>
<p>① <span style="font-family: Consolas;">get</span><span style="font-family: 宋体;">请求在</span><span style="font-family: Consolas;">nodejs</span><span style="font-family: 宋体;">中用</span><span style="font-family: Consolas;">url.parse(req.url,true).qurey</span><span style="font-family: 宋体;">识别</span></p>
<p>② <span style="font-family: Consolas;">post</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">checkout</span><span style="font-family: 宋体;">等所有其他请求，在</span><span style="font-family: Consolas;">Nodejs</span><span style="font-family: 宋体;">中用</span><span style="font-family: Consolas;">formidable</span><span style="font-family: 宋体;">包识别</span></p>
<hr />
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>