<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk</center></div><div class='banquan'>原文出处:本文由博客园博主RopeHuo提供。<br/>
原文连接:https://www.cnblogs.com/rope/p/10741659.html</div><br>
    <h1>一、<strong>ES6<span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">Set</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">Map</span><span style="font-family: 宋体;">数据结构</span></strong></h1>
<p>Map<span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">Set</span><span style="font-family: 宋体;">都是</span><span style="font-family: Consolas;">ES6</span><span style="font-family: 宋体;">新的数据结构，都是新的内置构造函数，也就是说</span><span style="font-family: Consolas;">typeof</span><span style="font-family: 宋体;">的结果，多了两个：</span></p>
<p>Set <span style="font-family: 宋体;">是不能重复的数组</span></p>
<p>Map <span style="font-family: 宋体;">是可以任何东西当做键的对象</span></p>
<p align="justify">&nbsp;</p>
<p align="justify">ES6 <span style="font-family: 宋体;">提供了新的数据结构 </span><span style="font-family: Consolas;">Set</span><span style="font-family: 宋体;">。它类似于数组，但是成员的值都是唯一的，没有重复的值。</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('3f65c405-da9b-4499-8b3a-315fe2ec3878')"><img id="code_img_closed_3f65c405-da9b-4499-8b3a-315fe2ec3878" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_3f65c405-da9b-4499-8b3a-315fe2ec3878" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('3f65c405-da9b-4499-8b3a-315fe2ec3878',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_3f65c405-da9b-4499-8b3a-315fe2ec3878" class="cnblogs_code_hide">
<pre><code>let s = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Set();
s.add(</span>1<span style="color: #000000;">);
s.add(</span>2<span style="color: #000000;">);
s.add(</span>3<span style="color: #000000;">);
s.add(</span>3<span style="color: #000000;">);
s.add(</span>3<span style="color: #000000;">);
s.add(</span>4<span style="color: #000000;">);
s.add(</span>5<span style="color: #000000;">);
console.log(s)</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p align="justify">&nbsp;</p>
<p>&nbsp;</p>
<p align="justify">&nbsp;</p>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk2.png" alt="" /></p>
<p>集合中添加数据用add()<span style="font-family: 宋体;">方法，会自动过滤已经有的元素。</span></p>
<p>&nbsp;</p>
<p>最快的数组去重方法：</p>
<div class="cnblogs_code">
<pre><code>let s = <span style="color: #0000ff;">new</span> Set([1,2,3,3,3,4,5<span style="color: #000000;">]);
console.log([...s])</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk3.png" alt="" /></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('69c325b9-81ac-4343-8c5b-8141ca82d7e4')"><img id="code_img_closed_69c325b9-81ac-4343-8c5b-8141ca82d7e4" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_69c325b9-81ac-4343-8c5b-8141ca82d7e4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('69c325b9-81ac-4343-8c5b-8141ca82d7e4',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_69c325b9-81ac-4343-8c5b-8141ca82d7e4" class="cnblogs_code_hide">
<pre><code>let s = <span style="color: #0000ff;">new</span> Set([1,2,3,4,5<span style="color: #000000;">]);
console.log(s.size)
console.log(s.has(</span>5<span style="color: #000000;">))
console.log(s.</span><span style="color: #0000ff;">delete</span>(5<span style="color: #000000;">))
console.log(s)</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p>&nbsp;</p>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk6.png" alt="" /></p>
<p>集合的关注点是在元素里面，而不关注顺序，所以不提供s[0]<span style="font-family: 宋体;">来枚举某项</span><span style="font-family: Consolas;">API</span><span style="font-family: 宋体;">，但是可以转为数组</span><span style="font-family: Consolas;">[...s]</span></p>
<p>&nbsp;</p>
<p>JavaScript <span style="font-family: 宋体;">的对象（</span><span style="font-family: Consolas;">Object</span><span style="font-family: 宋体;">），本质上是键值对的集合（</span><span style="font-family: Consolas;">Hash </span><span style="font-family: 宋体;">结构），但是传统上只能用字符串当作键。这给它的使用带来了很大的限制。</span></p>
<p><span style="font-family: 宋体;">为了解决这个问题，</span>ES6 <span style="font-family: 宋体;">提供了 </span><span style="font-family: Consolas;">Map </span><span style="font-family: 宋体;">数据结构。它类似于对象，也是键值对的集合，但是&ldquo;键&rdquo;的范围不限于字符串，各种类型的值（包括对象）都可以当作键。也就是说，</span><span style="font-family: Consolas;">Object </span><span style="font-family: 宋体;">结构提供了&ldquo;字符串&mdash;值&rdquo;的对应，</span><span style="font-family: Consolas;">Map </span><span style="font-family: 宋体;">结构提供了&ldquo;值&mdash;值&rdquo;的对应，是一种更完善的 </span><span style="font-family: Consolas;">Hash </span><span style="font-family: 宋体;">结构实现。如果你需要&ldquo;键值对&rdquo;的数据结构，</span><span style="font-family: Consolas;">Map </span><span style="font-family: 宋体;">比 </span><span style="font-family: Consolas;">Object </span><span style="font-family: 宋体;">更合适。</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('be8d85e7-e807-4a20-9220-e5d9be34e14c')"><img id="code_img_closed_be8d85e7-e807-4a20-9220-e5d9be34e14c" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_be8d85e7-e807-4a20-9220-e5d9be34e14c" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('be8d85e7-e807-4a20-9220-e5d9be34e14c',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_be8d85e7-e807-4a20-9220-e5d9be34e14c" class="cnblogs_code_hide">
<pre><code>let m = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Map();
const o </span>= {a:1,b:2<span style="color: #000000;">};
m.set(</span>"haha", 123<span style="color: #000000;">);
m.set(o, </span>456<span style="color: #000000;">)
m.set(</span>888,789<span style="color: #000000;">)
console.log(m)
console.log(m.get(o))</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk9.png" alt="" /></p>
<p>使用get()<span style="font-family: 宋体;">来得到元素的值，</span><span style="font-family: Consolas;">key</span><span style="font-family: 宋体;">是区分类型的。</span></p>
<hr />
<h1>二、<strong>函数式编程库</strong></h1>
<p><span style="font-family: 宋体;">所谓的</span>&ldquo;函数式编程&rdquo;指的是程序中的函数的是&ldquo;纯函数&rdquo;，就表示一个函数不改变传入的参数。</p>
<p><span style="font-family: 宋体;">我们之前大量使用</span>...<span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">filter</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">map</span><span style="font-family: 宋体;">等等操作，略微麻烦，就有</span><span style="font-family: Consolas;">3</span><span style="font-family: 宋体;">个特别好用的函数式编程库应运而生。</span></p>
<h2><strong>2.1 immutable.js<span style="font-family: 宋体;">库</span></strong></h2>
<h3><strong>2.1.1<span style="font-family: 宋体;">概述</span></strong></h3>
<p><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">来自</span>Facebook<span style="font-family: 宋体;">，是官方推荐的库，</span><span style="font-family: Consolas;">immutable</span><span style="font-family: 宋体;">表示不可变。</span><span style="font-family: Consolas;">immutable</span><span style="font-family: 宋体;">总是返回新的对象，不会修改原对象。</span></strong></span></p>
<p>&nbsp;</p>
<p>immutable<span style="font-family: 宋体;">不是深拷贝对象，创造性的使用</span><span style="font-family: Consolas;">DIFF</span><span style="font-family: 宋体;">算法，有一个结构共享机制，它所做的是智能分析改变，让改变后的元素可以共享改变之前的一些结构。</span></p>
<p>Immutable <span style="font-family: 宋体;">使用了 </span><span style="color: #ff0000;"><strong>Structural Sharing<span style="font-family: 宋体;">（结构共享）</span></strong></span>，即如果对象树中一个节点发生变化，只修改这个节点和受它影响的父节点，其它节点则进行共享。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">{
  <span style="color: #ff0000;">  a:{</span></span><span style="color: #ff0000;">"x":1 , "y":2</span><span style="color: #000000;"><span style="color: #ff0000;">},</span>
    b:{
        c:{</span>"x":3, "y":4<span style="color: #000000;">},
        <span style="color: #ff0000;">d:{</span></span><span style="color: #ff0000;">"x":5</span><span style="color: #000000;"><span style="color: #ff0000;">},</span>
    }
}</span></pre>
</div>
<div class="cnblogs_code">
<pre><code><span style="color: #000000;">{
  <span style="color: #ff0000;">  a:{</span></span><span style="color: #ff0000;">"x":1 , "y":2</span><span style="color: #000000;"><span style="color: #ff0000;">},</span>
    b:{
        c:{</span>"x":8, "y":4<span style="color: #000000;">},
       <span style="color: #ff0000;"> d:{</span></span><span style="color: #ff0000;">"x":5</span><span style="color: #000000;"><span style="color: #ff0000;">},</span>
    }
}</span></pre>
</div>
<p>上面代码中，颜色相同部分，还是内存中同一个对象。</p>
<hr />
<h3><strong>2.1.2<span style="font-family: 宋体;">基本讲解</span></strong></h3>
<p>官方：<a href="http://facebook.github.io/immutable-js/docs/#/"><span style="text-decoration: underline;">http://facebook.github.io/immutable-js/docs/#/</span></a></p>
<p>安装依赖：</p>
<div class="cnblogs_code">
<pre><code>npm install immutable --save</pre>
</div>
<p><span style="color: #ff0000;"><strong>immutable<span style="font-family: 宋体;">提供了两个数据类型：</span></strong></span></p>
<p><span style="color: #ff0000;"><strong>List<span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">Map</span><span style="font-family: 宋体;">是</span><span style="font-family: Consolas;">immutable</span><span style="font-family: 宋体;">自己封装的一个类，</span><span style="font-family: Consolas;">List</span><span style="font-family: 宋体;">是不可变的数组，</span><span style="font-family: Consolas;">Map</span><span style="font-family: 宋体;">是不可变的对象。</span></strong></span></p>
<p>&nbsp;<img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk10.png" alt="" /></p>
<p>fromJS() <span style="font-family: 宋体;">将一个原生</span><span style="font-family: Consolas;">js</span><span style="font-family: 宋体;">数据类型转换为</span><span style="font-family: Consolas;">immutable</span><span style="font-family: 宋体;">类型的数据</span></p>
<p>toJS() &nbsp;&nbsp;<span style="font-family: 宋体;">将一个</span>immutable<span style="font-family: 宋体;">类型的数据转换为</span><span style="font-family: Consolas;">JS</span><span style="font-family: 宋体;">类型的数据。</span></p>
<p>List()<span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">Map() </span><span style="font-family: 宋体;">用来创建新的</span><span style="font-family: Consolas;">List</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">Map</span><span style="font-family: 宋体;">对象（将原生</span><span style="font-family: Consolas;">JS</span><span style="font-family: 宋体;">对象和数组转换到不可变的</span><span style="font-family: Consolas;">Map</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">List</span><span style="font-family: 宋体;">）</span></p>
<p>&nbsp;</p>
<p><strong>immutable<span style="font-family: 宋体;">思维：</span></strong></p>
<p><span style="font-family: 宋体;">先用</span>fromJS()<span style="font-family: 宋体;">或</span><span style="font-family: Consolas;">List()</span><span style="font-family: 宋体;">或</span><span style="font-family: Consolas;">Map()</span><span style="font-family: 宋体;">将原生</span><span style="font-family: Consolas;">JS</span><span style="font-family: 宋体;">的数组、对象、变为</span><span style="font-family: Consolas;">List</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">Map</span><span style="font-family: 宋体;">对象</span></p>
<p><span style="font-family: 宋体;">然后再操作，比如对数组的</span>push<span style="font-family: 宋体;">操作</span></p>
<p><span style="font-family: 宋体;">最后</span>.toJS()<span style="font-family: 宋体;">将</span><span style="font-family: Consolas;">immutable</span><span style="font-family: 宋体;">对象变为原生</span><span style="font-family: Consolas;">JS</span><span style="font-family: 宋体;">的数组、对象</span></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">在</span>Nodejs<span style="font-family: 宋体;">环境中引包：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> immutable = require("immutable"<span style="color: #000000;">);
</span><span style="color: #ff0000;">var List =</span><span style="color: #000000;"><span style="color: #ff0000;"> immutable.List</span>

const list1 </span>= <span style="color: #ff0000;">List</span>(["白板","幺鸡","三条","三万"<span style="color: #000000;">])
const list2 </span>= list1.push("四条"<span style="color: #000000;">)
console.log(list1.<span style="color: #ff0000;">toJS()</span>)
console.log(list2.<span style="color: #ff0000;">toJS()</span>)</span></pre>
</div>
<p><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">会发现</span>push<span style="font-family: 宋体;">之后，原数组没有改变，只返回了新数组。</span></strong></span></p>
<p><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">上面案例是用</span>List(<span style="font-family: 宋体;">原数组</span><span style="font-family: Consolas;">)</span><span style="font-family: 宋体;">将数组变为</span><span style="font-family: Consolas;">List</span><span style="font-family: 宋体;">对象，也可以用</span><span style="font-family: Consolas;">fromJS</span><span style="font-family: 宋体;">。</span></strong></span></p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> immutable = require("immutable"<span style="color: #000000;">);
</span><span style="color: #0000ff;">var</span> <span style="color: #ff0000;">fromJS</span> =<span style="color: #000000;"><span style="color: #ff0000;"> immutable.fromJS</span>

const list1 </span>= <span style="color: #ff0000;">fromJS</span>(["白板","幺鸡","三条","三万"<span style="color: #000000;">])
const list2 </span>= list1.push("四条"<span style="color: #000000;">)
console.log(list1.<span style="color: #ff0000;">toJS()</span>)
console.log(list2.<span style="color: #ff0000;">toJS()</span>)</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk11.png" alt="" /></p>
<p>&nbsp;</p>
<p>数组的头尾操作，也不会改变原数组，都是返回新数组：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('efcd0c98-7cc0-4e2c-990d-4e6929077227')"><img id="code_img_closed_efcd0c98-7cc0-4e2c-990d-4e6929077227" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_efcd0c98-7cc0-4e2c-990d-4e6929077227" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('efcd0c98-7cc0-4e2c-990d-4e6929077227',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_efcd0c98-7cc0-4e2c-990d-4e6929077227" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">var</span> immutable = require("immutable"<span style="color: #000000;">);
</span><span style="color: #0000ff;">var</span> fromJS =<span style="color: #000000;"> immutable.fromJS

const list1 </span>= fromJS(["白板","幺鸡","三条","三万"<span style="color: #000000;">])
const list2 </span>= list1.push("四条"<span style="color: #000000;">)
const list3 </span>=<span style="color: #000000;"> list1.pop()
const list4 </span>= list1.unshift("东风"<span style="color: #000000;">)
const list5 </span>=<span style="color: #000000;"> list1.shift()

console.log(list1.toJS())
console.log(list2.toJS())
console.log(list3.toJS())
console.log(list4.toJS())
console.log(list5.toJS())</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk14.png" alt="" /></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">更改</span>set</p>
<p>set<span style="font-family: 宋体;">表示更改下标为</span><span style="font-family: Consolas;">2</span><span style="font-family: 宋体;">的项为&ldquo;二筒&rdquo;，注意不会真的改变原数组，而是返回新数组：</span></p>
<div class="cnblogs_code">
<pre><code>const list1 = fromJS(["白板","幺鸡","三条","三万"<span style="color: #000000;">])
const list2 </span>= list1.<span style="color: #ff0000;">set</span>(<span style="color: #ff0000;">2,"二筒"</span>);</pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk15.png" alt="" /></p>
<p>&nbsp;</p>
<p>对象也有set</p>
<div class="cnblogs_code">
<pre><code>const obj1 = fromJS({"a" : 1, "b" : 2 ,"c" : 3<span style="color: #000000;">})
const obj2 </span>= obj1<span style="color: #ff0000;">.set("b",888</span><span style="color: #000000;"><span style="color: #ff0000;">)</span>

console.log(obj1.toJS())
console.log(obj2.toJS())</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk16.png" alt="" /></p>
<p>&nbsp;</p>
<p>在数组中查找某一项，使用find()<span style="font-family: 宋体;">，寻找某一项下标用</span><span style="font-family: Consolas;">findIndex()</span></p>
<p><span style="font-family: 宋体;">得到</span>Map<span style="font-family: 宋体;">对象的某一个键的值，要用</span><span style="font-family: Consolas;">get()</span><span style="font-family: 宋体;">方法</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> immutable = require("immutable"<span style="color: #000000;">);
</span><span style="color: #0000ff;">var</span> fromJS =<span style="color: #000000;"> immutable.fromJS

const data </span>=<span style="color: #000000;"> fromJS([
    {</span>"id" : 1, "name" : "小明", "age" : 12<span style="color: #000000;">},
    {</span>"id" : 2, "name" : "小红", "age" : 12<span style="color: #000000;">},
    {</span>"id" : 3, "name" : "小强", "age" : 13<span style="color: #000000;">},
])

const item </span>= <span style="color: #ff0000;">data.find(item=&gt;item.get("id") == 2</span><span style="color: #000000;"><span style="color: #ff0000;">);</span>
console.log(item.toJS())</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk17.png" alt="" /></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">删除用</span>delete<span style="font-family: 宋体;">，删除下标为</span><span style="font-family: Consolas;">2</span><span style="font-family: 宋体;">的项</span></p>
<div class="cnblogs_code">
<pre><code>const list1 = fromJS([111,222,333,888,999<span style="color: #000000;">]);
const list2 </span>= list1<span style="color: #ff0000;">.delete(2</span><span style="color: #000000;"><span style="color: #ff0000;">);</span>
console.log(list1.toJS());
console.log(list2.toJS());</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk18.png" alt="" /></p>
<p>&nbsp;</p>
<p>is()<span style="font-family: 宋体;">函数验证是否相等</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> {is , Map} = require("immutable"<span style="color: #000000;">);
let o1 </span>= Map({a : 1, b : 2, c : 3<span style="color: #000000;">});
let o2 </span>= Map({a : 1, b : 2, c : 3<span style="color: #000000;">});

console.log(o1 </span>== o2);  <span style="color: #008000;">//</span><span style="color: #008000;">在内存中不相等</span>
console.log(<span style="color: #ff0000;">is(o1,o2)</span>); <span style="color: #008000;">//</span><span style="color: #008000;">在immutable世界中是相等</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk19.png" alt="" /></p>
<hr />
<h3><strong>2.1.3<span style="font-family: 宋体;">真实项目场景</span></strong></h3>
<p><strong><span style="font-family: 宋体;">真实项目场景</span> - <span style="font-family: 宋体;">增加</span><span style="font-family: Consolas;">todo</span><span style="font-family: 宋体;">，用</span><span style="font-family: Consolas;">set</span><span style="font-family: 宋体;">设置，用</span><span style="font-family: Consolas;">get</span><span style="font-family: 宋体;">获取</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> immutable = require("immutable"<span style="color: #000000;">);
</span><span style="color: #0000ff;">var</span> fromJS =<span style="color: #000000;"> immutable.fromJS

const data </span>=<span style="color: #000000;"> fromJS({
    </span>"todos"<span style="color: #000000;"> : [
        {</span>"id" : 1,"title" : "吃饭", "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;"> },
        {</span>"id" : 2,"title" : "睡觉", "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;"> },
        {</span>"id" : 3,"title" : "打豆豆", "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;"> },
    ],
    </span>"show" : "ALL"<span style="color: #000000;">
})

const newData </span>=<span style="color: #000000;"> data.<span style="color: #ff0000;">set(
    </span></span>"todos"<span style="color: #000000;">,
    data.<span style="color: #ff0000;">get(</span></span><span style="color: #ff0000;">"todos")</span>.push({"id" : 4,"title" : "打架", "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">})
<span style="color: #ff0000;">)</span>
console.log(newData.toJS())</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk20.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong><span style="font-family: 宋体;">真实项目场景</span> - <span style="font-family: 宋体;">删除</span><span style="font-family: Consolas;">id</span><span style="font-family: 宋体;">为</span><span style="font-family: Consolas;">2</span><span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">todo</span><span style="font-family: 宋体;">，使用</span><span style="font-family: Consolas;">delete(2)</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">删除id为2的项</span>
const newdata =<span style="color: #000000;"> data.<span style="color: #ff0000;">set</span>(
</span>"todos"<span style="color: #000000;">, 
data.get(</span>"todos").<span style="color: #ff0000;">delete</span>(data.<span style="color: #ff0000;">get</span>("todos").<span style="color: #ff0000;">findIndex(</span>item=&gt;item.get("id")== 2<span style="color: #000000;"><span style="color: #ff0000;">)</span>
)<span style="color: #ff0000;">)</span>;

console.log(newdata.toJS());</span></pre>
</div>
<p>&nbsp;</p>
<p>方法2<span style="font-family: 宋体;">：</span></p>
<div class="cnblogs_code">
<pre><code>const newData =<span style="color: #000000;"> data.set(
    </span>"todos"<span style="color: #000000;">,
    data.get(</span>"todos").filter(item=&gt;item.get("id") != 2<span style="color: #000000;">)
)</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk21.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong><span style="font-family: 宋体;">真实项目场景</span> - <span style="font-family: 宋体;">改变</span><span style="font-family: Consolas;">id</span><span style="font-family: 宋体;">为</span><span style="font-family: Consolas;">2</span><span style="font-family: 宋体;">的项</span><span style="font-family: Consolas;">title</span><span style="font-family: 宋体;">为&ldquo;吃鸡&rdquo;</span></strong></p>
<p><strong><span style="font-family: 宋体;">方法</span>1</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> index = data.get("todos")<span style="color: #ff0000;">.findIndex(</span>item=&gt;item.get("id") == 2<span style="color: #000000;"><span style="color: #ff0000;">)</span>;
</span><span style="color: #0000ff;">var</span> item = data.get("todos"<span style="color: #000000;">).get(index)
const newData </span>= data.set("todos",data.get("todos").set(index, item.set("title","吃鸡"<span style="color: #000000;">)));

console.log(newData.toJS())</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">方法</span>2</p>
<div class="cnblogs_code">
<pre><code>const newData = data.set("todos",data.get("todos").map(item=&gt;<span style="color: #000000;">{
    </span><span style="color: #0000ff;">return</span> item.get("id") == 2 <span style="color: #ff0000;">?</span> item.set("title" , "吃鸡"<span style="color: #000000;">) <span style="color: #ff0000;">:</span> item;
}))</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk22.png" alt="" /></p>
<hr />
<h3><strong>2.1.4<span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">redux</span><span style="font-family: 宋体;">结合</span></strong></h3>
<p><span style="font-family: 宋体;">改造</span>TodoList<span style="font-family: 宋体;">项目：</span></p>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk23.png" alt="" /></p>
<p><span style="font-family: 宋体;">只改变</span>reducers<span style="font-family: 宋体;">中的文件夹的写法，其它地方一律不改。</span></p>
<p>state<span style="font-family: 宋体;">的数据依然是原生</span><span style="font-family: Consolas;">JS</span><span style="font-family: 宋体;">的数组和对象，只不过在</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">函数运行中，瞬间变成为</span><span style="font-family: Consolas;">immutable</span><span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">List</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">Map</span><span style="font-family: 宋体;">了，但是出去的时候就</span><span style="font-family: Consolas;">toJS</span><span style="font-family: 宋体;">了，里外里，</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">还是原生数组、对象。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #ff0000;">import {fromJS , toJS} from "immutable"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
const initObj </span>=<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;"> : [
        {</span>"id" : 1 , "title" : "吃饭" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
        {</span>"id" : 2 , "title" : "睡觉" , "done" : <span style="color: #0000ff;">true</span><span style="color: #000000;">},
        {</span>"id" : 3 , "title" : "打豆豆" , "done" : <span style="color: #0000ff;">true</span><span style="color: #000000;">}
    ],
    </span>"show" : "ALL"<span style="color: #000000;">         
}

export </span><span style="color: #0000ff;">default</span> (state = initObj, action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">下面的语句很重要，变为immutable对象</span>
 <span style="color: #ff0000;">   state = fromJS(state);

    </span><span style="color: #0000ff;">if(action.type == "ADDTODO"){
         return</span> <span style="color: #0000ff;">state.set("todos", state.get("todos"</span><span style="color: #000000;"><span style="color: #0000ff;">).push(</span>
             {
                 </span>"id" : state.get("todos").reduce((a,b)=&gt;<span style="color: #000000;">{
　　　　　　　　　　</span><span style="color: #0000ff;">return</span> b.get("id") &gt; a ? b.get("id"<span style="color: #000000;">) : a
　　　　　　　　　　}, </span>0) + 1<span style="color: #000000;">,
                 </span>"title"<span style="color: #000000;"> : action.title,
                 </span>"done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">
             }
        <span style="color: #0000ff;"> ))</span><span style="color: #ff0000;">.toJS()</span>;
    <span style="color: #0000ff;">}</span></span><span style="color: #0000ff;">else if(action.type == "DELTODO"){
        </span><span style="color: #0000ff;">return</span><span style="color: #0000ff;"> state.set(
</span>"todos"<span style="color: #000000;">, 
state.get(</span>"todos").filter(item=&gt;item.get("id") !=<span style="color: #000000;"> action.id)
)<span style="color: #ff0000;">.toJS();</span>
   <span style="color: #0000ff;"> }</span></span><span style="color: #0000ff;">else if(action.type == "CHANGETODO"){
        </span><span style="color: #0000ff;">return</span><span style="color: #0000ff;"> state.set(
</span>"todos"<span style="color: #000000;">, 
state.get(</span>"todos"<span style="color: #000000;">).map(
item </span>=&gt; item.get("id") == action.id ?<span style="color: #000000;"> item.set(action.k, action.v) : item
)
<span style="color: #0000ff;">).</span><span style="color: #ff0000;">toJS();</span>
   <span style="color: #0000ff;"> }</span></span><span style="color: #0000ff;">else if(action.type == "CHANGESHOW"){
        </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">state.set</span>("show"<span style="color: #000000;">, action.show)<span style="color: #0000ff;">.toJS()</span>;
<span style="color: #0000ff;">    }
    </span></span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state.<span style="color: #ff0000;">toJS()</span>;
}</span></pre>
</div>
<hr />
<h2><strong>2.2 Ramda.js<span style="font-family: 宋体;">库</span></strong></h2>
<p><span style="font-family: 宋体;">纯函数，也叫作</span>&ldquo;兰姆达函数&rdquo;，就是<span style="font-family: Consolas;">ramda</span><span style="font-family: 宋体;">这个词。</span><a href="http://ramda.cn/"><span style="text-decoration: underline;">http://ramda.cn/</span></a></p>
<h3><strong>2.2.1<span style="font-family: 宋体;">函数柯里化基础</span></strong></h3>
<p><span style="font-family: 宋体;">函数柯里化</span>(Currying)<span style="font-family: 宋体;">，是把接受多个参数的函数变换成接受一个单一参数的函数，并且返回接受余下的参数，而且返回结果的新函数。柯里化函数就是逐步传参，逐步缩小函数的适用范围，逐步求解的过程。</span></p>
<p>&nbsp;</p>
<p>简单的加法函数：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> add(x,y){
    </span><span style="color: #0000ff;">return</span> x +<span style="color: #000000;"> y;
}
add(</span>2,3);<span style="color: #008000;">//</span><span style="color: #008000;">5</span></pre>
</div>
<p>如果用函数柯里化接受两个参数的函数变成单一参数，如下：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('0f5f10cb-1b27-44c5-84bd-9aa9dc3d113f')"><img id="code_img_closed_0f5f10cb-1b27-44c5-84bd-9aa9dc3d113f" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_0f5f10cb-1b27-44c5-84bd-9aa9dc3d113f" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('0f5f10cb-1b27-44c5-84bd-9aa9dc3d113f',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_0f5f10cb-1b27-44c5-84bd-9aa9dc3d113f" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> add(x) {
    </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> (y){
        </span><span style="color: #0000ff;">return</span> x +<span style="color: #000000;"> y
    }
}

console.log(add(</span>2)(3))</pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p>&nbsp;</p>
<hr />
<h3>&nbsp;</h3>
<h3><strong>2.2.2<span style="font-family: 宋体;">基本讲解</span></strong></h3>
<div class="cnblogs_code">
<pre><code>npm install ramda --save</pre>
</div>
<p>数组尾插一项：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> R = require("ramda"<span style="color: #000000;">);

</span><span style="color: #0000ff;">var</span> arr1 = ["红中","白板","幺鸡"<span style="color: #000000;">];
</span><span style="color: #0000ff;">var</span> arr2 = R.<span style="color: #ff0000;">append</span>("一筒"<span style="color: #000000;">, arr1)
</span><span style="color: #0000ff;">var</span> arr3 = R.<span style="color: #ff0000;">append</span>("二筒"<span style="color: #000000;">)(arr1)

console.log(arr1)
console.log(arr2)
console.log(arr3)</span></pre>
</div>
<p><span style="color: #ff0000;"><strong>被操作的元素放到最后一个参数。</strong></span></p>
<p>&nbsp;<img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk26.png" alt="" /></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">数组头插一项：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('02fd01eb-3544-412f-abd0-0bae8718aa55')"><img id="code_img_closed_02fd01eb-3544-412f-abd0-0bae8718aa55" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_02fd01eb-3544-412f-abd0-0bae8718aa55" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('02fd01eb-3544-412f-abd0-0bae8718aa55',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_02fd01eb-3544-412f-abd0-0bae8718aa55" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">var</span> R = require("ramda"<span style="color: #000000;">);

</span><span style="color: #0000ff;">var</span> arr1 = ["红中","白板","幺鸡"<span style="color: #000000;">];
</span><span style="color: #0000ff;">var</span> arr4 = R.prepend("发财"<span style="color: #000000;">,arr1)

console.log(arr4)</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk29.png" alt="" /></p>
<hr />
<h3><strong>2.2.3<span style="font-family: 宋体;">真实项目场景</span></strong></h3>
<p>改变对象的<span style="font-family: Consolas;">b</span><span style="font-family: 宋体;">属性为</span><span style="font-family: Consolas;">8</span></p>
<p><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">这里使用了非常重要的方法</span>R.lensProp()<span style="font-family: 宋体;">聚焦到某属性，功能就是让改变的值从原基础上进行修改</span></strong></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> R = require("ramda"<span style="color: #000000;">);

const obj1 </span>= {"a" : 1,"b" : 2,"c" : 3<span style="color: #000000;">}
const obj2 </span>= R.set(<span style="color: #ff0000;">R.lensProp("b")</span> , 8<span style="color: #000000;">, obj1)
console.log(obj2)</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk30.png" alt="" /></p>
<p>&nbsp;</p>
<p>删除id<span style="font-family: 宋体;">为</span><span style="font-family: Consolas;">2</span><span style="font-family: 宋体;">的项：</span></p>
<div class="cnblogs_code">
<pre><code>const state =<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;">: [
       {</span>"id" : 1, "title" : "吃饭",  "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
       {</span>"id" : 2, "title" : "睡觉",  "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
       {</span>"id" : 3, "title" : "打豆豆","done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">}
    ],
    </span>"show":"ALL"<span style="color: #000000;">
}

</span><span style="color: #008000;">//</span><span style="color: #008000;">删除id为2的项</span>
<span style="color: #ff0000;">const newstate = R.set(R.lensProp("todos"), R.filter(item=&gt;item.id != 2</span><span style="color: #000000;"><span style="color: #ff0000;">, state.todos) , state);</span>
console.log(newdata)</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk31.png" alt="" /></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">修改</span>id<span style="font-family: 宋体;">为</span><span style="font-family: Consolas;">2</span><span style="font-family: 宋体;">的项</span><span style="font-family: Consolas;">title</span><span style="font-family: 宋体;">为吃鸡</span></p>
<div class="cnblogs_code">
<pre><code>const newstate = R.set(<span style="color: #ff0000;">R.lensProp("todos")</span>,R.map(item =&gt; item.id == 2 <span style="color: #ff0000;">?</span> <br />R.set(R.lensProp("title"),"吃鸡",item) <span style="color: #ff0000;">:</span> item , state.todos), state);</pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk32.png" alt="" /></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">修改</span>show<span style="font-family: 宋体;">为</span><span style="font-family: Consolas;">ONLYDONE</span></p>
<div class="cnblogs_code">
<pre><code>const newstate = R.set(<span style="color: #ff0000;">R.lensProp("show")</span> , "ONLYDONE", state);</pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk33.png" alt="" /></p>
<p><span style="color: #ff0000;"><strong>基本上一条语句能够解决问题，不再写</strong><strong>...<span style="font-family: 宋体;">了，并且相比如</span><span style="font-family: Consolas;">immutable</span><span style="font-family: 宋体;">，没有</span><span style="font-family: Consolas;">Map</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">List</span><span style="font-family: 宋体;">和对象、数组的转换。</span></strong></span></p>
<hr />
<h3><strong>2.2.4<span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">redux</span><span style="font-family: 宋体;">结合</span></strong></h3>
<p><span style="font-family: 宋体;">还是用</span>todolist<span style="font-family: 宋体;">举例，在</span><span style="font-family: Consolas;">reducers/index.js</span><span style="font-family: 宋体;">中修改，下面标黄色的语句的</span><span style="font-family: Consolas;">R.__</span><span style="font-family: 宋体;">是占位符：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> R = require("ramda"<span style="color: #000000;">);

const initObj </span>=<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;"> : [
        {</span>"id" : 1 , "title" : "吃饭" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
        {</span>"id" : 2 , "title" : "睡觉" , "done" : <span style="color: #0000ff;">true</span><span style="color: #000000;">},
        {</span>"id" : 3 , "title" : "打豆豆", "done" : <span style="color: #0000ff;">true</span><span style="color: #000000;">}
    ],
    </span>"show" : "ALL"<span style="color: #000000;">         
}

export </span><span style="color: #0000ff;">default</span> (state = initObj, action) =&gt;<span style="color: #000000;"> {
</span><span style="color: #008000;">//</span><span style="color: #008000;">R.__表示占位符，下面调用setTodos时，就等于传入了要更改成为的值</span>
   <span style="color: #ff0000;"> const setTodos = R.set(R.lensProp("todos"), R.__ , state);
    const setShow  = R.set(R.lensProp("show") , R.__ , state);

    </span><span style="color: #0000ff;">if</span>(action.type == "ADDTODO"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span><span style="color: #ff0000;"> setTodos(R.append({
            "id" : state.todos.reduce((a,b) =&gt; b.id &gt; a ? b.id : a, 0) + 1,
            "title" : action.title,
            "done" : false</span><span style="color: #000000;"><span style="color: #ff0000;">
        },state.todos));</span>
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "DELTODO"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span> <span style="color: #ff0000;">setTodos(state.todos.filter(item=&gt;item.id !=</span><span style="color: #000000;"><span style="color: #ff0000;"> action.id));</span>
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "CHANGETODO"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span> <span style="color: #ff0000;">setTodos(state.todos.map(item=&gt;item.id == action.id ?</span><span style="color: #000000;"><span style="color: #ff0000;"> R.set(R.lensProp(action.k), action.v, item) : item))</span>
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "CHANGESHOW"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"><span style="color: #ff0000;"> setShow(action.show);</span>
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<hr />
<h2><strong>2.3 lodash.js<span style="font-family: 宋体;">库</span></strong></h2>
<h3><strong>2.3.1<span style="font-family: 宋体;">基本讲解</span></strong></h3>
<p><span style="font-family: 宋体;">实际上</span>underscore.js<span style="font-family: 宋体;">已经在&ldquo;函数库工具&rdquo;输给了</span><span style="font-family: Consolas;">lodash</span><span style="font-family: 宋体;">，</span><span style="font-family: Consolas;">lodash</span><span style="font-family: 宋体;">完全可以替代</span><span style="font-family: Consolas;">underscore</span><span style="font-family: 宋体;">。</span></p>
<p>官网：<a href="https://lodash.com/"><span style="text-decoration: underline;">https://lodash.com/</span></a></p>
<p>中文：<a href="https://www.lodashjs.com/"><span style="text-decoration: underline;">https://www.lodashjs.com/</span></a></p>
<p>中文：<a href="http://www.css88.com/doc/lodash/"><span style="text-decoration: underline;">http://www.css88.com/doc/lodash/</span></a></p>
<div class="cnblogs_code">
<pre><code>npm install --save lodash</pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk34.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong>underscore<span style="font-family: 宋体;">有的函数，</span><span style="font-family: Consolas;">lodash</span><span style="font-family: 宋体;">全有，比如数组去重和最大最小值：</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> _ = require("lodash"<span style="color: #000000;">);

</span><span style="color: #0000ff;">var</span> arr1 = [3,3,3,3,4,4,4,4,5,5,5,5,3<span style="color: #000000;">];
</span><span style="color: #0000ff;">var</span> arr2 =<span style="color: #000000;"><span style="color: #ff0000;"> _.uniq(arr1);</span>

console.log(arr1);
console.log(arr2);

console.log(_.max(arr1));
console.log(_.min(arr1));</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk35.png" alt="" /></p>
<p>&nbsp;</p>
<p><strong>lodash<span style="font-family: 宋体;">中有子包，叫做</span><span style="font-family: Consolas;">fp</span><span style="font-family: 宋体;">。</span><span style="font-family: Consolas;">fp</span><span style="font-family: 宋体;">是</span><span style="font-family: Consolas;">functional programing</span><span style="font-family: 宋体;">函数式编程的意思。</span></strong></p>
<p>需要引入这个包</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> fp = require("lodash/fp");</pre>
</div>
<p><span style="font-family: 宋体;">更改</span>b<span style="font-family: 宋体;">属性为</span><span style="font-family: Consolas;">8</span><span style="font-family: 宋体;">：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('07c2424f-4d81-4104-add9-fed78f6615b0')"><img id="code_img_closed_07c2424f-4d81-4104-add9-fed78f6615b0" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_07c2424f-4d81-4104-add9-fed78f6615b0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('07c2424f-4d81-4104-add9-fed78f6615b0',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_07c2424f-4d81-4104-add9-fed78f6615b0" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">var</span> fp = require("lodash/fp"<span style="color: #000000;">);

</span><span style="color: #0000ff;">var</span> obj1 = {"a" : 1 , "b" : 2 , "c" : 3<span style="color: #000000;">};
</span><span style="color: #0000ff;">var</span> obj2 = fp.set("b" , 8<span style="color: #000000;"> , obj1);

console.log(obj1);
console.log(obj2);</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk38.png" alt="" /></p>
<p>和ramda<span style="font-family: 宋体;">一样，被操作对象写最后一个参数。</span></p>
<hr />
<h3><strong>2.3.2<span style="font-family: 宋体;">真实项目场景</span></strong></h3>
<p><strong>删除</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> fp = require("lodash/fp"<span style="color: #000000;">);

const state </span>=<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;"> : [
        {</span>"id" : 1 , "title" : "吃1饭" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
        {</span>"id" : 2 , "title" : "吃2饭" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
        {</span>"id" : 3 , "title" : "吃3饭" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">}
    ],
    </span>"show" : "ALL"<span style="color: #000000;">
};

</span><span style="color: #008000;">//</span><span style="color: #008000;">删除id为2的项</span>
<span style="color: #ff0000;">const newstate = fp.set("todos", state.todos.filter(item =&gt; item.id != 2</span><span style="color: #000000;"><span style="color: #ff0000;">), state);</span>

console.log(state);
console.log(newstate);</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>增加：</strong></p>
<div class="cnblogs_code">
<pre><code>const newstate = <span style="color: #ff0000;">fp.set</span>("todos"<span style="color: #000000;">, <span style="color: #ff0000;">fp.concat(</span>
    state.todos,
    {
        </span>"id" : state.todos.reduce((a,b) =&gt; b.id &gt; a ? b.id : a, 0) + 1<span style="color: #000000;">,
        </span>"title": "吃鸡"<span style="color: #000000;">,
        </span>"done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">
    }
<span style="color: #ff0000;">)</span> , state<span style="color: #ff0000;">);</span></span></pre>
</div>
<p>&nbsp;</p>
<p><strong><span style="font-family: 宋体;">修改</span>id<span style="font-family: 宋体;">为</span><span style="font-family: Consolas;">2</span><span style="font-family: 宋体;">的项的</span><span style="font-family: Consolas;">title</span><span style="font-family: 宋体;">为&ldquo;吃鸡&rdquo;</span></strong></p>
<div class="cnblogs_code">
<pre><code>const newstate = fp.set("todos",state.todos.map(item=&gt;item.id == 2 ? fp.set("title", "吃鸡", item) : item), state);</pre>
</div>
<p><span style="font-family: 宋体;">如果遇见比较难的场景，此时可以用克隆方法，比如在第</span>2<span style="font-family: 宋体;">项之间插入一项</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('e53b8fda-d154-4ccf-95aa-d538b1841c8e')"><img id="code_img_closed_e53b8fda-d154-4ccf-95aa-d538b1841c8e" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_e53b8fda-d154-4ccf-95aa-d538b1841c8e" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('e53b8fda-d154-4ccf-95aa-d538b1841c8e',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_e53b8fda-d154-4ccf-95aa-d538b1841c8e" class="cnblogs_code_hide">
<pre><code>const _todos =<span style="color: #000000;"> fp.clone(state.todos)

</span><span style="color: #008000;">//</span><span style="color: #008000;">更改克隆之后的数组</span>
_todos.splice(2,0,{"id": 4,"title":"游泳","done":<span style="color: #0000ff;">false</span><span style="color: #000000;">})

</span><span style="color: #008000;">//</span><span style="color: #008000;">更改state</span>
const newstate = fp.set("todos"<span style="color: #000000;">, _todos, state)
console.log(state)
console.log(newstate)</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<div class="cnblogs_code" onclick="cnblogs_code_show('efaf558e-a9eb-4c68-aebd-43840b2596f4')"><img id="code_img_closed_efaf558e-a9eb-4c68-aebd-43840b2596f4" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_efaf558e-a9eb-4c68-aebd-43840b2596f4" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('efaf558e-a9eb-4c68-aebd-43840b2596f4',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_efaf558e-a9eb-4c68-aebd-43840b2596f4" class="cnblogs_code_hide">
<pre><code>const car =<span style="color: #000000;"> {
    </span>"cars"<span style="color: #000000;"> : {
        </span>"a"<span style="color: #000000;"> : [
            {
                </span>"name" : "奥迪"<span style="color: #000000;"> ,
                </span>"series"<span style="color: #000000;"> : [
                    {
                        </span>"name" : "A6"<span style="color: #000000;">,
                        </span>"type" : "豪华轿车"<span style="color: #000000;">
                    },
                    {
                        </span>"name" : "A4"<span style="color: #000000;">,
                        </span>"type" : "豪华轿车"<span style="color: #000000;">
                    }
                ]
            },
            {
                </span>"name" : "奥拓"<span style="color: #000000;">,
                </span>"series" : [{"奥拓1号" : 2<span style="color: #000000;">}]
            }
        ],
        </span>"b"<span style="color: #000000;"> : [
            {</span>"奔驰" : 1<span style="color: #000000;">}
        ]
    }
}

</span><span style="color: #008000;">//</span><span style="color: #008000;">改变A6的车系为普通轿车</span>
<span style="color: #0000ff;">var</span> newstate =<span style="color: #000000;"> fp.cloneDeep(car);
newstate.cars.a[</span>0].series[0].type = '普通轿车'<span style="color: #000000;">;

console.log(JSON.stringify(newstate))</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<hr />
<h3><strong>2.3.3 <span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">redux</span><span style="font-family: 宋体;">结合</span></strong></h3>
<div class="cnblogs_code">
<pre><code>import fp from "lodash/fp"<span style="color: #000000;">; 

const initObj </span>=<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;"> : [
        {</span>"id" : 1 , "title" : "吃饭" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
        {</span>"id" : 2 , "title" : "睡觉" , "done" : <span style="color: #0000ff;">true</span><span style="color: #000000;">},
        {</span>"id" : 3 , "title" : "打豆豆" , "done" : <span style="color: #0000ff;">true</span><span style="color: #000000;">}
    ],
    </span>"show" : "ALL"<span style="color: #000000;">         
}

export </span><span style="color: #0000ff;">default</span> (state = initObj, action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">if</span>(action.type == "ADDTODO"<span style="color: #000000;">){
        </span><span style="color: #ff0000;">return fp.set("todos" , fp.concat(state.todos , {
            "id" : state.todos.reduce((a,b) =&gt; b.id &gt; a ? b.id : a , 0) + 1,
            "title" : action.title,
            "done" : false</span><span style="color: #000000;"><span style="color: #ff0000;">
        }), state);</span>
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "DELTODO"<span style="color: #000000;">){
        </span><span style="color: #ff0000;">return fp.set("todos" , state.todos.filter(item =&gt; item.id !=</span><span style="color: #000000;"><span style="color: #ff0000;"> action.id) , state);</span>
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "CHANGETODO"<span style="color: #000000;">){
        </span><span style="color: #ff0000;">return fp.set("todos", state.todos.map(item=&gt;item.id == action.id ?</span><span style="color: #000000;"><span style="color: #ff0000;"> fp.set(action.k,action.v,item) : item) , state);</span>
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "CHANGESHOW"<span style="color: #000000;">){
        </span><span style="color: #ff0000;">return fp.set("show"</span><span style="color: #000000;"><span style="color: #ff0000;"> , action.show , state);</span>
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<hr />
<h1><strong>三、异步</strong></h1>
<h2><strong>3.1<span style="font-family: 宋体;">搭建服务器</span></strong></h2>
<p><span style="font-family: 宋体;">我们将所有前端的东西都放入</span>www<span style="font-family: 宋体;">文件夹中。</span></p>
<p>&nbsp;</p>
<p>Node.js<span style="font-family: 宋体;">写</span><span style="font-family: Consolas;">app.js</span><span style="font-family: 宋体;">实现数据接口：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('f446aff1-4fa8-4604-9bba-e1afd135df30')"><img id="code_img_closed_f446aff1-4fa8-4604-9bba-e1afd135df30" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_f446aff1-4fa8-4604-9bba-e1afd135df30" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('f446aff1-4fa8-4604-9bba-e1afd135df30',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_f446aff1-4fa8-4604-9bba-e1afd135df30" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">var</span> express = require("express"<span style="color: #000000;">);
</span><span style="color: #0000ff;">var</span> app =<span style="color: #000000;"> express();
app.use(express.static(</span>"www"<span style="color: #000000;">))

app.get(</span>"/api",(req,res)=&gt;<span style="color: #000000;">{
    res.json({</span>"result":8<span style="color: #000000;">})
})
app.listen(</span>3000);</pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<hr />
<h2><strong>3.2 redux-thunk<span style="font-family: 宋体;">解决异步</span></strong></h2>
<p><span style="font-family: 宋体;">我们现在有四个文件都没有地方适合写异步：</span>components<span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">actions</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">constants</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">。</span></p>
<p><span style="font-family: 宋体;">所以</span>React<span style="font-family: 宋体;">提供了</span><span style="font-family: Consolas;">react-thunk</span><span style="font-family: 宋体;">包，</span><span style="font-family: Consolas;">thunk</span><span style="font-family: 宋体;">是中间件，所谓的中间件就是在发出</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">进行改变的中间，要做的事。</span></p>
<p><a href="https://www.npmjs.com/package/redux-thunk"><span style="text-decoration: underline;">https://www.npmjs.com/package/redux-thunk</span></a></p>
<p>&nbsp;</p>
<p>安装依赖：</p>
<div class="cnblogs_code">
<pre><code>npm install --save redux-thunk</pre>
</div>
<p>main.js</p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import ReactDOM from </span>"react-dom"<span style="color: #000000;">;
import { createStore, applyMiddleware} from </span>"redux"<span style="color: #000000;">;
import { Provider } from </span>'react-redux'<span style="color: #ff0000;">
import thunk from 'redux-thunk'</span><span style="color: #000000;"> 
import reducers from </span>"./reducers/index"<span style="color: #000000;">;
import logger from </span>"redux-logger"<span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">引入父组件</span>
import App from "./containers/App"<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">创建Redux store 仓库用来存放状态</span>
const store =<span style="color: #000000;"> createStore(reducers, applyMiddleware(logger, <span style="color: #ff0000;">thunk</span>))

ReactDOM.render(
    </span>&lt;Provider store={store}&gt;
        &lt;App&gt;&lt;/App&gt;
    &lt;/Provider&gt;,
    document.getElementById('app'<span style="color: #000000;">)
)</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>components/counter/index.js<span style="font-family: 宋体;">组件，按钮点击之后做</span><span style="font-family: Consolas;">addServer</span><span style="font-family: 宋体;">：</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">button </span><span style="color: #ff0000;">onClick</span><span style="color: #0000ff;">={()=</span><span style="color: #0000ff;">&gt;</span>{this.props.counterActions.addServer()}}&gt;加服务器那么多<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">button</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p><strong><span style="font-family: 宋体;">此时</span>actions/counterActions.js<span style="font-family: 宋体;">文件中，就可以写异步函数了：</span></strong></p>
<p><span style="font-family: 宋体;">两步：第一步请求服务器数据，第二步发出</span>action<span style="font-family: 宋体;">。将服务器的返回结果，当做载荷发给</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">。</span></p>
<div class="cnblogs_code">
<pre><code>import {ADD , MINUS , <span style="color: #ff0000;">ADDSERVER</span>} from "../constants/COUNTER.js"<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">同步阵营，直接返回一个Action</span>
export const add = () =&gt; ({"type"<span style="color: #000000;"> : ADD});
export const minus </span>= () =&gt; ({"type"<span style="color: #000000;"> : MINUS});

</span><span style="color: #008000;">//</span><span style="color: #008000;">异步有两个()，第一个()接受按钮传的参数，第二个()是系统给你的dispatch和getState</span><span style="color: #008000;">
//</span><span style="color: #008000;">export const addServer = (n)=&gt; (dispatch, getState)=&gt;{ </span><span style="color: #008000;">
//</span><span style="color: #008000;">    alert(n) </span><span style="color: #008000;">
//</span><span style="color: #008000;">    alert(dispatch)</span><span style="color: #008000;">
//</span><span style="color: #008000;">    alert(getState().counter.v)</span><span style="color: #008000;">
//</span><span style="color: #008000;">}</span>
<span style="color: #0000ff;">
export const addServer = ()=&gt; async (dispatch , getState) =&gt; {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">发出Ajax请求，实际上是fetch请求，fetch不是Ajax</span>
   <span style="color: #ff0000;"> const {result} = await</span> <span style="color: #ff0000;">fetch("/api").then(data=&gt;data.json());
    </span><span style="color: #008000;">//</span><span style="color: #008000;">发action，因为唯一能改变reducer的方法就是dispath一个action</span>
   <span style="color: #ff0000;"> dispatch({"type"</span><span style="color: #000000;"><span style="color: #ff0000;"> : ADDSERVER , result})</span>
<span style="color: #0000ff;">}</span></span></pre>
</div>
<p>&nbsp;</p>
<p><strong>constants/COUNTER.js</strong></p>
<div class="cnblogs_code">
<pre><code>export const <span style="color: #ff0000;">ADDSERVER</span> = "ADDSERVER_COUNTER";</pre>
</div>
<p><strong>reducers/counter.js</strong></p>
<div class="cnblogs_code">
<pre><code>import {ADD , MINUS , <span style="color: #ff0000;">ADDSERVER</span>} from "../constants/COUNTER.js"<span style="color: #000000;">;
export </span><span style="color: #0000ff;">default</span> (state = {"v" : 0} , action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"> ADD){
        ...
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"> MINUS){
        ...
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"><span style="color: #ff0000;"> ADDSERVER</span>){
        </span><span style="color: #ff0000;">return {
            "v" : state.v +</span><span style="color: #000000;"><span style="color: #ff0000;"> action.result
        }</span>
    } 
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">如果使用</span>fetch<span style="font-family: 宋体;">，要安装</span><span style="font-family: Consolas;">babel</span><span style="font-family: 宋体;">插件：</span><span style="font-family: Consolas;">babel-plugin-transform-runtime</span></strong></span></p>
<p><span style="color: #ff0000;"><strong>babel<span style="font-family: 宋体;">把</span><span style="font-family: Consolas;">async await</span><span style="font-family: 宋体;">翻译成浏览器都不认识的语句了，所以要用插件解决，不让</span><span style="font-family: Consolas;">babel</span><span style="font-family: 宋体;">翻译：</span></strong></span></p>
<div class="cnblogs_code">
<pre><code>const path = require('path'<span style="color: #000000;">);
module.exports </span>=<span style="color: #000000;"> {
    entry : </span>"./www/app/main",                             <span style="color: #008000;">//</span><span style="color: #008000;"> 入口</span>
<span style="color: #000000;">    output: {
        path: path.resolve(__dirname, </span>"www/dist"),         <span style="color: #008000;">//</span><span style="color: #008000;"> 出口文件夹</span>
        filename: "bundle.js"                             <span style="color: #008000;">//</span><span style="color: #008000;"> 出口文件名</span>
<span style="color: #000000;">    },
    watch : </span><span style="color: #0000ff;">true</span>,                                         <span style="color: #008000;">//</span><span style="color: #008000;"> 自动检测变化，进行打包</span>
    module: {                                            <span style="color: #008000;">//</span><span style="color: #008000;"> 配置一些插件</span>
<span style="color: #000000;">        rules: [
            {
                test: </span>/\.js$/,                            <span style="color: #008000;">//</span><span style="color: #008000;"> 所有.js结尾的文件</span>
                loader: "babel-loader",                <span style="color: #008000;">//</span><span style="color: #008000;"> 都要使用babel-loader处理</span>
                include: [path.resolve(__dirname, "www/app"<span style="color: #000000;">)],
                exclude: [path.resolve(__dirname, </span>"node_modules"<span style="color: #000000;">)],
                options: {
                    presets: [</span>"env" , "react"<span style="color: #000000;">],
                    plugins: [</span>"transform-object-rest-spread", <span style="color: #ff0000;">"transform-runtime"</span><span style="color: #000000;"> ]
                }
            }
        ]
    }
}</span></pre>
</div>
<p><strong>现在讲解重要知识，如何从服务器上请求默认数据，此时要通过：</strong></p>
<p>&nbsp;<img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk45.png" alt="" /></p>
<h3><strong><span style="font-family: 宋体;">结合</span>Echarts.js<span style="font-family: 宋体;">使用</span></strong></h3>
<p>app.js<span style="font-family: 宋体;">服务端出数据接口：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('4ba5c3fe-6793-4ee7-bd6b-1b3233b213cd')"><img id="code_img_closed_4ba5c3fe-6793-4ee7-bd6b-1b3233b213cd" class="code_img_closed" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk0.png" alt="" /><img id="code_img_opened_4ba5c3fe-6793-4ee7-bd6b-1b3233b213cd" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('4ba5c3fe-6793-4ee7-bd6b-1b3233b213cd',event)" src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk1.png" alt="" />
<div id="cnblogs_code_open_4ba5c3fe-6793-4ee7-bd6b-1b3233b213cd" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">var</span> a = 0<span style="color: #000000;">;
</span><span style="color: #0000ff;">var</span> b = 0<span style="color: #000000;">;
</span><span style="color: #0000ff;">var</span> c = 0<span style="color: #000000;">;
app.get(</span>"/api2" , (req,res)=&gt;<span style="color: #000000;">{
    res.json({
        </span>"result"<span style="color: #000000;">: [
            { value: a, name: </span>'清晰'<span style="color: #000000;"> },
            { value: b, name: </span>'一般'<span style="color: #000000;"> },
            { value: c, name: </span>'懵逼'<span style="color: #000000;"> }
        ]
    });
});

</span><span style="color: #008000;">//</span><span style="color: #008000;">投票接口</span>
app.get("/toupiao/:zimu" , (req,res)=&gt;<span style="color: #000000;">{
    </span><span style="color: #0000ff;">var</span> zimu =<span style="color: #000000;"> req.params.zimu;
    </span><span style="color: #0000ff;">if</span>(zimu == "a") a++<span style="color: #000000;">;
    </span><span style="color: #0000ff;">if</span>(zimu == "b") b++<span style="color: #000000;">;
    </span><span style="color: #0000ff;">if</span>(zimu == "c") c++<span style="color: #000000;">;
    
    res.json({
        </span>"result"<span style="color: #000000;">: [
            { value: a, name: </span>'清晰'<span style="color: #000000;"> },
            { value: b, name: </span>'一般'<span style="color: #000000;"> },
            { value: c, name: </span>'懵逼'<span style="color: #000000;"> }
        ]
    });
});

app.listen(</span>3000);</pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p><strong>containers/App.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
import {connect} from </span>"react-redux"<span style="color: #000000;">;
import Counter from </span>"../components/counter/index.js"<span style="color: #000000;">;
<span style="color: #ff0000;">import Pie from </span></span><span style="color: #ff0000;">"../components/pie/index.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> class App extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
                &lt;Counter&gt;&lt;/Counter&gt;
               <span style="color: #ff0000;"> &lt;Pie&gt;&lt;/Pie&gt;</span>
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>components/pie/index.js<span style="font-family: 宋体;">组件的构造函数中调用函数：</span></strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
<span style="color: #ff0000;">import {connect} from </span></span><span style="color: #ff0000;">"react-redux";
import {bindActionCreators} from "redux";
import * as pieActions from "../../actions/pieActions.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>

class Pie extends React.Component {
    constructor(<span style="color: #ff0000;">props</span>) {
        super(<span style="color: #ff0000;">props</span>);
        </span><span style="color: #008000;">//</span><span style="color: #008000;">/组件还没上树时，发异步请求数据</span>
<span style="color: #000000;"><span style="color: #ff0000;">        props.pieActions.loadServer();</span>
    }
</span><span style="color: #008000;">//</span><span style="color: #008000;">组件已经上树，然后初始化echart结构</span>
<span style="color: #0000ff;">    componentDidMount(){
        <span style="color: #ff0000;">this.pic = echarts.init(this.refs.pic);</span>
    }
</span><span style="color: #008000;">//</span><span style="color: #008000;">React开发中没有回调函数的，所以数据回来了，在组件将要更新的生命周期写</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">组件将要更新，为什么会将要更新，因为reducer中的result变了！</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">为什么它变了，因为fetch回来了，从而发出dispatch，影响result了。</span>
<span style="color: #0000ff;">    componentWillUpdate(nextProps){
        </span><span style="color: #008000;">//</span><span style="color: #008000;">这是百度的图表插件标准写法，就是一个配置，最重要的是最后一项data，来自服务器</span>
        <span style="color: #0000ff;">var</span> option =<span style="color: #000000;"> {
            tooltip: {
                trigger: </span>'item'<span style="color: #000000;">,
                formatter: </span>"{a} &lt;br/&gt;{b}: {c} ({d}%)"<span style="color: #000000;">
            },
            legend: {
                orient: </span>'vertical'<span style="color: #000000;">,
                x: </span>'left'<span style="color: #000000;">,
               <span style="color: #ff0000;"> data: [</span></span><span style="color: #ff0000;">'清晰', '一般', '懵逼'</span><span style="color: #000000;"><span style="color: #ff0000;">]</span>
            },
            series: [
                {
                    name: </span>'懵逼指数'<span style="color: #000000;">,
                    type: </span>'pie'<span style="color: #000000;">,
                    radius: [</span>'50%', '70%'<span style="color: #000000;">],
                    avoidLabelOverlap: </span><span style="color: #0000ff;">false</span><span style="color: #000000;">,
                    label: {
                        normal: {
                            show: </span><span style="color: #0000ff;">false</span><span style="color: #000000;">,
                            position: </span>'center'<span style="color: #000000;">
                        },
                        emphasis: {
                            show: </span><span style="color: #0000ff;">true</span><span style="color: #000000;">,
                            textStyle: {
                                fontSize: </span>'30'<span style="color: #000000;">,
                                fontWeight: </span>'bold'<span style="color: #000000;">
                            }
                        }
                    },
                    labelLine: {
                        normal: {
                            show: </span><span style="color: #0000ff;">false</span><span style="color: #000000;">
                        }
                    },
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">这里呈递数据</span>
<span style="color: #000000;"><span style="color: #ff0000;">                    data: nextProps.result</span>
                }
            ]
        };
        </span><span style="color: #008000;">//</span><span style="color: #008000;">设置option，组件就能显示图表了</span>
        <span style="color: #ff0000;">this</span><span style="color: #000000;"><span style="color: #ff0000;">.pic.setOption(option);</span>
 <span style="color: #0000ff;">   }</span>

    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
              </span>&lt;div&gt;
            &lt;p&gt;结果：{<span style="color: #0000ff;">this</span>.props.result}&lt;/p&gt;
                &lt;div<span style="color: #ff0000;"> ref="pic" style={{"width":"300px" ,"height":"300px"}}</span>&gt;&lt;/div&gt;
                &lt;button <span style="color: #0000ff;">onClick={<span style="color: #ff0000;">()=&gt;{this.props.pieActions.toupiao('a')}</span>}</span>&gt;清晰&lt;/button&gt;
                &lt;button <span style="color: #0000ff;">onClick={<span style="color: #ff0000;">()=&gt;{this.props.pieActions.toupiao('b')}</span>}</span>&gt;一般&lt;/button&gt;
                &lt;button <span style="color: #0000ff;">onClick={<span style="color: #ff0000;">()=&gt;{this.props.pieActions.toupiao('c')}</span>}</span>&gt;懵逼&lt;/button&gt;
              &lt;/div&gt;
<span style="color: #000000;">        );
    }
}

export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    <span style="color: #0000ff;">({pie})</span></span><span style="color: #0000ff;">=&gt;({
        <span style="color: #ff0000;">result: pie.result</span>
    }),
    (dipatch)=&gt;</span><span style="color: #000000;"><span style="color: #0000ff;">({
       <span style="color: #ff0000;"> pieActions: bindActionCreators(pieActions, dipatch)</span>
    })</span>
)(Pie);</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>actions/pieActions.js<span style="font-family: 宋体;">中写异步请求数据</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">export const loadServer = () =&gt; async (dispatch , getState) =&gt; {
    //异步请求数据
    <span style="color: #ff0000;">const {result} = await fetch("/api2").then(data=&gt;data.json());</span>
    //存储到reducer
    <span style="color: #ff0000;">dispatch({"type" : "LOADSERVER"</span></span><span style="color: #000000;"><span style="color: #0000ff;"><span style="color: #ff0000;"> , result});</span>
}</span>

<span style="color: #0000ff;">export const toupiao </span></span><span style="color: #0000ff;">= (zimu) =&gt; async (dispatch, getState) =&gt; {
   <span style="color: #ff0000;"> const { result } = await fetch("/toupiao/" + zimu).then(data =&gt; data.json());
    dispatch({ "type": "LOADSERVER", result });</span>
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>reducers/pie.js<span style="font-family: 宋体;">要处理</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">的工作</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">export default (state = {"result" : []} , action) =&gt; {
    if(action.type == "LOADSERVER"){
        <span style="color: #ff0000;">return {"result" : action.result};</span>
    }
    <span style="color: #ff0000;">return state;</span>
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>reducers/index.js</strong></p>
<div class="cnblogs_code">
<pre><code>import {combineReducers} from "redux"<span style="color: #000000;">;
import counter from </span>"./counter.js"<span style="color: #000000;">;
<span style="color: #ff0000;">import pie from </span></span><span style="color: #ff0000;">"./pie.js";
</span><span style="color: #008000;">//</span><span style="color: #008000;">暴露合并的reducer</span>
export <span style="color: #0000ff;">default</span><span style="color: #000000;"> combineReducers({
    counter ,
    <span style="color: #ff0000;">pie</span>
});</span></pre>
</div>
<p><img src="./images/前端笔记之React（六）ES6的Set和Map&amp;immutable和Ramda和lodash&amp;redux-thunk48.png" alt="" /></p>
<hr />
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>