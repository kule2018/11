<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修封装原生Ajax 和 Axios的 二次封装' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>封装原生Ajax 和 Axios的 二次封装</center></div><div class='banquan'>原文出处:本文由博客园博主G_Owen提供。<br/>
原文连接:https://www.cnblogs.com/gaoguowen/p/10862914.html</div><br>
    <div style="color: #eeffff; background-color: #263238; font-family: Consolas, 'Courier New', monospace; line-height: 19px; white-space: pre;">
<div class="highlight highlight-source-js" style="box-sizing: border-box; margin-bottom: 16px; color: #24292e; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol'; font-size: 16px; white-space: normal; background-color: #ffffff;">
<h2 style="text-align: left;">AJAX</h2>
<div style="text-align: left;">异步的JavaScript与XML技术（ Asynchronous JavaScript and XML ）</div>
<div style="text-align: left;">Ajax 核心使用 `XMLHttpRequest` （XHR）对象,首先由微软引入的一个特性；Ajax 不需要任何浏览器插件，能在不更新整个页面的前提下维护数据（可以向服务器请求额外的数据无需重载页面），但需要用户允许JavaScript在浏览器上执行。</div>
<div style="text-align: left;">&nbsp;</div>
<h3 style="text-align: left;">XHR 对象用法</h3>
<div class="cnblogs_code" style="text-align: left;">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">var</span> xhr = <span style="color: #0000ff;">new</span> XMLRequestHttp() <span style="color: #008000;">//</span><span style="color: #008000;"> 通过XMLHttpRequest 构造函数来创建</span></pre>
</div>
<h4 style="text-align: left;">open 方法</h4>
<div class="cnblogs_code" style="text-align: left;">
<pre><code>xhr.open(method, url, async, user, password);</pre>
</div>
<h5 style="text-align: left;">method：要发送的请求类型 GET、POST、PUT、DELETE 。（必选）</h5>
<h5 style="text-align: left;">url：请求的URL&nbsp;（必选）</h5>
<h5 style="text-align: left;">axync ：布尔值，是否异步发送请求，默认true（true 时，已完成事务的通知可供事件监听使用，如果 xhr.multipart为true,则此参数必须为true；false 时，send()方法直到收到答复前不会返回）</h5>
<h5 style="text-align: left;">user：用户名用于认证用途 默认 null</h5>
<h5 style="text-align: left;">password：用户名用于认证用途 默认 null</h5>
<p style="text-align: left;"><span style="color: #ff0000;">调用open方法不会真正发送请求，只是准备发送请求，并且URL有同源策略的限制（须和页面的主域、端口、协议一致，只要一处不符合要求将报错，数据将被拦截，可通过前后端配置，或使用代理来解决）。</span></p>
<h5 style="text-align: left;"><span style="font-size: 1em;">setRequestHeader()&nbsp;</span></h5>
<p style="text-align: left;">如需设置 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept" target="_blank">Accpet</a> 头部信息，可通过setRequestHeader() 方法来设置</p>
<h5 style="text-align: left;">&nbsp;<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Accept" target="_blank">Accpet</a>&nbsp;头部信息：告知客户端可以处理的内容类型，用&nbsp;<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank">MIME类型</a>&nbsp;表示；使用 <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type" target="_blank">Content-Type</a>&nbsp;&nbsp;服务端使用 `Content-Type` 通知客户端它的选择</h5>
<h5 style="text-align: left;">&nbsp;<strong>媒体类型（&nbsp;</strong><a style="font-size: 0.83em;" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Basics_of_HTTP/MIME_types" target="_blank">MIME类型</a>&nbsp;<strong>）</strong>&nbsp;：一种标准，用来表示文档、文件或字节流的性质和格式。&nbsp;<a href="https://www.iana.org/assignments/media-types/media-types.xhtml" target="_blank">完整类型列表</a>&nbsp;</h5>
<h5 style="text-align: left;"><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/Content-Type" target="_blank">Content-Type</a>&nbsp;：实体头部用于指示资源的 MIME 类型，告诉客户端实际返回的内容类型；浏览器会在某些情况下进行MIME查找，并不一定遵循此标题的值; 为了防止这种行为，可以将标题&nbsp;<a title="X-Content-Type-Options 响应首部相当于一个提示标志，被服务器用来提示客户端一定要遵循在 Content-Type 首部中对&nbsp; MIME 类型&nbsp;的设定，而不能对其进行修改。这就禁用了客户端的 MIME 类型嗅探行为，换句话说，也就是意味着网站管理员确定自己的设置没有问题。" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Headers/X-Content-Type-Options"><code>X-Content-Type-Options</code></a>&nbsp;设置为&nbsp;<strong>nosniff</strong>。</h5>
<div class="cnblogs_code" style="text-align: left;">
<pre><code>  xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');</pre>
</div>
<h4 style="text-align: left;">send 方法</h4>
<div class="cnblogs_code" style="text-align: left;">
<pre><code> xhr.send(data);</pre>
</div>
<h5>data：作为请求主体发送的数据，如果不需要通过请求主体发送数据，则必须传 null&nbsp;</h5>
<p style="text-align: left;">调用 send()发送请求，在收到响应后，响应的数据会自动填充XHR对象的属性</p>
<h4 style="text-align: left;">responseText ：从服务端返回的文本</h4>
<div class="cnblogs_code" style="text-align: left;">
<pre><code><span style="color: #008080;">1</span> xhr.onload = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">if</span> (xhr.readyState ===<span style="color: #000000;"> xhr.DONE) {
</span><span style="color: #008080;">3</span>         <span style="color: #0000ff;">if</span> (xhr.status === 200<span style="color: #000000;">) {</span><span style="color: #008080;">5</span> <span style="color: #000000;">            console.log(xhr.responseText);
</span><span style="color: #008080;">6</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">7</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">8</span> };</pre>
</div>
<h4 style="text-align: left;">responseXML</h4>
<p style="text-align: left;">如果响应的 Content-Type 为 text/html 或 application/xml，将保存包含响应数据的 XML DOM 文档，对于其它类型的数据则为 null, 也可通过<a title="overrideMimeType" href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/overrideMimeType"><code>overrideMimeType()</code></a>&nbsp; 强制 XHR 对象解析为 XML</p>
<div class="cnblogs_code" style="text-align: left;">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> overrideMimeType() 用来强制解析 response 为 XML</span>
<span style="color: #008080;"> 2</span> xhr.overrideMimeType('text/xml'<span style="color: #000000;">);
</span><span style="color: #008080;"> 3</span> 
<span style="color: #008080;"> 4</span> xhr.onload = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;"> 5</span>   <span style="color: #0000ff;">if</span> (xhr.readyState ===<span style="color: #000000;"> xhr.DONE) {
</span><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">if</span> (xhr.status === 200<span style="color: #000000;">) {</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">      console.log(xhr.responseXML);
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">10</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">11</span> };</pre>
</div>
<h4 style="text-align: left;">status</h4>
<p style="text-align: left;">返回响应的HTTP状态码，请求完成前值为0，如果XHR 对象出错 值也是0， 200 表示请求成功，304表示请求的资源并没有修改，可直接使用浏览器种缓存的数据。&nbsp;<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status" target="_blank">其它状态信息</a></p>
<h4 style="text-align: left;">statusText</h4>
<p style="text-align: left;">&nbsp;返回响应的HTTP状态说明，status 值为 200 时&nbsp; statusText为 "OK"</p>
<h4 class="document-actions" style="text-align: left;">readyState</h4>
<p style="text-align: left;">返回一个当前XHR对象所处的活动状态</p>
<table class="standard-table" style="height: 174px; width: 686px;">
<tbody>
<tr><th><span style="font-size: 16px;">值</span></th><th style="width: 100px;" scope="col"><span style="font-size: 16px;">状态</span></th><th><span style="font-size: 16px;">描述</span></th></tr>
<tr>
<td style="text-align: center;"><span style="font-size: 16px;"><code>0</code></span></td>
<td style="width: 100px; text-align: center;" scope="col"><span style="font-size: 16px;"><code>UNSENT</code></span></td>
<td style="text-align: center;"><span style="font-size: 16px;">代理被创建，但尚未调用 open() 方法。</span></td>
</tr>
<tr>
<td style="text-align: center;"><span style="font-size: 16px;"><code>1</code></span></td>
<td style="width: 100px; text-align: center;" scope="col"><span style="font-size: 16px;"><code>OPENED</code></span></td>
<td style="text-align: center;"><span style="font-size: 16px;"><code>open()</code>&nbsp;方法已经被调用。</span></td>
</tr>
<tr>
<td style="text-align: center;"><span style="font-size: 16px;"><code>2</code></span></td>
<td style="width: 100px; text-align: center;" scope="col"><span style="font-size: 16px;"><code>HEADERS_RECEIVED</code></span></td>
<td style="text-align: center;"><span style="font-size: 16px;"><code>send()</code>&nbsp;方法已经被调用，并且头部和状态已经可获得。</span></td>
</tr>
<tr>
<td style="text-align: center;"><span style="font-size: 16px;"><code>3</code></span></td>
<td style="width: 100px; text-align: center;" scope="col"><span style="font-size: 16px;"><code>LOADING</code></span></td>
<td style="text-align: center;"><span style="font-size: 16px;">下载中；响应体部分正在被接收&nbsp;<code>responseText</code>&nbsp;属性已经包含部分数据。</span></td>
</tr>
<tr>
<td style="text-align: center;"><span style="font-size: 16px;"><code>4</code></span></td>
<td style="width: 100px; text-align: center;" scope="col"><span style="font-size: 16px;"><code>DONE</code></span></td>
<td style="text-align: center;"><span style="font-size: 16px;">下载操作已完成。</span></td>
</tr>
</tbody>
</table>
<h3>&nbsp;</h3>
<h4>onreadystatechange</h4>
<p>当 readyState变化时会触发次事件函数，如果使用&nbsp;<a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/abort">abort()</a>&nbsp;取消请求则次事件函数不会被触发</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> xhr.onreadystatechange = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">2</span>   <span style="color: #0000ff;">if</span>(xhr.readyState === XMLHttpRequest.DONE &amp;&amp; xhr.status === 200<span style="color: #000000;">) {
</span><span style="color: #008080;">3</span> <span style="color: #000000;">    console.log(xhr.responseText)
</span><span style="color: #008080;">4</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">5</span> }</pre>
</div>
<p>&nbsp;</p>
<h5><a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" target="_blank">&nbsp;参考资料</a></h5>
<h3>&nbsp;</h3>
<h3>兼容性</h3>
<div>
<p><img src="./images/封装原生Ajax 和 Axios的 二次封装0.png" alt="" /></p>
<p>&nbsp;</p>
</div>
<h3><code style="font-size: 1em;">封装 XMLHttpRequest</code><span style="font-size: 1em;">&nbsp;对象</span></h3>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 创建 构造函数</span>
<span style="color: #008080;"> 2</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> Ajax(obj) {
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">this</span>.url = obj.url ||''<span style="color: #000000;">;
</span><span style="color: #008080;"> 4</span>     <span style="color: #0000ff;">this</span>.type = obj.type || 'get'<span style="color: #000000;">;
</span><span style="color: #008080;"> 5</span>     <span style="color: #0000ff;">this</span>.data = obj.data ||<span style="color: #000000;">{};
</span><span style="color: #008080;"> 6</span>     <span style="color: #0000ff;">this</span>.success = obj.success || <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 7</span>     <span style="color: #0000ff;">this</span>.error = obj.error || <span style="color: #0000ff;">null</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 9</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 原型上创建方法支持 post 和 get</span>
<span style="color: #008080;">10</span> Ajax.prototype.send = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">var</span> self = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
</span><span style="color: #008080;">12</span>     <span style="color: #0000ff;">var</span>  toStr =<span style="color: #000000;"> Object.prototype.toString; 
</span><span style="color: #008080;">13</span>     <span style="color: #0000ff;">if</span> (self.data === <span style="color: #0000ff;">null</span> &amp;&amp; <span style="color: #0000ff;">typeof</span> self.data !== 'object' &amp;&amp; Array.isArray(obj)) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">return</span> (<span style="color: #0000ff;">function</span><span style="color: #000000;">(){
</span><span style="color: #008080;">15</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 实例化 XML对象</span>
<span style="color: #008080;">16</span>             <span style="color: #0000ff;">var</span> xhr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLHttpRequest();
</span><span style="color: #008080;">17</span>             <span style="color: #0000ff;">var</span> data = ''<span style="color: #000000;">;
</span><span style="color: #008080;">18</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 序列化参数</span>
<span style="color: #008080;">19</span>             <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> k <span style="color: #0000ff;">in</span><span style="color: #000000;"> self.data){
</span><span style="color: #008080;">20</span>                     data += k + '=' + self.data[k] + '&amp;'<span style="color: #000000;">;
</span><span style="color: #008080;">21</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">22</span>             data = data.substr(0,data.length - 1<span style="color: #000000;">);
</span><span style="color: #008080;">23</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 接收回调函数             </span>
<span style="color: #008080;">24</span>             xhr.onreadystatechange = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
</span><span style="color: #008080;">25</span>                 <span style="color: #0000ff;">if</span> (xhr.readyState === 4<span style="color: #000000;">){
</span><span style="color: #008080;">26</span>                     <span style="color: #0000ff;">if</span>(xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300 || xhr.status == 304<span style="color: #000000;">) {
</span><span style="color: #008080;">27</span>                         isFunction(self.success)  &amp;&amp;<span style="color: #000000;">  self.success(xhr.responseText)
</span><span style="color: #008080;">28</span>                     }<span style="color: #0000ff;">else</span><span style="color: #000000;">{
</span><span style="color: #008080;">29</span>                         isFunction(self.error)  &amp;&amp;<span style="color: #000000;"> self.error(xhr)
</span><span style="color: #008080;">30</span> <span style="color: #000000;">                    }
</span><span style="color: #008080;">31</span> <span style="color: #000000;">                }
</span><span style="color: #008080;">32</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">33</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 初始化请求</span>
<span style="color: #008080;">34</span>             <span style="color: #0000ff;">if</span>(self.type.toLocaleLowerCase() === 'post'<span style="color: #000000;">){
</span><span style="color: #008080;">35</span>                     xhr.open ('post',self.url,<span style="color: #0000ff;">true</span><span style="color: #000000;">)
</span><span style="color: #008080;">36</span>                     <span style="color: #008000;">//</span><span style="color: #008000;"> 设置请求头</span>
<span style="color: #008080;">37</span>                     xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded'<span style="color: #000000;">);
</span><span style="color: #008080;">38</span>                     <span style="color: #008000;">//</span><span style="color: #008000;">发送请求</span>
<span style="color: #008080;">39</span> <span style="color: #000000;">                    xhr.send(data)
</span><span style="color: #008080;">40</span>                 } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">41</span>                     xhr.open('get', self.url + "?" + data,<span style="color: #0000ff;">true</span><span style="color: #000000;">)
</span><span style="color: #008080;">42</span>                     xhr.send(<span style="color: #0000ff;">null</span><span style="color: #000000;">)
</span><span style="color: #008080;">43</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">44</span> <span style="color: #000000;">    }());
</span><span style="color: #008080;">45</span> <span style="color: #000000;">};
</span><span style="color: #008080;">46</span> 
<span style="color: #008080;">47</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> isFunction(obj){
</span><span style="color: #008080;">48</span>     <span style="color: #0000ff;">return</span> toStr.call(obj) === "[object Function]"
<span style="color: #008080;">49</span> <span style="color: #000000;">}
</span><span style="color: #008080;">50</span> 
<span style="color: #008080;">51</span> <span style="color: #0000ff;">var</span> ajax = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Ajax({
</span><span style="color: #008080;">52</span>      type:'post'<span style="color: #000000;">,
</span><span style="color: #008080;">53</span>      url:"/login"<span style="color: #000000;">,
</span><span style="color: #008080;">54</span> <span style="color: #000000;">     data:{ 
</span><span style="color: #008080;">55</span>          loginname:"admin"<span style="color: #000000;">,
</span><span style="color: #008080;">56</span>          password:"admin" 
<span style="color: #008080;">57</span> <span style="color: #000000;">        },
</span><span style="color: #008080;">58</span>       success:<span style="color: #0000ff;">function</span><span style="color: #000000;">(e){
</span><span style="color: #008080;">59</span> <span style="color: #000000;">            console.log(e)
</span><span style="color: #008080;">60</span> <span style="color: #000000;">            }, 
</span><span style="color: #008080;">61</span>        error:<span style="color: #0000ff;">function</span><span style="color: #000000;">(err){
</span><span style="color: #008080;">62</span> <span style="color: #000000;">              console.log(err)
</span><span style="color: #008080;">63</span> <span style="color: #000000;">              },
</span><span style="color: #008080;">64</span>         }).send();</pre>
</div>
<h3>&nbsp;</h3>
<h4><code>XMLHttpRequest Level 2</code>&nbsp;相比于 老版本的&nbsp;<code>XMLHttpRequest</code>&nbsp;新增以下内容：</h4>
<h5>可以设置 HTTP 请求超时时间</h5>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">var</span> xhr =<span style="color: #000000;"> XMLHttpRequest();
</span><span style="color: #008080;">2</span>  xhr.open('GET'.'url'<span style="color: #000000;">);
</span><span style="color: #008080;">3</span>  <span style="color: #008000;">//</span><span style="color: #008000;"> 超时 2s</span>
<span style="color: #008080;">4</span>  xhr.timeout = 2000<span style="color: #000000;">;
</span><span style="color: #008080;">5</span>  <span style="color: #008000;">//</span><span style="color: #008000;"> 超时处理</span>
<span style="color: #008080;">6</span>  xhr.ontimeout = <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {
</span><span style="color: #008080;">7</span> <span style="color: #000000;">     console.log(e)
</span><span style="color: #008080;">8</span> <span style="color: #000000;"> }
</span><span style="color: #008080;">9</span>  xhr.send(<span style="color: #0000ff;">null</span>)</pre>
</div>
<h5>可以通过&nbsp;<code>FormData</code>&nbsp;发送表单数据</h5>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span>  <span style="color: #008000;">//</span><span style="color: #008000;"> 实例化 FormData</span>
<span style="color: #008080;">2</span>  <span style="color: #0000ff;">var</span> formData = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FormData();
</span><span style="color: #008080;">3</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 添加数据</span>
<span style="color: #008080;">4</span> <span style="color: #000000;">  formData.append(key,value);
</span><span style="color: #008080;">5</span> 
<span style="color: #008080;">6</span>   xhr.open('POST','url'<span style="color: #000000;">);
</span><span style="color: #008080;">7</span>   xhr.send(formData);</pre>
</div>
<h5>可以上传文件</h5>
<ul>
<li><code>FormData</code>&nbsp;除了可以添加字符串数据，也可以添加&nbsp;<code>blob、file</code>&nbsp;类型的数据，因此可以用于上传文件。</li>
<li>在浏览器中，一般是通过文件上传输入框来获取 file 对象，比如：</li>
</ul>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">input </span><span style="color: #ff0000;">type</span><span style="color: #0000ff;">="file"</span><span style="color: #ff0000;"> name</span><span style="color: #0000ff;">='uploadFile' </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">="upload-file"</span> <span style="color: #0000ff;">/&gt;</span>
</pre>
</div>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> document.getElementById('upload-file'<span style="color: #000000;">)
</span><span style="color: #008080;">2</span>         .addEventListener('change', <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">3</span>             
<span style="color: #008080;">4</span>             <span style="color: #0000ff;">var</span> formData = <span style="color: #0000ff;">new</span><span style="color: #000000;"> FormData();
</span><span style="color: #008080;">5</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 获取数据</span>
<span style="color: #008080;">6</span>               formData.append('uploadFile', <span style="color: #0000ff;">this</span>.files[0<span style="color: #000000;">])
</span><span style="color: #008080;">7</span> <span style="color: #000000;">               xhr.send(formData)
</span><span style="color: #008080;">8</span>       })</pre>
</div>
<div>
<div>&nbsp;</div>
</div>
<h5>支持跨域请求</h5>
<ul>
<li>浏览器默认是不允许跨域请求的，有时候又是必要的，在以前通常使用<a href="https://baike.baidu.com/item/JSONP" rel="nofollow"><code>JSONP</code></a>来解决（IE10 以下不支持）</li>
<li>为了标准化跨域请求， W3C提出&nbsp;<a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" rel="nofollow">跨域资源共享</a>（CORS）前端无须修改代码，只需 服务器返回&nbsp;<code>Access-Control-Allow-Origin</code>&nbsp;响应头，指定允许对应的域</li>
<li><code>CORS</code>&nbsp;默认不发送&nbsp;<code>cookie</code>&nbsp;如果需要发送，前端需要设置&nbsp;<code>withCredentials&nbsp;</code>属性，同时服务器需要 返回&nbsp;<code>Access-Control-Allow-Credentials: true</code>,
<div class="cnblogs_code">
<pre><code> xhr.withCredentials = <span style="color: #0000ff;">true</span>;</pre>
</div>
</li>
</ul>
<div>检测XHR是否支持CORS最简单的方式，就是检查是否存在 `withCredentials`，再检测`XDomainRequest` 对象是否存在，即可兼顾所有浏览器</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> let createCORSRequest = (method,url)=&gt;<span style="color: #000000;">{
</span><span style="color: #008080;"> 2</span>     let <span style="color: #0000ff;">var</span> xhr =<span style="color: #000000;"> mew XMLHttpRequest();
</span><span style="color: #008080;"> 3</span>     <span style="color: #0000ff;">if</span> ('withCredentials' <span style="color: #0000ff;">in</span><span style="color: #000000;"> xhr){
</span><span style="color: #008080;"> 4</span>       xhr.open(method,url,<span style="color: #0000ff;">true</span><span style="color: #000000;">);
</span><span style="color: #008080;"> 5</span>     }<span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(<span style="color: #0000ff;">typeof</span> XDomainRequest != 'undefined'<span style="color: #000000;">){
</span><span style="color: #008080;"> 6</span>       xhr = <span style="color: #0000ff;">new</span><span style="color: #000000;"> XDomainRequest();
</span><span style="color: #008080;"> 7</span> <span style="color: #000000;">      xhr.open(method,url);
</span><span style="color: #008080;"> 8</span>     }<span style="color: #0000ff;">else</span><span style="color: #000000;">{
</span><span style="color: #008080;"> 9</span>       xhr = <span style="color: #0000ff;">null</span>
<span style="color: #008080;">10</span> <span style="color: #000000;">    }
</span><span style="color: #008080;">11</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> xhr
</span><span style="color: #008080;">12</span> <span style="color: #000000;">}
</span><span style="color: #008080;">13</span>     let request = createCORSRequest('get','baidu.com'<span style="color: #000000;">)
</span><span style="color: #008080;">14</span>     <span style="color: #0000ff;">if</span><span style="color: #000000;">(request){
</span><span style="color: #008080;">15</span>       request.onload = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
</span><span style="color: #008080;">16</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> request.responseText</span>
<span style="color: #008080;">17</span> <span style="color: #000000;">      }
</span><span style="color: #008080;">18</span> <span style="color: #000000;">      request.send()
</span><span style="color: #008080;">19</span>     }</pre>
</div>
<p>&nbsp;</p>
</div>
<h4>Preflighted Requests：</h4>
<div>- 一个透明服务器验证机制，用于检查服务器是否支持[CORS](http://www.ruanyifeng.com/blog/2016/04/cors.html)</div>
<div>这是一个 OPTIONS 请求，使用了三个请求头</div>
<div>- Access-Control-Request-Method：请求自身使用的方法</div>
<div>- Access-Control-Request-Headers：自定义头部信息，多个头部以逗号分隔</div>
<div>- Origin报头：和简单请求相同，将请求的域发送给服务端，服务端再Access-Control-Allow-Origin 响应头中返回同样的域即可解决跨域问题。</div>
<h5>&nbsp;</h5>
<h4>img src特性：</h4>
<div>- 一个网页可以从任何网页中加载图像，不用担心跨域问题，通过onload 和 onerror 事件处理确定是否接收到响应</div>
<div>- 请求的数据通过查询字符串形式发送，响应可以是任意内容，通常是像素图或204响应。</div>
<div>- 只能发送 get 请求，无法访问服务器的响应文本</div>
<div>&nbsp;</div>
<div>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> let img = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Image();
</span><span style="color: #008080;">2</span> img.onload = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (){
</span><span style="color: #008080;">3</span>   console.log('done'<span style="color: #000000;">)
</span><span style="color: #008080;">4</span> <span style="color: #000000;">}
</span><span style="color: #008080;">5</span> img.src = 'http://www.baidu.com?test=test1'</pre>
</div>
<p>&nbsp;</p>
</div>
<h5>&nbsp;</h5>
<h5>可以获取服务端二进制数据</h5>
<p>1. 使用&nbsp;<code>overrideMimeType</code>&nbsp;方法覆写服务器指定的&nbsp;<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types" rel="nofollow"><code>MIME</code></a>&nbsp;类型，从而改变浏览器解析数据的方式</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 参数 MIME 类型</span>
<span style="color: #008080;">2</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 告诉浏览器，服务器响应的内容是用户自定义的字符集 </span>
<span style="color: #008080;">3</span> xhr.overrideMimeType('text/plain; charset=x-user-defined'<span style="color: #000000;">);
</span><span style="color: #008080;">4</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 浏览器就会将服务器返回的二进制数据当成文本处理，我们需要做进一步的转换才能拿到真实的数据</span>
<span style="color: #008080;">5</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 获取二进制数据的第 i 位的值</span>
<span style="color: #008080;">6</span>   <span style="color: #0000ff;">var</span> <span style="color: #0000ff;">byte</span> = xhr.responseText.charCodeAt(i) &amp; 0xff</pre>
</div>
<p>&nbsp;</p>
<p>&nbsp; "&amp; 0xff" 运算 参考&nbsp;<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html" rel="nofollow">阮一峰的文章<br /><br /></a></p>
<p>2.xhr.responseType 用于设置服务器返回的数据的类型,将<code>返回类型设置为 blob 或者 arraybuffer</code>，然后就可以从&nbsp;<code>xhr.response</code>&nbsp;属性获取到对应类型的服务器返回数据。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span>   xhr.responseType = 'arraybuffer'
<span style="color: #008080;">2</span>   xhr.onload = <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">3</span>   <span style="color: #0000ff;">var</span> arrayBuffer =<span style="color: #000000;"> xhr.response
</span><span style="color: #008080;">4</span>   <span style="color: #008000;">//</span><span style="color: #008000;"> 接下来对 arrayBuffer 做进一步处理...</span>
<span style="color: #008080;">5</span>   }</pre>
</div>
<p>&nbsp;</p>
<h5>可以获取数据传输进度信息&nbsp;<a href="https://dev.opera.com/articles/xhr2/" rel="nofollow">参考资料</a></h5>
<p>使用 onload 监听了一个数据传输完成的事件。</p>
<div class="highlight highlight-source-js">&nbsp;
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 上传进度监听</span>
<span style="color: #008080;">2</span> xhr.upload.addEventListener('progress', onProgressHandler, <span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">3</span> 
<span style="color: #008080;">4</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 传输成功完成</span>
<span style="color: #008080;">5</span> xhr.upload.addEventListener('load', onLoadHandler, <span style="color: #0000ff;">false</span><span style="color: #000000;">);
</span><span style="color: #008080;">6</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 传输失败信息</span>
<span style="color: #008080;">7</span> xhr.upload.addEventListener('error', onErrorHandler, <span style="color: #0000ff;">false</span>);</pre>
</div>
<p>更多资料参考:&nbsp;<a href="http://www.ruanyifeng.com/blog/2012/09/xmlhttprequest_level_2.html" rel="nofollow">阮一峰的文章</a>&nbsp;<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest" rel="nofollow">MDN</a></p>
<h2>&nbsp;</h2>
<p>&nbsp;</p>
<h2>AXIOS</h2>
</div>
</div>
</div>
<ul>
<li>基于&nbsp;<a href="https://owen027.github.io/2019/03/14/promise/" rel="nofollow">Promise</a>&nbsp;的 Http 库</li>
<li>可以在客户端 和 nodeJs中使用</li>
<li>在客户端创基 XMLHttpRequests</li>
<li>在nodeJs 创建&nbsp;<a href="https://nodejs.org/api/http.html" rel="nofollow">HTTP</a>&nbsp;请求</li>
<li>支持<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank">Promise</a></li>
<li>可拦截转化请求和响应数据</li>
<li>取消请求</li>
<li>自动转化JSON数据</li>
<li>支持客户端&nbsp;<a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery" rel="nofollow">XSRF</a></li>
</ul>
<h3>&nbsp;兼容性</h3>
<p><img src="./images/封装原生Ajax 和 Axios的 二次封装1.png" alt="" /></p>
<p>&nbsp;</p>
<h3>安装</h3>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> npm <span style="color: #0000ff;">install</span> axios</pre>
</div>
<h3>methods</h3>
<h4>Get</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> const axios = require('axios'<span style="color: #000000;">)
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> axios.get('url?id=xxx'<span style="color: #000000;">)
</span><span style="color: #008080;"> 4</span>      .then(res =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 5</span> <span style="color: #000000;">       console.log(res)
</span><span style="color: #008080;"> 6</span> <span style="color: #000000;">     })
</span><span style="color: #008080;"> 7</span>      .<span style="color: #0000ff;">catch</span>(err =&gt;<span style="color: #000000;">{
</span><span style="color: #008080;"> 8</span> <span style="color: #000000;">       console.log(err)
</span><span style="color: #008080;"> 9</span> <span style="color: #000000;">     })
</span><span style="color: #008080;">10</span> <span style="color: #008000;">//</span><span style="color: #008000;">or</span>
<span style="color: #008080;">11</span> axios.get('url'<span style="color: #000000;">,{
</span><span style="color: #008080;">12</span> <span style="color: #000000;">  params:{
</span><span style="color: #008080;">13</span>     id:'xxxxx'
<span style="color: #008080;">14</span> <span style="color: #000000;">  }
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">16</span>    .then(res =&gt;<span style="color: #000000;">{
</span><span style="color: #008080;">17</span> <span style="color: #000000;">     console.log(res)
</span><span style="color: #008080;">18</span> <span style="color: #000000;">   })
</span><span style="color: #008080;">19</span>    .<span style="color: #0000ff;">catch</span>(err =&gt;<span style="color: #000000;">{
</span><span style="color: #008080;">20</span> <span style="color: #000000;">       console.log(err)
</span><span style="color: #008080;">21</span>      })</pre>
</div>
<p>同样的传参方法有 delete</p>
<h4>post</h4>
<div class="cnblogs_code">
<pre><code>axios.post('url',{name:'Owen'<span style="color: #000000;">})
     .then(res </span>=&gt;<span style="color: #000000;">{
       console.log(res)
     })
     .</span><span style="color: #0000ff;">catch</span>(err =&gt;<span style="color: #000000;">{
       console.log(err)
     })</span></pre>
</div>
<p>同样的传参方法有 put patch</p>
<p>&nbsp;</p>
<h4>concurrent requests</h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> axios.all([axios.get('url1'),axios.get('url2')])</pre>
</div>
<h4>API</h4>
<h4><code>axios(config)</code></h4>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">  1</span> <span style="color: #000000;">axios({
</span><span style="color: #008080;">  2</span>   method:'get', <span style="color: #008000;">//</span><span style="color: #008000;"> default is get </span>
<span style="color: #008080;">  3</span>   url:'url', <span style="color: #008000;">//</span><span style="color: #008000;"> request  url</span>
<span style="color: #008080;">  4</span>   data:{ <span style="color: #008000;">//</span><span style="color: #008000;"> 仅支持post，put和patch方法，数据作为请求主体发送 ( Only the post,put and patch methods are supported, and the data is sent as the request body )</span>
<span style="color: #008080;">  5</span>   <span style="color: #008000;">/*</span><span style="color: #008000;"> 浏览器仅支持传递 FormData, File, Blob （The browser only supports passing FormData, File and Blob)
</span><span style="color: #008080;">  6</span> <span style="color: #008000;">     Node 仅支持传递 Stream, Buffer (The Node only supports passing Stream, Buffer)
</span><span style="color: #008080;">  7</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">  8</span>     name:'owen'
<span style="color: #008080;">  9</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 10</span>   baseURL:'base/url', <span style="color: #008000;">//</span><span style="color: #008000;"> 除非url是绝对路径，否则将baseURL添加到url的前面 (Add baseURL to then front of the url unless the url is an absolute path)</span>
<span style="color: #008080;"> 11</span>   transformRequest: [<span style="color: #0000ff;">function</span><span style="color: #000000;"> (data, headers) {
</span><span style="color: #008080;"> 12</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 可以修改发送的请求数据和请求头，只支持put，post和patch，回调函数必须返回Buffer，ArrayBuffer，FormData或Stream数据</span>
<span style="color: #008080;"> 13</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> Can modify the sent request data and request header,only support put, post and patch.</span>
<span style="color: #008080;"> 14</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> Callback must return Buffer, ArrayBuffer, FormData or Stream data</span>
<span style="color: #008080;"> 15</span>     
<span style="color: #008080;"> 16</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> Do whatever you want to transform the data</span>
<span style="color: #008080;"> 17</span> 
<span style="color: #008080;"> 18</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> data;
</span><span style="color: #008080;"> 19</span> <span style="color: #000000;">  }],
</span><span style="color: #008080;"> 20</span>   transformResponse: [<span style="color: #0000ff;">function</span><span style="color: #000000;"> (data) {
</span><span style="color: #008080;"> 21</span>      <span style="color: #008000;">//</span><span style="color: #008000;"> 修改响应数据，再传递给 then或catch 方法 （Modify the response data and pass it to the then or catch method)</span>
<span style="color: #008080;"> 22</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> Do whatever you want to transform the data</span>
<span style="color: #008080;"> 23</span> 
<span style="color: #008080;"> 24</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> data;
</span><span style="color: #008080;"> 25</span> <span style="color: #000000;">  }],
</span><span style="color: #008080;"> 26</span>   headers: {'X-Requested-With': 'XMLHttpRequest'}, <span style="color: #008000;">//</span><span style="color: #008000;"> 自定义请求头 (Custom request header)</span>
<span style="color: #008080;"> 27</span>   params:{ <span style="color: #008000;">//</span><span style="color: #008000;"> 添加到url尾部的参数，一般用于get 和 delete（ Parameters addde to the end of the url,generally used for get and delete )</span>
<span style="color: #008080;"> 28</span>     id:'xxx'
<span style="color: #008080;"> 29</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 30</span>    paramsSerializer: <span style="color: #0000ff;">function</span> (params) { <span style="color: #008000;">//</span><span style="color: #008000;">序列化 [params] (https://www.npmjs.com/package/qs)</span>
<span style="color: #008080;"> 31</span>     <span style="color: #0000ff;">return</span> Qs.stringify(params, {arrayFormat: 'brackets'<span style="color: #000000;">})
</span><span style="color: #008080;"> 32</span> <span style="color: #000000;">  },
</span><span style="color: #008080;"> 33</span>   timeout:1000,<span style="color: #008000;">//</span><span style="color: #008000;"> default is 0 , 设置请求超时时间，单位毫秒 （ Set request timeout in milliseconds )</span>
<span style="color: #008080;"> 34</span>   withCredentials: <span style="color: #0000ff;">true</span>, <span style="color: #008000;">//</span><span style="color: #008000;"> default is false, 跨域时是否携带cookie（ Whether to carry cookies when crossing domains )</span>
<span style="color: #008080;"> 35</span>   adapter: <span style="color: #0000ff;">function</span><span style="color: #000000;"> (config) {
</span><span style="color: #008080;"> 36</span>     <span style="color: #008000;">/*</span><span style="color: #008000;">拦截响应数据</span><span style="color: #008000;">*/</span>
<span style="color: #008080;"> 37</span>       <span style="color: #008000;">//</span><span style="color: #008000;"> At this point:</span>
<span style="color: #008080;"> 38</span>     <span style="color: #008000;">//</span><span style="color: #008000;">  - config has been merged with defaults</span>
<span style="color: #008080;"> 39</span>     <span style="color: #008000;">//</span><span style="color: #008000;">  - request transformers have already run</span>
<span style="color: #008080;"> 40</span>     <span style="color: #008000;">//</span><span style="color: #008000;">  - request interceptors have already run</span>
<span style="color: #008080;"> 41</span>     
<span style="color: #008080;"> 42</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> Make the request using config provided</span>
<span style="color: #008080;"> 43</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> Upon response settle the Promise</span>
<span style="color: #008080;"> 44</span>       <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> Promise(<span style="color: #0000ff;">function</span><span style="color: #000000;">(resolve, reject) {
</span><span style="color: #008080;"> 45</span>   
<span style="color: #008080;"> 46</span>     <span style="color: #0000ff;">var</span> response =<span style="color: #000000;"> {
</span><span style="color: #008080;"> 47</span> <span style="color: #000000;">      data: responseData,
</span><span style="color: #008080;"> 48</span> <span style="color: #000000;">      status: request.status,
</span><span style="color: #008080;"> 49</span> <span style="color: #000000;">      statusText: request.statusText,
</span><span style="color: #008080;"> 50</span> <span style="color: #000000;">      headers: responseHeaders,
</span><span style="color: #008080;"> 51</span> <span style="color: #000000;">      config: config,
</span><span style="color: #008080;"> 52</span> <span style="color: #000000;">      request: request
</span><span style="color: #008080;"> 53</span> <span style="color: #000000;">    };
</span><span style="color: #008080;"> 54</span> 
<span style="color: #008080;"> 55</span> <span style="color: #000000;">    settle(resolve, reject, response);
</span><span style="color: #008080;"> 56</span> 
<span style="color: #008080;"> 57</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> From here:</span>
<span style="color: #008080;"> 58</span>     <span style="color: #008000;">//</span><span style="color: #008000;">  - response transformers will run</span>
<span style="color: #008080;"> 59</span>     <span style="color: #008000;">//</span><span style="color: #008000;">  - response interceptors will run</span>
<span style="color: #008080;"> 60</span> 
<span style="color: #008080;"> 61</span>       <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 62</span> <span style="color: #008000;">       * Resolve or reject a Promise based on response status.
</span><span style="color: #008080;"> 63</span> <span style="color: #008000;">       *
</span><span style="color: #008080;"> 64</span> <span style="color: #008000;">       * @param {Function} resolve A function that resolves the promise.
</span><span style="color: #008080;"> 65</span> <span style="color: #008000;">       * @param {Function} reject A function that rejects the promise.
</span><span style="color: #008080;"> 66</span> <span style="color: #008000;">       * @param {object} response The response.
</span><span style="color: #008080;"> 67</span>        <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 68</span>         <span style="color: #0000ff;">function</span><span style="color: #000000;"> settle(resolve, reject, response) {
</span><span style="color: #008080;"> 69</span>             <span style="color: #0000ff;">var</span> validateStatus =<span style="color: #000000;"> response.config.validateStatus;
</span><span style="color: #008080;"> 70</span>             <span style="color: #0000ff;">if</span> (!validateStatus ||<span style="color: #000000;"> validateStatus(response.status)) {
</span><span style="color: #008080;"> 71</span> <span style="color: #000000;">              resolve(response);
</span><span style="color: #008080;"> 72</span>             } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;"> 73</span> <span style="color: #000000;">              reject(createError(
</span><span style="color: #008080;"> 74</span>                 'Request failed with status code ' +<span style="color: #000000;"> response.status,
</span><span style="color: #008080;"> 75</span> <span style="color: #000000;">                response.config,
</span><span style="color: #008080;"> 76</span>                 <span style="color: #0000ff;">null</span><span style="color: #000000;">,
</span><span style="color: #008080;"> 77</span> <span style="color: #000000;">                response.request,
</span><span style="color: #008080;"> 78</span> <span style="color: #000000;">                response
</span><span style="color: #008080;"> 79</span> <span style="color: #000000;">              ));
</span><span style="color: #008080;"> 80</span> <span style="color: #000000;">            }
</span><span style="color: #008080;"> 81</span> <span style="color: #000000;">          };
</span><span style="color: #008080;"> 82</span>         <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 83</span> <span style="color: #008000;">         * Create an Error with the specified message, config, error code, request and response.
</span><span style="color: #008080;"> 84</span> <span style="color: #008000;">         *
</span><span style="color: #008080;"> 85</span> <span style="color: #008000;">         * @param {string} message The error message.
</span><span style="color: #008080;"> 86</span> <span style="color: #008000;">         * @param {Object} config The config.
</span><span style="color: #008080;"> 87</span> <span style="color: #008000;">         * @param {string} [code] The error code (for example, 'ECONNABORTED').
</span><span style="color: #008080;"> 88</span> <span style="color: #008000;">         * @param {Object} [request] The request.
</span><span style="color: #008080;"> 89</span> <span style="color: #008000;">         * @param {Object} [response] The response.
</span><span style="color: #008080;"> 90</span> <span style="color: #008000;">         * @returns {Error} The created error.
</span><span style="color: #008080;"> 91</span>          <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 92</span>         <span style="color: #0000ff;">function</span><span style="color: #000000;"> createError(message, config, code, request, response) {
</span><span style="color: #008080;"> 93</span>           <span style="color: #0000ff;">var</span> error = <span style="color: #0000ff;">new</span><span style="color: #000000;"> Error(message);
</span><span style="color: #008080;"> 94</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> enhanceError(error, config, code, request, response);
</span><span style="color: #008080;"> 95</span> <span style="color: #000000;">          }
</span><span style="color: #008080;"> 96</span> 
<span style="color: #008080;"> 97</span>         <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 98</span> <span style="color: #008000;">         * Update an Error with the specified config, error code, and response.
</span><span style="color: #008080;"> 99</span> <span style="color: #008000;">         *
</span><span style="color: #008080;">100</span> <span style="color: #008000;">         * @param {Error} error The error to update.
</span><span style="color: #008080;">101</span> <span style="color: #008000;">         * @param {Object} config The config.
</span><span style="color: #008080;">102</span> <span style="color: #008000;">         * @param {string} [code] The error code (for example, 'ECONNABORTED').
</span><span style="color: #008080;">103</span> <span style="color: #008000;">         * @param {Object} [request] The request.
</span><span style="color: #008080;">104</span> <span style="color: #008000;">         * @param {Object} [response] The response.
</span><span style="color: #008080;">105</span> <span style="color: #008000;">         * @returns {Error} The error.
</span><span style="color: #008080;">106</span>          <span style="color: #008000;">*/</span>
<span style="color: #008080;">107</span>         <span style="color: #0000ff;">function</span><span style="color: #000000;"> enhanceError(error, config, code, request, response) {
</span><span style="color: #008080;">108</span>             error.config =<span style="color: #000000;"> config;
</span><span style="color: #008080;">109</span>             <span style="color: #0000ff;">if</span><span style="color: #000000;"> (code) {
</span><span style="color: #008080;">110</span>               error.code =<span style="color: #000000;"> code;
</span><span style="color: #008080;">111</span> <span style="color: #000000;">            }
</span><span style="color: #008080;">112</span> 
<span style="color: #008080;">113</span>             error.request =<span style="color: #000000;"> request;
</span><span style="color: #008080;">114</span>             error.response =<span style="color: #000000;"> response;
</span><span style="color: #008080;">115</span>             error.isAxiosError = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
</span><span style="color: #008080;">116</span> 
<span style="color: #008080;">117</span>             error.toJSON = <span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #008080;">118</span>               <span style="color: #0000ff;">return</span><span style="color: #000000;"> {
</span><span style="color: #008080;">119</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> Standard</span>
<span style="color: #008080;">120</span>                 message: <span style="color: #0000ff;">this</span><span style="color: #000000;">.message,
</span><span style="color: #008080;">121</span>                 name: <span style="color: #0000ff;">this</span><span style="color: #000000;">.name,
</span><span style="color: #008080;">122</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> Microsoft</span>
<span style="color: #008080;">123</span>                 description: <span style="color: #0000ff;">this</span><span style="color: #000000;">.description,
</span><span style="color: #008080;">124</span>                 number: <span style="color: #0000ff;">this</span><span style="color: #000000;">.number,
</span><span style="color: #008080;">125</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> Mozilla</span>
<span style="color: #008080;">126</span>                 fileName: <span style="color: #0000ff;">this</span><span style="color: #000000;">.fileName,
</span><span style="color: #008080;">127</span>                 lineNumber: <span style="color: #0000ff;">this</span><span style="color: #000000;">.lineNumber,
</span><span style="color: #008080;">128</span>                 columnNumber: <span style="color: #0000ff;">this</span><span style="color: #000000;">.columnNumber,
</span><span style="color: #008080;">129</span>                 stack: <span style="color: #0000ff;">this</span><span style="color: #000000;">.stack,
</span><span style="color: #008080;">130</span>                 <span style="color: #008000;">//</span><span style="color: #008000;"> Axios</span>
<span style="color: #008080;">131</span>                 config: <span style="color: #0000ff;">this</span><span style="color: #000000;">.config,
</span><span style="color: #008080;">132</span>                 code: <span style="color: #0000ff;">this</span><span style="color: #000000;">.code
</span><span style="color: #008080;">133</span> <span style="color: #000000;">              };
</span><span style="color: #008080;">134</span> <span style="color: #000000;">            };
</span><span style="color: #008080;">135</span>           <span style="color: #0000ff;">return</span><span style="color: #000000;"> error;
</span><span style="color: #008080;">136</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">137</span> <span style="color: #000000;">    });
</span><span style="color: #008080;">138</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">139</span>   auth:{ <span style="color: #008000;">//</span><span style="color: #008000;">  表示应使用HTTP Basic身份验证，并提供凭据 ( indicates that HTTP Basic auth should be used, and supplies credentials. )</span>
<span style="color: #008080;">140</span>     user:'xxx'<span style="color: #000000;">,
</span><span style="color: #008080;">141</span>     password:'***'
<span style="color: #008080;">142</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">143</span>   responseType: 'json',<span style="color: #008000;">/*</span><span style="color: #008000;"> 服务器响应的数据类型（ The server response data type ） 
</span><span style="color: #008080;">144</span> <span style="color: #008000;">                         支持 arraybuffer, blob, document, json, text, stream 
</span><span style="color: #008080;">145</span>                         <span style="color: #008000;">*/</span>
<span style="color: #008080;">146</span>   responseEncoding:'utf8', <span style="color: #008000;">//</span><span style="color: #008000;"> 用于解码响应的编码 (Encoding for decoding the response )</span>
<span style="color: #008080;">147</span>   xsrfCookieName: 'XSRF-TOKEN', <span style="color: #008000;">//</span><span style="color: #008000;"> default is XSRF-TOKEN , csrf令牌Cookie 名称</span>
<span style="color: #008080;">148</span>   xsrfHeaderName: 'X-XSRF-TOKEN', <span style="color: #008000;">//</span><span style="color: #008000;">default is X-XSRF-TOKEN, xsrf标记值的http标头的名称</span>
<span style="color: #008080;">149</span> onUploadProgress: <span style="color: #0000ff;">function</span> (progressEvent) { <span style="color: #008000;">//</span><span style="color: #008000;">上传进度事件 （handling of progress events for uploads ）</span>
<span style="color: #008080;">150</span> <span style="color: #000000;">    console.log(progressEvent)
</span><span style="color: #008080;">151</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">152</span> onDownloadProgress: <span style="color: #0000ff;">function</span> (progressEvent) { <span style="color: #008000;">//</span><span style="color: #008000;"> 下载进度事件 （ handling of progress events for downloads）</span>
<span style="color: #008080;">153</span> <span style="color: #000000;">   console.log(progressEvent)
</span><span style="color: #008080;">154</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">155</span> maxContentLength: 2000, <span style="color: #008000;">//</span><span style="color: #008000;"> 允许响应内容的最大字节 （defines the max size of the http response content in bytes allowed）</span>
<span style="color: #008080;">156</span> validateStatus: <span style="color: #0000ff;">function</span> (status) { <span style="color: #008000;">//</span><span style="color: #008000;"> 返回给定HTTP状态范围, 如果状态在给定范围内，响应数据传给`then` ，否则传给 `catch` ( Returns the given HTTP status range, if the status is within the give range, the respones data is passed to `then`, otherwise passed to `catch` ) </span>
<span style="color: #008080;">157</span>     <span style="color: #0000ff;">return</span> status &gt;= 200 &amp;&amp; status &lt; 300; <span style="color: #008000;">//</span><span style="color: #008000;"> default</span>
<span style="color: #008080;">158</span> <span style="color: #000000;">  },
</span><span style="color: #008080;">159</span>   maxRedirects: 5, <span style="color: #008000;">//</span><span style="color: #008000;"> default is 5  // 定义Node 中最大重定向数  ( defines the maximunn number of redirects in Node )</span>
<span style="color: #008080;">160</span>   socketPath: <span style="color: #0000ff;">null</span>, <span style="color: #008000;">//</span><span style="color: #008000;">  default is null 定义要在node.js中使用的 UNIX socket</span>
<span style="color: #008080;">161</span>   httpAgent: <span style="color: #0000ff;">new</span> http.Agent({ keepAlive: <span style="color: #0000ff;">true</span> }), <span style="color: #008000;">//</span><span style="color: #008000;"> node 中 http 和 https 的代理</span>
<span style="color: #008080;">162</span>   httpsAgent: <span style="color: #0000ff;">new</span> https.Agent({ keepAlive: <span style="color: #0000ff;">true</span> }),<span style="color: #008000;">//</span><span style="color: #008000;"> http://nodejs.cn/api/http.html</span>
<span style="color: #008080;">163</span>   proxy: { <span style="color: #008000;">//</span><span style="color: #008000;"> 代理配置</span>
<span style="color: #008080;">164</span>     host: '127.0.0.1'<span style="color: #000000;">,
</span><span style="color: #008080;">165</span>     port: 9000<span style="color: #000000;">,
</span><span style="color: #008080;">166</span> <span style="color: #000000;">    auth: {
</span><span style="color: #008080;">167</span>       username: 'mikeymike'<span style="color: #000000;">,
</span><span style="color: #008080;">168</span>       password: 'rapunz3l'
<span style="color: #008080;">169</span> <span style="color: #000000;">          }
</span><span style="color: #008080;">170</span> <span style="color: #000000;">   },
</span><span style="color: #008080;">171</span>     cancelToken: <span style="color: #0000ff;">new</span> CancelToken(<span style="color: #0000ff;">function</span> (cancel) { <span style="color: #008000;">//</span><span style="color: #008000;"> 取消请求的 token</span>
<span style="color: #008080;">172</span> <span style="color: #000000;">  })
</span><span style="color: #008080;">173</span> <span style="color: #000000;">  })  
</span><span style="color: #008080;">174</span>   .then(res =&gt;<span style="color: #000000;">{
</span><span style="color: #008080;">175</span> <span style="color: #000000;">       console.log(res)
</span><span style="color: #008080;">176</span> <span style="color: #000000;">     })
</span><span style="color: #008080;">177</span>   .<span style="color: #0000ff;">catch</span>(err =&gt;<span style="color: #000000;">{
</span><span style="color: #008080;">178</span> <span style="color: #000000;">       console.log(err)
</span><span style="color: #008080;">179</span>      })</pre>
</div>
<h4>全局配置</h4>
<p>通过&nbsp;<code>axios.create</code>&nbsp;方法来替换全局配置</p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code>const instance =<span style="color: #000000;"> axios.create({
  baseURL: </span>'base/url'<span style="color: #000000;">
});</span></pre>
</div>
<p>&nbsp;</p>
<p>通过<code>axios.defaults</code>&nbsp;对象替换全局默认配置</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> instance.defaults.headers.common['Authorization'] =<span style="color: #000000;"> AUTH_TOKEN;
</span><span style="color: #008080;">2</span> instance.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';</pre>
</div>
<h4>拦截器</h4>
<p>&nbsp;</p>
<p>拦截请求数据</p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> axios.interceptors.request.use(<span style="color: #0000ff;">function</span><span style="color: #000000;"> (config) {
</span><span style="color: #008080;">2</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> config;
</span><span style="color: #008080;">3</span>   }, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (error) {
</span><span style="color: #008080;">4</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> Promise.reject(error);
</span><span style="color: #008080;">5</span>   });</pre>
</div>
<p>&nbsp;</p>
<p>拦截响应数据</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> axios.interceptors.response.use(<span style="color: #0000ff;">function</span><span style="color: #000000;"> (response) {
</span><span style="color: #008080;">2</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> Do something with response data</span>
<span style="color: #008080;">3</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> response;
</span><span style="color: #008080;">4</span>   }, <span style="color: #0000ff;">function</span><span style="color: #000000;"> (error) {
</span><span style="color: #008080;">5</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> Do something with response error</span>
<span style="color: #008080;">6</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> Promise.reject(error);
</span><span style="color: #008080;">7</span>   });</pre>
</div>
<p>删除拦截器</p>
<p>&nbsp;</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span> const myInterceptor = axios.interceptors.request.use(<span style="color: #0000ff;">function</span> () {<span style="color: #008000;">/*</span><span style="color: #008000;">...</span><span style="color: #008000;">*/</span><span style="color: #000000;">});
</span><span style="color: #008080;">2</span> axios.interceptors.request.eject(myInterceptor);</pre>
</div>
<p><a href="https://github.com/axios/axios" target="_blank">查阅更多信息</a></p>
<h2>Axios 二次封装</h2>
<p>-&nbsp; <strong>核心文件</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">  1</span> <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;">  2</span> <span style="color: #008000;">  * @desc: axios封装
</span><span style="color: #008080;">  3</span> <span style="color: #008000;">  * @author: ggw 
</span><span style="color: #008080;">  4</span> <span style="color: #008000;">  * @module: axios
</span><span style="color: #008080;">  5</span> <span style="color: #008000;">  * @description: 配合使用 饿了么的 Message和Loading
</span><span style="color: #008080;">  6</span> <span style="color: #008000;">  * 
</span><span style="color: #008080;">  7</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;">  8</span>  import axios from 'axios'<span style="color: #000000;">;
</span><span style="color: #008080;">  9</span>  import qs from 'qs'<span style="color: #000000;">;
</span><span style="color: #008080;"> 10</span> <span style="color: #000000;"> import {
</span><span style="color: #008080;"> 11</span> <span style="color: #000000;">     Message,
</span><span style="color: #008080;"> 12</span> <span style="color: #000000;">     Loading
</span><span style="color: #008080;"> 13</span>  } from 'element-ui'<span style="color: #000000;">;
</span><span style="color: #008080;"> 14</span>  
<span style="color: #008080;"> 15</span>  import router from '../router'<span style="color: #000000;">; 
</span><span style="color: #008080;"> 16</span> <span style="color: #000000;"> let loading;
</span><span style="color: #008080;"> 17</span>  let headerNone =<span style="color: #000000;"> {
</span><span style="color: #008080;"> 18</span>      'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8'
<span style="color: #008080;"> 19</span> <span style="color: #000000;"> };
</span><span style="color: #008080;"> 20</span>  let headerTwo =<span style="color: #000000;"> {
</span><span style="color: #008080;"> 21</span>      'Content-Type': 'application/json; charset=UTF-8'
<span style="color: #008080;"> 22</span> <span style="color: #000000;"> };
</span><span style="color: #008080;"> 23</span>  let baseURL =<span style="color: #000000;"> window.location.origin ;
</span><span style="color: #008080;"> 24</span> 
<span style="color: #008080;"> 25</span> 
<span style="color: #008080;"> 26</span>  <span style="color: #008000;">/*</span><span style="color: #008000;">* 
</span><span style="color: #008080;"> 27</span> <span style="color: #008000;">  * @description: 定义初始化Loading
</span><span style="color: #008080;"> 28</span> <span style="color: #008000;">  * @method: startLoading 
</span><span style="color: #008080;"> 29</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 30</span>   const startLoading = () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 31</span>      loading =<span style="color: #000000;"> Loading.service({
</span><span style="color: #008080;"> 32</span>          target: '.content-box'<span style="color: #000000;">,
</span><span style="color: #008080;"> 33</span>          background: 'rgba(220, 220, 220, 0.51)'
<span style="color: #008080;"> 34</span> <span style="color: #000000;">     });
</span><span style="color: #008080;"> 35</span> <span style="color: #000000;"> };
</span><span style="color: #008080;"> 36</span>  
<span style="color: #008080;"> 37</span> 
<span style="color: #008080;"> 38</span>  let count = 0<span style="color: #000000;">;
</span><span style="color: #008080;"> 39</span>  <span style="color: #008000;">/*</span><span style="color: #008000;">* 
</span><span style="color: #008080;"> 40</span> <span style="color: #008000;">  * @description: 显示Loading 同时多个发送请求 只开启一次Loading
</span><span style="color: #008080;"> 41</span> <span style="color: #008000;">  * @method: showLoading  &amp;&amp; hideLoading
</span><span style="color: #008080;"> 42</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 43</span>   const showLoading = () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 44</span>      <span style="color: #0000ff;">if</span> (count === 0<span style="color: #000000;">) startLoading();
</span><span style="color: #008080;"> 45</span>      count++<span style="color: #000000;">;
</span><span style="color: #008080;"> 46</span> <span style="color: #000000;"> };
</span><span style="color: #008080;"> 47</span>   const hideLoading = () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 48</span>      <span style="color: #0000ff;">if</span> (count &lt;= 0) <span style="color: #0000ff;">return</span><span style="color: #000000;">;
</span><span style="color: #008080;"> 49</span>      count--<span style="color: #000000;">;
</span><span style="color: #008080;"> 50</span>      <span style="color: #0000ff;">if</span> (count === 0<span style="color: #000000;">) {
</span><span style="color: #008080;"> 51</span>          setTimeout(() =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 52</span> <span style="color: #000000;">            loading.close();
</span><span style="color: #008080;"> 53</span>          }, 300<span style="color: #000000;">);
</span><span style="color: #008080;"> 54</span> <span style="color: #000000;">     }
</span><span style="color: #008080;"> 55</span> <span style="color: #000000;"> };
</span><span style="color: #008080;"> 56</span> 
<span style="color: #008080;"> 57</span>  export let filiter = r =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 58</span> 
<span style="color: #008080;"> 59</span>      <span style="color: #0000ff;">for</span><span style="color: #000000;"> (let item of Object.keys(r)) {
</span><span style="color: #008080;"> 60</span>          <span style="color: #0000ff;">if</span> (r[item] === ' ' || r[item] === ''<span style="color: #000000;">) {
</span><span style="color: #008080;"> 61</span>              <span style="color: #0000ff;">delete</span><span style="color: #000000;"> r[item];
</span><span style="color: #008080;"> 62</span> <span style="color: #000000;">         }
</span><span style="color: #008080;"> 63</span> <span style="color: #000000;">     }
</span><span style="color: #008080;"> 64</span> <span style="color: #000000;"> };
</span><span style="color: #008080;"> 65</span>  <span style="color: #008000;">/*</span><span style="color: #008000;">* 
</span><span style="color: #008080;"> 66</span> <span style="color: #008000;">  * @description: 出口
</span><span style="color: #008080;"> 67</span> <span style="color: #008000;">  * @exports api
</span><span style="color: #008080;"> 68</span> <span style="color: #008000;">  * @param:options 必须是对象
</span><span style="color: #008080;"> 69</span> <span style="color: #008000;">  * options 对象为 axios对应参数
</span><span style="color: #008080;"> 70</span>   <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 71</span>  export <span style="color: #0000ff;">default</span> (options) =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 72</span>      <span style="color: #008000;">/*</span><span style="color: #008000;">* 
</span><span style="color: #008080;"> 73</span> <span style="color: #008000;">      * @description: 用来初始化承诺的回调。
</span><span style="color: #008080;"> 74</span> <span style="color: #008000;">      * 这个回调被传递了两个参数：
</span><span style="color: #008080;"> 75</span> <span style="color: #008000;">      * 一个解析回调用一个值或另一个承诺的结果来解析承诺，
</span><span style="color: #008080;"> 76</span> <span style="color: #008000;">      * 以及一个拒绝回调，用来拒绝承诺的原因或错误。
</span><span style="color: #008080;"> 77</span> <span style="color: #008000;">      * @constructor: Promise
</span><span style="color: #008080;"> 78</span>       <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 79</span>      <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> Promise((resolve, reject) =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 80</span>          const instance =<span style="color: #000000;"> axios.create({
</span><span style="color: #008080;"> 81</span>              withCredentials: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;"> 82</span> <span style="color: #000000;">             headers: headerNone,
</span><span style="color: #008080;"> 83</span> <span style="color: #000000;">             baseURL
</span><span style="color: #008080;"> 84</span> <span style="color: #000000;">         });
</span><span style="color: #008080;"> 85</span>          <span style="color: #008000;">//</span><span style="color: #008000;"> 请求拦截器</span>
<span style="color: #008080;"> 86</span>          instance.interceptors.request.use(config =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 87</span>               let {load = <span style="color: #0000ff;">true</span>} = config.data || config.params ||<span style="color: #000000;"> {} ;
</span><span style="color: #008080;"> 88</span>              <span style="color: #0000ff;">if</span><span style="color: #000000;"> (load) showLoading();
</span><span style="color: #008080;"> 89</span>              <span style="color: #008000;">//</span><span style="color: #008000;">  过滤无值参数</span>
<span style="color: #008080;"> 90</span>              <span style="color: #0000ff;">if</span><span style="color: #000000;"> (config.params) {
</span><span style="color: #008080;"> 91</span>                 <span style="color: #0000ff;">delete</span><span style="color: #000000;"> config.params.load;
</span><span style="color: #008080;"> 92</span> <span style="color: #000000;">                 filiter(config.params);
</span><span style="color: #008080;"> 93</span>                 } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span><span style="color: #000000;"> (config.data) {
</span><span style="color: #008080;"> 94</span> <span style="color: #000000;">                 filiter(config.data);
</span><span style="color: #008080;"> 95</span>                 <span style="color: #0000ff;">delete</span><span style="color: #000000;"> config.data.load;
</span><span style="color: #008080;"> 96</span> <span style="color: #000000;">                }
</span><span style="color: #008080;"> 97</span>              <span style="color: #0000ff;">if</span><span style="color: #000000;"> (
</span><span style="color: #008080;"> 98</span>                  config.method.toLocaleLowerCase() === 'post' ||
<span style="color: #008080;"> 99</span>                  config.method.toLocaleLowerCase() === 'put'
<span style="color: #008080;">100</span> <span style="color: #000000;">             ) {
</span><span style="color: #008080;">101</span>                  <span style="color: #008000;">//</span><span style="color: #008000;"> json 格式传递</span>
<span style="color: #008080;">102</span>                  <span style="color: #0000ff;">if</span><span style="color: #000000;"> (config.json) {
</span><span style="color: #008080;">103</span>                      config.headers =<span style="color: #000000;"> headerTwo;
</span><span style="color: #008080;">104</span>                  } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">105</span>                      config.data =<span style="color: #000000;"> qs.stringify(config.data);
</span><span style="color: #008080;">106</span>                      config.data = config.data + '&amp;t=' +<span style="color: #000000;"> Date.now();
</span><span style="color: #008080;">107</span> <span style="color: #000000;">                 }
</span><span style="color: #008080;">108</span> <span style="color: #000000;">             }
</span><span style="color: #008080;">109</span>              <span style="color: #0000ff;">return</span><span style="color: #000000;"> config;
</span><span style="color: #008080;">110</span>          }, error =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">111</span> <span style="color: #000000;">              hideLoading();
</span><span style="color: #008080;">112</span>              <span style="color: #0000ff;">return</span><span style="color: #000000;"> Promise.reject(error);
</span><span style="color: #008080;">113</span> <span style="color: #000000;">         });
</span><span style="color: #008080;">114</span>          <span style="color: #008000;">//</span><span style="color: #008000;"> 响应拦截器</span>
<span style="color: #008080;">115</span>          instance.interceptors.response.use(response =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">116</span>             setTimeout(hideLoading,0<span style="color: #000000;">);
</span><span style="color: #008080;">117</span> <span style="color: #000000;">             let data;
</span><span style="color: #008080;">118</span>              <span style="color: #008000;">//</span><span style="color: #008000;"> IE9时response.data是undefined，因此需要使用response.request.responseText(Stringify后的字符串)</span>
<span style="color: #008080;">119</span>              <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">response.data ) {
</span><span style="color: #008080;">120</span>                  data =<span style="color: #000000;"> response.request.responseText;
</span><span style="color: #008080;">121</span>              } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">122</span>                  data =<span style="color: #000000;"> response.data;
</span><span style="color: #008080;">123</span> <span style="color: #000000;">             }
</span><span style="color: #008080;">124</span> 
<span style="color: #008080;">125</span>              <span style="color: #0000ff;">switch</span> (data.code) { <span style="color: #008000;">//</span><span style="color: #008000;"> 接口定义字段</span>
<span style="color: #008080;">126</span>                  <span style="color: #0000ff;">case</span> '001'<span style="color: #000000;">:
</span><span style="color: #008080;">127</span> <span style="color: #000000;">                     Message({
</span><span style="color: #008080;">128</span>                          showClose: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">129</span>                          message: data.msg || '未知错误,请联系管理员'<span style="color: #000000;">,
</span><span style="color: #008080;">130</span>                          type: 'error'
<span style="color: #008080;">131</span> <span style="color: #000000;">                     });
</span><span style="color: #008080;">132</span> <span style="color: #000000;">                     router.push({
</span><span style="color: #008080;">133</span>                          path: '/login'
<span style="color: #008080;">134</span> <span style="color: #000000;">                     });
</span><span style="color: #008080;">135</span>                      <span style="color: #0000ff;">break</span><span style="color: #000000;">;
</span><span style="color: #008080;">136</span>                 <span style="color: #0000ff;">default</span><span style="color: #000000;">:
</span><span style="color: #008080;">137</span> <span style="color: #000000;">             }
</span><span style="color: #008080;">138</span>              <span style="color: #0000ff;">return</span><span style="color: #000000;"> data;
</span><span style="color: #008080;">139</span>          }, err =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">140</span> <span style="color: #000000;">           hideLoading();
</span><span style="color: #008080;">141</span> 
<span style="color: #008080;">142</span>              <span style="color: #0000ff;">if</span> (err &amp;&amp;<span style="color: #000000;"> err.response) {
</span><span style="color: #008080;">143</span>                  let msg =<span style="color: #000000;"> {
</span><span style="color: #008080;">144</span>                      400: '请求错误'<span style="color: #000000;">,
</span><span style="color: #008080;">145</span>                      401: '未授权，请登录'<span style="color: #000000;">,
</span><span style="color: #008080;">146</span>                      403: '拒绝访问'<span style="color: #000000;">,
</span><span style="color: #008080;">147</span>                      404<span style="color: #000000;">: `请求地址出错: ${err.response.request.responseURL}`,
</span><span style="color: #008080;">148</span>                      408: '请求超时'<span style="color: #000000;">,
</span><span style="color: #008080;">149</span>                      500: '服务器内部错误'<span style="color: #000000;">,
</span><span style="color: #008080;">150</span>                      501: '服务未实现'<span style="color: #000000;">,
</span><span style="color: #008080;">151</span>                      502: '网关错误'<span style="color: #000000;">,
</span><span style="color: #008080;">152</span>                      503: '服务不可用'<span style="color: #000000;">,
</span><span style="color: #008080;">153</span>                      504: '网关超时'<span style="color: #000000;">,
</span><span style="color: #008080;">154</span>                      505: 'HTTP版本不受支持'
<span style="color: #008080;">155</span> <span style="color: #000000;">                 };
</span><span style="color: #008080;">156</span>                  let status = parseInt(err.response.status,10<span style="color: #000000;">);
</span><span style="color: #008080;">157</span> <span style="color: #000000;">                 Message({
</span><span style="color: #008080;">158</span>                      showClose: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">159</span>                      message: msg[status] || ''<span style="color: #000000;">,
</span><span style="color: #008080;">160</span>                      type: 'error'
<span style="color: #008080;">161</span> <span style="color: #000000;">                 });
</span><span style="color: #008080;">162</span>              } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span><span style="color: #008080;">163</span> <span style="color: #000000;">                 Message({
</span><span style="color: #008080;">164</span>                      message: err.config ?<span style="color: #000000;"> `请求地址出错: ${err.config.url}` : err,
</span><span style="color: #008080;">165</span>                      type: 'error'
<span style="color: #008080;">166</span> <span style="color: #000000;">                 });
</span><span style="color: #008080;">167</span> <span style="color: #000000;">             }
</span><span style="color: #008080;">168</span> 
<span style="color: #008080;">169</span>              <span style="color: #0000ff;">return</span><span style="color: #000000;"> Promise.reject(err);
</span><span style="color: #008080;">170</span> <span style="color: #000000;">         });
</span><span style="color: #008080;">171</span>          <span style="color: #008000;">//</span><span style="color: #008000;"> 请求</span>
<span style="color: #008080;">172</span> <span style="color: #000000;">         instance(options)
</span><span style="color: #008080;">173</span>              .then(res =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">174</span> <span style="color: #000000;">                 resolve(res);
</span><span style="color: #008080;">175</span>                  <span style="color: #0000ff;">return</span> <span style="color: #0000ff;">false</span><span style="color: #000000;">;
</span><span style="color: #008080;">176</span> <span style="color: #000000;">             })
</span><span style="color: #008080;">177</span>              .<span style="color: #0000ff;">catch</span>(error =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">178</span> <span style="color: #000000;">                   reject(error);
</span><span style="color: #008080;">179</span> <span style="color: #000000;">             });
</span><span style="color: #008080;">180</span> <span style="color: #000000;">     });
</span><span style="color: #008080;">181</span>  };</pre>
</div>
<p>&nbsp;-&nbsp; <strong>导出</strong></p>
<div class="cnblogs_code">
<pre><code>import axios <span style="color: #0000ff;">from</span> <span style="color: #800000;">'</span><span style="color: #800000;">./api</span><span style="color: #800000;">'</span><span style="color: #000000;">;

</span><span style="color: #0000ff;">const</span> <span style="color: #0000ff;">get</span> = (url, data) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> axios({
      url,
      method: </span><span style="color: #800000;">'</span><span style="color: #800000;">get</span><span style="color: #800000;">'</span><span style="color: #000000;">,
      </span><span style="color: #0000ff;">params</span><span style="color: #000000;">:data
    });
  };
</span><span style="color: #0000ff;">const</span> post = (url, data,json) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> axios({
        url,
        method: </span><span style="color: #800000;">'</span><span style="color: #800000;">post</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        data,
        json
    });
    };
</span><span style="color: #0000ff;">const</span> del = (url, data) =&gt;<span style="color: #000000;"> {
</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> axios({
    url,
    method: </span><span style="color: #800000;">'</span><span style="color: #800000;">delete</span><span style="color: #800000;">'</span><span style="color: #000000;">,
    </span><span style="color: #0000ff;">params</span><span style="color: #000000;">:data
});
};
</span><span style="color: #0000ff;">const</span> put = (url, data,json) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> axios({
        url,
        method: </span><span style="color: #800000;">'</span><span style="color: #800000;">put</span><span style="color: #800000;">'</span><span style="color: #000000;">,
        data,
        json
    });
    };

export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> {
    </span><span style="color: #0000ff;">get</span><span style="color: #000000;">,
    post,
    del,
    put
};</span></pre>
</div>
<p>-&nbsp; <strong>导入vue main.js</strong></p>
<div class="cnblogs_code">
<pre><code>import Vue from 'vue'<span style="color: #000000;">;

import api from </span>'./api'<span style="color: #000000;">;

Vue.prototype.$api </span>= api;</pre>
</div>
<p>&nbsp;</p>
<p>- <strong>使用</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">this</span>.$api.get(url,data,isJson);</pre>
</div>
<p>&nbsp;</p>
<p><a href="https://owen027.github.io/" target="_blank">Owen 的个人博客</a><br /><a href="https://www.cnblogs.com/gaoguowen/" target="_blank">博客园</a></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>