<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修D3.js比例尺 序数比例尺(v3版本)' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>D3.js比例尺 序数比例尺(v3版本)</center></div><div class='banquan'>原文出处:本文由博客园博主溢杨年华提供。<br/>
原文连接:https://www.cnblogs.com/littleSpill/p/10827374.html</div><br>
    <p><span style="font-size: 18px;">上一章介绍了阈值比例尺:<a style="cursor: pointer;" onclick="window.open('https://www.cnblogs.com/littleSpill/p/10825038.html','','');return false;" href="https://www.cnblogs.com/littleSpill/p/10825038.html">https://www.cnblogs.com/littleSpill/p/10825038.html</a>。到目前所有的<strong>定量比例</strong>尺已经介绍完了。</span></p>
<p><span style="font-size: 18px;">现在给大家介绍一下<strong>序数比例尺</strong>。</span></p>
<div>
<div><span style="font-size: 18px;"><strong>定量比例尺</strong>的定义域都是连续的，值域有连续的也有离散的。<strong>序数比例尺(Ordinal Scale)</strong>的定义域和值域都是离散的。</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px;">现实中会有这样的需求，通过输入一些离散的值(如名称、序号、ID等)，要得到另一些离散的值(如颜色等)，这种时候就要考虑序数比例尺了。</span></div>
<div><span style="font-size: 18px;">序数比例尺的方法有:</span></div>
<div>&nbsp;</div>
<div>
<div><span style="font-size: 18px; color: #ff0000;">d3.scaleBand.ordinal() </span></div>
<div><span style="font-size: 18px;">//构建一个序数比例尺</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinal(x)</span></div>
<div><span style="font-size: 18px;"> //输入定义域内一个离散值，返回值域内一个离散值。</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinal.domain([values]) </span></div>
<div><span style="font-size: 18px;">//设定或获取定义域</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinam.range([values]) </span></div>
<div><span style="font-size: 18px;">//设定或获取值域</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinal.rangePoints(interval[,padding]) </span></div>
<div><span style="font-size: 18px;">//代替range()设定的值域。接受一个连续的区间，然后根据定义域中离散值的数量将其分段，</span><span style="font-size: 18px;">分段值即作为值域的离散值。</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinal.rangeRoundPoints(interval,[,padding])</span></div>
<div><span style="font-size: 18px;"> //和rangePoints()一样，但是结果会取整数。</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinal.rangeBands(interval[,padding[,outerPadding]])</span></div>
<div><span style="font-size: 18px;"> //代替range()设定值域。与rangePoints()一样，也是接收一个连续的区间，</span><span style="font-size: 18px;">然后根据定义域中离散值得数量将其分段，但是其分段方法是不同的。</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinal.rangeRoundBands(interval[,padding,outerPadding])</span></div>
<div><span style="font-size: 18px;">//和rangeBands()一样，但是会将结果取整。</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinal.rangBand()</span></div>
<div><span style="font-size: 18px;"> //返回使用rangeBands()设定后每一段的宽度、</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">ordinal.rangeExtend() </span></div>
<div><span style="font-size: 18px;">//返回一个数组，数组里存有值域的最大值和最小值</span></div>
<div>&nbsp;</div>
<div>
<div><span style="font-size: 18px;">首先举个例子，定义一个序数比例尺，定义域设置为[1,2,3,4,5]五个离散值，值域设置为[10,20,30,40,50]五个离散值。看代码:</span></div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> <span style="color: #0000ff;">var</span> ordinal =<span style="color: #000000;"> d3.scale.ordinal()
</span><span style="color: #008080;"> 2</span>                         .domain([1,2,3,4,5<span style="color: #000000;">])
</span><span style="color: #008080;"> 3</span>                         .range([10,20,30,40,50<span style="color: #000000;">])
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span>         console.log(ordinal(1))         <span style="color: #008000;">//</span><span style="color: #008000;">输出10</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span>         console.log(ordinal(3))         <span style="color: #008000;">//</span><span style="color: #008000;">输出30</span>
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>         console.log(ordinal(5))         <span style="color: #008000;">//</span><span style="color: #008000;">输出50</span>
<span style="color: #008080;">10</span>         
<span style="color: #008080;">11</span>         console.log(ordinal(8))         <span style="color: #008000;">//</span><span style="color: #008000;">输出10</span></span></pre>
</div>
<p>&nbsp;</p>
</div>
</div>
<div>
<div><span style="font-size: 18px;">由此可见，1对应10,3对应30,5对应50，与定义域和值域排列次序一致。但是最后一行输入值为8，不在定义域内，输出值为10.先不管其输出值有没有道理，总之不要输入超过定义域的值。</span></div>
<div>&nbsp;</div>
<div>
<div><span style="font-size: 18px;">但是，如果一个一个地设定值域的值，使其对应到定义域上，比较麻烦。D3提供了<strong>rangePoints()</strong>和<strong>rangRoundPoints()</strong>用于解决此问题:只要接收一个连续的区间，即可自动计算出相应的离散值。这两个方法都有两个参数:<strong>interval</strong>和<strong>padding</strong>。<strong>interval</strong>是区间，<strong>padding</strong>是边界部分留下的空白。可省略，默认为0。意义如图:</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px;"><img src="./images/D3.js比例尺 序数比例尺(v3版本)0.png" alt="" /></span></div>
<div>&nbsp;</div>
<div>
<div><span style="font-size: 18px;">如上图，<strong>rnage.interval</strong>就是<strong>rangePoints()</strong>的第一个参数<strong>interva</strong>l的值，是一个范围，如[0,100]。<strong>padding</strong>是第二个参数:<strong>step</strong>是根据定义域的数值计算得到的值。图中圆圈所代表的点，就是计算得到的离散值。看代码:</span></div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span>  <span style="color: #0000ff;">var</span> ordinal2 =<span style="color: #000000;"> d3.scale.ordinal()
</span><span style="color: #008080;"> 2</span>                         .domain([1,2,3,4,5<span style="color: #000000;">])
</span><span style="color: #008080;"> 3</span>                         .rangePoints([0,100<span style="color: #000000;">])
</span><span style="color: #008080;"> 4</span> 
<span style="color: #008080;"> 5</span>         console.log(ordinal2.range())        <span style="color: #008000;">//</span><span style="color: #008000;">输出&nbsp;[0, 25, 50, 75, 100]</span>
<span style="color: #008080;"> 6</span> 
<span style="color: #008080;"> 7</span>         console.log(ordinal2(1))             <span style="color: #008000;">//</span><span style="color: #008000;">输出0</span>
<span style="color: #008080;"> 8</span> 
<span style="color: #008080;"> 9</span>         console.log(ordinal2(3))             <span style="color: #008000;">//</span><span style="color: #008000;">输出50</span>
<span style="color: #008080;">10</span>         
<span style="color: #008080;">11</span>         console.log(ordinal2(5))             <span style="color: #008000;">//</span><span style="color: #008000;">输出100</span></span></pre>
</div>
<p>&nbsp;</p>
</div>
</div>
</div>
</div>
<div>
<div><span style="font-size: 18px;">上面代码的序数比例尺中，<strong>rangePoints()</strong>的第一个参数为[0,100]，第二个参数省略。对应到上图的话，则<strong>range interval</strong>等于[0,100],<strong>padding</strong>等于0，<strong>step</strong>等于25.因此，得到了 上面输出的5个离散值，与定义域的5个值是一一对应的。下面来看看padding有设定值的情况:</span></div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">1</span>  　　ordinal2.rangePoints([0,100],5<span style="color: #000000;">)
</span><span style="color: #008080;">2</span>         
<span style="color: #008080;">3</span>         console.log(ordinal2.range())        <span style="color: #008000;">//</span><span style="color: #008000;">输出[27.77777777777778, 38.888888888888886, 50, 61.11111111111111, 72.22222222222223]</span></pre>
</div>
<p>&nbsp;</p>
</div>
</div>
<div>
<div><span style="font-size: 18px;">这样设定后，<strong>padding</strong>等于5，<strong>step</strong>等于11.111111。则step*padding/2等于27.77777，正是输出数组的第一个值。这样，有时输出的数组是无穷小数，如果希望其都是整数，可用<strong>rangeRoundPoints()</strong>。代码 :</span></div>
</div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;">1</span>  　　ordinal2.rangeRoundPoints([0,100],5<span style="color: #000000;">)
</span><span style="color: #008080;">2</span>         
<span style="color: #008080;">3</span>         console.log(ordinal2.range())        <span style="color: #008000;">//</span><span style="color: #008000;">输出[28, 39, 50, 61, 72]结果被四舍五入取整了</span></span></pre>
</div>
<p>&nbsp;</p>
<div>
<div><span style="font-size: 18px;">D3还提供了<strong>rangeBands()</strong>和<strong>rangRouondBands()</strong>。与<strong>rangePoints()</strong>稍有不同的是，其接收三个参数:<strong>interval</strong>、<strong>padding</strong>、<strong>outerPadding</strong>。各参数的意义如下图。<strong>range interval</strong>是范围。<strong>padding</strong>和<strong>outerPadding</strong>分别是内部和边界的空白的参数，默认为0。<strong>rangePoints</strong>方框中的<strong>rangBand</strong>，表示一个区间。而该区间的起点，就是得到的离散值。图:</span></div>
</div>
<p><img src="./images/D3.js比例尺 序数比例尺(v3版本)1.png" alt="" /></p>
<p>&nbsp;</p>
<div><span style="font-size: 18px;"><strong>rangeBand()</strong>可返回<strong>rangeBand</strong>的值。要注意函数名的区别。<strong>rangBands()</strong>后面有s，用于设置值域。<strong>rangeBand</strong>()后面没有s，用于返回图中<strong>rangBand</strong>的值，举个例子:</span></div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;">1</span> <span style="color: #0000ff;">var</span> bands =<span style="color: #000000;"> d3.scale.ordinal()
</span><span style="color: #008080;">2</span>                     .domain([1,2,3,4,5<span style="color: #000000;">])
</span><span style="color: #008080;">3</span>                     .rangeBands([0,100<span style="color: #000000;">])
</span><span style="color: #008080;">4</span> 
<span style="color: #008080;">5</span>         console.log(bands.range())          <span style="color: #008000;">//</span><span style="color: #008000;">输出[0, 20, 40, 60, 80]</span>
<span style="color: #008080;">6</span>         
<span style="color: #008080;">7</span>         console.log(bands.rangeBand())      <span style="color: #008000;">//</span><span style="color: #008000;">输出20</span></span></pre>
</div>
<p>&nbsp;</p>
</div>
</div>
<div>
<div><span style="font-size: 18px;">这段代码中,<strong>padding</strong>和<strong>outerPadding</strong>都没有设定，默认为0.计算可得，<strong>rangeBand</strong>为20，值域有五个离散的值，分别是每一个<strong>rangeBand</strong>区域的起点，即[0,20,40,60,80]。下面试一下设定了空白的情况:</span></div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;">1</span> bands.rangeBands([0,100],0.5,0.2<span style="color: #000000;">)
</span><span style="color: #008080;">2</span> 
<span style="color: #008080;">3</span>         console.log(bands.range())          <span style="color: #008000;">//</span><span style="color: #008000;">输出[4.081632653061225, 24.489795918367346, 44.89795918367347, 65.3061224489796, 85.71428571428571]</span>
<span style="color: #008080;">4</span>         
<span style="color: #008080;">5</span>         console.log(bands.rangeBand())      <span style="color: #008000;">//</span><span style="color: #008000;">输出10.204081632653061</span></span></pre>
</div>
<p>&nbsp;</p>
</div>
</div>
<div>
<div><span style="font-size: 18px;">这段代码中，<strong>padding</strong>为0.5，<strong>outerPadding</strong>为0.2.对应上图中，<strong>step</strong>计算的值约等于20，因此左右边界的空白step*outerPadding约等于4即输出数组的第一个值。step*padding约等于10，即每个<strong>rangBand</strong>之间的空白长度。</span></div>
<div>&nbsp;</div>
<div>
<div><span style="font-size: 18px;">D3提供了几个获取颜色的序数比例尺。制作图标时，经常需要设定各图形元素的颜色，每次都要手动设定很麻烦，如果对颜色没有特殊要求直接使用这些颜色比例尺即可。并且，它们的颜色都经过精心的色彩搭配，相当美观。<strong><span style="font-size: 14pt;">颜色比例尺</span></strong>有4个:</span></div>
<div>&nbsp;</div>
<div>
<div>
<div><span style="font-size: 18px; color: #ff0000;">d3.scale.category10() :</span></div>
<div><span style="font-size: 18px;"> //10种颜色</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">d3.scale.category20() : </span></div>
<div><span style="font-size: 18px;">//20种颜色</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">d3.scale.category20b() : </span></div>
<div><span style="font-size: 18px;">//20种颜色</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px; color: #ff0000;">d3.scale.category20c() :</span></div>
<div><span style="font-size: 18px;"> //20种颜色</span></div>
</div>
</div>
</div>
</div>
<div>&nbsp;</div>
<div>
<div><span style="font-size: 18px;">这四个都是序数比例尺，输入离散值后返回也是离散值。例如category10()提供了10种颜色，分别为#1f77b4,#ff7f0e,#2ca02,#d62728,#9467bd,#8c564b,#c377c2,#7f7f7f,#bcbd22,#17becf。看代码:</span></div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;">1</span> <span style="color: #0000ff;">var</span> color =<span style="color: #000000;"> d3.scale.category10();
</span><span style="color: #008080;">2</span> 
<span style="color: #008080;">3</span>         console.log(color(1))                    <span style="color: #008000;">//</span><span style="color: #008000;">输出#1f77b4</span>
<span style="color: #008080;">4</span>         
<span style="color: #008080;">5</span>         console.log(color("zhangsan"))           <span style="color: #008000;">//</span><span style="color: #008000;">输出#ff7f0e</span></span></pre>
</div>
<p>&nbsp;</p>
</div>
</div>
<div>
<div><span style="font-size: 18px;">可以看到，无论输入值是什么样的离散值，该比例尺都按照颜色顺序返回:先返回了#1f77b4，再返回#ff7f0e，如果后面还有则继续返回后面的值。使用这四个比例尺来设定颜色以后会经常见到，比如以下应用:</span></div>
<div>&nbsp;</div>
<div>
<div class="cnblogs_code">
<pre><code><span style="font-size: 18px;"><span style="color: #008080;"> 1</span> 　　　　 <span style="color: #0000ff;">var</span> width = 600;                <span style="color: #008000;">//</span><span style="color: #008000;">svg绘制区域的宽度</span>
<span style="color: #008080;"> 2</span>         <span style="color: #0000ff;">var</span> height = 600;               <span style="color: #008000;">//</span><span style="color: #008000;">svg绘制区域的高度</span>
<span style="color: #008080;"> 3</span>         <span style="color: #0000ff;">var</span> dataset = d3.range(5);      <span style="color: #008000;">//</span><span style="color: #008000;">返回[0,1,2,3,4,5]</span>
<span style="color: #008080;"> 4</span>        
<span style="color: #008080;"> 5</span>         <span style="color: #0000ff;">var</span> color2 = d3.scale.category10();             <span style="color: #008000;">//</span><span style="color: #008000;">定义表示颜色的序数比例尺</span>
<span style="color: #008080;"> 6</span>         
<span style="color: #008080;"> 7</span>         <span style="color: #0000ff;">var</span> svg = d3.select("#body")                    <span style="color: #008000;">//</span><span style="color: #008000;">选择id为body的div</span>
<span style="color: #008080;"> 8</span>                     .append("svg")                      <span style="color: #008000;">//</span><span style="color: #008000;">在&lt;body&gt;中添加&lt;avg&gt;</span>
<span style="color: #008080;"> 9</span>                     .attr("width",width)                <span style="color: #008000;">//</span><span style="color: #008000;">设定&lt;svg&gt;的宽度属性</span>
<span style="color: #008080;">10</span>                     .attr("height",height)              <span style="color: #008000;">//</span><span style="color: #008000;">设定&lt;svg&gt;的高度属性</span>
<span style="color: #008080;">11</span>                     
<span style="color: #008080;">12</span>         <span style="color: #008000;">//</span><span style="color: #008000;">绘制圆</span>
<span style="color: #008080;">13</span>          svg.selectAll("circle")        <span style="color: #008000;">//</span><span style="color: #008000;">选择所有的圆</span>
<span style="color: #008080;">14</span>             .data(dataset)              <span style="color: #008000;">//</span><span style="color: #008000;">绑定数据</span>
<span style="color: #008080;">15</span>             .enter()                    <span style="color: #008000;">//</span><span style="color: #008000;">获取enter部分</span>
<span style="color: #008080;">16</span>             .append("circle")           <span style="color: #008000;">//</span><span style="color: #008000;">添加ciecle元素，使其与绑定数组的长度一致</span>
<span style="color: #008080;">17</span>             .attr("cx",<span style="color: #0000ff;">function</span>(d,i){<span style="color: #0000ff;">return</span> 30 + i*80})     <span style="color: #008000;">//</span><span style="color: #008000;">设定圆的x方向的位置</span>
<span style="color: #008080;">18</span>             .attr("cy",100)             <span style="color: #008000;">//</span><span style="color: #008000;">设定圆的y方向的位置</span>
<span style="color: #008080;">19</span>             .attr("r",30)               <span style="color: #008000;">//</span><span style="color: #008000;">设定圆的半径</span>
<span style="color: #008080;">20</span>             .attr("fill",<span style="color: #0000ff;">function</span>(d,i){ <span style="color: #008000;">//</span><span style="color: #008000;">设定圆的颜色</span>
<span style="color: #008080;">21</span>                 <span style="color: #0000ff;">return</span><span style="color: #000000;"> color2(i)
</span><span style="color: #008080;">22</span>             })</span></pre>
</div>
<p>&nbsp;</p>
</div>
</div>
<div>
<div><span style="font-size: 18px;"><strong>d3.range()</strong>返回一个等差数列，但是此处仅使用其长度，不使用数组的各项值。以上代码绘制了5个圆，再给每个圆设置颜色的时候，使用了<strong>color2(i)</strong>。color2是颜色比例尺。i是被绑定数据的索引号，被当做color2的参数使用。但是不一定非得用索引号，别的离散值也可以，颜色都会按顺序返回。效果图：</span></div>
<div>&nbsp;</div>
<div><span style="font-size: 18px;"><img src="./images/D3.js比例尺 序数比例尺(v3版本)2.png" alt="" /></span></div>
<div>&nbsp;</div>
<div>&nbsp;</div>
<div><span style="font-size: 18px;">到这一章，比例尺都介绍完了。下一章给大家介绍坐标轴的绘制方法、添加坐标轴的刻度和各比例尺的坐标轴。</span></div>
</div>
</div>
</div>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>