<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修PWA入门：手把手教你制作一个PWA应用' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>PWA入门：手把手教你制作一个PWA应用</center></div><div class='banquan'>原文出处:本文由博客园博主Fundebug提供。<br/>
原文连接:https://www.cnblogs.com/fundebug/p/pwa-tutorial.html</div><br>
    <p><strong>摘要：</strong> PWA图文教程</p>
<ul>
<li>原文：<a href="https://segmentfault.com/a/1190000019414253">PWA入门：手把手教你制作一个PWA应用</a></li>
<li>作者：MudOnTire</li>
</ul>
<p><strong><a href="https://www.fundebug.com/">Fundebug</a>经授权转载，版权归原作者所有。</strong></p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用0.png" /></p>
<h3 id="简介">简介</h3>
<p>Web前端的同学是否想过学习app开发，以弥补自己移动端能力的不足？但在面对一众的选择时很多同学略感迷茫，是学习ios还是android开发？是学习原生开发、混合开发（比如：<a href="https://ionicframework.com/">Ionic</a>)，还是使用<a href="https://facebook.github.io/react-native/">react native</a>或者<a href="https://flutter.dev/">flutter</a>这样的跨平台框架？而app开发的学习周期长、学习成本高也让一部分人望而却步。得益于前端技术的飞速发展、浏览器性能的不断提高，使用网页技术开发出接近原生体验的应用得以变为现实，PWA就在这样的背景下应运而生。可以用自己熟悉的HTML、CSS、Javascript开发出媲美原生app的网站，不仅拥有接近原生app的流畅程度，并且具备一些原生app才有的特性，比如：a. 可以在主屏上安装应用图标，b. 离线状态下访问，c. 获取消息通知，等等。。PWA的出现让大家看到了希望！</p>
<h3 id="对比原生应用">对比原生应用</h3>
<p>那PWA和原生应用相比到底有何竞争力呢？我们分别看一下原生应用和PWA的特点：</p>
<p><strong>原生应用：</strong></p>
<ul>
<li>使用原生SDK和开发工具开发</li>
<li>需要考虑跨平台，不同系统往往需要独立开发</li>
<li>需要发布到应用商店才能下载使用</li>
<li>可以安装到手机主屏，生成应用图标</li>
<li>直接运行于操作系统上，访问系统资源方便</li>
<li>可以离线使用</li>
<li>可以获取消息通知</li>
</ul>
<p><strong>PWA应用：</strong></p>
<ul>
<li>使用HTML，CSS，JS开发</li>
<li>无需考虑跨平台，只需要考虑浏览器兼容性</li>
<li>通过url访问，无需发布到应用商店</li>
<li>可以安装到手机主屏，生成应用图标</li>
<li>运行于浏览器中，可访问系统资源</li>
<li>可以离线使用</li>
<li>可以获取消息通知</li>
</ul>
<p>可以发现PWA具备了原生应用的主要能力，但是开发流程却比原生应用更加简洁：a. html/css/js的群众基础更好，开发效率更高；b. 省去了为不同系统开发独立版本的大量成本；c. 省去了上架到应用市场的繁琐流程；d. 无需前往应用商店下载，用户使用起来也更加方便。但是值得注意的是，PWA还是相对比较新的技术，实现规范还有很多调整的空间，部分浏览器对PWA的支持也还不完善，但是PWA是一个趋势，所以现在学习正合适！</p>
<p>本文将通过一个简单的列子（一个简单的邮编查询app）向大家展示PWA的开发流程，项目参考：<a href="https://www.youtube.com/watch?v=6H1wftPS0oo">Traversy Media - Build a PWA With Vue &amp; Ionic4</a>。完成后的效果是 <a href="https://mudontire.github.io/pwa-tutorial/">这样的</a> 。</p>
<h3 id="创建项目">创建项目</h3>
<p>项目使用Vue + Ionic的组合进行开发。本文主要关注PWA的搭建，因此vue、ionic等技术不做过多描述。使用VSCode的同学，建议安装<a href="https://vuejs.github.io/vetur/">Vetur</a>插件增加开发效率。</p>
<p><strong>1. 首先全局安装 <code>@vue/cli</code>：</strong></p>
<pre><code><code>npm install -g @vue/cli</code></pre>
<p><strong>2. 初始化vue项目：</strong></p>
<pre><code><code>vue create vue-ionic-pwa</code></pre>
<p><strong>3. 因为ionic的路由依赖于<code>vue-router</code>，所以接下来安装 <code>vue-router</code>：</strong></p>
<pre><code><code>vue add router</code></pre>
<p><strong>4. 安装 <code>@ionic/vue</code></strong></p>
<pre><code><code>npm install @ionic/vue</code></pre>
<p><strong>5. 在 <code>src/main.js</code> 中添加对ionic的引用：</strong></p>
<pre class="javascript"><code>import Ionic from &#39;@ionic/vue&#39;
import &#39;@ionic/core/css/ionic.bundle.css&#39;

Vue.use(Ionic)</code></pre>
<p><strong>6. 在 <code>src/router.js</code> 中使用 <code>IonicVueRouter</code> 替换默认的vue router：</strong></p>
<pre class="javascript"><code>import Vue from &#39;vue&#39;
import { IonicVueRouter } from &#39;@ionic/vue&#39;;
import Home from &#39;./views/Home.vue&#39;

Vue.use(IonicVueRouter)

export default new IonicVueRouter({
  mode: &#39;history&#39;,
  base: process.env.BASE_URL,
  routes: [
    {
      path: &#39;/&#39;,
      name: &#39;home&#39;,
      component: Home
    }
  ]
})</code></pre>
<p><strong>7. 将 <code>src/App.vue</code> 内容修改为：</strong></p>
<pre class="html"><code>&lt;template&gt;
  &lt;div id=&quot;app&quot;&gt;
    &lt;ion-app&gt;
      &lt;ion-vue-router/&gt;
    &lt;/ion-app&gt;
  &lt;/div&gt;
&lt;/template&gt;</code></pre>
<p><strong>8. 将 <code>src/views/Home.vue</code> 内容修改为：</strong></p>
<pre class="html"><code>&lt;template&gt;
  &lt;div class=&quot;ion-page&quot;&gt;
    &lt;ion-header&gt;
      &lt;ion-toolbar&gt;
        &lt;ion-title&gt;
          ZipInfo
        &lt;/ion-title&gt;
      &lt;/ion-toolbar&gt;
    &lt;/ion-header&gt;
    &lt;ion-content class=&quot;ion-padding&quot;&gt;My App&lt;/ion-content&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: &#39;home&#39;,
  components: {}
}
&lt;/script&gt;</code></pre>
<p><strong>最后，我们运行<code>yarn serve</code>看下效果：</strong></p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用1.png" /></p>
<h3 id="app功能实现">App功能实现</h3>
<p>App主要有三部分组成：1. 搜索组件，用于输入邮编并查询，2. 展示组件，用于展示查询到的邮编信息，3. 清除按钮，用于清除查询到的邮编信息</p>
<h4 id="搜索组件">1. 搜索组件</h4>
<p>我们在 <code>src/components</code> 下面新建 <code>ZipSearch.vue</code> 文件作为邮编搜索组件，主要逻辑为当用户输入一串字符，按下搜索按钮，如果输入合法则触发<code>get-zip</code>事件，如果不合法则给出提示。</p>
<p><strong>ZipSearch.vue</strong></p>
<pre class="html"><code>&lt;template&gt;
  &lt;ion-grid&gt;
    &lt;form @submit=&quot;onSubmit&quot;&gt;
      &lt;ion-col&gt;
        &lt;ion-item&gt;
          &lt;ion-label&gt;ZipCode:&lt;/ion-label&gt;
          &lt;ion-input
            :value=&quot;zip&quot;
            @input=&quot;zip = $event.target.value&quot;
            name=&quot;zip&quot;
            placeholder=&quot;Enter US ZipCode&quot;
          /&gt;
        &lt;/ion-item&gt;
      &lt;/ion-col&gt;
      &lt;ion-col&gt;
        &lt;ion-button type=&quot;submit&quot; color=&quot;primary&quot; expand=&quot;block&quot;&gt;Find&lt;/ion-button&gt;
      &lt;/ion-col&gt;
    &lt;/form&gt;
  &lt;/ion-grid&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: &quot;ZipSearch&quot;,
  data() {
    return {
      zip: &quot;&quot;
    };
  },
  methods: {
    onSubmit(e) {
      e.preventDefault();
      const zipRegex = /(^\d{5}$)|(^\d{5}-\d{4}$)/;
      const isValid = zipRegex.test(this.zip);
      if (!isValid) {
        this.showAlert();
      } else {
        this.$emit(&quot;get-zip&quot;, this.zip);
      }
      this.zip = &quot;&quot;;
    },
    showAlert() {
      return this.$ionic.alertController
        .create({
          header: &quot;Enter zipcode&quot;,
          message: &quot;Please enter a valid US ZipCode&quot;,
          buttons: [&quot;OK&quot;]
        })
        .then(a =&gt; a.present());
    }
  }
};
&lt;/script&gt;</code></pre>
<p>在 <code>src/views/Home.vue</code> 中引入 <code>ZipSearch</code> 组件，当<code>Home</code>接收到<code>get-zip</code>事件时调用 https://www.zippopotam.us 的接口，获取邮编对应的信息：</p>
<pre class="html"><code>...
    &lt;ion-content class=&quot;ion-padding&quot;&gt;
      &lt;ZipSearch v-on:get-zip=&quot;getZipInfo&quot;/&gt;
    &lt;/ion-content&gt;
...

&lt;script&gt;
import ZipSearch from &quot;../components/ZipSearch&quot;;

export default {
  name: &quot;home&quot;,
  components: {
    ZipSearch
  },
  data() {
    return {
      info: null
    };
  },
  methods: {
    async getZipInfo(zip) {
      const res = await fetch(`https://api.zippopotam.us/us/${zip}`);
      if (res.status == 404) {
        this.showAlert();
      }
      this.info = await res.json();
    },
    showAlert() {
      return this.$ionic.alertController
        .create({
          header: &quot;Not Valid&quot;,
          message: &quot;Please enter a valid US ZipCode&quot;,
          buttons: [&quot;OK&quot;]
        })
        .then(a =&gt; a.present());
    }
  }
};
&lt;/script&gt;</code></pre>
<p><strong>我们先看一下搜索组件的效果：</strong></p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用2.png" /></p>
<p><strong>输入邮编格式错误：</strong></p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用3.png" /></p>
<h4 id="信息展示和清除组件">2. 信息展示和清除组件</h4>
<p>获取到邮编信息后我们需要一个展示邮编信息的组件和一个清除信息的按钮，在 <code>src/components</code> 下面新建 <code>ZipInfo.vue</code>和<code>ClearInfo.vue</code> 。</p>
<p><strong>ZipInfo.vue</strong></p>
<pre class="html"><code>&lt;template&gt;
  &lt;ion-card v-if=&quot;info&quot;&gt;
    &lt;ion-card-header&gt;
      &lt;ion-card-subtitle&gt;{{info[&#39;post code&#39;]}}&lt;/ion-card-subtitle&gt;
      &lt;ion-card-title&gt;{{info[&#39;places&#39;][0][&#39;place name&#39;]}}&lt;/ion-card-title&gt;
    &lt;/ion-card-header&gt;
    &lt;ion-card-content&gt;
      &lt;ion-list&gt;
        &lt;ion-item&gt;
          &lt;ion-label&gt;
            &lt;strong&gt;State:&lt;/strong&gt;
            {{info[&#39;places&#39;][0][&#39;state&#39;]}} ({{info[&#39;places&#39;][0][&#39;state abbreviation&#39;]}})
          &lt;/ion-label&gt;
        &lt;/ion-item&gt;
        &lt;ion-item&gt;
          &lt;ion-label&gt;
            &lt;strong&gt;Latitude:&lt;/strong&gt;
            {{info[&#39;places&#39;][0][&#39;latitude&#39;]}}
          &lt;/ion-label&gt;
        &lt;/ion-item&gt;
        &lt;ion-item&gt;
          &lt;ion-label&gt;
            &lt;strong&gt;Longitude:&lt;/strong&gt;
            {{info[&#39;places&#39;][0][&#39;longitude&#39;]}}
          &lt;/ion-label&gt;
        &lt;/ion-item&gt;
      &lt;/ion-list&gt;
    &lt;/ion-card-content&gt;
  &lt;/ion-card&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: &quot;ZipInfo&quot;,
  props: [&quot;info&quot;]
};
&lt;/script&gt;</code></pre>
<p><strong>ClearInfo.vue</strong></p>
<pre class="html"><code>&lt;template&gt;
  &lt;ion-button color=&quot;light&quot; expand=&quot;block&quot; v-if=&quot;info&quot; @click=&quot;$emit(&#39;clear-info&#39;)&quot;&gt;Clear&lt;/ion-button&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: &quot;ClearInfo&quot;,
  props: [&quot;info&quot;]
};
&lt;/script&gt;</code></pre>
<p>接着在<code>Home</code>中引入<code>ZipInfo</code>和<code>ClearInfo</code>组件：</p>
<p><strong>src/views/Home.vue</strong></p>
<pre class="html"><code>...
    &lt;ion-content class=&quot;ion-padding&quot;&gt;
      &lt;ZipSearch v-on:get-zip=&quot;getZipInfo&quot;/&gt;
      &lt;ZipInfo v-bind:info=&quot;info&quot;/&gt;
      &lt;ClearInfo v-bind:info=&quot;info&quot; v-on:clear-info=&quot;clearInfo&quot;/&gt;
    &lt;/ion-content&gt;
...

import ZipInfo from &quot;../components/ZipInfo&quot;;
import ClearInfo from &quot;../components/ClearInfo&quot;;

export default {
  name: &quot;home&quot;,
  components: {
    ZipSearch, ZipInfo
  },
  methods:{
    ...
    clearInfo(){
      this.info = null;
    }
  }
}</code></pre>
<p>到此，app的主体就完成了，效果如下：</p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用4.png" /></p>
<h3 id="实现pwa">实现PWA</h3>
<p>我们使用现成的 <a href="https://github.com/vuejs/vue-cli/tree/v3/packages/%40vue/cli-plugin-pwa"><code>@vue/pwa</code></a> 插件来给我们的app增加PWA的能力。</p>
<p><strong>安装 <code>@vue/pwa</code>：</strong></p>
<pre><code><code>vue add @vue/pwa</code></pre>
<p>安装完成后项目中增加了 <code>public/manifest.json</code> 和 <code>registerServiceWorker.js</code>两个文件。其中 <code>public/manifest.json</code> 文件内容如下：</p>
<pre class="javascript"><code>{
  &quot;name&quot;: &quot;vue-ionic-pwa&quot;,
  &quot;short_name&quot;: &quot;vue-ionic-pwa&quot;,
  &quot;icons&quot;: [
    {
      &quot;src&quot;: &quot;./img/icons/android-chrome-192x192.png&quot;,
      &quot;sizes&quot;: &quot;192x192&quot;,
      &quot;type&quot;: &quot;image/png&quot;
    },
    {
      &quot;src&quot;: &quot;./img/icons/android-chrome-512x512.png&quot;,
      &quot;sizes&quot;: &quot;512x512&quot;,
      &quot;type&quot;: &quot;image/png&quot;
    }
  ],
  &quot;start_url&quot;: &quot;./index.html&quot;,
  &quot;display&quot;: &quot;standalone&quot;,
  &quot;background_color&quot;: &quot;#000000&quot;,
  &quot;theme_color&quot;: &quot;#4DBA87&quot;
}</code></pre>
<p><code>manifest.json</code>中主要包含app的基本信息，比如名称（name）、图标（icons）、显示方式（display）等等，是web app能被以类似原生的方式安装、展示的必要配置。更多的配置项可参考 <a href="https://developer.mozilla.org/en-US/docs/Web/Manifest">MDN Web App Manifest</a>。</p>
<p>在Chrome浏览器控制台中也可看到app的manifest配置：</p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用5.png" /></p>
<p><code>registerServiceWorker.js</code>用于注册service worker。service worker通俗来讲就是在浏览器后台独立于网页运行的一段脚本，service worker可以完成一些特殊的功能，比如：消息推送、后台同步、拦截和处理网络请求、管理网络缓存等。Service worker之于pwa的意义在于能够为用户提供离线体验，即掉线状态下用户依旧能够访问网站并获取已被缓存的数据。使用service worker需要HTTPS，并且考虑 <a href="https://caniuse.com/#search=service%20worker">浏览器兼容性</a>。</p>
<p><strong>registerServiceWorker.js</strong></p>
<pre class="javascript"><code>import { register } from &#39;register-service-worker&#39;

if (process.env.NODE_ENV === &#39;production&#39;) {
  register(`${process.env.BASE_URL}service-worker.js`, {
    ready () {
      console.log(
        &#39;App is being served from cache by a service worker.\n&#39; +
        &#39;For more details, visit https://goo.gl/AFskqB&#39;
      )
    },
    registered () {
      console.log(&#39;Service worker has been registered.&#39;)
    },
    cached () {
      console.log(&#39;Content has been cached for offline use.&#39;)
    },
    updatefound () {
      console.log(&#39;New content is downloading.&#39;)
    },
    updated () {
      console.log(&#39;New content is available; please refresh.&#39;)
    },
    offline () {
      console.log(&#39;No internet connection found. App is running in offline mode.&#39;)
    },
    error (error) {
      console.error(&#39;Error during service worker registration:&#39;, error)
    }
  })
}</code></pre>
<p>在Chrome浏览器控制台中也可看到service worker的状态：</p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用6.png" /></p>
<p>当然，只注册service worker还不够，我们还希望控制service worker的行为，通过在 <code>vue.config.js</code> 中增加相关的配置我们可以设置service worker文件的名称、缓存逻辑等等。</p>
<p><strong>vue.config.js</strong></p>
<pre class="javascript"><code>module.exports = {
  pwa: {
    workboxPluginMode: &#39;GenerateSW&#39;,
    workboxOptions: {
      navigateFallback: &#39;/index.html&#39;, 
      runtimeCaching: [
        {
          urlPattern: new RegExp(&#39;^https://api.zippopotam.us/us/&#39;),
          handler: &#39;networkFirst&#39;,
          options: {
            networkTimeoutSeconds: 20,
            cacheName: &#39;api-cache&#39;,
            cacheableResponse: {
              statuses: [0, 200]
            }
          }
        }
      ]
    }
  }
}</code></pre>
<p>更多配置请参考：<a href="https://github.com/vuejs/vue-cli/tree/dev/packages/%40vue/cli-plugin-pwa">@vue/cli-plugin-pwa</a> 和 <a href="https://developers.google.com/web/tools/workbox/modules/workbox-webpack-plugin">workbox-webpack-plugin</a>。由于<code>@vue/cli-plugin-pwa</code>生成的service worker只在生产环境生效，所以建议将项目build之后部署到生产环境测试。本文示例使用 <a href="https://pages.github.com/">github pages</a>进行部署和展示。</p>
<p>到此，将普通web app转成PWA的工作基本完成，我们部署到线上看下效果：</p>
<p><strong>文件已被缓存用于离线访问：</strong></p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用7.png" /></p>
<p><strong>查询一个邮编试试，可以发现请求被缓存了下来：</strong></p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用8.png" /></p>
<p><strong>我们接着关掉网络，再查询刚刚的那个邮编，发现在网络请求失败之后立即切换用本地缓存的数据：</strong></p>
<p><img src="./images/PWA入门：手把手教你制作一个PWA应用9.png" /></p>
<p>好了，一个简单的PWA就已经制作完成了。当然PWA的功能远不止本文所展示的，比如推送、安装到手机，后续有机会再跟大家分享，谢谢🙏。</p>
<blockquote>
<p>最后，推荐大家使用<a href="https://www.fundebug.com/?utm_source=MudOnTire">Fundebug</a>，一款很好用的BUG监控工具~</p>
</blockquote>
<p>本文demo地址：https://github.com/MudOnTire/pwa-tutorial</p>
<h3 id="关于fundebug">关于Fundebug</h3>
<p><a href="https://www.fundebug.com/">Fundebug</a>专注于JavaScript、微信小程序、微信小游戏、支付宝小程序、React Native、Node.js和Java线上应用实时BUG监控。 自从2016年双十一正式上线，Fundebug累计处理了20亿+错误事件，付费客户有阳光保险、核桃编程、荔枝FM、掌门1对1、微脉、青团社等众多品牌企业。欢迎大家<a href="https://www.fundebug.com/team/create">免费试用</a>！</p>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>