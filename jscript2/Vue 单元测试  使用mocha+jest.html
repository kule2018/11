<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修Vue 单元测试  使用mocha+jest' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>Vue 单元测试  使用mocha+jest</center></div><div class='banquan'>原文出处:本文由博客园博主=DLSS=webZT提供。<br/>
原文连接:https://www.cnblogs.com/NB-JDzhou/p/11772497.html</div><br>
    <div class="toc">
    <p class="toc-title">目录</p>
    <div class="toc-list">
        <ul>
        <li><a href="#vue-单元测试">Vue 单元测试</a><ul>
        <li><a href="#mochajest">mocha+jest</a></li>
        <li><a href="#jest">jest</a></li>
        <li><a href="#实例-mocha-expect方法断言">实例 mocha expect方法断言</a></li>
        <li><a href="#示例代码">示例代码</a></li>
        </ul></li>
        </ul>
    </div>
</div>
<h1 id="vue-单元测试">Vue 单元测试</h1>
<p><a href="https://vue-test-utils.vuejs.org/zh">官网：https://vue-test-utils.vuejs.org/zh</a></p>
<blockquote>
<p>定义：</p>
</blockquote>
<p>单元测试是用来对一个模块、一个函数或者一个类来进行正确性检验的测试工作。</p>
<blockquote>
<p>指令：<br />
package.json文件</p>
</blockquote>
<ul>
<li>&quot;test:unit&quot;: &quot;vue-cli-service test:unit&quot;</li>
</ul>
<p>测试驱动开发（TDD：Test-Driven Development）</p>
<h3 id="mochajest">mocha+jest</h3>
<ul>
<li><p>测试框架 mocha<br />
<a href="https://mochajs.org/">Mocha官网：https://mochajs.org/</a></p>
<p>使用expect断言语句</p>
<p><a href="https://www.chaijs.com/">chia官网：https://www.chaijs.com/</a></p>
<p><a href="https://www.chaijs.com/api/assert/">chia部分方法文档：https://www.chaijs.com/api/assert/</a></p>
<p>是JavaScript的一种单元测试框架。<br />
mocha的特点主要有：</p>
<ul>
<li><p>既可以测试简单的JavaScript函数，又可以测试异步代码，因为异步是JavaScript的特性之一；</p></li>
<li><p>可以自动运行所有测试，也可以只运行特定的测试；</p></li>
<li><p>可以支持before、after、beforeEach和afterEach来编写初始化代码。</p></li>
</ul>
<blockquote>
<p>参考</p>
</blockquote>
<p><a href="https://segmentfault.com/a/1190000011362879">Mocha中文文档：https://segmentfault.com/a/1190000011362879</a></p></li>
<li><p>断言库 jest</p></li>
</ul>
<h3 id="jest">jest</h3>
<h3 id="实例-mocha-expect方法断言">实例 mocha expect方法断言</h3>
<ul>
<li><p>格式模板</p>
<p>describe 套件</p>
<pre><code><code>    describe(&#39;名称&#39;,()=&gt;{
        &lt;!-- 用例 --&gt;
        it(&#39;方法描述&#39;,()=&gt;{
            /* 使用expect 断言语句 */
            /* 方法举例 */
            expcect(/* 需要检测的方法 */).to.be.equal(/* 检测结果 */)
        })
    })</code></pre></li>
<li><p>描述</p>
<blockquote>
<p>it()</p>
</blockquote></li>
</ul>
<p>测试异步代码 通过将回调（通常称为done）添加到it()</p>
<pre><code><code>.to.be.equal 是否相等
.to.be.deep.equal 是否严格相等</code></pre>
<h2 id="示例代码">示例代码</h2>
<blockquote>
<p>tests\unit\parser.spec.ts</p>
</blockquote>
<ol>
<li><p>测试各类断言语句执行成功或者失败</p>
<pre><code><code>/* 编写测试用例 */
import {parser,stringify} from &#39;@/code/parser&#39;;
/* 使用mocha(测试工具) +chai(断言库) */
import { expect } from &#39;chai&#39;;
/* 套件 */
describe(&#39;mytest1&#39;, () =&gt; {
    /* 用例 */
    // 常见的关系 相等 大于/小于 包含和不包含
    it(&#39;测试parser方法是否可用&#39;,()=&gt;{
        // deep.equal 表示两个对象是否完全相等（引用空间无所谓）
        // .to.be.equal 表示两个对象相等（引用空间无所谓）
        expect(parser(&#39;name=zfpx&#39;)).to.be.deep.equal({name:&#39;zfpx&#39;})
    })
    it(&#39;测试stringify方法是否可用&#39;,()=&gt;{
        expect(stringify({name:&#39;3px&#39;})).to.be.equal(&#39;name=3px&#39;)
    })
})
/* 断言语句各类 */
describe(&#39;测试方法&#39;,()=&gt;{
    it(&#39;相等关系&#39;,()=&gt;{
        expect(1+1).to.be.equal(2);//相加的值
        expect([1,2,3]).to.be.lengthOf(3);//长度
        expect(true).to.be.true;//布尔值
    })
    it(&#39;包含&#39;,()=&gt;{
        expect(&#39;zfpx&#39;).to.be.contain(&#39;zf&#39;);//是否包含指定字符
        expect(&#39;zfpx&#39;).to.be.match(/zf/);//是否匹配正则

    })
    it(&#39;大于，小于&#39;,()=&gt;{
        expect(5).to.be.greaterThan(3)
        expect(3).to.be.lessThan(6)
        expect(3).to.be.not.greaterThan(5)//不大于3
    })
})
</code></pre></li>
<li><p>测试模块是否正确渲染值</p>
<blockquote>
<p>src\components\unittest\demo1.vue</p>
</blockquote>
<pre class="html"><code>&lt;!-- 单元测试：是否能成功显示渲染的组件元素  --&gt;
&lt;template&gt;
&lt;div class=&quot;demo1&quot;&gt;
    &lt;h1&gt;{{ datas }}&lt;/h1&gt;
&lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
    name:&#39;demo1&#39;,
    props:[&#39;datas&#39;],
    data () {
        return {

        };
    }
}

&lt;/script&gt;
&lt;style lang=&#39;less&#39; scoped&gt;
&lt;/style&gt;
</code></pre>
<blockquote>
<p>tests\unit\unit1.spec.ts</p>
</blockquote>
<pre><code><code>import unitdemo1 from &#39;@/components/unittest/demo1.vue&#39;;
import Vue from &#39;vue&#39;;
import {expect} from  &#39;chai&#39;;
import {mount} from  &#39;@vue/test-utils&#39;;
/* 写法1 产地属性后能否正常显示结果*/
describe(&#39;unitdemo1&#39;,()=&gt;{
    it(&#39;1.传递属性后能否正常显示结果&#39;,()=&gt;{
        // 原生自己测试vue
        // extend 方法可以根据实例创建一个类
        let Constructor = Vue.extend(unitdemo1);
        // 对组件进行挂载
        // vm.$el mocha 测试的时候集成了 jsdom
        let vm:any = new Constructor({
            propsData:{datas:&#39;hello&#39;}
        }).$mount();

        /* 检测h1标签内是否包含hello */

        expect(vm.$el.querySelector(&#39;h1&#39;).innerHTML).to.be.contain(&#39;hello&#39;);
    })
})
/* 写法2 使用mount */
describe(&#39;unitdemo1&#39;,()=&gt;{
    it(&#39;2.传递属性后能否正常显示结果&#39;,()=&gt;{
        let wrapper = mount(unitdemo1);
        /* 设置 Wrapper vm 的 prop 并强制更新。
        https://vue-test-utils.vuejs.org/zh/api/wrapper/setProps.html
        */
        wrapper.setProps({datas:&#39;hello&#39;});//设定传递的值为hello
        expect(wrapper.find(&#39;h1&#39;).text()).to.be.contain(&#39;hello&#39;);
    })
})</code></pre></li>
<li><p>测试模块内的加法是否执行</p>
<blockquote>
<p>src\components\unittest\demo2.vue</p>
</blockquote>
<pre class="html"><code>&lt;!--  --&gt;
&lt;template&gt;
&lt;div&gt;
    &lt;span id=&quot;count&quot;&gt;{{count}}&lt;/span&gt;
    &lt;button @click = &quot;increment&quot;&gt;+&lt;/button&gt;
&lt;/div&gt;
&lt;/template&gt;
&lt;script&gt;
//这里可以导入其他文件（比如：组件，工具js，第三方插件js，json文件，图片文件等等）
//例如：import 《组件名称》 from &#39;《组件路径》&#39;;

export default {
//import引入的组件需要注入到对象中才能使用
components: {},
data() {
    //这里存放数据
    return {
        count:10
    };
},
//监听属性 类似于data概念
computed: {},
//监控data中的数据变化
watch: {},
//方法集合
methods: {
    increment(){
        this.count++
    }
},
//生命周期 - 创建完成（可以访问当前this实例）
created() {},
//生命周期 - 挂载完成（可以访问DOM元素）
mounted() {},
beforeCreate() {}, //生命周期 - 创建之前
beforeMount() {}, //生命周期 - 挂载之前
beforeUpdate() {}, //生命周期 - 更新之前
updated() {}, //生命周期 - 更新之后
beforeDestroy() {}, //生命周期 - 销毁之前
destroyed() {}, //生命周期 - 销毁完成
activated() {} //如果页面有keep-alive缓存功能，这个函数会触发
};
&lt;/script&gt;
&lt;style lang=&#39;lesss&#39; scoped&gt;
/* //@import url(); 引入公共css类 */
&lt;/style&gt;</code></pre>
<blockquote>
<p>tests\unit\unit2.spec.ts</p>
</blockquote>
<pre><code><code>import unitdemo2 from &#39;@/components/unittest/demo2.vue&#39;;
import Vue from &#39;vue&#39;;
import {expect} from  &#39;chai&#39;;
import {mount} from  &#39;@vue/test-utils&#39;;

/* 写法2 使用mount */
describe(&#39;测试demo2组件&#39;,()=&gt;{
    it(&#39;单机能否+1&#39;,()=&gt;{
        let wrapper = mount(unitdemo2);
        expect(wrapper.find(&#39;#count&#39;).text()).to.be.equal(&#39;10&#39;);
        wrapper.find(&#39;button&#39;).trigger(&#39;click&#39;);
        expect(wrapper.find(&#39;#count&#39;).text()).to.be.equal(&#39;11&#39;);
    })
})</code></pre>
<p>测试代码执行：npm run test:unit</p></li>
</ol>
<p>测试结果</p>
<pre><code><code>
     DONE  Compiled successfully in 3577ms

    [=========================] 100% (completed)

    WEBPACK  Compiled successfully in 3577ms

    MOCHA  Testing...

    { name: &#39;zfpx&#39; }
    name=zfpx


    mytest1
        √ 测试parser方法是否可用
        √ 测试stringify方法是否可用

    测试方法
        √ 相等关系
        √ 包含
        √ 大于，小于

    unitdemo1
        √ 1.传递属性后能否正常显示结果

    unitdemo1
        √ 2.传递属性后能否正常显示结果

    测试demo2组件
        √ 单机能否+1


    8 passing (111ms)

    MOCHA  Tests completed successfully</code></pre>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>