<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修map字典，储存cookie，切换账户，展示购物车不同商品' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>map字典，储存cookie，切换账户，展示购物车不同商品</center></div><div class='banquan'>原文出处:本文由博客园博主des雷锋提供。<br/>
原文连接:https://www.cnblogs.com/wangqingjiu/p/11104544.html</div><br>
    <h2 id="首页">1:首页</h2>
<blockquote>
<ul>
<li>1,静态html5+css做好基本样式</li>
</ul>
</blockquote>
<p>html5，css，jQery, sass</p>
<blockquote>
<ul>
<li>2,jsonp的方式src引入模拟的json数据//这里用的jsonp方式拿数据，详情有使用ajax</li>
</ul>
</blockquote>
<p>遍历json数据:</p>
<pre><code><code>
let data = like[&#39;msg&#39;]; //获取json数据列表
let like_lists = document.querySelector(&#39;.like_lists&#39;); //获取ul便签


//通过循环遍历出后台收据，每循环一次就通过js的dom生成节点，依次插入标签中。并附上类名与id。
</code></pre>
<hr />
<h2 id="跳转详情-ajax异步请求">2:跳转详情 <code>ajax异步请求</code></h2>
<blockquote>
<ul>
<li>关键：indexOf，continue ajax</li>
</ul>
</blockquote>
<pre><code><code>
//首页给a标签绑定一个宝贝的唯一id，点击跳转详情页，通过herf发送这条数据
a1.href = `./front/pages/detail_page.html?id=${itemId}`;

//详情接受地址数据
function getUrlParam(name) {
            var reg = new RegExp(&quot;(^|&amp;)&quot; + name + &quot;=([^&amp;]*)(&amp;|$)&quot;); //构造一个含有目标参数的正则表达式对象
            var r = window.location.search.substr(1).match(reg); //匹配目标参数
            if (r != null) return unescape(r[2]);
            return null; //返回参数值
}
//ajax请求json数据,indexOf判断列表是否包含次数据。
for (let i = 0; i &lt; data.msg.length; i++) {
    // let data = xq[&#39;msg&#39;][i][&#39;itemId&#39;];
    if (data.msg[i][&#39;itemId&#39;].indexOf(id) === -1) { /不包含id
        continue; //跳出  //多个
        //如果不包含就跳出,不打印。*注意要添加循环列表的索引值i
    }
}
</code></pre>
<h2 id="详情页遍历">3:详情页遍历</h2>
<ul>
<li><blockquote>
<p>使用到 jQuery sass gulp</p>
</blockquote></li>
</ul>
<p>主图部分，小盒子里的图片，通过循环给每个img的src更换图片。当鼠标移入小盒子里时，大盒子和放大镜里img的src更换成小盒子里的src。</p>
<pre><code><code>
for (let i = 0; i &lt; imgBtn.length; i++) {
    imgBtn[i].onmouseover = function() {
        oBig.children[0].src = imgBtn[i].childr.src;
        oSmall.children[0].src = imgBtn[i].chi[0].src;
    }
}


let imgBtn = document.querySelectorAll(&#39;.samll_box&#39;); //5个小盒子
let oSmall = document.getElementById(&#39;oSmall&#39;); //盒子  里面有img
let oBig = document.getElementById(&#39;oBig&#39;);
oSmall.children[0].src = imgBtn[0].children[0].src;//默认5小盒子里的第一个展示在大盒子上
</code></pre>
<hr />
<h2 id="登录-注册-页面-模块化">4:登录 注册 页面 <code>模块化</code></h2>
<ul>
<li><blockquote>
<p>使用到 PHP mysql jQuery sass gulp ajax localStorage</p>
</blockquote></li>
</ul>
<h3 id="注册">注册:</h3>
<ul>
<li>使用到jQuery插件，方便获取标签，而且它的选择器很方便。</li>
<li>当鼠标获取input焦点时触发focus事件,提示按正则要求输入</li>
<li>鼠标离开时触发blur事件,判断inpu的val()是否为空，是否满足正则条件，如果条件符合正则要求切不为空则提示，该用户名可注册</li>
<li>点击注册时，ajax提交后台，如果该用户名已别注册则返回一个提示&quot;该用户名已被注册&quot;</li>
<li>注册完成后,使用setTimeout()延迟3s打开登录界面</li>
</ul>
<h3 id="登录">登录:</h3>
<ul>
<li>使用到jQuery插件，方便获取标签，而且它的选择器很方便。</li>
<li>构造函数,通过prototype继承方法 ,触发登录事件时，执行函数。判断用户名与密码是否正确</li>
<li>登录成功，将用户名保存本地,并跳转首页</li>
</ul>
<pre><code><code>
 localStorage.setItem(&quot;username&quot;, $(&#39;#username&#39;).val());</code></pre>
<ul>
<li>首页跳转加载时<code>onload</code>触发下面的函数获取登录成功时保存本地的用户名，并展示</li>
</ul>
<pre><code><code>
 load_data() {
        var theme = localStorage.getItem(&quot;username&quot;);
        if (theme == null || theme == &quot;&quot;) {
            $(&#39;.login_show&#39;).hide();
            $(&#39;.unlogin&#39;).show();

        } else {
            $(&#39;.login_show&#39;).show().children(&#39;.login_name&#39;).text(theme).css(&#39;color&#39;, &#39;red&#39;)
            $(&#39;.unlogin&#39;).hide();
        }

    }</code></pre>
<ul>
<li>点击退出时，触发函数，清除本地用户名和<code>load_data()</code>函数，刷新局部</li>
</ul>
<pre><code><code>
exitu() {
        localStorage.removeItem(&quot;username&quot;);
        //刷新部分
        this.load_data();
     }</code></pre>
<hr />
<h2 id="添加购物车思路">5:添加购物车思路</h2>
<ul>
<li><blockquote>
<p>使用到 jQuery sass gulp ajax cookie</p>
</blockquote></li>
<li><blockquote>
<p>点击详情页 <code>购物车</code> 触发事件。执行函数，将次宝贝id存入cookie保存，并提示添加购物车完成</p>
</blockquote></li>
<li><blockquote>
<p>当用户点击 <code>进入购物车</code> 按钮。触发事件，执行函数，将cookie的value值遍历出来，同ajax异步请求json文件，indexOf判断筛选。将包含的商品价格 图片 展示与页面。</p>
</blockquote></li>
<li><blockquote>
<p>编写计算器。进行数量 ，价格计算.</p>
</blockquote></li>
</ul>
<p><strong>注意点：</strong><br />
<code>最后会与结算的计算器调用的函数必须要在ajax里面写或者调用，不然获取不了那些生成的元素，从而得不到里面的数据！</code></p>
<hr />
<h2 id="购物车进阶版本"><code>购物车进阶版本</code></h2>
<ul>
<li><blockquote>
<p>上面思路，触发加入购物车事件后，商品直接存入cookie，没有与用户名绑定，用户体验度极差。以下是用户与商品id绑定思路!</p>
</blockquote></li>
</ul>
<p><em>字典对象方法</em></p>
<pre><code><code>var dic={
    admin:[1,2,3],
    nihaoya:[4,5,6]
}</code></pre>
<pre><code><code>// 1、获取本地json串 -- String str = Local.getItem(&quot;one&quot;);&quot;{admin:[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;],  admin1:[shopcar],admin2:[]}&quot;
// 2、把json串转换成字典 -- Map dic = JSONObject.parse(str);  {admin:[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;],admin1:[shopcar],admin2:[]}
// 3、获取自己的购物车数据 -- List shopCar = dic[admin];       [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]
// 4、把需要添加到购物车的商品赋值给shopCar -- shopCar.add(data);[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;]
// 5、把dic转换成json -- String json = JSONObject.toJSONString(dic); {admin:[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;],admin1:[shopcar],admin2:[]}&quot;
// 6、保存json到本地  -- Local.saveItem(&quot;one&quot;,dic);</code></pre>
<pre><code><code>var locaname = localStorage.getItem(&#39;username&#39;);
var li = []; //购物车
var dictionary = {}; //创建一个空对象
if (!getCookie(0)) {
    // li = dictionary[locaname];
    if (dictionary[locaname] === undefined) {
        dictionary[locaname] = li;

} else {
    var dic = JSON.parse(getCookie(0));cookie 并解析
    // li = dic[locaname]; //将对应字典里key的v值给自己的购物车
    if (dic[locaname] !== undefined) {
        li = dic[locaname];
    }
}

if (!getCookie(0)) {

    li.push(data.msg[i][&#39;itemId&#39;]);
    dictionary[locaname] = li;
    var dobj = JSON.stringify(dictio

} else {

    li.push(data.msg[i][&#39;itemId&#39;]);
    dic[locaname] = li;
    var dobj = JSON.stringify(dic);

}

// li.push(data.msg[i][&#39;itemId&#39;]);
// setCookie(i, data.msg[i][&#39;itemId&#39;
setCookie(0, dobj, 7);</code></pre>
<ul>
<li><blockquote>
<p><code>注意点</code>：函数执行开始时，判断cookie是否有上一次存储的值,如果有，就赋值给dic,如果没有就得声明一个空对象，然后将list赋值给它!触发事件时也需要判断。存储json，读取时相同名。</p>
</blockquote></li>
</ul>
<pre><code><code>
  $.ajax({
                //请求方式为get
                type: &quot;GET&quot;,
                //json文件位置
                url: &quot;../../data/xqq.json&quot;,
                //返回数据格式为json
                dataType: &quot;json&quot;,
                //请求成功完成后要执行的方法

                success: function (data) {

                    // console.log(dictionary[locaname]);
                    // 1、获取本地数据dictionary {name1：[shopcar]，name2：[]}
                    // 2、获取自己的购物车数据 dictionary[locaname]
                    // 3、赋值给一个list var li=dictionary[locaname]
                    // 4、list插入需要加入到购物车的数据 li。add（data）
                    // 5、把list赋值给自己的购物车数据 dictionary[locaname]=li
                    // 6、保存dictionary local。save      

                    // 1、获取本地json串 -- String str = Local.getItem(&quot;one&quot;);             &quot;{admin:[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;],admin1:[shopcar],admin2:[]}&quot;
                    // 2、把json串转换成字典 -- Map dic = JSONObject.parse(str);            {admin:[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;],admin1:[shopcar],admin2:[]}
                    // 3、获取自己的购物车数据 -- List shopCar = dic[admin];                 [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;]
                    // 4、把需要添加到购物车的商品赋值给shopCar -- shopCar.add(data);          [&quot;1&quot;,&quot;2&quot;,&quot;3&quot;,&quot;4&quot;]
                    // 5、把dic转换成json -- String json = JSONObject.toJSONString(dic);    &quot;{admin:[&quot;1&quot;,&quot;2&quot;,&quot;3&quot;],admin1:[shopcar],admin2:[]}&quot;
                    // 6、保存json到本地  -- Local.saveItem(&quot;one&quot;,dic);

                    var locaname = localStorage.getItem(&#39;username&#39;);
                    var li = []; //购物车
                    var dictionary = {}; //创建一个空对象 存数据

                    if (!getCookie(0)) {
                        // li = dictionary[locaname];
                        if (dictionary[locaname] === undefined) {
                            dictionary[locaname] = li;
                        }

                    } else {
                        var dic = JSON.parse(getCookie(0)); //获取cookie 并解析
                        // li = dic[locaname]; //将对应字典里key的value赋值给自己的购物车
                        if (dic[locaname] !== undefined) {
                            li = dic[locaname];
                        }
                    }


                    for (let i = 0; i &lt; data.msg.length; i++) {
                        // let data = xq[&#39;msg&#39;][i][&#39;itemId&#39;];

                        if (data.msg[i][&#39;itemId&#39;].indexOf(id) === -1) { //data不包含id
                            continue; //跳出  //多个
                            //如果不包含就跳出,不打印。*注意要添加循环列表的索引值i
                        }
                        // 遍历详情页
                        // console.log(data.msg[i][&#39;goods_gallery_urls&#39;][2]);
                        for (let a = 0; a &lt; 5; a++) {
                            let img1 = document.createElement(&#39;img&#39;);
                            img1.className = &#39;img11&#39;;
                            img1.src = data.msg[i][&#39;goods_gallery_urls&#39;][a]
                            imgBox[a].appendChild(img1)
                        }
                        // 标题
                        let productMainName = document.getElementById(&#39;productMainName&#39;);
                        productMainName.innerHTML = data.msg[i][&#39;goods_name&#39;];
                        // 提示
                        let buy21 = document.getElementById(&#39;buy21&#39;);
                        buy21.innerHTML = data.msg[i][&#39;goods_desc&#39;];

                        let goods_eval_score = document.getElementById(&#39;goods_eval_score&#39;);
                        goods_eval_score.innerHTML = data.msg[i][&#39;payPoint&#39;];

                        let category_id = document.getElementById(&#39;category_id&#39;);
                        category_id.innerHTML = data.msg[i][&#39;srcPoint&#39;]

                        // 店名
                        $(&#39;.store_name&#39;).text(data.msg[i][&#39;mall_name&#39;]);

                        // 点击触发事件存储本地
                        $(&#39;.store_car&#39;).click(() =&gt; {

                            if (!getCookie(0)) {

                                li.push(data.msg[i][&#39;itemId&#39;]);
                                dictionary[locaname] = li;
                                var dobj = JSON.stringify(dictionary);

                            } else {
                                li.push(data.msg[i][&#39;itemId&#39;]);
                                dic[locaname] = li;
                                var dobj = JSON.stringify(dic);

                            }

                            // li.push(data.msg[i][&#39;itemId&#39;]);
                            // setCookie(i, data.msg[i][&#39;itemId&#39;], 7);

                            setCookie(0, dobj, 7);

                            alert(&#39;加入购物车成功，付款请进入购物车&#39;)

                        })

                    }


                    // dictionary[locaname] = [dakhadsdhksa, adajksjlkads, 3]

                    // var a = [&#39;sas&#39;, &#39;sa&#39;]
                    // a.push(&#39;assa&#39;)
                    // dictionary[locaname] = a;


                    // var keys = [];
                    // dictionary.locaname = [12, 32, 54]
                    // for (var key in dictionary) {
                    //     keys.push(key);
                    // }
                    // dictionary[&quot;locaname&quot;].push(77);

                    // console.log(dictionary);

                    // 详情主图
                    let imgBtn = document.querySelectorAll(&#39;.samll_box&#39;); //5个小盒子
                    let oSmall = document.getElementById(&#39;oSmall&#39;); //获取盒子  里面有img
                    let oBig = document.getElementById(&#39;oBig&#39;);

                    oSmall.children[0].src = imgBtn[0].children[0].src; //默认5小盒子里的第一个展示在大盒子上

                    for (let i = 0; i &lt; imgBtn.length; i++) {
                        imgBtn[i].onmouseover = function () {
                            oBig.children[0].src = imgBtn[i].children[0].src;
                            oSmall.children[0].src = imgBtn[i].children[0].src;
                        }
                    }


                }
            });
        });</code></pre>
<pre><code><code>//购物车js

 $.ajax({
        type: &quot;GET&quot;,
        // url: &quot;../../data/like_like.json&quot;,
        url: &quot;../../data/like_like.json&quot;,
        data: &quot;data&quot;,
        dataType: &quot;json&quot;,
        success: function(response) {
            let username = localStorage.getItem(&#39;username&#39;); //本地名


            let dic = JSON.parse(getCookie(0)); //json对象
            console.log(dic);

            var keys = []; //遍历dic长度

            for (var key in dic) {
                keys.push(key);
            }


            if (keys.indexOf(username) == -1) {
                $(&#39;.rember&#39;).show();
                $(&#39;.pay&#39;).hide();

            } else {
                $(&#39;.pay&#39;).show();

                let lkel = response.msg.length;

                // strc.length 
                // dic[username].length //当前用户名里面的value值

                for (let a = 0; a &lt; dic[username].length; a++) { //循环遍历value值

                    // var arr = strc[a].split(&#39;=&#39;)[1] //arr=cookie的
                    var arr = dic[username][a];

                    for (let i = 0; i &lt; lkel; i++) { //循环遍历json文件 
                        if (response.msg[i][&#39;itemId&#39;].indexOf(arr) === -1) { //json文件里是否包含dic[username]里面的value
                            continue;
                        }
                        // console.log(response.msg[i][&#39;nick&#39;]);
                        // console.log(response.msg[i][&#39;icon&#39;]);

                        let li1 = document.createElement(&#39;li&#39;);
                        li1.className = &#39;carlis&#39;;
                        $(&#39;.shop_lis&#39;).append(li1);
                        let img1 = document.createElement(&#39;img&#39;);
                        img1.src = response.msg[i][&#39;icon&#39;];
                        img1.className = &#39;goods_img&#39;;

                        li1.append(img1);

                        let p1 = document.createElement(&#39;p&#39;);
                        p1.innerHTML = response.msg[i][&#39;title&#39;];
                        li1.append(p1);
                        // var p1 = $(&quot;&lt;p&gt;&lt;/p&gt;&quot;).text(response.msg[i][&#39;title&#39;]);

                        let div1 = document.createElement(&#39;div&#39;);
                        div1.className = &#39;goods_bottom&#39;;
                        div1.innerHTML = &#39;￥&#39;;
                        li1.append(div1);

                        let span1 = document.createElement(&#39;span&#39;);
                        span1.className = &#39;goods_price&#39;;
                        span1.innerHTML = response.msg[i][&#39;srcPoint&#39;];

                        div1.append(span1)

                        let div_num = document.createElement(&#39;div&#39;);
                        div_num.className = &#39;num&#39;;
                        div1.append(div_num);

                        let div_minus = document.createElement(&#39;div&#39;);
                        let div_plus = document.createElement(&#39;div&#39;);
                        let span2 = document.createElement(&#39;span&#39;);
                        div_minus.innerHTML = &#39;-&#39;;
                        div_plus.innerHTML = &#39;+&#39;;
                        span2.innerHTML = &#39;0&#39;;
                        div_minus.className = &#39;minus&#39;;
                        div_plus.className = &#39;plus&#39;;


                        div_num.append(div_minus);
                        div_num.append(span2);
                        div_num.append(div_plus);

                    }

                }
            }

            $(&quot;.plus&quot;).click(function() {
                var num = $(this).parent().children(&quot;span&quot;);
                //单品数量增加

                num.text(parseInt(num.text()) + 1);
                //商品总数增加
                var totalNum = parseInt($(&quot;.totalNum&quot;).text());
                totalNum++
                $(&quot;.totalNum&quot;).text(totalNum);
                //计算总价
                var goods_price = parseFloat($(this).parent().parent().children(&quot;.goods_price&quot;).text());
                $(&quot;.totalPrice&quot;).text(parseFloat($(&quot;.totalPrice&quot;).text()) + goods_price);
            });

            //点击减少按钮触发事件
            $(&quot;.minus&quot;).click(function() {
                var num = $(this).parent().children(&quot;span&quot;);
                if (parseInt(num.text())) {
                    num.text(parseInt(num.text()) - 1);
                    var totalNum = parseInt($(&quot;.totalNum&quot;).text());
                    totalNum--
                    $(&quot;.totalNum&quot;).text(totalNum);
                    var goods_price = parseFloat($(this).parent().parent().children(&quot;.goods_price&quot;).text());
                    $(&quot;.totalPrice&quot;).text(parseFloat($(&quot;.totalPrice&quot;).text()) - goods_price);
                } else {
                    num.text(&quot;0&quot;);
                }

                // console.log(parseInt(num.text()));


            });

            //点击付款
            $(&#39;#pay_money&#39;).click(() =&gt; {
                console.log($(&#39;.totalPrice&#39;).text());

                if ($(&#39;.totalPrice&#39;).text() === &#39;00&#39;) {
                    alert(&#39;请输入商品数量&#39;);
                } else {
                    $(&#39;.pay_photo&#39;).show(1000);

                }

            })
            $(&#39;#pay_close&#39;).click(() =&gt; {
                $(&#39;.pay_photo&#39;).hide();
            })

        }
    });</code></pre>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>