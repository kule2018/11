<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修nodejs进阶（1）——npm使用技巧和最佳实践' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>nodejs进阶（1）——npm使用技巧和最佳实践</center></div><div class='banquan'>原文出处:本文由博客园博主小丸子大兄弟提供。<br/>
原文连接:https://www.cnblogs.com/xwanzi/p/11190923.html</div><br>
    <p>nodejs进阶教程，小白绕道！！！</p>
<h1 id="npm">npm使用技巧和最佳实践</h1>
<p>前提：请确保安装了node.js</p>
<h2 id="npm-1">npm的最佳实践</h2>
<p><code><span class="pln">npm install</span></code>是最常见的npm cli命令，但是它还有更多能力！接下来你会了解npm是如何在应用的整个生命周期帮助你的-从创建一个项目到开发和部署整个生命周期</p>
<h3 id="npm-2">认识npm</h3>
<p>在开始之前，我们先来看看一些查看正在运行的npm版本的命令</p>
<h3 id="npmversion">npm version</h3>
<p>获取当前npm cli正在使用的版本，你可以执行命令 <code><span class="pln">npm version</span></code>，这条命令除了返回版本外，还可以返回很多信息-当前包的版本，你正在使用的node.js的版本，openSSL或者V8的版本，以我本地安装的node为例，结果如下：</p>
<p><img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践0.png" alt="" /></p>
<h3 id="npmhelp">npm help</h3>
<p>和大多数的命令行工具一样，npm也有一个内置的帮助函数, 可以获取命令的描述和提要，比入我们想看看npm test命令是做什么的，执行 <code><span class="pln"> npm help test</span></code></p>
<p><img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践1.png" alt="" /></p>
<h3 id="1npminit">1 使用&nbsp;<code><span class="pln">npm init</span></code>创建新项目</h3>
<p>使用 <code><span class="pln">npm init</span></code>命令可以帮助你交互式地创建 <code><span class="kwd">package<span class="pun">.<span class="pln">json</span></span></span></code>文件，会弹出项目名称和描述的问题，有一个快速的解决方法 <code><span class="pln">npm init<span class="pun">--<span class="pln">yes</span></span></span></code>(或者简写 <code><span class="pln">npm init<span class="pun">-<span class="pln">y</span></span></span></code>),那么就不会弹出任何问题了，仅仅是使用默认配置创建一个 <code><span class="kwd">package<span class="pun">.<span class="pln">json</span></span></span></code>， 使用下面的命令，你可以配置这些默认配置</p>
<ol class="linenums">
<li class="L0"><code class="javascript language-javascript"><span class="pln">npm config <span class="kwd">set<span class="pln"> init<span class="pun">.<span class="pln">author<span class="pun">.<span class="pln">name YOUR_NAME</span></span></span></span></span></span></span></code></li>
<li class="L1"><code class="javascript language-javascript"><span class="pln">npm config <span class="kwd">set<span class="pln"> init<span class="pun">.<span class="pln">author<span class="pun">.<span class="pln">email YOUE_EMAIL</span></span></span></span></span></span></span></code></li>
</ol>
<h3 id="2npm">2 查找正确的npm包</h3>
<p>查找正确的npm包相当具有挑战性-有成千上万的包可供选择，因此选择正确的npm 包很令人苦恼了，然而，我们可以选择一个模块帮助我们发送HTTP请求 有一个网站可以帮助我们简单地完成这个任务，它就是<a href="https://npms.io/">npms.io</a>，它会展示包的质量，受欢迎度，和维护性，这些是通过一个模块是否更新了依赖，是否有提示配置，是否做了测试覆盖，最近有没有提交记录来综合计算得出的</p>
<p><img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践2.png" alt="" /></p>
<h3 id="3npm">3 检查npm包</h3>
<p>一旦我们找到了我们的模块（在我们的例子中是一个request模块），我们应该看一下文档，查看issues,以便更好地了解我们即将引入到应用中的包，不要忘记你使用的npm包越多，你的项目的风险就越高</p>
<p>如果你想在cli中打开这个模块的首页,执行</p>
<p><code><span class="pln"> npm home request</span></code></p>
<p>打开模块的issues</p>
<p><code><span class="pln">npm bugs request</span></code></p>
<p>或者你只是想查看模块的git仓库，执行下面的命令</p>
<p><code><span class="pln">npm repo request</span></code></p>
<h3 id="4">4 保存依赖</h3>
<p>npm采用semver进行控制</p>
<blockquote>
<p>所谓SEMVER，指的是语义化版本，其规则概述如下： 版本格式：主版本号.次版本号.修订号，版本号递增规则如下：</p>
<ul>
<li>主版本号：新的架构调整，不兼容老版本</li>
<li>次版本号：新增功能，兼容老版本</li>
<li>修订号：修复bug，兼容老版本。</li>
</ul>
</blockquote>
<p>一旦你决定将第三方包引入你的项目，你必须安装和保存它，最常见的命令是 <code><span class="pln">npm install some<span class="pun">-<span class="kwd">package</span></span></span></code>,如果你想自动将包信息添加进 <code><span class="kwd">package<span class="pun">.<span class="pln">json</span></span></span></code>文件，你需要执行 <code><span class="pln">npm install some<span class="pun">-<span class="kwd">package<span class="pln"><span class="pun">--<span class="pln">save</span></span></span></span></span></span></code></p>
<p>npm默认会带着'^&rsquo;这个前缀保存你的包,具体的安装规则如下：</p>
<p>^version</p>
<ol class="linenums">
<li class="L0"><code><span class="pun">兼容某个版本</span></code></li>
<li class="L1"><code></code></li>
<li class="L2"><code><span class="pun">版本号中最左边的非<span class="lit">0<span class="pun">数字的右侧可以任意</span></span></span></code></li>
<li class="L3"><code></code></li>
<li class="L4"><code><span class="pun">如果缺少某个版本号，则这个版本号的位置可以任意</span></code></li>
<li class="L5"><code></code></li>
<li class="L6"><code><span class="pun">如：^<span class="lit">1.1<span class="pun">.<span class="lit">2<span class="pln"> <span class="pun">，表示&gt;=<span class="lit">1.1<span class="pun">.<span class="lit">2<span class="pun">&lt;<span class="lit">2.0<span class="pun">.<span class="lit">0<span class="pun">，</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L7"><code><span class="pun">可以是<span class="lit">1.1<span class="pun">.<span class="lit">2<span class="pun">，<span class="lit">1.1<span class="pun">.<span class="lit">3<span class="pun">，.....，<span class="lit">1.1<span class="pun">.<span class="pln">n<span class="pun">，<span class="lit">1.2<span class="pun">.<span class="pln">n<span class="pun">，.....，<span class="lit">1.n<span class="pun">.<span class="pln">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L8"><code></code></li>
<li class="L9"><code><span class="pun">如：^<span class="lit">0.2<span class="pun">.<span class="lit">3<span class="pln"> <span class="pun">，表示&gt;=<span class="lit">0.2<span class="pun">.<span class="lit">3<span class="pln"> <span class="pun">&lt;<span class="lit">0.3<span class="pun">.<span class="lit">0<span class="pun">，</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L0"><code><span class="pun">可以是<span class="lit">0.2<span class="pun">.<span class="lit">3<span class="pun">，<span class="lit">0.2<span class="pun">.<span class="lit">4<span class="pun">，.....，<span class="lit">0.2<span class="pun">.<span class="pln">n</span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code></code></li>
<li class="L2"><code><span class="pun">如：^<span class="lit">0.0<span class="pun">，表示<span class="pln"> <span class="pun">&gt;=<span class="lit">0.0<span class="pun">.<span class="lit">0<span class="pln"> <span class="pun">&lt;<span class="lit">0.1<span class="pun">.<span class="lit">0<span class="pun">，</span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code><span class="pun">可以是<span class="lit">0.0<span class="pun">.<span class="lit">0<span class="pun">，<span class="lit">0.0<span class="pun">.<span class="lit">1<span class="pun">，.....，<span class="lit">0.0<span class="pun">.<span class="pln">n</span></span></span></span></span></span></span></span></span></span></span></span></code></li>
</ol>
<p>这也意味着当你下次执行 <code><span class="pln">npm install</span></code>的时候，即使主版本没有更改，次版本或者修订版本发生了改变，你的这个模块会重装，你可以执行下面的命令修改安装包版本规则 <code><span class="pln">npm config<span class="kwd">set<span class="pln">save<span class="pun">-<span class="pln">prefix<span class="pun">=<span class="str">'~'</span></span></span></span></span></span></span></code></p>
<p>这个包前缀的安装规则如下：</p>
<p>~version</p>
<ol class="linenums">
<li class="L0"><code><span class="pun">大概匹配某个版本</span></code></li>
<li class="L1"><code></code></li>
<li class="L2"><code><span class="pun">如果<span class="pln">minor<span class="pun">版本号指定了，那么<span class="pln">minor<span class="pun">版本号不变，而<span class="pln">patch<span class="pun">版本号任意</span></span></span></span></span></span></span></code></li>
<li class="L3"><code></code></li>
<li class="L4"><code><span class="pun">如果<span class="pln">minor<span class="pun">和<span class="pln">patch<span class="pun">版本号未指定，那么<span class="pln">minor<span class="pun">和<span class="pln">patch<span class="pun">版本号任意</span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code></code></li>
<li class="L6"><code><span class="pun">如：~<span class="lit">1.1<span class="pun">.<span class="lit">2<span class="pun">，表示&gt;=<span class="lit">1.1<span class="pun">.<span class="lit">2<span class="pln"> <span class="pun">&lt;<span class="lit">1.2<span class="pun">.<span class="lit">0<span class="pun">，可以是<span class="lit">1.1<span class="pun">.<span class="lit">2<span class="pun">，<span class="lit">1.1<span class="pun">.<span class="lit">3<span class="pun">，.....，<span class="lit">1.1<span class="pun">.<span class="pln">n </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L7"><code></code></li>
<li class="L8"><code><span class="pun">如：~<span class="lit">1.1<span class="pun">，表示&gt;=<span class="lit">1.1<span class="pun">.<span class="lit">0<span class="pln"> <span class="pun">&lt;<span class="lit">1.2<span class="pun">.<span class="lit">0</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L9"><code></code></li>
<li class="L0"><code><span class="pun">如：~<span class="lit">1<span class="pun">，表示&gt;=<span class="lit">1.0<span class="pun">.<span class="lit">0<span class="pun">&lt;<span class="lit">2.0<span class="pun">.<span class="lit">0<span class="pun">，</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L1"><code><span class="pun">可以是<span class="lit">1.0<span class="pun">.<span class="lit">0<span class="pun">，<span class="lit">1.0<span class="pun">.<span class="lit">1<span class="pun">，.....，<span class="lit">1.1<span class="pun">.<span class="pln">n<span class="pun">，<span class="lit">1.2<span class="pun">.<span class="pln">n<span class="pun">，.....，<span class="lit">1.n<span class="pun">.<span class="pln">n</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
</ol>
<p>如果你想保存指定的版本号，执行 <code><span class="pln">npm config<span class="kwd">set<span class="pln">save<span class="pun">-<span class="pln">exact<span class="kwd">true</span></span></span></span></span></span></code></p>
<h3 id="5">5 锁定依赖</h3>
<p>上面已经介绍过了，npm采用语义化的版本号 semver 进行控制，让开发过程中依赖的获取和升级变得非常容易，但不严格的版本号控制，也带来了不确定性</p>
<ul>
<li>npm建议使用semver版本，但是部分包不遵循semver；</li>
<li>package.json 可以使用精确的版本号控制你的直接依赖包，但第三方依赖的包无法管理；</li>
<li>在开发阶段执行得到的包的版本，和后续部署时得到的可能是不一致的，更不可控的是，你依赖的第三方包也有这样的情况会导致潜在的上线风险。</li>
</ul>
<p>可以用 <code><span class="pln">npm shrinkwrap</span></code>解决这个问题，这条命令会生成一个npm-shrinkwrap.json，这个文件里面不仅包含了安装在你机器上的指定版本的包，而且还有包的指定版的依赖包，一旦在项目的根目录下有这个文件，你执行 <code><span class="pln">npm install</span></code>命令会重新生成一个相同的依赖树</p>
<h3 id="6">6 检查项目的依赖包有无更新</h3>
<p>npm有一个内置的工具方法命令 <code><span class="pln">npm outdated</span></code>可以检查过时的包，在你项目下运行`npm outdated'即可，但是手动执行检查更新命令就很烦了，有一个可以自动执行包更新检查的工具<a href="https://greenkeeper.io/">Greenkeeper</a>，有兴趣的童鞋可以戳进链接了解。</p>
<h3 id="7">7 开发包</h3>
<p>在本地开发npm包的时候，我们可以使用 <code><span class="pln">npm link</span></code>命令，将npm模块链接到对应的运行项目中去，方便地对模块进行调试和测试</p>
<p>举个例子来说明是什么意思以及怎么使用吧</p>
<p>我们现在有两个项目，分别是npm-link-module和npm-link-test,其中npm-link-module是我们要开发的npm包，npm-link-test用来测试我们开发的包</p>
<p>在npm-link-module下执行 <code><span class="pln">npm init<span class="pun">-<span class="pln">y</span></span></span></code>生成一个默认的包配置文件package.json，在目录下新建index.js如下，写个简单的日期转换函数</p>
<ol class="linenums">
<li class="L0"><code class="javascript language-javascript"><span class="kwd">function<span class="pln"> formateTime<span class="pun">(<span class="pln">date<span class="pun">)<span class="pln"> <span class="pun">{</span></span></span></span></span></span></span></code></li>
<li class="L1"><code class="javascript language-javascript"><span class="pln"> let year <span class="pun">=<span class="pln"> date<span class="pun">.<span class="pln">getFullYear<span class="pun">();</span></span></span></span></span></span></code></li>
<li class="L2"><code class="javascript language-javascript"><span class="pln"> let month <span class="pun">=<span class="pln"> date<span class="pun">.<span class="pln">getMonth<span class="pun">()<span class="pln"> <span class="pun">+<span class="pln"> <span class="lit">1<span class="pun">;</span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L3"><code class="javascript language-javascript"><span class="pln"> let day <span class="pun">=<span class="pln"> date<span class="pun">.<span class="pln">getDay<span class="pun">();</span></span></span></span></span></span></code></li>
<li class="L4"><code class="javascript language-javascript"><span class="pln"> month <span class="pun">=<span class="pln"> month <span class="pun">&lt;<span class="pln"> <span class="lit">10<span class="pln"> <span class="pun">?<span class="pln"> <span class="str">'0'<span class="pln"> <span class="pun">+<span class="pln"> month <span class="pun">:<span class="pln"> month<span class="pun">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L5"><code class="javascript language-javascript"><span class="pln"> day <span class="pun">=<span class="pln"> day <span class="pun">&lt;<span class="pln"> <span class="lit">10<span class="pln"> <span class="pun">?<span class="pln"> <span class="str">'0'<span class="pln"> <span class="pun">+<span class="pln"> day <span class="pun">:<span class="pln"> day<span class="pun">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L6"><code class="javascript language-javascript"><span class="pln"> <span class="kwd">return<span class="pln"> year <span class="pun">+<span class="pln"> <span class="str">'-'<span class="pln"> <span class="pun">+<span class="pln"> month <span class="pun">+<span class="pln"> <span class="str">'-'<span class="pln"> <span class="pun">+<span class="pln"> day<span class="pun">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
<li class="L7"><code class="javascript language-javascript"><span class="pun">}</span></code></li>
<li class="L8"><code class="javascript language-javascript"><span class="pln">module<span class="pun">.<span class="pln">exports <span class="pun">=<span class="pln"> formateTime</span></span></span></span></span></code></li>
</ol>
<p>然后执行 <code><span class="pln">npm link</span></code>, 执行命令后，npm-link-module会根据package.json上的配置，被链接到全局，路径是 <code><span class="pun">{<span class="pln">prefix<span class="pun">}/<span class="pln">lib<span class="pun">/<span class="pln">node_modules<span class="pun">/&lt;<span class="kwd">package<span class="pun">&gt;</span></span></span></span></span></span></span></span></span></code>，这是官方文档上的描述，我们可以使用npm config get prefix命令获取到prefix的值(我使用的是windows，实际被链接到的路径是 <code><span class="pun">{<span class="pln">prefix<span class="pun">}/<span class="pln">node_modules<span class="pun">/&lt;<span class="kwd">package<span class="pun">&gt;</span></span></span></span></span></span></span></code>) <img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践3.png" alt="" /> 我们可以看到，已经在这个目录下面生成了一个npm-link-module的快捷方式</p>
<p>再进入npm-link-test,执行 <code><span class="pln">npm init<span class="pun">-<span class="pln">y</span></span></span></code>生成包文件，接着执行 <code><span class="pln">npm link npm<span class="pun">-<span class="pln">link<span class="pun">-<span class="kwd">module</span></span></span></span></span></code> 可以看到在这个项目的node_modules目录下生产了一个npm-link-module的快捷方式 <img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践4.png" alt="" /> 现在npm-link-test这个项目就可以引用这个 <code><span class="pln">npm<span class="pun">-<span class="pln">link<span class="pun">-<span class="kwd">module</span></span></span></span></span></code>这个模块了</p>
<p>我们在npm-link-test的目录下新建index.js文件,内容如下</p>
<ol class="linenums">
<li class="L0"><code class="javascript language-javascript"><span class="pln">let formateTime <span class="pun">=<span class="pln"> require<span class="pun">(<span class="str">'npm-link-module'<span class="pun">);</span></span></span></span></span></span></code></li>
<li class="L1"><code class="javascript language-javascript"><span class="pln">let date <span class="pun">=<span class="pln"> <span class="kwd">new<span class="pln"> <span class="typ">Date<span class="pun">();</span></span></span></span></span></span></span></code></li>
<li class="L2"><code class="javascript language-javascript"><span class="pln">console<span class="pun">.<span class="pln">log<span class="pun">(<span class="pln">formateTime<span class="pun">(<span class="pln">date<span class="pun">));</span></span></span></span></span></span></span></span></code></li>
</ol>
<p>然后执行node index.js，可以看到命令行已经打印出函数的执行结果了</p>
<p><img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践5.png" alt="" /></p>
<p>然后，我们修改下npm-link-module中的index.js文件的日期函数，返回结果就修改成返回斜线格式的日期</p>
<ol class="linenums">
<li class="L0"><code class="javascript language-javascript"><span class="kwd">return<span class="pln"> year <span class="pun">+<span class="pln"> <span class="str">'/'<span class="pln"> <span class="pun">+<span class="pln"> month <span class="pun">+<span class="pln"> <span class="str">'/'<span class="pln"> <span class="pun">+<span class="pln"> day<span class="pun">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></code></li>
</ol>
<p>再回到npm-link-test目录下执行index.js，可以看到，返回结果已经变成了斜线的日期</p>
<p><img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践6.png" alt="" /></p>
<p>看到了吧，所有对npm-link-module的修改会被直接映射到npm-link-test/node_modules/npm-link-module</p>
<p>说明一下，这个nodejs进阶教程计划写10篇左右，现在心中有大致的框架，所以准备边写边梳理，写完会将教程目录列出来</p>
<p><img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践7.png" alt="" /> 下面是我的个人前端公众号，欢迎大家扫码关注，第一时间获取教程的更新信息</p>
<p><img src="./images/nodejs进阶（1）——npm使用技巧和最佳实践8.png" alt="" /></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>