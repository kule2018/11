<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='ç”µè„‘,ç”µè„‘è®²è§£,ç”µè„‘æŠ€æœ¯,ç¼–ç¨‹,ç”µè„‘æ•…éšœç»´ä¿®reselectæ˜¯æ€æ ·æå‡reactç»„ä»¶æ¸²æŸ“æ€§èƒ½çš„ï¼Ÿ' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>é¦–é¡µ</a></li>
</div><div onclick='hidden1()' >åˆ†äº«</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>reselectæ˜¯æ€æ ·æå‡reactç»„ä»¶æ¸²æŸ“æ€§èƒ½çš„ï¼Ÿ</center></div><div class='banquan'>åŸæ–‡å‡ºå¤„:æœ¬æ–‡ç”±åšå®¢å›­åšä¸»ç³Šç³Šç³Šç³Šç³Šäº†æä¾›ã€‚<br/>
åŸæ–‡è¿æ¥:https://www.cnblogs.com/rynxiao/p/12020844.html</div><br>
    <h2 id="reselectæ˜¯ä»€ä¹ˆ">reselectæ˜¯ä»€ä¹ˆï¼Ÿ</h2>
<p><a href="https://github.com/reduxjs/reselect">reselect</a>æ˜¯é…åˆ<code>redux</code>ä½¿ç”¨çš„ä¸€æ¬¾è½»é‡å‹çš„çŠ¶æ€é€‰æ‹©åº“ï¼Œç›®çš„åœ¨äºå½“storeä¸­çš„stateé‡æ–°æ”¹å˜ä¹‹åï¼Œä½¿å¾—å±€éƒ¨æœªæ”¹å˜çš„çŠ¶æ€ä¸ä¼šå› ä¸ºæ•´ä½“çš„stateå˜åŒ–è€Œå…¨éƒ¨é‡æ–°æ¸²æŸ“ï¼ŒåŠŸèƒ½æœ‰ç‚¹ç±»ä¼¼äºç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°<code>shouldComponentDidUpdate</code>ï¼Œä½†æ˜¯å®ƒä»¬å¹¶ä¸æ˜¯ä¸€ä¸ªä¸œè¥¿ã€‚ä¸‹é¢æ˜¯å®˜æ–¹çš„ä¸€äº›ç®€ä»‹ï¼š</p>
<blockquote>
<ul>
<li>Selectors can compute derived data, allowing Redux to store the minimal possible state.</li>
<li>Selectors are efficient. A selector is not recomputed unless one of its arguments changes.</li>
<li>Selectors are composable. They can be used as input to other selectors.</li>
</ul>
</blockquote>
<p><strong>[æ³¨]</strong>ï¼šå¹¶ä¸æ˜¯reselectéè¦å’Œreduxç»‘å®šä½¿ç”¨ä¸å¯ï¼Œå¯ä»¥è¯´reselectåªæ˜¯ä¸€ä¸ªenhancementï¼Œå¹¶ä¸ä»£è¡¨å¼ºè€¦åˆã€‚</p>
<h2 id="ä»€ä¹ˆæ—¶å€™ç”¨reselect">ä»€ä¹ˆæ—¶å€™ç”¨reselect?</h2>
<ul>
<li><code>store</code>çŠ¶æ€æ ‘åºå¤§ä¸”å±‚æ¬¡è¾ƒæ·±</li>
<li>ç»„ä»¶ä¸­çš„stateéœ€è¦ç»è¿‡å¤æ‚çš„è®¡ç®—æ‰èƒ½å‘ˆç°åœ¨ç•Œé¢ä¸Š</li>
</ul>
<p>ä¸ªäººè®¤ä¸ºç¬¦åˆè¿™ä¸¤ç‚¹å°±å¯ä»¥ä½¿ç”¨reselectï¼Œä¸ºä»€ä¹ˆï¼Ÿç®€å•çš„stateæˆ–è®¸æ ¹æœ¬å®Œå…¨æ²¡æœ‰å¿…è¦å¼•å…¥reduxï¼ŒçŠ¶æ€ç®¡ç†ç»„ä»¶å†…éƒ¨å°±å¯ä»¥æ¶ˆåŒ–ï¼Œå†è€…reselectåªæ˜¯åœ¨å‚æ•°çº§åˆ«çš„ç¼“å­˜ï¼Œå¦‚æœç»„ä»¶çŠ¶æ€é€»è¾‘å¹¶ä¸æ˜¯ç‰¹åˆ«å¤æ‚ï¼Œåªæ˜¯ç®€å•çš„getterï¼Œé‚£ä¹Ÿå¯ä¸å¿…å¼•å…¥reselectã€‚</p>
<p><strong>[å»ºè®®]</strong>ï¼šå»ºè®®å¼•å…¥äº†reduxå°±å¯ä»¥å¼•å…¥reselectï¼Œå»çœ‹å®˜æ–¹çš„æºç ï¼Œæ€»å…±åŠ èµ·æ¥æ‰çŸ­çŸ­çš„108è¡Œä»£ç ï¼Œå¯¹æµ‹è¯•å¹¶æ²¡æœ‰ä»€ä¹ˆæˆæœ¬ï¼ŒåŒæ—¶åŠ å…¥ä¹Ÿä¸ä¼šå¯¹æ‰“åŒ…ä½“ç§¯é€ æˆä»€ä¹ˆå½±å“ï¼Œä½†æ˜¯æœ‰äº›æ—¶å€™å¯¹ç»„ä»¶æ¸²æŸ“çš„æ€§èƒ½å´æœ‰å¾ˆå¤§çš„æ”¹å–„ã€‚</p>
<h2 id="åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</h2>
<p>è¿™é‡Œæ˜¯ç›´æ¥copyçš„å®˜æ–¹ä»“åº“ä¸­çš„ä»£ç </p>
<p><a href="https://codesandbox.io/s/empty-fog-xhjtn?expanddevtools=1&amp;fontsize=14&amp;hidenavigation=1"><img src="./images/reselectæ˜¯æ€æ ·æå‡reactç»„ä»¶æ¸²æŸ“æ€§èƒ½çš„ï¼Ÿ0.png" alt="Edit reselect" /></a></p>
<pre><code><code>import { createSelector } from &#39;reselect&#39;

const shopItemsSelector = state =&gt; state.shop.items
const taxPercentSelector = state =&gt; state.shop.taxPercent

const subtotalSelector = createSelector(
  shopItemsSelector,
  items =&gt; items.reduce((acc, item) =&gt; acc + item.value, 0)
)

const taxSelector = createSelector(
  subtotalSelector,
  taxPercentSelector,
  (subtotal, taxPercent) =&gt; subtotal * (taxPercent / 100)
)

export const totalSelector = createSelector(
  subtotalSelector,
  taxSelector,
  (subtotal, tax) =&gt; ({ total: subtotal + tax })
)

let exampleState = {
  shop: {
    taxPercent: 8,
    items: [
      { name: &#39;apple&#39;, value: 1.20 },
      { name: &#39;orange&#39;, value: 0.95 },
    ]
  }
}

console.log(subtotalSelector(exampleState)) // 2.15
console.log(taxSelector(exampleState))      // 0.172
console.log(totalSelector(exampleState))    // { total: 2.322 }</code></pre>
<h2 id="reselectæ˜¯æ€ä¹ˆä¼˜åŒ–ä»£ç æ€§èƒ½çš„">reselectæ˜¯æ€ä¹ˆä¼˜åŒ–ä»£ç æ€§èƒ½çš„ï¼Ÿ</h2>
<ul>
<li><a href="https://github.com/reduxjs/reselect/blob/ac77610bbb0a3cab9b280ea5ea379c2387017446/src/index.js#L68">æ•´ä½“storeå±‚çº§stateçš„ç¼“å­˜</a></li>
<li>ç»„ä»¶çº§åˆ«stateçš„ç¼“å­˜</li>
</ul>
<pre><code><code>const selector = memoize(function () {
  const params = []
  const length = dependencies.length

  for (let i = 0; i &lt; length; i++) {
    // apply arguments instead of spreading and mutate a local list of params for performance.
    params.push(dependencies[i].apply(null, arguments))
  }

  // apply arguments instead of spreading for performance.
  return memoizedResultFunc.apply(null, params)
})

selector.resultFunc = resultFunc
selector.dependencies = dependencies
selector.recomputations = () =&gt; recomputations
selector.resetRecomputations = () =&gt; recomputations = 0
return selector</code></pre>
<p>å‡½æ•°æ•´ä½“è¿”å›çš„å°±æ˜¯è¿™ä¸ª<code>selector</code>ï¼Œå› ä¸ºæˆ‘ä»¬è°ƒç”¨<code>createSelector</code>ï¼Œå…¶å®è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæ‰€ä»¥<code>memoize</code>è¿”å›çš„å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆ<code>selector</code>ä¸­åšäº†ä»€ä¹ˆï¼Ÿ</p>
<pre><code><code>export function defaultMemoize(func, equalityCheck = defaultEqualityCheck) {
  let lastArgs = null
  let lastResult = null
  // we reference arguments instead of spreading them for performance reasons
  // è¿™é‡Œä½œä¸ºè¿”å›çš„å‡½æ•°ï¼Œä¼ å…¥çš„å‚æ•°å³ä¸ºstate
  return function () {
    if (!areArgumentsShallowlyEqual(equalityCheck, lastArgs, arguments)) {
      // apply arguments instead of spreading for performance.
      lastResult = func.apply(null, arguments)
    }

    lastArgs = arguments
    return lastResult
  }
}</code></pre>
<p><code>memoize</code>æ˜¯reselectä¸­æä¾›çš„é»˜è®¤ç¼“å­˜å‡½æ•°ï¼Œå¯ä»¥çš„å¾—çŸ¥æ‰§è¡Œè¿™ä¸ªå‡½æ•°çš„æ—¶å€™ï¼Œè¿”å›çš„å‡½æ•°å³ä¸ºä¸Šé¢ä»£ç ä¸­çš„<code>selector</code>ï¼Œé‚£ä¹ˆ<code>arguments</code>å³ä¸ºä¼ å…¥çš„stateï¼Œé€šè¿‡<code>areArgumentsShallowlyEqual</code>æ¯”è¾ƒä¸¤æ¬¡ä¼ å…¥çš„å‚æ•°æ˜¯å¦ç›¸ç­‰ï¼Œæ³¨æ„ï¼Œè¿™é‡Œæ˜¯æµ…æ¯”è¾ƒï¼Œå³ç¬¬ä¸€å±‚å¼•ç”¨çš„æ¯”è¾ƒ</p>
<pre><code><code>function defaultEqualityCheck(a, b) {
  return a === b
}</code></pre>
<p>å½“ä¸¤æ¬¡ä¼ å…¥çš„å€¼å­˜åœ¨å˜åŒ–çš„æ—¶å€™ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œ</p>
<pre><code><code>func.apply(null, arguments)</code></pre>
<p>è¿™é‡Œä¼šè®¡ç®—å¾—åˆ°æ‰€æœ‰çš„ä¾èµ–ï¼Œç„¶åå¾—åˆ°ä¸‹ä¸€è½®ç¼“å­˜å‡½æ•°çš„<code>params</code>ã€‚</p>
<p>å°±reduxçš„reduceræ¥è®²ï¼Œè¿™å±‚ç¼“å­˜å¹¶æ²¡æœ‰ä»€ä¹ˆä½œç”¨ï¼Œçœ‹çœ‹reducerä»£ç ï¼š</p>
<pre><code><code>function reducer(state, action) {
  switch (action.type): 
    case REQUEST_TODO_PENDING:
        return { ...state, loading: true };
    case REQUEST_TODO_LIST_SUCCESS:
        return { ...state, list: [&#39;todo&#39;], loading: false };
    // ...
    // default
}</code></pre>
<p>reduxç¤¾åŒºæ¨å´‡æ‰€æœ‰çš„stateéƒ½æ˜¯ä¸å¯å˜çš„ï¼Œæ‰€ä»¥åªè¦dispatchäº†ä¸€ä¸ªactionï¼Œæ¯æ¬¡è¿”å›çš„stateå¿…ç„¶ä¼šæ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œå¯¹äºæµ…æ¯”è¾ƒæ¯æ¬¡è¿”å›çš„ç»“æœå¿…ç„¶æ˜¯<code>true</code>;</p>
<p>æ‰€ä»¥ï¼Œç¼“å­˜çš„å…³é”®è¿˜åœ¨ç¬¬äºŒå±‚<code>momoize</code>ï¼Œå› ä¸ºè¿™é‡Œçš„stateå¹¶ä¸æ˜¯æ¯ä¸€æ¬¡éƒ½å¿…é¡»å˜åŒ–ï¼š</p>
<pre><code><code>const resultFunc = funcs.pop()
const dependencies = getDependencies(funcs)

const memoizedResultFunc = memoize(
  function () {
    recomputations++
    // apply arguments instead of spreading for performance.
    return resultFunc.apply(null, arguments)
  },
  ...memoizeOptions
)</code></pre>
<p>çœŸæ­£ä»£ç çš„æ‰§è¡Œåœ¨<code>resultFunc.apply(null, arguments)</code>ï¼Œè¿™é‡Œç¼“å­˜çš„é€»è¾‘è·Ÿä¸Šé¢æ²¡ä»€ä¹ˆåŒºåˆ«ï¼Œè¿™é‡Œå°±ä¸åœ¨è®²è§£äº†ã€‚<code>resultFunc</code>æ˜¯<code>createSelector</code>ä¸­çš„æœ€åä¸€ä¸ªå‚æ•°</p>
<pre><code><code>const shopItemsSelector = state =&gt; state.shop.items
const taxPercentSelector = state =&gt; state.shop.taxPercent

const subtotalSelector = createSelector(
  shopItemsSelector,
  items =&gt; items.reduce((acc, item) =&gt; acc + item.value, 0)
)</code></pre>
<p>å¤§å®¶å¯ä»¥è‡ªè¡Œå¯¹ç…§ä¸€ä¸‹ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ï¼Œé‚£ä¹ˆ<code>arguments</code>å°±æ˜¯ç¬¬äºŒä¸ªå‡½æ•°çš„å‚æ•°ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€æ­¥ç¼“å­˜å‡½æ•°ä¸­çš„<code>params</code>ã€‚</p>
<h2 id="æ€»ç»“">æ€»ç»“</h2>
<p>å¥½äº†ï¼Œå°±å•°å—¦è¿™ä¹ˆå¤šäº†ï¼Œæœ€åï¼Œå¤šè¯»ä¹¦ï¼Œå¤šçœ‹æŠ¥ï¼Œå°‘åƒé›¶é£Ÿï¼Œå¤šç¡è§‰ğŸ˜ªğŸ˜ªğŸ’¤</p>

</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>