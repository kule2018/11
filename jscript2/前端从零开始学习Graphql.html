<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修前端从零开始学习Graphql' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>前端从零开始学习Graphql</center></div><div class='banquan'>原文出处:本文由博客园博主前端-小刘提供。<br/>
原文连接:https://www.cnblogs.com/liuming666/p/11185554.html</div><br>
    <p><span style="font-size: 10pt;">学习本姿势需要电脑装有node,vue-cli相关环境，以及要有node,express,koa,vue相关基础 </span></p>
<p><span style="font-size: 10pt;">本文相关demo的github地址： </span></p>
<pre><code><code><span style="font-size: 10pt;">node服务：</span><span style="color: blue; font-family: Consolas; font-size: 7pt;"><span style="text-decoration: underline;">https://github.com/liuming888/graphql_node_demo.git</span></span></code></pre>
<pre><code><code><span style="color: #24292e; font-size: 7pt;"><span style="font-family: Consolas;">vue</span><span style="font-family: 宋体;">项目：</span><span style="font-family: Consolas;"><a href="https://github.com/liuming888/graphql_vue_demo.git"><span style="color: blue; text-decoration: underline;">https://github.com/liuming888/graphql_vue_demo.git</span></a>
					</span></span></code></pre>
<h2>一 Graphql概述</h2>
<h3>它是什么？从哪里来？要干什么？</h3>
<p><span style="font-size: 12pt;">简单地讲，对于前端，它就是让你舒舒服服发请求的 </span></p>
<p><span style="font-size: 12pt;">严格的说，它是一种api设计思想，用来取代restful api的一种前端处于主导地位的api规范。它把前端所需要的api用类似图数据结构（graph）的方式展现出来，让前端很方便的获取所需要的数据。 </span></p>
<p>&nbsp;</p>
<h3>特点</h3>
<p><span style="font-size: 12pt;">需要什么就获取什么数据 </span></p>
<p><span style="font-size: 12pt;">支持关系数据的查询 </span></p>
<p><span style="font-size: 12pt;">API无需定义各种路由，完全数据驱动 </span></p>
<p><span style="font-size: 12pt;">无需管理API版本，一个版本持续演进 </span></p>
<p><span style="font-size: 12pt;">支持大部分主流开发语言和平台 </span></p>
<p><span style="font-size: 12pt;">强大的配套开发工具 </span></p>
<p>&nbsp;</p>
<h3>起源，restful api的问题</h3>
<p><span style="font-size: 12pt;">如果采用restful api的话，后端要持续维护api doc，但是实际场景是这样的： </span></p>
<p><span style="font-size: 12pt;">1.来了新需求，后端先评估和开发，后端弄得差不多，前端才开始，然后中间后端一顿猛改 </span></p>
<p><span style="font-size: 12pt;">2.由于多种原因，后端经常自己偷偷改掉传参或者返回值，完了接口报错，测试姐姐把前端叫过去一顿批，前端一脸懵圈，仔细检查，发现问题，找后端撕X，这样一个循环非常影响开发效率。 </span></p>
<h3>gql出现</h3>
<p><span style="font-size: 12pt;">由于上面这一堆的问题，facebook公司2012年内部实践了GraphQL，15年刚开源的时候引起了很多大公司和社区关注，落地了很多规范和框架。需要了解详细历史可以看看底下的youtube视频。 </span></p>
<p><span style="font-size: 12pt;">这种叫GraphQL的东西帮助人们经过一系列定义和规范，可以发送gql请求非常方便的拿到想要的数据，甚至还可以修改数据，而不用后台的配合，而且一旦Schema确定（数据库那边定义好），前后端就可以快速并行开发，例如下图获得某个用户的信息，我想要这个用户的什么属性就写什么，graphiQl工具可以进行完整的详细的提示，请求主体简单明了 </span></p>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">    query{
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">          student{
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">            id
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">            name
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">            age
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">          }
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">          course{
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">            id
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">            title
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">          }
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">        }</span>
</code></pre>
<h3>gql理想使用场景</h3>
<p><span style="font-size: 12pt;">数据库建好模型，前后端可以同步开始开发需求，前端只有少数需要依赖后端接口，前端开发过程中可以方便的拿到任何想要的数据，从而节省大量联调接口的时间，迅速的完成一个项目。 </span></p>
<h3>实现原理</h3>
<p><span style="font-size: 12pt;">gql的实现挺复杂的，代码有点难懂，不过原理说起来比较简单易懂 </span></p>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">var { graphql, buildSchema } = require(</span>'graphql'<span style="font-family: Courier New; font-size: 10pt;">);
</span></code></pre>
<p>&nbsp;</p>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">// Construct a schema, using GraphQL schema language
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">var schema = buildSchema(`
</span></code></pre>
<pre><code><code>type<span style="font-family: Courier New; font-size: 10pt;"> Query {
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">    hello: String
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">  }
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">`);
</span></code></pre>
<p>&nbsp;</p>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">// The root provides a resolver </span>functionfor<span style="font-family: Courier New; font-size: 10pt;"> each API endpoint
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">var root = {
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">  hello: () =&gt; {
</span></code></pre>
<pre><code><code>return'Hello world!'<span style="font-family: Courier New; font-size: 10pt;">;
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">  },
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">};
</span></code></pre>
<p>&nbsp;</p>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">// Run the GraphQL query </span>'{ hello }'<span style="font-family: Courier New; font-size: 10pt;"> and </span>print<span style="font-family: Courier New; font-size: 10pt;"> out the response
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">graphql(schema, </span>'{ hello }'<span style="font-family: Courier New; font-size: 10pt;">, root).then((response) =&gt; {
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">  console.log(response);
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">});</span>
</code></pre>
<p><span style="font-size: 12pt;">如上就是一个最简单的node版的gql服务器 gql把定义好的schema拿到，用root之类的resolve解析器去解析发送来的</span><span style="font-family: Courier New; font-size: 10pt;">'{ hello }'</span><span style="font-size: 12pt;">请求，然后返回给相应的json值。上面代码打印出的response如下 </span></p>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">{ 
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">    data: 
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">        { 
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">            hello: </span>'Hello world!'</code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">        } 
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">}</span>
</code></pre>
<p><span style="font-size: 12pt;">当然，resolve逐层解析会有一些问题，如果resolve请求数据库，就要用到<a href="https://link.juejin.im?target=https://github.com/facebook/dataloader" target="_blank">DataLoader</a> </span></p>
<p><span style="font-size: 12pt;">DataLoader是gql服务器性能的关键一环，也是gql社区的主要推动完善方向，就像react里面的shouldComponentUpdate一样制约着gql服务器的性能。 </span></p>
<p><span style="font-size: 12pt;">DataLoader 能让我们从数据库读取数据并让数据能被 GraphQL 处理，我们使用 DataLoader，而不是直接通过 SQL 查询从数据库获取数据，将 DataLoader 作为代理以减少我们实际需要发送给数据库的 SQL 查询。 DataLoader 使用批处理和缓存的组合来实现。如果同一个客户端请求会造成多次请求数据库，DataLoader 会整合这些问题并从数据库批量拉取请求数据。DataLoader 会同时缓存这些数据，当有后续请求需要同样资源时可以直接从缓存获取到。 </span></p>
<h3>具体使用</h3>
<p><span style="font-size: 12pt;">通过服务端对请求的元数据的type进行严格的定义，我们只要在客户端发送gql请求就能返回期望的相应类型的数据 </span></p>
<p><span style="font-size: 12pt;">下图是请求格式，query【请求】，mutation【修改】和subscribe【订阅】是三种api发送方式，query用的多一些，mutation相对传统的restful来说不够可靠和安全，subscribe类似websocket </span></p>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">query 
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">{
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">  schema {
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">    types {
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">      id
</span></code></pre>
<pre><code><code><span style="font-size: 10pt;"><span style="font-family: Courier New;">      name // </span><span style="font-family: 宋体;">获取根字段名</span></span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">      fields {
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">        id
</span></code></pre>
<pre><code><code><span style="font-size: 10pt;"><span style="font-family: Courier New;">        name // </span><span style="font-family: 宋体;">获取字段名</span></span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">      }
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">    }
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">  }
</span></code></pre>
<pre><code><code><span style="font-family: Courier New; font-size: 10pt;">}</span>
			</code></pre>
<h3>和restful比较的优缺点</h3>
<h4>优点</h4>
<p style="margin-left: 18pt;">优点就是后端可以少招几个写接口的</p>
<p style="margin-left: 18pt;">前后端一起开发，节约工期</p>
<p style="margin-left: 18pt;">较少维护api文档，节省精力</p>
<p><span style="font-size: 12pt;">说了这些，其实单对于前端来说，帮助不算特别大 </span></p>
<h4>缺点和难推广的地方</h4>
<p><span style="font-size: 12pt;">后端或者中间层把gql封装相应业务对接数据库是难点，需要高端人力 </span></p>
<p><span style="font-size: 12pt;">需要前端多少学一点类sql语句，不过大部分场景可以封装好固定的sql语句 </span></p>
<p><span style="font-size: 12pt;">封装gql不好会产生sql性能问题，三级嵌套联查还有n+1的老问题又会冒出来，需要持续优化 </span></p>
<p><span style="font-size: 12pt;">前端排除bug需要一定的后端知识，前后端架构多少了解一些 </span></p>
<p><span style="font-size: 12pt;">.. </span></p>
<p>&nbsp;</p>
<h2>二 hello word</h2>
<h3>简易版的hello world</h3>
<p>npm install graphql</p>
<p>&nbsp;</p>
<p>然后使用 node hello.js 以运行 hello.js 中的代码：</p>
<p>&nbsp;</p>
<p>var { graphql, buildSchema } = require('graphql');</p>
<p>&nbsp;</p>
<p>var schema = buildSchema(`</p>
<p>type Query {</p>
<p>hello: String</p>
<p>}</p>
<p>`);</p>
<p>&nbsp;</p>
<p>var root = { hello: () =&gt; 'Hello world!' };</p>
<p>&nbsp;</p>
<p>graphql(schema, '{ hello }', root).then((response) =&gt; {</p>
<p>console.log(response);</p>
<p>});</p>
<p>&nbsp;</p>
<p>控制台打印出Hello world!</p>
<p>&nbsp;</p>
<h3>express版hello world</h3>
<p>npm install express express-graphql graphql</p>
<p>&nbsp;</p>
<p>然后使用 node server.js 以运行 server.js 中的代码：</p>
<p>&nbsp;</p>
<p>var express = require('express');</p>
<p>var graphqlHTTP = require('express-graphql');</p>
<p>var { buildSchema } = require('graphql');</p>
<p>&nbsp;</p>
<p>var schema = buildSchema(`</p>
<p>type Query {</p>
<p>hello: String</p>
<p>}</p>
<p>`);</p>
<p>&nbsp;</p>
<p>var root = { hello: () =&gt; 'Hello world!' };</p>
<p>&nbsp;</p>
<p>var app = express();</p>
<p>app.use('/graphql', graphqlHTTP({</p>
<p>schema: schema,</p>
<p>rootValue: root,</p>
<p>graphiql: true, // 是否开启调试模式（生产环境注意得关掉）</p>
<p>}));</p>
<p>app.listen(4000, () =&gt; console.log('Now browse to localhost:4000/graphql'));</p>
<p>&nbsp;</p>
<p>访问<a href="http://localhost:4000/graphql"><span style="font-family: 宋体; font-size: 12pt;">http://localhost:4000/graphql</span></a></p>
<p><img src="./images/前端从零开始学习Graphql0.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h3>koa版hello world</h3>
<pre><code><code>npm install koa graphql koa-graphql koa-mount</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>然后使用 node server.js 以运行 server.js 中的代码：</p>
<p>const Koa = require('koa');</p>
<p>const mount = require('koa-mount');</p>
<p>const { buildSchema } = require('graphql');</p>
<p>const graphqlHTTP = require('koa-graphql');</p>
<p>const app = new Koa();</p>
<p>&nbsp;</p>
<p>const schema = buildSchema(`</p>
<p>type Query {</p>
<p>hello: String</p>
<p>}</p>
<p>`);</p>
<p>&nbsp;</p>
<p>const root = {</p>
<p>hello: () =&gt; 'Hello world!',</p>
<p>};</p>
<p>&nbsp;</p>
<p>app.use(</p>
<p>mount(</p>
<p>'/graphql',</p>
<p>graphqlHTTP({</p>
<p>schema: schema,</p>
<p>rootValue: root,</p>
<p>graphiql: true,</p>
<p>})</p>
<p>)</p>
<p>);</p>
<p>&nbsp;</p>
<p>app.use(async ctx =&gt; {</p>
<p>ctx.body = 'Hello World';</p>
<p>});</p>
<p>&nbsp;</p>
<p>app.listen(3000);</p>
<p>&nbsp;</p>
<p>访问 <a href="http://localhost:3000/graphql"><span style="font-family: 宋体; font-size: 12pt;">http://localhost:3000/graphql</span></a></p>
<p><img src="./images/前端从零开始学习Graphql1.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>三 进阶</h2>
<p>参考资料：<a href="https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247491385&amp;idx=2&amp;sn=91ea5a1cadb5ba60b91b0c7f6a3eb931&amp;chksm=f951aa7ace26236c89f6f7db5b9e362d6f90c03ce34f77c2b79bfe97f41d48b50f0644e81e12&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;key=333b7957c9b83671735d64576a2ff98cb0d7a">用Node创建GraphQL API：代码量少，性能高</a></p>
<p>&nbsp;</p>
<h4>基于express</h4>
<p>代码看 node-graphql-demo项目 <img src="./images/前端从零开始学习Graphql2.png" alt="" /> 然后yarn npm run dev</p>
<p>github地址： <a href="https://github.com/liuming888/graphql_node_demo.git"><span style="font-family: Consolas; font-size: 7pt;">https://github.com/liuming888/graphql_node_demo.git</span></a><span style="color: #24292e; font-size: 7pt;"><span style="font-family: Consolas;"> master</span><span style="font-family: 等线;">分支</span></span></p>
<h5>创建 Project</h5>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">我们现在来创建我们的 project。打开一个新的 terminal，执行以下命令，即可使用缺省值创建 package.json 文件： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">mkdir node-graphql-demo </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">cd node-graphql-demo </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">npm init -y </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">接下来，我们需要安装以下依赖: </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">npm install graphql express express-graphql sqlite3 --save </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">这样就会安装 Express 框架，Node.js 上的 GraphQL 实现，Express 和 SQLite3 的 GraphQL 中间件。为简单起见，我们使用 SQLite3 作为数据库。 </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p>graphql&nbsp;是一个支持库，并且在我们这里是一个必要的模块</p>
<p>&nbsp;</p>
<p>express 是一个简洁而灵活的 node.js Web应用框架, 提供了一系列强大特性帮助你创建各种 Web 应用，和丰富的 HTTP 工具。</p>
<p>&nbsp;</p>
<p>express-graphql GraphQL HTTP服务器中间件</p>
<p>&nbsp;</p>
<p>SQLite是一个进程内的库，实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。它是一个零配置的数据库，这意味着与其他数据库一样，您不需要在系统中配置。就像其他数据库，SQLite 引擎不是一个独立的进程，可以按应用程序需求进行静态或动态连接。SQLite 直接访问其存储文件</p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<h5>创建 GraphQL 服务器</h5>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">创建工程并引入基本依赖包之后，现在来创建 API 服务器。在工程文件夹里，创建 index.js 文件，并引入下列内容： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const express = require('express'); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const sqlite3 = require('sqlite3').verbose(); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const graphql = require("graphql"); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const ExpressGraphQL = require("express-graphql"); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">上面的代码的目的是：为Express导入Express，SQLite3，GraphQL和GraphQL中间件。 </span></p>
<p style="background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">接下来，添加下列代码，在当前文件夹中创建一个 Express 应用程序和名为 my.db 的 SQLite 3 数据库： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const app = express(); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const database = new sqlite3.Database("./my.db"); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">然后，添加 createContactTable() 方法，在数据库中创建 contacts 表并马上调用函数： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const createContactTable = () =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> const query = ` </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> CREATE TABLE IF NOT EXISTS contacts ( </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id integer PRIMARY KEY, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName text, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName text, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email text UNIQUE)`; </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return database.run(query); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">} </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">createContactTable(); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">我们创建了一个 SQL 表来存储 contacts的基本信息。每个 contact 的基本信息包括：唯一的标识、名、姓和 email。 </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">接下来，添加下列代码来定义一个 GraphQL 类型： </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const ContactType = new graphql.GraphQLObjectType({ </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> name: "Contact", </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> fields: { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: { type: graphql.GraphQLID }, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName: { type: graphql.GraphQLString }, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName: { type: graphql.GraphQLString }, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email: { type: graphql.GraphQLString } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">我们使用基本的内置 GraphQL 类型，如 GraphQLID 和 GraphQLString 来创建我们自定义类型，对应数据库中的 contact。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">相关链接： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">GraphQLID： <a href="https://graphql.github.io/graphql-spec/draft/#sec-ID">https://graphql.github.io/graphql-spec/draft/#sec-ID</a> </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">GraphQLString： <a href="https://graphql.github.io/graphql-spec/draft/#sec-String">https://graphql.github.io/graphql-spec/draft/#sec-String</a> </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">接着，定义查询类型，如下所示： </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">var queryType = new graphql.GraphQLObjectType({ </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> name: 'Query', </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> fields: { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> contacts: { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: graphql.GraphQLList(ContactType), </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, args, context, info) =&gt; { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.all("SELECT * FROM contacts;", function (err, rows) { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject([]); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve(rows); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="background: white;">&nbsp;</p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> contact: { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: ContactType, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> args: { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLID) </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, context, info) =&gt; { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="background: white;">&nbsp;</p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.all("SELECT * FROM contacts WHERE id = (?);", [id], function (err, rows) { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject(null); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve(rows[0]); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">我们的查询有两个字段： contacts，可以用来获取数据库中的所有 contacts，而 contact 则根据 id 获取一个 contact 信息。 contact 字段允许所需的 id 参数为 GraphQLID 类型。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">每个字段都有一个 type，用来说明返回数据的类型，args 定义期望从客户端得到的参数， resolve 则定义了在获取数据逻辑中实际使用的方法。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">对于前两个字段， resolve() 方法是实际逻辑发生的地方&mdash;&mdash; 我们简单调用 database.all() 和 database.run() 方法来执行正确的 SQL 查询，以便从 SQLite 获取数据，返回一个 Promise 来处理得到的数据。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">我们可以从resolve()方法的第二个参数访问任何传递的参数。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">接下来，我们创建一个 mutation 类型，用于创建、更新和删除操作： https://graphql.github.io/graphql-spec/draft/#sec-Mutation </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">var mutationType = new graphql.GraphQLObjectType({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> name: 'Mutation', </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> fields: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> createContact: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: ContactType, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> args: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.run('INSERT INTO contacts (firstName, lastName, email) VALUES (?,?,?);', [firstName, lastName, email], (err) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject(null); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.get("SELECT last_insert_rowid() as id", (err, row) =&gt; { </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: row["id"], </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName: firstName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName: lastName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email: email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> updateContact: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: graphql.GraphQLString, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> args: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLID) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.run('UPDATE contacts SET firstName = (?), lastName = (?), email = (?) WHERE id = (?);', [firstName, lastName, email, id], (err) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject(err); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve(`Contact #${id} updated`); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> deleteContact: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: graphql.GraphQLString, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> args: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLID) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.run('DELETE from contacts WHERE id =(?);', [id], (err) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject(err); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve(`Contact #${id} deleted`); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">我们的 mutation 类型有三个字段： </span></p>
<p style="text-align: justify;"><span style="color: #4a4a4a;"><span style="font-family: 微软雅黑; font-size: 9pt; background-color: white;">createContact 创建 contacts;</span></span></p>
<p style="text-align: justify;"><span style="color: #4a4a4a;"><span style="font-family: 微软雅黑; font-size: 9pt; background-color: white;">updateContact 更新 contacts;</span></span></p>
<p style="text-align: justify;"><span style="color: #4a4a4a;"><span style="font-family: 微软雅黑; font-size: 9pt; background-color: white;">deleteContact 删除 contacts.</span></span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">所有的字段都接受符合 args 属性定义的参数，并由一个 resolve() 方法来获取传递过来的参数，执行相应的 SQL 操作，并返回一个 Promise。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">然后，创建 GraphQL schema： https://graphql.github.io/graphql-spec/draft/#sec-Schema </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const schema = new graphql.GraphQLSchema({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> query: queryType, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> mutation: mutationType </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">GraphQL schema 是 GraphQL 的核心概念，它定义了连接到服务器的客户端可用的功能。我们传递已定义的 query 和 mutation 类型到 schema。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">最后，挂载到 /graphql 端点，在 4000 端口运行 Express 服务器： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">app.use("/graphql", ExpressGraphQL({ schema: schema, graphiql: true})); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">app.listen(4000, () =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> console.log("GraphQL server running at http://localhost:4000."); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">保存 index.js 文件，返回到你的 terminal。运行下列命令，启动服务器： </span></p>
<p><span style="color: black; font-family: 宋体; font-size: 12pt;"><strong>node index.js </strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h5>怎样使用 GraphQL API</h5>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">构建客户端前，可以使用 GraphQL 接口来测试你的 API。 </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">访问网址 ： http://localhost:4000/graphql ，并运行下列 mutation query： </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">mutation { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> createContact(firstName: "Jon", lastName: "Snow", email: "jonsnow@thenightswatch.com") { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">} </span></p>
<p style="background: white;">&nbsp;</p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">使用下列 mutation，可以更新 id 为 1 的 contact： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">mutation { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;"> updateContact(id: 1, firstName: "Aegon", lastName: "Targaryen", email: "aegontargaryen@ironthrone.com") </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">} </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">也可以使用下列 mutation 来删除 id 为 1 的 contact： </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">mutation { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;"> deleteContact(id: 1) </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">} </span></p>
<p style="background: white;">&nbsp;</p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">最后，使用如下 query，可以获取数据库中所有 contacts 信息： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">query { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> contacts { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">} </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">使用下面 query，可以获取一个 contact 的信息： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">query { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> contact(id: 1) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">} </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">这里，我们得到的是 id 为 1 的 contact 信息。 </span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h4>基于koa (和express类似)</h4>
<p>&nbsp;</p>
<p>代码看 koa-demo项目 <img src="./images/前端从零开始学习Graphql3.png" alt="" /> 然后yarn npm run dev</p>
<p>github地址： <a href="https://github.com/liuming888/graphql_node_demo.git"><span style="font-family: Consolas; font-size: 7pt;">https://github.com/liuming888/graphql_node_demo.git</span></a><span style="color: #24292e; font-size: 7pt;"><span style="font-family: Consolas;"> koa</span><span style="font-family: 等线;">分支</span></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h5>创建 Project</h5>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">我们现在来创建我们的 project。打开一个新的 terminal，执行以下命令，即可使用缺省值创建 package.json 文件： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">mkdir koa-demo </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">cd koa-demo </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">npm init -y </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">接下来，我们需要安装以下依赖: </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">npm install graphql koa koa-graphql koa-mount sqlite3 --save </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">这样就会安装 koa库，Node.js 上的 GraphQL 实现，koa 和 SQLite3 的 GraphQL 中间件。为简单起见，我们使用 SQLite3 作为数据库。 </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p>graphql&nbsp;是一个支持库，并且在我们这里是一个必要的模块</p>
<p>&nbsp;</p>
<p><span style="color: #33333d; font-family: Lucida Sans Unicode; font-size: 10pt; background-color: #fdfdfd;">Koa 是一个新的 web 框架，由 Express 幕后的原班人马打造， 致力于成为 web 应用和 API 开发领域中的一个更小、更富有表现力、更健壮的基石。 通过利用 async 函数，Koa 帮你丢弃回调函数，并有力地增强错误处理。 Koa 并没有捆绑任何中间件， 而是提供了一套优雅的方法，帮助您快速而愉快地编写服务端应用程序 </span></p>
<p>&nbsp;</p>
<p>koa-graphql GraphQL HTTP服务器中间件</p>
<p>&nbsp;</p>
<p><span style="color: #4a4a4a;"><span style="font-size: 9pt;"><span style="font-family: 微软雅黑; background-color: white;">koa-mount </span><span style="color: #333333; font-family: Helvetica; background-color: white;">让多个Koa.js子应用合并成一个父应用，用请求的前缀区分子应用</span></span> </span></p>
<p>&nbsp;</p>
<p>SQLite是一个进程内的库，实现了自给自足的、无服务器的、零配置的、事务性的 SQL 数据库引擎。它是一个零配置的数据库，这意味着与其他数据库一样，您不需要在系统中配置。就像其他数据库，SQLite 引擎不是一个独立的进程，可以按应用程序需求进行静态或动态连接。SQLite 直接访问其存储文件</p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<h5>创建 GraphQL 服务器</h5>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">创建工程并引入基本依赖包之后，现在来创建 API 服务器。在工程文件夹里，创建 index.js 文件，并引入下列内容： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const Koa = require('koa'); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const mount = require('koa-mount'); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const graphql = require('graphql'); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const graphqlHTTP = require('koa-graphql'); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const sqlite3 = require('sqlite3').verbose(); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const app = new Koa(); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const database = new sqlite3.Database('./my.db'); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const createContactTable = () =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> const query = ` </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> CREATE TABLE IF NOT EXISTS contacts ( </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id integer PRIMARY KEY, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName text, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName text, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email text UNIQUE)`; </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return database.run(query); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}; </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">// 创建了一个 SQL 表来存储 contacts的基本信息。每个 contact 的基本信息包括：唯一的标识、名、姓和 email。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">createContactTable(); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">// 定义一个 GraphQL 类型 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">// 使用基本的内置 GraphQL 类型，如 GraphQLID 和 GraphQLString 来创建我们自定义类型，对应数据库中的 contact。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const ContactType = new graphql.GraphQLObjectType({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> name: 'Contact', </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> fields: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: { type: graphql.GraphQLID }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName: { type: graphql.GraphQLString }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName: { type: graphql.GraphQLString }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email: { type: graphql.GraphQLString }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">// 定义查询类型 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">// 查询有两个字段： contacts，可以用来获取数据库中的所有 contacts，而 contact 则根据 id 获取一个 contact 信息。 contact 字段允许所需的 id 参数为 GraphQLID 类型。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">var queryType = new graphql.GraphQLObjectType({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> name: 'Query', </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> fields: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> contacts: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: graphql.GraphQLList(ContactType), </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, args, context, info) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.all("SELECT * FROM contacts;", function (err, rows) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject([]); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve(rows); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> contact: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: ContactType, // 说明返回数据的类型 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> args: { // 定义期望从客户端得到的参数 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLID) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, { // 实际逻辑发生的地方 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id // resolve()方法的第二个参数访问任何传递的参数 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, context, info) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> // 简单调用 database.all() 和 database.run() 方法来执行正确的 SQL 查询，以便从 SQLite 获取数据，返回一个 Promise 来处理得到的数据。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.all("SELECT * FROM contacts WHERE id = (?);", [id], function (err, rows) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject(null); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve(rows[0]); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">// 创建一个 mutation 类型，用于创建、更新和删除操作 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">var mutationType = new graphql.GraphQLObjectType({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> name: 'Mutation', </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> fields: { // 所有的字段都接受符合 args 属性定义的参数，并由一个 resolve() 方法来获取传递过来的参数，执行相应的 SQL 操作，并返回一个 Promise。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> createContact: { // 创建 contacts </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: ContactType, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> args: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.run('INSERT INTO contacts (firstName, lastName, email) VALUES (?,?,?);', [firstName, lastName, email], (err) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject(null); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.get("SELECT last_insert_rowid() as id", (err, row) =&gt; { </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: row["id"], </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName: firstName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName: lastName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email: email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> updateContact: { // 更新 contacts </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: graphql.GraphQLString, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> args: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLID) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLString) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.run('UPDATE contacts SET firstName = (?), lastName = (?), email = (?) WHERE id = (?);', [firstName, lastName, email, id], (err) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject(err); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve(`Contact #${id} updated`); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> deleteContact: { // 删除 contacts </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: graphql.GraphQLString, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> args: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id: { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> type: new graphql.GraphQLNonNull(graphql.GraphQLID) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve: (root, { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> return new Promise((resolve, reject) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> database.run('DELETE from contacts WHERE id =(?);', [id], (err) =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> if (err) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> reject(err); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> resolve(`Contact #${id} deleted`); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">// 创建 GraphQL schema </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">// GraphQL schema 是 GraphQL 的核心概念，它定义了连接到服务器的客户端可用的功能。我们传递已定义的 query 和 mutation 类型到 schema。 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">const schema = new graphql.GraphQLSchema({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> query: queryType, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> mutation: mutationType </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">app.use( </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> mount( </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> '/graphql', </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> graphqlHTTP({ </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> schema: schema, </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> graphiql: true, //是否开启本地调试模式 </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> }) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> ) </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">app.use(async ctx =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> ctx.body = 'Hello World'; </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">app.listen(3000,() =&gt; { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> console.log("GraphQL server running at http://localhost:3000"); </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">}); </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">保存 index.js 文件，返回到你的 terminal。运行下列命令，启动服务器： </span></p>
<p><span style="color: black; font-family: 宋体; font-size: 12pt;"><strong>node index.js </strong></span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h5>怎样使用 GraphQL API</h5>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">构建客户端前，可以使用 GraphQL 接口来测试你的 API。 </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">访问网址 ： http://localhost:4000/graphql ，并运行下列 mutation query： </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">mutation { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> createContact(firstName: "Jon", lastName: "Snow", email: "jonsnow@thenightswatch.com") { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName, </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">} </span></p>
<p style="background: white;">&nbsp;</p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">使用下列 mutation，可以更新 id 为 1 的 contact： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">mutation { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;"> updateContact(id: 1, firstName: "Aegon", lastName: "Targaryen", email: "aegontargaryen@ironthrone.com") </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">} </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">也可以使用下列 mutation 来删除 id 为 1 的 contact： </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">mutation { </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;"> deleteContact(id: 1) </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">} </span></p>
<p style="background: white;">&nbsp;</p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">最后，使用如下 query，可以获取数据库中所有 contacts 信息： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">query { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> contacts { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">} </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">使用下面 query，可以获取一个 contact 的信息： </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">query { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> contact(id: 1) { </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> id </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> firstName </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> lastName </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> email </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;"> } </span></p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 8pt;">} </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">这里，我们得到的是 id 为 1 的 contact 信息。 </span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2>四 Vue和GraphQL</h2>
<p>参考资料 <a href="https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247491552&amp;idx=2&amp;sn=c31ed6543f1a24b3156bc5075136b44d&amp;chksm=f951aaa3ce2623b51ba46dbff4f737e42b1813f8508b161cfd81f15c9135beb0f98efc35a224&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;key=c8b1cdfc5f2a0a522a7651564f0b2c10fc1b1">使用Vue和GraphQL构建一个CRUD APP</a> （改资料的修改有问题，本文已修复）</p>
<p>&nbsp;</p>
<p>相关代码：<img src="./images/前端从零开始学习Graphql4.png" alt="" /><img src="./images/前端从零开始学习Graphql5.png" alt="" /></p>
<pre><code><code><span style="font-size: 10pt;">node服务： </span><span style="color: blue; font-family: Consolas; font-size: 7pt;"><span style="text-decoration: underline;">https://github.com/liuming888/graphql_node_demo.git</span></span></code></pre>
<pre><code><code><span style="color: #24292e; font-size: 7pt;"><span style="font-family: Consolas;">vue</span><span style="font-family: 宋体;">项目：</span><span style="font-family: Consolas;">
						<a href="https://github.com/liuming888/graphql_vue_demo.git"><span style="color: blue; text-decoration: underline;">https://github.com/liuming888/graphql_vue_demo.git</span></a>
					</span></span>
			</code></pre>
<h3>node服务复用上文进阶中的项目（下面采用koa服务）</h3>
<p>打开koa-demo项目的server.js</p>
<p>增加一下代码</p>
<p>const cors = require('@koa/cors');</p>
<p>...</p>
<p>app.use(cors());</p>
<p>&nbsp;</p>
<p>然后yarn add @koa/cors 再npm run dev</p>
<p>因为我们在两个不同的本地端口之间发送请求，这两个端口被视为两个独立的域，因此我们需要在服务器中启用跨源资源共享功能</p>
<p>&nbsp;</p>
<h3>创建一个 Vue 项目</h3>
<p>使用 Vue CLI，让我们继续创建一个 Vue 项目。回到终端机，执行下列命令：</p>
<p style="text-align: justify; background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">vue create vue-graphql-demo </span></p>
<p style="text-align: justify; background: white;"><span style="font-size: 10pt;">当提示对预置选项进行选择时，你可以简单地选择默认设置。 </span></p>
<p style="text-align: justify; background: white;"><span style="font-size: 10pt;">等待生成项目，运行以下命令启动开发服务器： </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">cd vue-graphql-demo </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">npm run serve </span></p>
<p style="text-align: justify; background: white;"><span style="font-size: 10pt;">这样，你的应用就运行起来了，在 http://localhost:8080/ 地址下可以访问。 </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<h3>安装 Apollo 客户端</h3>
<p style="text-align: justify; background: white;"><span style="font-size: 10pt;">Apollo 是一组实用程序，可以帮助你在 APP 中使用 GraphQL。它以其客户端和服务器而闻名。Apollo 是由 Meteor Development Group开发和维护的：https://www.meteor.io/ </span></p>
<p style="text-align: justify; background: white;"><span style="font-size: 10pt;">打开一个新的终端，进入你的项目文件夹，运行以下命令来安装 Apollo 客户端到你的 Vue 项目中： </span></p>
<p style="background: white;"><span style="color: #4a4a4a; font-family: 微软雅黑; font-size: 9pt;">yarn add vue-apollo graphql apollo-boost </span></p>
<p style="text-align: justify; background: white;"><span style="font-size: 10pt;">Apollo Boost 是一种无需任何手动配置就可以开始使用 Apollo 客户端的方式。它包括一些常见的默认值，比如推荐的 InMemoryCache 和 HttpLink，它们是以推荐的参数为你进行配置的。这种零配置的方式适合快速开发使用。 </span></p>
<p style="text-align: justify; background: white;">&nbsp;</p>
<p style="text-align: justify; background: white;"><span style="font-size: 10pt;">修改src/main.js 文件，代码如下： </span></p>
<p><span style="font-size: 9pt;">import Vue from 'vue'; </span></p>
<p><span style="font-size: 9pt;">import ApolloClient from 'apollo-boost'; </span></p>
<p><span style="font-size: 9pt;">import VueApollo from 'vue-apollo'; </span></p>
<p><span style="font-size: 9pt;">import App from './App.vue'; </span></p>
<p><span style="font-size: 9pt;">import router from './router'; </span></p>
<p><span style="font-size: 9pt;">import store from './store'; </span></p>
<p><span style="font-size: 9pt;">import './registerServiceWorker'; </span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">// 创建 Apollo 客户端的一个实例，并传入 GraphQL 端点的 URL </span></p>
<p><span style="font-size: 9pt;">const apolloClient = new ApolloClient({ </span></p>
<p><span style="font-size: 9pt;"> uri: 'http://localhost:3000/graphql', // graphql服务的地址 （注意服务端开启cors） </span></p>
<p><span style="font-size: 9pt;">}); </span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">Vue.use(VueApollo); // 使用 VueApollo 插件将 Apollo 集成到我们的 Vue APP 中 </span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">// 创建了 Apollo Provider，它包含所有 Vue 组件都可以使用的 Apollo Client 实例。 </span></p>
<p><span style="font-size: 9pt;">const apolloProvider = new VueApollo({ </span></p>
<p><span style="font-size: 9pt;"> defaultClient: apolloClient, </span></p>
<p><span style="font-size: 9pt;">}); </span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">Vue.config.productionTip = false; </span></p>
<p>&nbsp;</p>
<p><span style="font-size: 9pt;">new Vue({ </span></p>
<p><span style="font-size: 9pt;"> router, </span></p>
<p><span style="font-size: 9pt;"> store, </span></p>
<p><span style="font-size: 9pt;"> render: h =&gt; h(App), </span></p>
<p><span style="font-size: 9pt;"> apolloProvider, // 将 Apollo Provider 添加到 Vue 实例中 </span></p>
<p><span style="font-size: 9pt;">}).$mount('#app'); </span></p>
<p>&nbsp;</p>
<h3>使用 GraphQL API</h3>
<p><span style="color: #333333; font-family: Arial; font-size: 9pt;">将 vue-apollo 添加到 APP 后，所有组件都可以通过 apollo 选项来使用 Apollo </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 9pt;">修改App.vue代码如下： </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">&lt;template&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;div id="app"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;table border='1' </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> width='100%' </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> style='border-collapse: collapse;'&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;tr&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;th&gt;First Name&lt;/th&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;th&gt;Last Name&lt;/th&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;th&gt;Email&lt;/th&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;th&gt;Actions&lt;/th&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/tr&gt; </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;tr v-for='contact in contacts' </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> :key="contact.id"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;td&gt;{{ contact.firstName }}&lt;/td&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;td&gt;{{ contact.lastName }}&lt;/td&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;td&gt;{{ contact.email }}&lt;/td&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;td&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;input type="button" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> @click="selectContact(contact)" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> value="Select"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;input type="button" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> @click="deleteContact(contact.id)" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> value="Delete"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/td&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/tr&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/table&gt; </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/br&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;form&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;label&gt;First Name&lt;/label&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;input type="text" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> name="firstName" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> v-model="firstName"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/br&gt; </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;label&gt;Last Name&lt;/label&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;input type="text" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> name="lastName" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> v-model="lastName"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/br&gt; </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;label&gt;Email&lt;/label&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;input type="email" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> name="email" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> v-model="email"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/br&gt; </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;input v-if="!id" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> type="button" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> @click="createContact(firstName, lastName, email)" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> value="Add"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;input v-if="id" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> type="button" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> @click="updateContact(id, firstName, lastName, email)" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> value="Update"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;input type="button" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> @click="clearForm()" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> value="Clear"&gt; </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/form&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> &lt;/div&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">&lt;/template&gt; </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">&lt;script&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">import gql from "graphql-tag"; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">export default { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> data() { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> // 定义了四个组件变量，分别是 id、firstName、lastName 和 email。这些变量将被绑定到用于创建新联系人的 HTML Form 中 </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> return { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> id: null, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> firstName: "", </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> lastName: "", </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> email: "" </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> apollo: { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">// gql 是一个 JavaScript 模板文字标签，它将 GraphQL 查询字符串解析到标准的 GraphQL AST 中。可以在 Github 上的官方库中找到更多详细信息： </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">// https://github.com/apollographql/graphql-tag </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">// 在这个 apollo 对象中，我们添加了一个 contacts 属性，它将保存 contacts 查询的结果。稍后，我们将使用它在模板中显示联系人。 </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> contacts: gql` </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> query { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> contacts { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> id </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> firstName </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> lastName </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> email </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> ` </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> methods: { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> // 添加 createContact()、updateContact() 和 deleteContact() </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> // 使用 this.$apollo.mutate() 方法向 GraphQL Server 发送 mutation 查询，并调用 location.reload() 方法来重新加载页面。 </span></p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> createContact(firstName, lastName, email) { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> console.log(`Create contact: ${email}`); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.$apollo.mutate({ </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> mutation: gql` </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> mutation createContact( </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> $firstName: String! </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> $lastName: String! </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> $email: String! </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> ) { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> createContact( </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> firstName: $firstName </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> lastName: $lastName </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> email: $email </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> ) { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> id </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> firstName </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> lastName </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> email </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> `, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> variables: { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> firstName: firstName, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> lastName: lastName, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> email: email </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> location.reload(); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> updateContact(id, firstName, lastName, email) { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> console.log( </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> "id, firstName, lastName, email: ", </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> id, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> firstName, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> lastName, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> email </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> ); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> console.log(`Update contact: # ${id}`); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.$apollo.mutate({ </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> mutation: gql` </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> mutation updateContact( </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> $id: ID! </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> $firstName: String! </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> $lastName: String! </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> $email: String! </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> ) { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> updateContact( </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> id: $id </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> firstName: $firstName </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> lastName: $lastName </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> email: $email </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> ) </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> `, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> variables: { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> id: id, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> firstName: firstName, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> lastName: lastName, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> email: email </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> location.reload(); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> deleteContact(id) { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> console.log(`Delete contact: # ${id}`); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.$apollo.mutate({ </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> mutation: gql` </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> mutation deleteContact($id: ID!) { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> deleteContact(id: $id) </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> `, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> variables: { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> id: id </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> location.reload(); </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> selectContact(contact) { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.id = contact.id; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.firstName = contact.firstName; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.lastName = contact.lastName; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.email = contact.email; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> }, </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> clearForm() { </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.id = null; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.firstName = ""; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.lastName = ""; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> this.email = ""; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;"> } </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">}; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">&lt;/script&gt; </span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">&lt;style lang="scss"&gt; </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 8pt;">&lt;/style&gt; </span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>保存后，重新启动vue项目，会看到以下页面：</p>
<p><img src="./images/前端从零开始学习Graphql6.png" alt="" /></p>
<p>&nbsp;</p>
<p>到此，恭喜你已经成功入门graphql了，有兴趣可以自行查询相关资料深入研究</p>
<p>&nbsp;</p>
<h2>五 总结</h2>
<h4>使用GraphQL API的目的是什么？</h4>
<p><span style="color: #333333; font-family: Arial; font-size: 9pt;">创建API的目的是使自己的软件具有可以被其他外部服务集成的能力。即使你的程序被单个前端程序所使用，也可以将此前端视为外部服务，为此，当通过API为两者之间提供通信时，你能够在不同的项目中工作。 </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 9pt;">如果你在一个大型团队中工作，可以将其拆分为创建前端和后端团队，从而允许他们使用相同的技术，并使他们的工作更轻松。 </span></p>
<h5>优点</h5>
<p style="margin-left: 18pt;">优点就是后端可以少招几个写接口的</p>
<p style="margin-left: 18pt;">前后端一起开发，节约工期</p>
<p style="margin-left: 18pt;">较少维护api文档，节省精力（代码即是文档）</p>
<p><span style="font-size: 12pt;">说了这些，其实单对于前端来说，帮助不算特别大 </span></p>
<h5>缺点和难推广的地方</h5>
<p style="margin-left: 36pt;"><span style="font-size: 12pt;">后端或者中间层把gql封装相应业务对接数据库是难点，需要高端人力 </span></p>
<p style="margin-left: 36pt;"><span style="font-size: 12pt;">需要前端多少学一点类sql语句，不过大部分场景可以封装好固定的sql语句 </span></p>
<p style="margin-left: 36pt;"><span style="font-size: 12pt;">封装gql不好会产生sql性能问题，三级嵌套联查还有n+1的老问题又会冒出来，需要持续优化 </span></p>
<p style="margin-left: 36pt;"><span style="font-size: 12pt;">前端排除bug需要一定的后端知识，前后端架构多少了解一些 </span></p>
<p>&nbsp;</p>
<h4>GraphQL比REST更好吗？</h4>
<p><span style="color: #333333; font-family: Arial; font-size: 9pt;">GraphQL是一种适合多种情况的方法。 REST是一种体系结构方法。如今，有大量的文章可以解释为什么一个比另一个好，或者为什么你应该只使用REST而不是GraphQL。另外你可以通过多种方式在内部使用GraphQL，并将API的端点维护为基于REST的架构。 </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 9pt;">你应该做的是了解每种方法的好处，分析自己正在创建的解决方案，评估你的团队使用解决方案的舒适程度，并评估你是否能够指导你的团队快速掌握这些技术。 </span></p>
<p><span style="color: #333333; font-family: Arial; font-size: 9pt;">本文更偏重于实用指南，而不是GraphQL和REST的主观比较。如果你想查看这两者的详细比较，我建议你查看另一篇文章，<a href="https://mp.weixin.qq.com/s?__biz=MzI3NzIzMDY0NA==&amp;mid=2247486398&amp;idx=1&amp;sn=14e046403e8f31a984ca95f3b06efbd6&amp;chksm=eb682ee5dc1fa7f3097f699b27148865b3b40021bb6847cc2f8ee0118c6e642480bd65f8b6f4&amp;token=813345898&amp;lang=zh_CN&amp;scene=21" target="https://cloud.tencent.com/developer/article/_blank"><span style="color: #00a4ff;">为什么GraphQL是API的未来</span></a>。</span></p>
<p>&nbsp;</p>
<h2>参考资料</h2>
<p><a href="https://graphql.cn/">graphql官网</a></p>
<p><a href="https://juejin.im/post/5c3d54096fb9a049c04346db ">2019 GraphQL学习指南</a>&nbsp;&nbsp;&nbsp;&nbsp;</p>
<p><a href="https://juejin.im/post/5c015a5af265da612577d89a">使用 NodeJS 创建一个 GraphQL 服务器</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247491385&amp;idx=2&amp;sn=91ea5a1cadb5ba60b91b0c7f6a3eb931&amp;chksm=f951aa7ace26236c89f6f7db5b9e362d6f90c03ce34f77c2b79bfe97f41d48b50f0644e81e12&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;key=333b7957c9b83671735d64576a2ff98cb0d7a">用Node创建GraphQL API：代码量少，性能高</a></p>
<p><a href="https://cloud.tencent.com/developer/article/1426390 ">用Node.js创建安全的 GraphQL API[每日前端夜话0x61]</a></p>
<p><a href="https://www.cnblogs.com/Wayou/p/koa_graphql_example.html ">Koa + GraphQL 示例</a></p>
<p><a href="https://segmentfault.com/a/1190000017766370">GraphQL 入门详解</a></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzUxMzcxMzE5Ng==&amp;mid=2247491552&amp;idx=2&amp;sn=c31ed6543f1a24b3156bc5075136b44d&amp;chksm=f951aaa3ce2623b51ba46dbff4f737e42b1813f8508b161cfd81f15c9135beb0f98efc35a224&amp;mpshare=1&amp;scene=1&amp;srcid=&amp;key=c8b1cdfc5f2a0a522a7651564f0b2c10fc1b1">使用Vue和GraphQL构建一个CRUD APP</a></p>
<p style="margin-left: 21pt;">&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>