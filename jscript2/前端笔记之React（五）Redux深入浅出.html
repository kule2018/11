<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修前端笔记之React（五）Redux深入浅出' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>前端笔记之React（五）Redux深入浅出</center></div><div class='banquan'>原文出处:本文由博客园博主RopeHuo提供。<br/>
原文连接:https://www.cnblogs.com/rope/p/10741396.html</div><br>
    <h1>一、<strong>Redux<span style="font-family: 宋体;">整体感知</span></strong></h1>
<p>Redux<span style="font-family: 宋体;">是</span><span style="font-family: Consolas;">JavaScript</span><span style="font-family: 宋体;">状态管理容器，提供了可被预测状态的状态管理容器。来自于</span><span style="font-family: Consolas;">Flux</span><span style="font-family: 宋体;">思想，</span><span style="font-family: Consolas;">Facebook</span><span style="font-family: 宋体;">基于</span><span style="font-family: Consolas;">Flux</span><span style="font-family: 宋体;">思想，在</span><span style="font-family: Consolas;">2015</span><span style="font-family: 宋体;">年推出</span><span style="font-family: Consolas;">Redux</span><span style="font-family: 宋体;">库。</span></p>
<p>中文网站：<a href="http://www.redux.org.cn/"><span style="text-decoration: underline;">http://www.redux.org.cn/</span></a></p>
<p><span style="font-family: 宋体;">官方</span>git<span style="font-family: 宋体;">：</span><a href="https://github.com/reduxjs/redux"><span style="text-decoration: underline;">https://github.com/reduxjs/redux</span></a></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">首先要引</span>redux.js<span style="font-family: 宋体;">包，这个包提供了</span><span style="font-family: Consolas;">Redux</span><span style="font-family: 宋体;">对象，这个对象可以调用</span><span style="font-family: Consolas;">Redux.createStore()</span><span style="font-family: 宋体;">方法。</span></p>
<div class="cnblogs_code">
<pre><code>&lt;body&gt;
    &lt;h1 id="info"&gt;&lt;/h1&gt;
    &lt;button id="btn1"&gt;加&lt;/button&gt;
    &lt;button id="btn2"&gt;减&lt;/button&gt;
    &lt;button id="btn3"&gt;乘&lt;/button&gt;
    &lt;button id="btn4"&gt;除&lt;/button&gt;

    &lt;script type="text/javascript" src="redux.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        <span style="color: #008000;">//</span><span style="color: #008000;">这是一个 reducer，形式为 (state, action) =&gt; state 的纯函数。</span>
        <span style="color: #008000;">//</span><span style="color: #008000;">纯函数：函数内部，不改变传入的参数，只return新值。</span>
        <span style="color: #008000;">//</span><span style="color: #008000;">描述了 action 如何把 state 转变成下一个 state。</span>
        <span style="color: #0000ff;">const reducer = (state = {"v" : 10} , action)=&gt;{
            if(action.type == "ADD"){
                <span style="color: #ff0000;">return {"v" : state.v + 1};</span>
            }else if(action.type == "MINUS"){
                <span style="color: #ff0000;">return {"v" : state.v - 1};</span>
            }else if(action.type == "CHENG2"){
                <span style="color: #ff0000;">return {"v" : state.v * 2}</span>
            }
             </span><span style="color: #ff0000;">return</span><span style="color: #000000;"><span style="color: #ff0000;"> state;</span>
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;">创建 Redux store 来存放应用的状态。</span>
        <span style="color: #008000;">//</span><span style="color: #008000;">store翻译为&ldquo;仓库&rdquo;，这是一个存放数据并且可以操作数据的东西</span>
       <span style="color: #ff0000;"> const store = Redux.createStore(reducer);

        </span><span style="color: #008000;">//</span><span style="color: #008000;">创建一个视图函数，并且将store显示到视图上。</span>
        <span style="color: #0000ff;">const render = ()=&gt;{
            //store的getState()方法可以得到仓库中的数据
            <span style="color: #ff0000;">document.getElementById("info").innerHTML =</span></span><span style="color: #000000;"><span style="color: #0000ff;"><span style="color: #ff0000;"> store.getState().v;</span>
        }</span>
       <span style="color: #ff0000;"> render(); </span></span><span style="color: #008000;">//</span><span style="color: #008000;">调用render函数</span>
        <span style="color: #008000;">//</span><span style="color: #008000;">要将store注册到视图，这样的话，当store中的数据变化候，就能自动调用render函数</span>
<span style="color: #ff0000;">        store.subscribe(render);

        </span><span style="color: #008000;">//</span><span style="color: #008000;"> 应用中所有的 state 都以一个对象树的形式储存在一个单一的 store 中。</span>
        <span style="color: #008000;">//</span><span style="color: #008000;"> 惟一改变state的办法是触发action，一个描述发生什么的对象。</span>
        <span style="color: #008000;">//</span><span style="color: #008000;"> 为了描述 action 如何改变 state 树，你需要编写 reducers。</span>
        <span style="color: #0000ff;">document.getElementById("btn1").onclick = function(){
            // 改变内部 state 惟一方法是 dispatch 一个 action，type表示要做的动作
            <span style="color: #ff0000;">store.dispatch({"type":"ADD"</span></span><span style="color: #000000;"><span style="color: #0000ff;"><span style="color: #ff0000;">})</span>
        }</span>
        document.getElementById(</span>"btn2").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
            store.dispatch({</span>"type":"MINUS"<span style="color: #000000;">})
        }
        document.getElementById(</span>"btn3").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
            store.dispatch({</span>"type":"CHENG"<span style="color: #000000;">})
        }
    </span>&lt;/script&gt;
&lt;/body&gt;</pre>
</div>
<p><span style="font-family: 宋体;">创建一个叫做</span>reducer<span style="font-family: 宋体;">的函数，</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">中&ldquo;维持&rdquo;一个量，叫</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">，初始值是</span><span style="font-family: Consolas;">{"v" : 0}</span><span style="font-family: 宋体;">。</span></p>
<p>&nbsp;</p>
<p><strong>这个函数你必须知道两点：</strong></p>
<p><strong>1<span style="font-family: 宋体;">）它是一个纯函数，在函数内部不改变</span><span style="font-family: Consolas;">{"v" : 0}</span><span style="font-family: 宋体;">的，不改变</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">对象的，只是返回了新的</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">。</span></strong></p>
<div class="cnblogs_code">
<pre><code>const reducer = (state = {"v" : 0} , action)=&gt;<span style="color: #000000;">{
    </span><span style="color: #0000ff;">if</span>(action.type == "ADD"<span style="color: #000000;">){
        </span><span style="color: #ff0000;">return {"v" : state.v + 1</span><span style="color: #000000;"><span style="color: #ff0000;">};</span>
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "MINUS"<span style="color: #000000;">){
        </span><span style="color: #ff0000;">return {"v" : state.v - 1</span><span style="color: #000000;"><span style="color: #ff0000;">};</span>
    }
    </span><span style="color: #ff0000;">return</span><span style="color: #000000;"><span style="color: #ff0000;"> state;</span>
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>2<span style="font-family: 宋体;">）这个函数提供了可被预测的功能。</span></strong></p>
<p>reducer<span style="font-family: 宋体;">中的</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">，就像被关进了保险箱。任何对这个</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">的变化，</span><span style="color: #ff0000;"><strong><span style="text-decoration: underline;"><span style="font-family: 宋体;">只能是通过</span>dispatch<span style="font-family: 宋体;">一个</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">来改变的</span></span></strong></span>。换句话说，<span style="color: #ff0000;"><strong><span style="text-decoration: underline;"><span style="font-family: 宋体;">只有</span>dispatch<span style="font-family: 宋体;">一个</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">才能改变这个保险箱中的数据</span></span></strong>。</span></p>
<p><span style="font-family: 宋体;">在</span>reducer<span style="font-family: 宋体;">函数中，用</span><span style="font-family: Consolas;">if</span><span style="font-family: 宋体;">语句来表示对</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">可能发生变化的罗列，只有罗列在楼层里面的改变，才会发生：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('702bd951-603f-4d5f-bf83-ca8dbcab53d0')"><img id="code_img_closed_702bd951-603f-4d5f-bf83-ca8dbcab53d0" class="code_img_closed" src="./images/前端笔记之React（五）Redux深入浅出0.png" alt="" /><img id="code_img_opened_702bd951-603f-4d5f-bf83-ca8dbcab53d0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('702bd951-603f-4d5f-bf83-ca8dbcab53d0',event)" src="./images/前端笔记之React（五）Redux深入浅出1.png" alt="" />
<div id="cnblogs_code_open_702bd951-603f-4d5f-bf83-ca8dbcab53d0" class="cnblogs_code_hide">
<pre><code><span style="color: #0000ff;">if</span>(action.type==""<span style="color: #000000;">){
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> 新的state
}</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type ==""<span style="color: #000000;">){
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> 新的state
}</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type ==""<span style="color: #000000;">){
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> 新的state
}</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p><span style="font-family: 宋体;">创建</span>store<span style="font-family: 宋体;">仓库，这个仓库创建时需要提供</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">，所以可以认为</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">就是</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">，</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">就是</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">。</span></p>
<div class="cnblogs_code">
<pre><code>const store = Redux.createStore(reducer);</pre>
</div>
<p>reducer<span style="font-family: 宋体;">是一个纯函数，而</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">提供了三个方法：</span></p>
<p class="16">&nbsp;store.subscribe() 注册到视图</p>
<p class="16">&nbsp;store.getState() 得到数据</p>
<p class="16">&nbsp;store.dispatch() <span style="font-family: 宋体;">发送</span>action</p>
<p class="16">&nbsp;</p>
<p><span style="font-family: 宋体;">学习</span>redux<span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">react</span><span style="font-family: 宋体;">结合，到时候就不用注册到视图。</span></p>
<p>然后创建监听：</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('9167f657-943a-4d61-ae2e-05edce83efc6')"><img id="code_img_closed_9167f657-943a-4d61-ae2e-05edce83efc6" class="code_img_closed" src="./images/前端笔记之React（五）Redux深入浅出0.png" alt="" /><img id="code_img_opened_9167f657-943a-4d61-ae2e-05edce83efc6" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('9167f657-943a-4d61-ae2e-05edce83efc6',event)" src="./images/前端笔记之React（五）Redux深入浅出1.png" alt="" />
<div id="cnblogs_code_open_9167f657-943a-4d61-ae2e-05edce83efc6" class="cnblogs_code_hide">
<pre><code>document.getElementById("btn1").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
     store.dispatch({</span>"type":"ADD"<span style="color: #000000;">})
}
document.getElementById(</span>"btn2").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
     store.dispatch({</span>"type":"MINUS"<span style="color: #000000;">})
}
document.getElementById(</span>"btn3").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
     store.dispatch({</span>"type":"CHENG"<span style="color: #000000;">})
}</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p><span style="font-family: 宋体;">点击按钮，</span>store<span style="font-family: 宋体;">要</span><span style="font-family: Consolas;">dispatch</span><span style="font-family: 宋体;">出一个</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">。所谓的</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">就是一个</span><span style="font-family: Consolas;">JSON</span><span style="font-family: 宋体;">，这个</span><span style="font-family: Consolas;">JSON</span><span style="font-family: 宋体;">必须有</span><span style="font-family: Consolas;">type</span><span style="font-family: 宋体;">属性，值为大写字母。这个</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">没有任何意义，比如</span><span style="font-family: Consolas;">{"type":"ADD"}</span><span style="font-family: 宋体;">，但</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">认识这个</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">，可以产生变化！</span></p>
<p>&nbsp;</p>
<p><strong><span style="font-family: 宋体;">案例</span>2<span style="font-family: 宋体;">，添加载荷：</span></strong></p>
<div class="cnblogs_code">
<pre><code>&lt;body&gt;
    &lt;h1 id="info"&gt;&lt;/h1&gt;
    &lt;button id="btn1"&gt;加&lt;/button&gt;

    &lt;input type="text" id="txt"&gt;
&lt;button id="btn2"&gt;加输入的&lt;/button&gt;

    &lt;script type="text/javascript" src="redux.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;<span style="color: #000000;">
        const reducer </span>= (state = {"v" : 10}, <span style="color: #ff0000;">{type, data}</span>)=&gt;<span style="color: #000000;">{
            </span><span style="color: #ff0000;">if(type == "ADD"){
            </span><span style="text-decoration: line-through;"><span style="color: #0000ff; text-decoration: line-through;">return</span> {"v" : state.v +<span style="color: #000000; text-decoration: line-through;"> action.data}
　　　　　　　　　　</span></span><span style="color: #ff0000;">return {"v" : state.v + data}
            }
            return</span><span style="color: #000000;"><span style="color: #ff0000;"> state;</span>
        }
        const store </span>=<span style="color: #000000;"> Redux.createStore(reducer);
        const render </span>= ()=&gt;<span style="color: #000000;">{
            document.getElementById(</span>"info").innerHTML =<span style="color: #000000;"> store.getState().v;
        }
        render();
        store.subscribe(render);

    document.getElementById(</span>"btn1").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
        store.dispatch({ type: </span>'ADD', data:100<span style="color: #000000;">});
    }

        document.getElementById(</span>"btn2").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
            </span><span style="color: #ff0000;">var a = parseInt(document.getElementById("txt").value);
            </span><span style="color: #008000;">//</span><span style="color: #008000;">载荷payload。</span>
           <span style="color: #ff0000;"> store.dispatch({"type":"ADD"</span><span style="color: #000000;"><span style="color: #ff0000;"> , data:a});</span>
        }
    </span>&lt;/script&gt;
&lt;/body&gt;</pre>
</div>
<p><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">唯一可以改变</span>state<span style="font-family: 宋体;">的方式</span><span style="font-family: Consolas;">dispatch</span><span style="font-family: 宋体;">一个</span><span style="font-family: Consolas;">action</span></strong></span></p>
<p>&nbsp;</p>
<p><strong><span style="font-family: 宋体;">案例</span>3<span style="font-family: 宋体;">：添加数组</span></strong></p>
<div class="cnblogs_code">
<pre><code>&lt;body&gt;
    &lt;div id="box"&gt;
        &lt;p&gt;&lt;input type="text" id="name"&gt;&lt;/p&gt;
        &lt;p&gt;&lt;input type="text" id="age"&gt;&lt;/p&gt;
        &lt;button id="btn"&gt;增加&lt;/button&gt;
        &lt;ul id="List"&gt;

        &lt;/ul&gt;
    &lt;/div&gt;

    &lt;script type="text/javascript" src="redux.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        <span style="color: #008000;">//</span><span style="color: #008000;">初始数据</span>
        const initObj =<span style="color: #000000;"> {
            </span>"arr"<span style="color: #000000;"> : [
                {</span>"name" : "小明" , "age" : 12<span style="color: #000000;">},
                {</span>"name" : "小红" , "age" : 13<span style="color: #000000;">},
                {</span>"name" : "小强" , "age" : 14<span style="color: #000000;">}
            ]
        };
        </span><span style="color: #008000;">//</span><span style="color: #008000;">reducer函数</span>
        const reducer = (<span style="color: #ff0000;">state = initObj, {type , name , age}</span>) =&gt;<span style="color: #000000;"> {
            </span><span style="color: #0000ff;">if</span>(type == "ADD_STUDENT"<span style="color: #000000;">){
                </span><span style="color: #008000;">//</span><span style="color: #008000;">不能push改变传入的原数组，所以要返回新数组</span>
                <span style="color: #ff0000;">return {
                    "arr"</span><span style="color: #000000;"><span style="color: #ff0000;"> : [
                        {name , age} ,
                        ...state.arr
                    ]
                }</span>
            }
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;">创建store</span>
        const store =<span style="color: #000000;"> Redux.createStore(reducer);
        </span><span style="color: #008000;">//</span><span style="color: #008000;">视图函数</span>
        const render = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
            </span><span style="color: #008000;">//</span><span style="color: #008000;">清空ul</span>
            document.getElementById("List").innerHTML = ""<span style="color: #000000;">;
            </span><span style="color: #008000;">//</span><span style="color: #008000;">创建li</span>
            <span style="color: #0000ff;">for</span>(<span style="color: #0000ff;">var</span> i = 0 ; i &lt; store.getState().arr.length ; i++<span style="color: #000000;">){
                </span><span style="color: #0000ff;">var</span> li = document.createElement("li"<span style="color: #000000;">);
            </span><span style="color: #0000ff;">var</span> storeArr =<span style="color: #000000;"> store.getState().arr[i]
                li.innerHTML </span>= storeArr.name + storeArr.age+"岁"<span style="color: #000000;">
                document.getElementById(</span>"List"<span style="color: #000000;">).appendChild(li);
            }
        }
        render();</span><span style="color: #008000;">//</span><span style="color: #008000;">运行视图函数</span>
        store.subscribe(render);<span style="color: #008000;">//</span><span style="color: #008000;">注册到视图</span>
<span style="color: #000000;">        
        document.getElementById(</span>"btn").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
            </span><span style="color: #0000ff;">var</span> name = document.getElementById("name"<span style="color: #000000;">).value;
            </span><span style="color: #0000ff;">var</span> age = document.getElementById("age"<span style="color: #000000;">).value;
            </span><span style="color: #008000;">//</span><span style="color: #008000;">发出Action，这是唯一能够改变store的途径</span>
           <span style="color: #ff0000;"> store.dispatch({"type" : "ADD_STUDENT"</span><span style="color: #000000;"><span style="color: #ff0000;">, name, age })</span>
        }
    </span>&lt;/script&gt;
&lt;/body&gt;</pre>
</div>
<p>&nbsp;</p>
<p><strong><span style="font-family: 宋体;">案例</span>4<span style="font-family: 宋体;">，加深练习：</span></strong></p>
<div class="cnblogs_code">
<pre><code>&lt;body&gt;
    &lt;h1 id="info"&gt;&lt;/h1&gt;
    &lt;h1 id="info2"&gt;&lt;/h1&gt;
    &lt;button id="btn"&gt;+&lt;/button&gt;

    &lt;script type="text/javascript" src="redux.min.js"&gt;&lt;/script&gt;
    &lt;script type="text/javascript"&gt;
        <span style="color: #0000ff;">var</span> initObj =<span style="color: #000000;"> {
            </span>"a"<span style="color: #000000;"> : {
                </span>"b"<span style="color: #000000;"> : {
                    </span>"c"<span style="color: #000000;"> : {
                        </span>"v" : 10<span style="color: #000000;">
                    }
                },
                </span>"m" : 8<span style="color: #000000;">
            }
        }
        const reducer </span>= (state = initObj , action) =&gt;<span style="color: #000000;"> {
            </span><span style="color: #0000ff;">if</span>(action.type == "ADD"<span style="color: #000000;">){
                </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
                    ...state, 
                    </span>"a"<span style="color: #000000;"> : {
                        ...state.a ,
                        </span>"b"<span style="color: #000000;"> : {
                            ...state.a.b,
                            </span>"c"<span style="color: #000000;"> : {
                                ...state.a.b.c ,
                                </span><span style="color: #ff0000;">"v" : state.a.b.c.v + 1</span><span style="color: #000000;">
                            }
                        }
                    }
                }
            }
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
        }
        const store </span>=<span style="color: #000000;"> Redux.createStore(reducer);
        const render </span>= ()=&gt;<span style="color: #000000;">{
            document.getElementById(</span>"info").innerHTML =<span style="color: #000000;"><span style="color: #ff0000;"> store.getState().a.b.c.v;</span>
            document.getElementById(</span>"info2").innerHTML =<span style="color: #000000;"><span style="color: #ff0000;"> store.getState().a.m;</span>
        }
        render();
        store.subscribe(render);

        document.getElementById(</span>"btn").onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(){
           <span style="color: #ff0000;"> store.dispatch({</span></span><span style="color: #ff0000;">"type" : "ADD"</span><span style="color: #000000;"><span style="color: #ff0000;">});</span>
        }
    </span>&lt;/script&gt;
&lt;/body&gt;</pre>
</div>
<hr />
<h1><strong><span style="font-family: 宋体;">二、</span>Redux<span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">React</span><span style="font-family: 宋体;">进行结合开发</span></strong></h1>
<p><span style="font-family: 宋体;">在</span>React<span style="font-family: 宋体;">开发的时候使用</span><span style="font-family: Consolas;">Redux</span><span style="font-family: 宋体;">可预测状态容器，要装两个新的依赖：</span></p>
<p>&nbsp;redux<span style="font-family: 宋体;">：提供</span><span style="font-family: Consolas;">createStore</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">combineReducers</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">bindActionCreators</span><span style="font-family: 宋体;">等功能</span></p>
<p>&nbsp;react-redux<span style="font-family: 宋体;">：只提供两个东西，</span><span style="font-family: Consolas;">&lt;Provider&gt;</span><span style="font-family: 宋体;">组件、</span><span style="font-family: Consolas;">connect()</span><span style="font-family: 宋体;">函数。</span></p>
<p>&nbsp;</p>
<p>安装两个依赖：</p>
<div class="cnblogs_code">
<pre><code>npm install --save <span style="color: #ff0000;">redux react-redux</span></pre>
</div>
<p>&nbsp;</p>
<p><strong><span style="font-family: 宋体;">创建</span>reducers<span style="font-family: 宋体;">文件夹，创建</span><span style="font-family: Consolas;">index.js</span><span style="font-family: 宋体;">，这个文件暴露一个纯函数：</span></strong></p>
<p><strong>reducers/index.js<span style="font-family: 宋体;">：</span></strong></p>
<div class="cnblogs_code">
<pre><code>export <span style="color: #0000ff;">default</span> (state = { v : 10}, action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p>&nbsp;</p>
<p>main.js<span style="font-family: 宋体;">入口文件：</span></p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import ReactDOM from </span>"react-dom"<span style="color: #000000;">;
<span style="color: #ff0000;">import {createStore} from </span></span><span style="color: #ff0000;">"redux"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
import App from </span>"./App.js"<span style="color: #000000;">;
<span style="color: #ff0000;">import reducer from </span></span><span style="color: #ff0000;">"./reducers";  //reducer函数</span>

<span style="color: #008000;">//</span><span style="color: #008000;">创建 Redux store 来存放应用的状态。</span>
<span style="color: #ff0000;">const store =</span><span style="color: #000000;"><span style="color: #ff0000;"> createStore(reducer);</span>

ReactDOM.render(
    </span>&lt;App&gt;&lt;/App&gt;,
    document.getElementById("app"<span style="color: #000000;">)
);</span></pre>
</div>
<p class="16">有两个问题：</p>
<p class="16"><span style="font-family: 宋体;">如何让组件能够访问到</span>store<span style="font-family: 宋体;">中的数据？</span></p>
<p class="16"><span style="font-family: 宋体;">如果让</span>store<span style="font-family: 宋体;">中的数据改变的时候，能够自动更新组件的视图</span></p>
<p>&nbsp;</p>
<p>react-redux<span style="font-family: 宋体;">解决了这两个问题。</span></p>
<p><span style="font-family: 宋体;">在</span>main.js<span style="font-family: 宋体;">中创建</span><span style="font-family: Consolas;">&lt;Provider&gt;</span><span style="font-family: 宋体;">组件，它提供的是一个顶层容器的作用，实现</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">的上下文传递，是让</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">能够&ldquo;注入&rdquo;到所有组件</span></p>
<p>react-redux<span style="font-family: 宋体;">提供</span><span style="font-family: Consolas;">Provider</span><span style="font-family: 宋体;">组件，可以让容器组件拿到</span><span style="font-family: Consolas;">state</span></p>
<p>Provider<span style="font-family: 宋体;">在根组件外面包一层，这样一来，</span><span style="font-family: Consolas;">App</span><span style="font-family: 宋体;">所有的子组件就默认都拿到了</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">了。</span></p>
<p><span style="font-family: 宋体;">原理是</span>React<span style="font-family: 宋体;">组件的</span><span style="font-family: Consolas;">context</span><span style="font-family: 宋体;">属性，就是将</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">这个对象放到上下文（</span><span style="font-family: Consolas;">context</span><span style="font-family: 宋体;">）中</span></p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import ReactDOM from </span>"react-dom"<span style="color: #000000;">;
import {createStore} from </span>"redux"<span style="color: #000000;">;
<span style="color: #ff0000;">import {Provider} from </span></span><span style="color: #ff0000;">"react-redux"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
import App from </span>"./App.js"<span style="color: #000000;">;
import reducer from </span>"./reducers"<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">创建store仓库</span>
const store =<span style="color: #000000;"> createStore(reducer);

ReactDOM.render(
    </span><span style="color: #ff0000;">&lt;Provider store={store}&gt;</span>
        &lt;App&gt;&lt;/App&gt;
<span style="color: #ff0000;">    &lt;/Provider&gt;,</span>
    document.getElementById('app'<span style="color: #000000;">)
);</span></pre>
</div>
<p align="justify"><span style="font-family: 宋体;">组件中要获得全局</span>store<span style="font-family: 宋体;">的值，需要用</span><span style="font-family: Consolas;">connect</span><span style="font-family: 宋体;">函数，</span>connect<span style="font-family: 宋体;">提供连接</span><span style="font-family: Consolas;">React</span><span style="font-family: 宋体;">组件与</span><span style="font-family: Consolas;">Redux store</span><span style="font-family: 宋体;">的作用。</span></p>
<div class="cnblogs_code">
<pre><code>connect([mapStateToProps], [mapDispatchToProps])</pre>
</div>
<p align="justify"><strong>connect()<span style="font-family: 宋体;">的第一个参数：</span></strong><span style="color: #ff0000;"><strong>mapStateToProps<span style="font-family: 宋体;">这个函数的第一个参数就是</span><span style="font-family: Consolas;">Redux</span><span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">，会自动将</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">的数据作为</span><span style="font-family: Consolas;">props</span><span style="font-family: 宋体;">绑定到组件上。</span></strong></span></p>
<p align="justify"><strong>connect()<span style="font-family: 宋体;">的第二个参数：</span></strong><span style="color: #ff0000;"><strong>mapDispatchToProps<span style="font-family: 宋体;">它的功能是，将</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">作为</span><span style="font-family: Consolas;">props</span><span style="font-family: 宋体;">绑定到组件上</span></strong></span></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">通俗理解，使用</span>connect<span style="font-family: 宋体;">可以把</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">dispatch</span><span style="font-family: 宋体;">绑定到</span><span style="font-family: Consolas;">React</span><span style="font-family: 宋体;">组件，使得组件可以访问到</span><span style="font-family: Consolas;">redux</span><span style="font-family: 宋体;">的数据。</span></p>
<p>常看到下面这种写法：</p>
<div class="cnblogs_code">
<pre><code>export <span style="color: #0000ff;">default</span> connect()(App)</pre>
</div>
<p align="justify">App.js</p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
<span style="color: #ff0000;">import {connect} from </span></span><span style="color: #ff0000;">"react-redux"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
class App extends React.Component {
    constructor() {
        super();
     
    }
    render(){
        </span><span style="color: #0000ff;">return</span> &lt;div&gt;
            &lt;h1&gt;<span style="color: #ff0000;">{this.props.v}</span>&lt;/h1&gt;
        &lt;/div&gt;
<span style="color: #000000;">    }
}
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
</span><span style="color: #008000;">//</span><span style="color: #008000;">这个函数return的对象的值，将自动成为组件的props。</span>
    <span style="color: #ff0000;">(state) =&gt; {
        return</span><span style="color: #000000;"><span style="color: #ff0000;"> {
            v : state.v
        }
    }</span>
)(App);</span></pre>
</div>
<p><span style="font-family: 宋体;">一旦</span>connect()(App); <span style="font-family: 宋体;">连接某个组件，此时这个组件就会：</span><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">当全局</span>store<span style="font-family: 宋体;">发送改变时，如同自己的</span><span style="font-family: Consolas;">props</span><span style="font-family: 宋体;">发生改变一样，从而进行视图更新。</span></strong></span></p>
<p><strong>&nbsp;</strong></p>
<p><strong><span style="font-family: 宋体;">在</span>App.js<span style="font-family: 宋体;">写两个按钮，可以加</span><span style="font-family: Consolas;">1</span><span style="font-family: 宋体;">，减</span><span style="font-family: Consolas;">1</span><span style="font-family: 宋体;">：</span></strong></p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import {connect} from </span>"react-redux"<span style="color: #000000;">;
class App extends React.Component {
    constructor() {
        super();
    }
    render(){
        </span><span style="color: #0000ff;">return</span> &lt;div&gt;
            &lt;h1&gt;{<span style="color: #0000ff;">this</span>.props.v}&lt;/h1&gt;
            &lt;button <span style="color: #ff0000;">onClick={()=&gt;{this.props.add()}}</span>&gt;+&lt;/button&gt;
            &lt;button <span style="color: #ff0000;">onClick={()=&gt;{this.props.minus()}}</span>&gt;-&lt;/button&gt;
        &lt;/div&gt;
<span style="color: #000000;">    }
}
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    (state) </span>=&gt;<span style="color: #000000;"> {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            v : state.v
        }
    },
    <span style="color: #ff0000;">(dispatch) </span></span><span style="color: #ff0000;">=&gt; {
        return {
            add(){
                dispatch({"type" : "ADD"});
            },
            minus(){
                dispatch({"type" : "MINUS"</span><span style="color: #000000;"><span style="color: #ff0000;">});
            }
        }
    }</span>
)(App);</span></pre>
</div>
<p><strong>reducers/index.js<span style="font-family: 宋体;">提供可预测状态</span></strong></p>
<div class="cnblogs_code">
<pre><code>export <span style="color: #0000ff;">default</span> (state = {"v" : 10} , action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #ff0000;">if(action.type == "ADD"){
        return { "v" : state.v + 1 };
    }else if(action.type == "MINUS"){
        return { "v" : state.v - 1 };
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p align="justify">&nbsp;</p>
<p align="justify"><strong>学生管理系统小案例：</strong></p>
<p align="justify"><strong>reducers/index.js</strong></p>
<div class="cnblogs_code">
<pre><code>const initObj =<span style="color: #000000;"> {
    </span>"arr"<span style="color: #000000;"> : [
        {</span>"id" : 1, "name" : "小明" , "age" : 12<span style="color: #000000;">},
        {</span>"id" : 2, "name" : "小红" , "age" : 13<span style="color: #000000;">},
        {</span>"id" : 3, "name" : "小刚" , "age" : 14<span style="color: #000000;">}　　
    ]
}
export </span><span style="color: #0000ff;">default</span> (state =<span style="color: #ff0000;"> initObj, {type, age, name, id})</span>=&gt;<span style="color: #000000;">{
    </span><span style="color: #0000ff;">if</span>(type == "ADD_STUDENT"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
           <span style="color: #ff0000;"> ...state ,</span> 
            </span>"arr"<span style="color: #000000;"> : [
                <span style="color: #ff0000;">...state.arr ,</span>
                {
                    </span><span style="color: #ff0000;">"id" : state.arr.reduce((a,b)=&gt;{
                        return b.id &gt; a ? b.id : a;
                    },0) + 1</span><span style="color: #000000;"><span style="color: #ff0000;">,
                    name, 
                    age</span>
                }
            ]
        }
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(type == "DEL_STUDENT"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            <span style="color: #ff0000;">...state,
            </span></span><span style="color: #ff0000;">"arr" : state.arr.filter(item=&gt;item.id !=</span><span style="color: #000000;"><span style="color: #ff0000;"> id)</span>
        }
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p align="justify">&nbsp;</p>
<p align="justify"><strong>App.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import <span style="color: #ff0000;">{connect}</span> from </span>"react-redux"<span style="color: #000000;">;
class App extends React.Component {
    constructor() {
        super();
    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;">增加学生</span>
<span style="color: #0000ff;">    add(){
       <span style="color: #ff0000;"> var name = this.refs.name.value;
        var age = this.refs.age.value;
        this</span></span><span style="color: #000000;"><span style="color: #0000ff;"><span style="color: #ff0000;">.props.addStudent(name, age)</span>
    }</span>
    render(){
        </span><span style="color: #0000ff;">return</span> &lt;div&gt;
            &lt;p&gt;&lt;input type="text" <span style="color: #ff0000;">ref="name"</span>/&gt;&lt;/p&gt;
            &lt;p&gt;&lt;input type="text" <span style="color: #ff0000;">ref="age"</span>/&gt;&lt;/p&gt;
            &lt;button <span style="color: #0000ff;">onClick={()=&gt;{<span style="color: #ff0000;">this.add()</span>}}</span>&gt;增加学生&lt;/button&gt;
<span style="color: #000000;">            {
                </span><span style="color: #0000ff;">this.props.arr.map((item,index)=&gt;{
                    </span><span style="color: #0000ff;">return</span> &lt;p <span style="color: #ff0000;">key={item.id}</span>&gt;<span style="color: #000000;"><span style="color: #ff0000;">
                        {item.id} {item.name} {item.age}</span>岁
                        </span>&lt;button <span style="color: #0000ff;">onClick={()=&gt;{<span style="color: #ff0000;">this.props.delStudent(item.id)</span>}}</span>&gt;删除&lt;/button&gt;
                    &lt;/p&gt;
<span style="color: #000000;"><span style="color: #0000ff;">                })</span>
            }
        </span>&lt;/div&gt;
<span style="color: #000000;">    }
}
export </span><span style="color: #0000ff;">default</span><span style="color: #0000ff;"> connect(
</span><span style="color: #008000;">//</span><span style="color: #008000;">(state) =&gt; {</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">    return { arr : state.arr }</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">},</span><span style="color: #008000;">
//</span><span style="color: #008000;">简化写法</span>
    <span style="color: #0000ff;">({arr})=&gt;{
        </span><span style="color: #ff0000;">return</span><span style="color: #000000;"><span style="color: #ff0000;"> { arr }
    },</span>
    <span style="color: #0000ff;">(dispatch)</span></span><span style="color: #0000ff;">=&gt;{
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
           <span style="color: #0000ff;"> addStudent(name, age){</span>
                <span style="color: #ff0000;">dispatch({</span></span><span style="color: #ff0000;">"type" : "ADD_STUDENT"</span><span style="color: #000000;"><span style="color: #ff0000;">, name, age})</span>
            },
            <span style="color: #0000ff;">delStudent(id){</span>
               <span style="color: #ff0000;"> dispatch({</span></span><span style="color: #ff0000;">"type" : "DEL_STUDENT"</span><span style="color: #000000;"><span style="color: #ff0000;"> , id})</span>
            <span style="color: #0000ff;">}
        }
    }
)(App);</span></span></pre>
</div>
<p align="justify"><strong>原理解析</strong></p>
<p align="justify"><span style="font-family: 宋体;">首先</span>connect<span style="font-family: 宋体;">之所以会成功，是因为</span><span style="font-family: Consolas;">Provider</span><span style="font-family: 宋体;">组件：</span></p>
<p align="justify"><span style="font-family: 宋体;">在原应用组件上包裹一层，使原来整个应用成为</span>Provider<span style="font-family: 宋体;">的子组件</span></p>
<p align="justify"><span style="font-family: 宋体;">接收</span>Redux<span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">作为</span><span style="font-family: Consolas;">props</span><span style="font-family: 宋体;">，通过</span><span style="font-family: Consolas;">context</span><span style="font-family: 宋体;">对象传递给子孙组件上的</span><span style="font-family: Consolas;">connect</span></p>
<p align="justify">&nbsp;</p>
<p align="justify"><strong>connect<span style="font-family: 宋体;">做了些什么？</span></strong></p>
<p align="justify"><span style="font-family: 宋体;">它真正连接</span> Redux <span style="font-family: 宋体;">和 </span><span style="font-family: Consolas;">React</span><span style="font-family: 宋体;">，它包在我们的容器组件的外一层，它接收</span><span style="font-family: Consolas;">Provider</span><span style="font-family: 宋体;">提供的 </span><span style="font-family: Consolas;">store </span><span style="font-family: 宋体;">里面的</span><span style="font-family: Consolas;">state </span><span style="font-family: 宋体;">和 </span><span style="font-family: Consolas;">dispatch</span><span style="font-family: 宋体;">，传给一个构造函数，返回一个对象，以属性形式传给我们的容器组件。</span></p>
<p align="justify">&nbsp;</p>
<p align="justify"><strong>总结：</strong></p>
<p align="justify">connect()(App)<span style="font-family: 宋体;">，第一个</span><span style="font-family: Consolas;">()</span><span style="font-family: 宋体;">中接受两个参数，分别是：</span><span style="font-family: Consolas;">mapStateToProps</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">mapDispatchToProps</span><span style="font-family: 宋体;">。</span></p>
<p align="justify"><span style="font-family: 宋体;">这两个参数都是函数，第一个参数函数</span>return<span style="font-family: 宋体;">的对象的键名将自动和</span><span style="font-family: Consolas;">props</span><span style="font-family: 宋体;">进行绑定，第二个参数函数</span><span style="font-family: Consolas;">return</span><span style="font-family: 宋体;">的对象的键名，也将和</span><span style="font-family: Consolas;">props</span><span style="font-family: 宋体;">进行绑定。</span></p>
<p align="justify"><span style="font-family: 宋体;">第一个参数</span>return<span style="font-family: 宋体;">的对象，是从</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">中获得值</span></p>
<p align="justify"><span style="font-family: 宋体;">第二个参数</span>return<span style="font-family: 宋体;">的对象，是要改变</span><span style="font-family: Consolas;">state</span><span style="font-family: 宋体;">的值</span></p>
<p align="justify">&nbsp;</p>
<p align="justify"><span style="font-family: 宋体;">如果有兴趣，可以看一下</span>connect<span style="font-family: 宋体;">函数的</span><span style="font-family: Consolas;">API</span><span style="font-family: 宋体;">文档：</span></p>
<p align="justify"><a href="https://github.com/reactjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options"><span style="text-decoration: underline;">https://github.com/reactjs/react-redux/blob/master/docs/api.md#connectmapstatetoprops-mapdispatchtoprops-mergeprops-options</span></a></p>
<p align="justify"><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">不管应用程序有多大，</span>store<span style="font-family: 宋体;">只有一个，它就像天神一样&ldquo;照耀&rdquo;所有组件，但默认情况下所有组件是不能得到</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">的数据的，</span></strong><strong><span style="font-family: 宋体;">哪个组件要拿数据，就要</span>connect<span style="font-family: 宋体;">一下</span></strong><strong><span style="font-family: 宋体;">，另外</span>App<span style="font-family: 宋体;">最大组件确实包裹着所有组件，但不代表</span><span style="font-family: Consolas;">App</span><span style="font-family: 宋体;">组件连接了就代表其他组件也连接了。</span></strong></span></p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;"><img src="./images/前端笔记之React（五）Redux深入浅出4.png" alt="" /></span></p>
<hr />
<h1><strong>三、</strong><strong>Redux<span style="font-family: 宋体;">编程</span><span style="font-family: Consolas;">-TodoList</span></strong></h1>
<p><span style="text-decoration: underline;"><a href="http://www.todolist.cn/">http://www.todolist.cn/</a></span></p>
<p><span style="font-family: 宋体;">在</span>reducers/index.js<span style="font-family: 宋体;">中根据项目情况创建</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">：</span></p>
<div class="cnblogs_code">
<pre><code>const initObj =<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;">: [
       {</span>"id" : 1, "title" : "吃饭",  "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
       {</span>"id" : 2, "title" : "睡觉",  "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
       {</span>"id" : 3, "title" : "打豆豆","done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">}
    ]
}

export </span><span style="color: #0000ff;">default</span> (state = <span style="color: #ff0000;">initObj</span>, action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">分别创建</span>TodoHd.js<span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">TodoBd.js</span><span style="font-family: 宋体;">、</span><span style="font-family: Consolas;">TodoFt.js</span><span style="font-family: 宋体;">三个组件：</span></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('990d9846-a99e-466a-9eb4-dede9c349dbf')"><img id="code_img_closed_990d9846-a99e-466a-9eb4-dede9c349dbf" class="code_img_closed" src="./images/前端笔记之React（五）Redux深入浅出0.png" alt="" /><img id="code_img_opened_990d9846-a99e-466a-9eb4-dede9c349dbf" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('990d9846-a99e-466a-9eb4-dede9c349dbf',event)" src="./images/前端笔记之React（五）Redux深入浅出1.png" alt="" />
<div id="cnblogs_code_open_990d9846-a99e-466a-9eb4-dede9c349dbf" class="cnblogs_code_hide">
<pre><code>import React from "react"<span style="color: #000000;">;
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> class TodoHd extends React.Component {
    constructor() {
        super();
    }

    render() {
        </span><span style="color: #0000ff;">return</span> &lt;div&gt;
            &lt;h1&gt;我是TodoHd组件&lt;/h1&gt;
        &lt;/div&gt;
<span style="color: #000000;">    }
}</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>App.js<span style="font-family: 宋体;">引入组件</span></p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import {connect} from </span>"react-redux"<span style="color: #000000;">;

<span style="color: #ff0000;">import TodoHd from </span></span><span style="color: #ff0000;">"./components/TodoHd.js";
import TodoBd from "./components/TodoBd.js";
import TodoFt from "./components/TodoFt.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>

class App extends React.Component {
    constructor() {
        super();
    }
    
    render() {
        </span><span style="color: #0000ff;">return</span> &lt;div&gt;
           <span style="color: #ff0000;"> &lt;TodoHd&gt;&lt;/TodoHd&gt;
            &lt;TodoBd&gt;&lt;/TodoBd&gt;
            &lt;TodoFt&gt;&lt;/TodoFt&gt;</span>
        &lt;/div&gt;
<span style="color: #000000;">    }
}
export </span><span style="color: #0000ff;">default</span> connect()(App)　　</pre>
</div>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
<span style="color: #ff0000;">import {connect} from </span></span><span style="color: #ff0000;">"react-redux";
import TodoItem from "./TodoItem.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
class <span style="color: #ff0000;">TodoBd</span> extends React.Component {
    constructor(props){
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
            <span style="color: #008000;">//</span><span style="color: #008000;">{JSON.stringify(this.props.todos)}</span>
<span style="color: #000000;">                {
                    </span><span style="color: #0000ff;">this.props.todos.map(item=&gt;{
                    </span><span style="text-decoration: line-through;"><span style="color: #008000; text-decoration: line-through;">//</span><span style="color: #008000; text-decoration: line-through;">return &lt;div key={item.id}&gt;{item.title}&lt;/div&gt;</span></span>
                       <span style="color: #ff0000;"> return &lt;TodoItem key={item.id} item={item}&gt;&lt;/TodoItem&gt;</span>
<span style="color: #000000;"><span style="color: #0000ff;">                    })</span>
                }
            </span>&lt;/div&gt;
<span style="color: #000000;">        );
    }
}　　
</span><span style="color: #008000;">//</span><span style="color: #008000;">connect目的是问&ldquo;天&rdquo;要数据，要通天。</span><span style="color: #008000;">
//</span><span style="color: #008000;">&ldquo;通天&rdquo;是比喻，就是说要问store要数据</span>
export <span style="color: #0000ff;">default</span><span style="color: #0000ff;"> connect(
    (state)=&gt;{
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            <span style="color: #0000ff;">todos : state.todos</span>
        }
<span style="color: #0000ff;">    }
)(TodoBd);</span></span></pre>
</div>
<p>&nbsp;</p>
<p><strong>TodoItem.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> class TodoItem extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div <span style="color: #ff0000;">className="todoItem"</span>&gt;
                &lt;input type="checkbox" <span style="color: #ff0000;">checked={this.props.item.done}</span>/&gt;
                &lt;span&gt;<span style="color: #ff0000;">{this.props.item.title}</span>&lt;/span&gt;
                &lt;button&gt;删除&lt;/button&gt;
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>TodoHd.js<span style="font-family: 宋体;">增加待办事项</span></strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
import {connect} from </span>"react-redux"<span style="color: #000000;">;
class <span style="color: #0000ff;">TodoHd</span> extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
              <span style="color: #ff0000;">  &lt;input type="text" ref="titleTxt"/&gt;</span>
               <span style="color: #0000ff;"> &lt;button onClick={()=&gt;{
                    </span><span style="color: #ff0000;">this.props.addTodo(this.refs.titleTxt.value);
                    this.refs.titleTxt.value = ""</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
                <span style="color: #0000ff;">}}</span></span><span style="color: #0000ff;">&gt;</span>添加<span style="color: #0000ff;">&lt;/button&gt;</span>
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}
</span><span style="color: #008000;">//</span><span style="color: #008000;">这个组件要通天的目的不是要数据，而是改变数据</span>
export <span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> ,
   <span style="color: #0000ff;"> (dispatch)</span></span><span style="color: #0000ff;">=&gt;{
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            <span style="color: #0000ff;">addTodo(title){</span>
                <span style="color: #ff0000;">dispatch({</span></span><span style="color: #ff0000;">"type":"ADDTODO"</span><span style="color: #000000;"><span style="color: #ff0000;">, title})</span>
            }
        }
   <span style="color: #0000ff;"> }</span>
)(<span style="color: #0000ff;">TodoHd</span>);</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>reducers/index.js<span style="font-family: 宋体;">写可预测状态</span></strong>　　</p>
<div class="cnblogs_code">
<pre><code>const initObj =<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;"> : [
        ...
    ],
}
export </span><span style="color: #0000ff;">default</span> <span style="color: #0000ff;">(state = initObj, action)=&gt;{
    if(action.type == "ADDTODO"){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            <span style="color: #ff0000;">...state,</span> 
            </span>"todos"<span style="color: #000000;"> : [
               <span style="color: #ff0000;"> ...state.todos,</span> 
                {
                    </span><span style="color: #ff0000;">"id" :</span> <span style="color: #0000ff;">state.todos.reduce((a,b)=&gt;{
                        <span style="color: #ff0000;">return b.id &gt; a ? b.id : a;</span>
                    },0) + 1,
                    </span><span style="color: #ff0000;">"title" : action.title, 
                    "done" : false</span><span style="color: #000000;">
                }
            ]
        }
  <span style="color: #0000ff;">  }
    </span></span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p>TodoFt.js</p>
<div class="cnblogs_code" onclick="cnblogs_code_show('31796a2d-bbcd-4eeb-8b86-036d818ad1e0')"><img id="code_img_closed_31796a2d-bbcd-4eeb-8b86-036d818ad1e0" class="code_img_closed" src="./images/前端笔记之React（五）Redux深入浅出0.png" alt="" /><img id="code_img_opened_31796a2d-bbcd-4eeb-8b86-036d818ad1e0" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('31796a2d-bbcd-4eeb-8b86-036d818ad1e0',event)" src="./images/前端笔记之React（五）Redux深入浅出1.png" alt="" />
<div id="cnblogs_code_open_31796a2d-bbcd-4eeb-8b86-036d818ad1e0" class="cnblogs_code_hide">
<pre><code>import React from "react"<span style="color: #000000;">;
import {connect} from </span>"react-redux"<span style="color: #000000;">;
class TodoFt extends React.Component {
    constructor() {
        super();
    }

    render() {
        </span><span style="color: #0000ff;">return</span> &lt;div&gt;<span style="color: #000000;">
            当前：共{</span><span style="color: #0000ff;">this</span>.props.todos.length}条信息--<span style="color: #000000;">
            已做{</span><span style="color: #0000ff;">this</span>.props.todos.filter(item =&gt; item.done).length}条--<span style="color: #000000;">
            未做{</span><span style="color: #0000ff;">this</span>.props.todos.filter(item =&gt; !<span style="color: #000000;">item.done).length}条
        </span>&lt;/div&gt;
<span style="color: #000000;">    }
}

export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    (state)</span>=&gt;<span style="color: #000000;">{
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            todos:state.todos
        }
    }
)(TodoFt)</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p><span style="font-family: 宋体;">因为</span>TodoItem<span style="font-family: 宋体;">这个组件是不通天的，所以</span><span style="font-family: Consolas;">TodoItem</span><span style="font-family: 宋体;">是不能自己独立</span><span style="font-family: Consolas;">dispatch</span><span style="font-family: 宋体;">到</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">的。</span></p>
<p><span style="font-family: 宋体;">此时就需要</span>TodoBd<span style="font-family: 宋体;">帮助，因为</span><span style="font-family: Consolas;">TodoBd</span><span style="font-family: 宋体;">是通天。</span></p>
<p>&nbsp;</p>
<p><span style="color: #ff0000;"><strong><span style="text-decoration: underline;"><span style="font-family: 宋体;">这是套路：所有被循环语句</span>map<span style="font-family: 宋体;">出来的组件，一律不通天，数据父亲给，改变</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">的能力父亲给。</span></span></strong></span></p>
<p><span style="color: #ff0000;"><strong>TodoBd.js<span style="font-family: 宋体;">组件引入了</span><span style="font-family: Consolas;">TodoItem.js</span><span style="font-family: 宋体;">组件，因为</span><span style="font-family: Consolas;">TodoItem</span><span style="font-family: 宋体;">组件是被</span><span style="font-family: Consolas;">map</span><span style="font-family: 宋体;">出来的，所以信息要传给每一个</span><span style="font-family: Consolas;">TodoItem</span><span style="font-family: 宋体;">，而不是让</span><span style="font-family: Consolas;">TodoItem</span><span style="font-family: 宋体;">自己通天拿数据。</span></strong></span></p>
<p><strong>TodoBd.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
import {connect} from </span>"react-redux"<span style="color: #000000;">;
import TodoItem from </span>"./TodoItem.js"<span style="color: #000000;">;

class TodoBd extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">根据全局的show属性来决定当前todos数组</span>
        <span style="color: #0000ff;">if(this.props.show == "ALL"){
           <span style="color: #ff0000;"> var todos = this.props.todos;</span>
        }else if(this.props.show == "ONLYDONE"){
            <span style="color: #ff0000;">var todos = this.props.todos.filter(item=&gt;item.done);</span>
        }else if(this.props.show == "ONLYUNDONE"){
            <span style="color: #ff0000;">var todos = this.props.todos.filter(item=&gt;!item.done);</span>
        }

        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;<span style="color: #000000;">
                {
                    <span style="color: #ff0000;">todos.map(item</span></span><span style="color: #ff0000;">=&gt;{
                        </span><span style="color: #0000ff;">return</span> &lt;<span style="color: #000000;">TodoItem
                            key</span>=<span style="color: #000000;">{item.id}
                            item</span>=<span style="color: #000000;">{item}
                            delTodo</span>={<span style="color: #0000ff;">this</span>.props.delTodo.bind(<span style="color: #0000ff;">this</span><span style="color: #000000;">)}
                            changeTodo</span>={<span style="color: #0000ff;">this</span>.props.changeTodo.bind(<span style="color: #0000ff;">this</span><span style="color: #000000;">)}
                        </span><span style="color: #000000;">&gt;&lt;/TodoItem&gt;
</span><span style="color: #000000;"><span style="color: #ff0000;">                    })</span>
                }
            </span>&lt;/div&gt;
<span style="color: #000000;">        );
    }
}
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    (state)</span>=&gt;<span style="color: #000000;">{
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            todos : state.todos ,
           <span style="color: #ff0000;"> show : state.show</span>
        }
    },
    <span style="color: #0000ff;">(dispatch)</span></span><span style="color: #0000ff;">=&gt;{
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
    <span style="color: #0000ff;">        delTodo(id){</span>
                <span style="color: #ff0000;">dispatch({</span></span><span style="color: #ff0000;">"type" : "DELTODO"</span><span style="color: #000000;"><span style="color: #ff0000;">, id});</span>
            <span style="color: #0000ff;">},</span>
            <span style="color: #0000ff;">changeTodo(id , k , v){</span>
                <span style="color: #ff0000;">dispatch({</span></span><span style="color: #ff0000;">"type" : "CHANGETODO"</span><span style="color: #000000;"><span style="color: #ff0000;">, id, k, v});</span>
            <span style="color: #0000ff;">}</span>
        }
   <span style="color: #0000ff;"> }</span>
)(TodoBd);</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>TodoItem.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> class TodoItem extends React.Component {
    constructor(props) {
        super(props);
        </span><span style="color: #ff0000;">this.state = {
            "onEdit" : false</span><span style="color: #000000;"><span style="color: #ff0000;">
        }</span>
    }
    render() {
     <span style="color: #ff0000;">const {id, title, done} </span></span><span style="color: #ff0000;">= this.props.item;
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
                &lt;<span style="color: #000000;">input 
                    type</span>="checkbox" checked=<span style="color: #000000;">{done}
                    <span style="color: #0000ff;">onChange</span></span><span style="color: #0000ff;">={(e)=&gt;{
　　　　　　　　　　　　　　this.props.changeTodo(<span style="color: #ff0000;">id, "done", e.target.checked</span>)
　　　　　　　　　　　　}}
                </span>/&gt;
<span style="color: #000000;">                {
                    </span><span style="color: #ff0000;">this.state.onEdit 
                    ?</span>
                    &lt;<span style="color: #000000;">input 
                        type</span>="text"<span style="color: #ff0000;"> 
                        defaultValue=</span><span style="color: #000000;"><span style="color: #ff0000;">{title}</span> 
                        <span style="color: #0000ff;">onBlur</span></span><span style="color: #0000ff;">={(e)=&gt;{
                            this.props.changeTodo(<span style="color: #ff0000;">id,"title", e.target.value</span>)
                            this.setState(<span style="color: #ff0000;">{"onEdit" : false}</span>)
                        }}
                    </span>/&gt;
<span style="color: #ff0000;">                    :
                    </span>&lt;span <span style="color: #0000ff;">onDoubleClick={()=&gt;{this.setState({"onEdit":true})}}</span>&gt;<span style="color: #000000;">
　　　　　　　　　　　<span style="color: #ff0000;">　{title}</span>
　　　　　　　　　　</span>&lt;/span&gt;
<span style="color: #000000;">                }

                </span>&lt;button<span style="color: #0000ff;"> onClick={()=&gt;{this.props.delTodo(id)}}</span>&gt;删除&lt;/button&gt;
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>index.js</strong></p>
<div class="cnblogs_code">
<pre><code>const initObj =<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;"> : [
        ...
    ],
    </span><span style="color: #ff0000;">"show" : "ALL"</span>       <span style="color: #008000;">//</span><span style="color: #008000;">ALL、ONLYDONE、ONLYUNDONE</span>
<span style="color: #000000;">}
export </span><span style="color: #0000ff;">default</span> (state = initObj, action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">if</span>(action.type == "ADDTODO"<span style="color: #000000;">){
        ...
   <span style="color: #0000ff;"> }</span></span><span style="color: #0000ff;">else if(action.type == "<span style="color: #ff0000;">DELTODO</span>"){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            <span style="color: #ff0000;">...state, 
            </span></span><span style="color: #ff0000;">"todos" : state.todos.filter(item =&gt; item.id !=</span><span style="color: #000000;"><span style="color: #ff0000;"> action.id)</span>
        }
   <span style="color: #0000ff;"> }</span></span><span style="color: #0000ff;">else if(action.type == "<span style="color: #ff0000;">CHANGETODO</span>"){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
         <span style="color: #ff0000;">   ...state, 
            </span></span><span style="color: #0000ff;">"todos" : state.todos.map(item =&gt; {
                //如果遍历到的item项和传入的aciton的id项不一样，此时返回原item
               <span style="color: #ff0000;"> if(item.id != action.id) return item;
                //否则返回修改之后的item
                return</span></span><span style="color: #000000;"><span style="color: #0000ff;"><span style="color: #ff0000;"> {
                    ...item ,
                    [action.k] : action.v
                }</span>
            })</span>
        }
   <span style="color: #0000ff;"> }</span></span><span style="color: #0000ff;">else if(action.type == "<span style="color: #ff0000;">CHANGESHOW</span>"){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            <span style="color: #ff0000;">...state, 
            </span></span><span style="color: #ff0000;">"show"</span><span style="color: #000000;"><span style="color: #ff0000;"> : action.show</span>
        }
    <span style="color: #0000ff;">}
    </span></span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>TodoFt.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
import {connect} from </span>"react-redux"<span style="color: #000000;">;
import classnames from </span>"classnames"<span style="color: #000000;">;

class TodoFt extends React.Component {
    constructor(props) {
        super(props);
    }

    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
                &lt;p&gt;<span style="color: #000000;">
                    当前共{</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.props.todos.length}条信息
做完{</span><span style="color: #0000ff;">this</span>.props.todos.filter(item=&gt;<span style="color: #000000;">item.done).length}条
未做{</span><span style="color: #0000ff;">this</span>.props.todos.filter(item=&gt;!<span style="color: #000000;">item.done).length}条
                </span>&lt;/p&gt;
                &lt;p&gt;
                    &lt;button <span style="color: #ff0000;">className={classnames({"cur":this.props.show == 'ALL'})} </span>                                <br />　　　　　　　　　　　　<span style="color: #0000ff;">onClick={()=&gt;{this.props.changeShow('ALL')}}</span>&gt;<span style="color: #000000;">查看全部
　　　　　　　　　　　　</span>&lt;/button&gt;
                    &lt;button <span style="color: #ff0000;">className={classnames({"cur":this.props.show == 'ONLYDONE'</span><span style="color: #000000;"><span style="color: #ff0000;">})}</span>
<span style="color: #0000ff;">onClick</span></span><span style="color: #0000ff;">={()=&gt;{this.props.changeShow('ONLYDONE')}}</span>&gt;<span style="color: #000000;">仅看已做
</span>&lt;/button&gt;
                    &lt;button <span style="color: #ff0000;">className={classnames({"cur":this.props.show == 'ONLYUNDONE'</span><span style="color: #000000;"><span style="color: #ff0000;">})}</span>
<span style="color: #0000ff;">onClick</span></span><span style="color: #0000ff;">={()=&gt;{this.props.changeShow('ONLYUNDONE')}}</span>&gt;<span style="color: #000000;">仅看未做
</span>&lt;/button&gt;
                &lt;/p&gt;
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}

export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    (state) </span>=&gt;<span style="color: #000000;"> {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            todos : state.todos ,
           <span style="color: #ff0000;"> show : state.show</span>
        }
    },
   <span style="color: #0000ff;"> (dispatch) </span></span><span style="color: #0000ff;">=&gt; {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
           <span style="color: #0000ff;"> changeShow(show){</span>
             <span style="color: #ff0000;">   dispatch({</span></span><span style="color: #ff0000;">"type" : "CHANGESHOW"</span><span style="color: #000000;"><span style="color: #ff0000;"> , show})</span>
            <span style="color: #0000ff;">}</span>
        }
    <span style="color: #0000ff;">}</span>
)(TodoFt);</span></pre>
</div>
<hr />
<h1><strong><span style="font-family: 宋体;">四、</span>logger<span style="font-family: 宋体;">插件</span></strong></h1>
<p>redux-logger<span style="font-family: 宋体;">用来辅助开发。</span></p>
<div class="cnblogs_code">
<pre><code>npm install --save redux-logger</pre>
</div>
<p><span style="font-family: 宋体;">改变</span>main.js:</p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import ReactDOM from </span>"react-dom"<span style="color: #000000;">;
import {createStore , <span style="color: #ff0000;">applyMiddleware</span>} from </span>"redux"<span style="color: #000000;">;
import {Provider} from </span>"react-redux"<span style="color: #000000;">;
<span style="color: #ff0000;">import logger from </span></span><span style="color: #ff0000;">"redux-logger"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>

import App from </span>"./App.js"<span style="color: #000000;">;
</span><span style="color: #008000;">//</span><span style="color: #008000;">引入reducer</span>
import reducer from "./reducers/index.js"<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">创建store</span>
const store =<span style="color: #000000;"> createStore(reducer , <span style="color: #ff0000;">applyMiddleware(logger)</span>);

ReactDOM.render(
    </span>&lt;Provider store={store}&gt;
        &lt;App&gt;&lt;/App&gt;
    &lt;/Provider&gt;
<span style="color: #000000;">    ,
    document.getElementById(</span>"app-container"<span style="color: #000000;">)
);</span></pre>
</div>
<p><img src="./images/前端笔记之React（五）Redux深入浅出9.png" alt="" /></p>
<p><span style="font-family: 宋体;">也可以使用</span>redux-devtools<span style="font-family: 宋体;">这个插件。</span></p>
<div class="cnblogs_code">
<pre><code>npm install --save-dev redux-<span style="color: #000000;">devtools
npm install </span>--save-dev redux-devtools-log-<span style="color: #000000;">monitor
npm install </span>--save-dev redux-devtools-dock-<span style="color: #000000;">monitor
npm install </span>--save-dev redux-devtools-chart-monitor</pre>
</div>
<p>文档：</p>
<p><a href="https://github.com/reduxjs/redux-devtools"><span style="text-decoration: underline;">https://github.com/reduxjs/redux-devtools</span></a></p>
<p><a href="https://github.com/reduxjs/redux-devtools/blob/master/docs/Walkthrough.md"><span style="text-decoration: underline;">https://github.com/reduxjs/redux-devtools/blob/master/docs/Walkthrough.md</span></a></p>
<p>&nbsp;</p>
<hr />
<h1><strong><span style="font-family: 宋体;">五、</span>combineReducers<span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">bindActionCreators</span></strong></h1>
<p><strong><span style="font-family: 宋体;">一个网页的应用程序可能是多个</span>reducer<span style="font-family: 宋体;">，合并为一个</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">，比如</span><span style="font-family: Consolas;">counter</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">todo</span><span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">。</span></strong></p>
<p>&nbsp;</p>
<p>Redux<span style="font-family: 宋体;">提供的</span><span style="font-family: Consolas;">combineReducers</span><span style="font-family: 宋体;">方法，用于</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">的拆分，只要定义各个子</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">函数，然后用这个方法，将它们合成一个大的</span><span style="font-family: Consolas;">reducer</span><span style="font-family: 宋体;">。</span></p>
<p>Redux<span style="font-family: 宋体;">提供的</span><span style="font-family: Consolas;">bindActionCreators</span><span style="font-family: 宋体;">方法，用于通过</span><span style="font-family: Consolas;">dispatch</span><span style="font-family: 宋体;">将</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">包裹起来，这条可以通过</span><span style="font-family: Consolas;">bindActionCreators</span><span style="font-family: 宋体;">创建的方法，直接调用</span><span style="font-family: Consolas;">dispatch(action)</span><span style="font-family: 宋体;">&ldquo;隐式调用&rdquo;。</span></p>
<hr />
<h2><strong>5.1 combineReducers</strong></h2>
<p align="justify"><strong>reducers/counter.js<span style="font-family: 宋体;">就是一个普通的纯函数：</span></strong></p>
<div class="cnblogs_code">
<pre><code>export <span style="color: #0000ff;">default</span> (state = {"v" : 10},action)=&gt;<span style="color: #000000;">{
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p><strong>reducers/todo.js<span style="font-family: 宋体;">提供的数据：</span></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('a49691a4-37cd-4a95-ba02-98013542409b')"><img id="code_img_closed_a49691a4-37cd-4a95-ba02-98013542409b" class="code_img_closed" src="./images/前端笔记之React（五）Redux深入浅出0.png" alt="" /><img id="code_img_opened_a49691a4-37cd-4a95-ba02-98013542409b" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('a49691a4-37cd-4a95-ba02-98013542409b',event)" src="./images/前端笔记之React（五）Redux深入浅出1.png" alt="" />
<div id="cnblogs_code_open_a49691a4-37cd-4a95-ba02-98013542409b" class="cnblogs_code_hide">
<pre><code>const initObj =<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;">: [
        { </span>"id": 1, "title": "吃饭", "done": <span style="color: #0000ff;">false</span><span style="color: #000000;"> },
        { </span>"id": 2, "title": "睡觉", "done": <span style="color: #0000ff;">false</span><span style="color: #000000;"> },
        { </span>"id": 3, "title": "打豆豆", "done": <span style="color: #0000ff;">true</span><span style="color: #000000;"> }
    ] 
};

export </span><span style="color: #0000ff;">default</span> (state = initObj, action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state
}</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>reducers/index.js<span style="font-family: 宋体;">要用</span><span style="font-family: Consolas;">redux</span><span style="font-family: 宋体;">提供的</span><span style="font-family: Consolas;">combineReducers</span><span style="font-family: 宋体;">来进行智能合并</span></strong></p>
<div class="cnblogs_code">
<pre><code>import { combineReducers } from "redux"<span style="color: #000000;">;
<span style="color: #ff0000;">import counter from </span></span><span style="color: #ff0000;">"./counter.js";
import todos from "./todos.js";

</span><span style="color: #008000;">//</span><span style="color: #008000;">暴露合并的reducer</span>
<span style="color: #ff0000;">export default combineReducers({
    counter,
    todos
})</span></pre>
</div>
<p>&nbsp;</p>
<p>main.js</p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import ReactDOM from </span>"react-dom"<span style="color: #000000;">;
import {createStore} from </span>"redux"<span style="color: #000000;">;
import {Provider} from </span>"react-redux"<span style="color: #000000;">;

<span style="color: #ff0000;">import App from </span></span><span style="color: #ff0000;">"./containers/App.js";
</span><span style="color: #008000;">//</span><span style="color: #008000;">引入reducer</span>
<span style="color: #ff0000;">import reducer from "./reducers";

</span><span style="color: #008000;">//</span><span style="color: #008000;"> 创建 Redux store 来存放应用的状态。</span>
<span style="color: #ff0000;">const store =</span><span style="color: #000000;"><span style="color: #ff0000;"> createStore(reducer);</span>

ReactDOM.render(
    </span>&lt;Provider store={store}&gt;
        &lt;App&gt;&lt;/App&gt;
    &lt;/Provider&gt;,
    document.getElementById("app"<span style="color: #000000;">)
);</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>containers/App.js<span style="font-family: 宋体;">组件使用数据</span></strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
import {connect} from </span>"react-redux"<span style="color: #000000;">;
class <span style="color: #ff0000;">App</span> extends React.Component {
    constructor(){
        super();
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
                &lt;h1&gt;<span style="color: #ff0000;">{this.props.v}</span>&lt;/h1&gt;
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    (<span style="color: #ff0000;">{counter}</span>) </span>=&gt;<span style="color: #000000;"> ({
        <span style="color: #ff0000;">v : counter.v</span>
    })
)(App);</span></pre>
</div>
<p>&nbsp;</p>
<p>components/TodoList/index.js<span style="font-family: 宋体;">组件</span></p>
<div class="cnblogs_code">
<pre><code>import React from "react"<span style="color: #000000;">;
import { connect } from </span>"react-redux"<span style="color: #000000;">;
class <span style="color: #ff0000;">TodoList</span> extends React.Component {
    constructor(){
        super();
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
                &lt;h1&gt;我是TodoList&lt;/h1&gt;
<span style="color: #000000;">                {
                    </span><span style="color: #ff0000;">this.props.todos.map(item=&gt;{
                        return &lt;p key={item.id}&gt;{item.title}&lt;/p&gt;
</span><span style="color: #000000;"><span style="color: #ff0000;">                    })</span>
                }
            </span>&lt;/div&gt;
<span style="color: #000000;">        )
    }
};
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
   <span style="color: #ff0000;">({todos: {todos}})</span></span><span style="color: #ff0000;">=&gt;{
        return</span><span style="color: #000000;"><span style="color: #ff0000;"> {
            todos
        }
   }</span>
)(TodoList)</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>containers/App.js<span style="font-family: 宋体;">引入组件：</span></strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
<span style="color: #ff0000;">import TodoList from </span></span><span style="color: #ff0000;">"../components/todolist/index.js";
import Counter from "../components/counter/index.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
 
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> class App extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
               <span style="color: #ff0000;"> &lt;Counter&gt;&lt;/Counter&gt;
                &lt;TodoList&gt;&lt;/TodoList&gt;</span>
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}</span></pre>
</div>
<hr />
<h2><strong>5.2 bindActionCreators</strong></h2>
<p><span style="color: #ff0000;"><strong>bindActionCreators<span style="font-family: 宋体;">会将</span><span style="font-family: Consolas;">action</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">dispatch</span><span style="font-family: 宋体;">绑定并返回一个对象，这个对象会作为</span><span style="font-family: Consolas;">props</span><span style="font-family: 宋体;">的一部分传入组件中。</span></strong></span></p>
<p><span style="color: #ff0000;"><strong>bindActionCreators<span style="font-family: 宋体;">主要作用：一般情况下，可以通过</span><span style="font-family: Consolas;">Provider</span><span style="font-family: 宋体;">将</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">通过</span><span style="font-family: Consolas;">React</span><span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">connext</span><span style="font-family: 宋体;">属性向下传递，</span><span style="font-family: Consolas;">bindActionCreators</span><span style="font-family: 宋体;">的唯一用处就是需要传递</span><span style="font-family: Consolas;">action creater</span><span style="font-family: 宋体;">到子组件，并且该子组件并没有接收到父组件上传递的</span><span style="font-family: Consolas;">store</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">dispatch</span><span style="font-family: 宋体;">。</span></strong></span></p>
<p>官方的文件夹结构：<a href="https://github.com/reduxjs/redux/tree/master/examples/todomvc/src"><span style="text-decoration: underline;">https://github.com/reduxjs/redux/tree/master/examples/todomvc/src</span></a></p>
<p>&nbsp;</p>
<p><strong>actions/counterActions.js<span style="font-family: 宋体;">：</span></strong><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">新建</span>actions<span style="font-family: 宋体;">文件夹存放</span><span style="font-family: Consolas;">type</span></strong></span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;"> 我们把return一个action的函数叫做&ldquo;action creator&rdquo;</span><span style="color: #008000;">
//</span><span style="color: #008000;"> 所以这个文件向外暴露了几个动作</span>
export const add = () =&gt; ({ type: "ADD"<span style="color: #000000;"> })
export const minus </span>= () =&gt; ({ type: "MINUS"<span style="color: #000000;"> })
export const cheng </span>= () =&gt; ({ type: "CHENG"<span style="color: #000000;"> })
export const chu </span>= () =&gt; ({ type: "CHU" })</pre>
</div>
<p>&nbsp;</p>
<p><strong>counter/index.js<span style="font-family: 宋体;">计数器组件</span></strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
<span style="color: #ff0000;">import {bindActionCreators} from </span></span><span style="color: #ff0000;">"redux"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
import {connect} from </span>"react-redux"<span style="color: #000000;">;
<span style="color: #ff0000;">import </span></span><span style="color: #ff0000;">* as counterActions from "../../actions/counterActions.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>

class <span style="color: #ff0000;">Counter</span> extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
                &lt;h1&gt;Counter : <span style="color: #ff0000;">{this.props.v}</span>&lt;/h1&gt;
                &lt;button onClick={()=&gt;{<span style="color: #0000ff;">this</span>.props.<span style="color: #ff0000;">counterActions</span>.add()}}&gt;加&lt;/button&gt;
                &lt;button onClick={()=&gt;{<span style="color: #0000ff;">this</span>.props.<span style="color: #ff0000;">counterActions</span>.minus()}}&gt;减&lt;/button&gt;
                &lt;button onClick={()=&gt;{<span style="color: #0000ff;">this</span>.props.<span style="color: #ff0000;">counterActions</span>.cheng()}}&gt;乘&lt;/button&gt;
                &lt;button onClick={()=&gt;{<span style="color: #0000ff;">this</span>.props.<span style="color: #ff0000;">counterActions</span>.chu()}}&gt;除&lt;/button&gt;
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    ({counter}) </span>=&gt;<span style="color: #000000;"> ({
        <span style="color: #ff0000;">v : counter.v</span>
    }),
    (dispatch) </span>=&gt;<span style="color: #000000;"> ({
    </span><span style="color: #008000;">//</span><span style="color: #008000;">这里的dispatch，等同于store中的store.dispatch，用于组合action</span>
<span style="color: #000000;"><span style="color: #ff0000;">        counterActions : bindActionCreators(counterActions , dispatch)</span>
    })
)(Counter);</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>app/reducers/counter.js<span style="font-family: 宋体;">：</span></strong></p>
<div class="cnblogs_code" onclick="cnblogs_code_show('121269d2-004c-431f-ad0c-7eeb99e07ffb')"><img id="code_img_closed_121269d2-004c-431f-ad0c-7eeb99e07ffb" class="code_img_closed" src="./images/前端笔记之React（五）Redux深入浅出0.png" alt="" /><img id="code_img_opened_121269d2-004c-431f-ad0c-7eeb99e07ffb" class="code_img_opened" style="display: none;" onclick="cnblogs_code_hide('121269d2-004c-431f-ad0c-7eeb99e07ffb',event)" src="./images/前端笔记之React（五）Redux深入浅出1.png" alt="" />
<div id="cnblogs_code_open_121269d2-004c-431f-ad0c-7eeb99e07ffb" class="cnblogs_code_hide">
<pre><code>import {ADD, MINUS, CHENG, CHU} from "../constants/COUNTER.js"<span style="color: #000000;">;

export </span><span style="color: #0000ff;">default</span> (state = {"v" : 0} , action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">if</span>(action.type == "ADD"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state , 
            </span>"v" : state.v + 1<span style="color: #000000;">
        }
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "MINUS"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state , 
            </span>"v" : state.v - 1<span style="color: #000000;">
        }
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "CHENG"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state , 
            </span>"v" : state.v * 2<span style="color: #000000;">
        }
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type == "CHU"<span style="color: #000000;">){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state , 
            </span>"v" : state.v / 2<span style="color: #000000;">
        }
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<span class="cnblogs_code_collapse">示例代码</span></div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><strong>todolist/index.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
<span style="color: #ff0000;">import TodoHd from </span></span><span style="color: #ff0000;">"./TodoHd.js";
import TodoBd from "./TodoBd.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>

export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> class <span style="color: #ff0000;">TodoList</span> extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
              </span>&lt;div&gt;
                  &lt;h1&gt;TodoList&lt;/h1&gt;
                 <span style="color: #ff0000;"> &lt;TodoHd&gt;&lt;/TodoHd&gt;
                  &lt;TodoBd&gt;&lt;/TodoBd&gt;</span>
              &lt;/div&gt;
<span style="color: #000000;">        );
    }
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>TodoHd.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
<span style="color: #ff0000;">import {bindActionCreators} from </span></span><span style="color: #ff0000;">"redux"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
import {connect} from </span>"react-redux"<span style="color: #000000;">;
<span style="color: #ff0000;">import </span></span><span style="color: #ff0000;">* as todoActions from "../../actions/todoActions.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;
</span>
class TodoHd extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;
                &lt;input type="text" ref="titleTxt"/&gt;
                &lt;button onClick={()=&gt;{<span style="color: #0000ff;">this</span>.props.<span style="color: #ff0000;">todoActions</span>.add(<span style="color: #0000ff;">this</span><span style="color: #000000;">.refs.titleTxt.value)}}
　　　　　　　　　　　　</span>&gt;<span style="color: #000000;">添加
　　　　　　　　　　</span>&lt;/button&gt;
            &lt;/div&gt;
<span style="color: #000000;">        );
    }
}
export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    </span><span style="color: #0000ff;">null</span><span style="color: #000000;"> ,
    (dispatch) </span>=&gt;<span style="color: #000000;"> ({
       <span style="color: #ff0000;"> todoActions : bindActionCreators(todoActions , dispatch)</span>
    })
)(TodoHd);</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>TodoBd.js</strong></p>
<div class="cnblogs_code">
<pre><code>import React from 'react'<span style="color: #000000;">;
<span style="color: #ff0000;">import {bindActionCreators} from </span></span><span style="color: #ff0000;">"redux"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
import {connect} from </span>"react-redux"<span style="color: #000000;">;
<span style="color: #ff0000;">import </span></span><span style="color: #ff0000;">* as todoActions from "../../actions/todoActions.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>

class TodoBd extends React.Component {
    constructor(props) {
        super(props);
    }
    render() {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> (
            </span>&lt;div&gt;<span style="color: #000000;">
                {
                    </span><span style="color: #0000ff;">this</span>.props.todos.map(item=&gt;<span style="color: #000000;">{
                        </span><span style="color: #0000ff;">return</span> &lt;p key={item.id}&gt;<span style="color: #000000;">
                            {item.title}
                            </span>&lt;button onClick={()=&gt;{<span style="color: #0000ff;">this</span>.props.<span style="color: #ff0000;">todoActions</span>.del(item.id)}}&gt;<span style="color: #000000;">
　　　　　　　　　　　　　　　　　删除
　　　　　　　　　　　　　　　　　　</span>&lt;/button&gt;
                        &lt;/p&gt;
<span style="color: #000000;">                    })
                }
            </span>&lt;/div&gt;
<span style="color: #000000;">        );
    }
}

export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> connect(
    ({todo}) </span>=&gt;<span style="color: #000000;"> ({
        todos : todo.todos
    }) ,
    (dispatch) </span>=&gt;<span style="color: #000000;"> ({
       <span style="color: #ff0000;"> todoActions : bindActionCreators(todoActions , dispatch)</span>
    })
)(TodoBd);</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="color: #ff0000;"><strong><span style="font-family: 宋体;">为了防止</span>action<span style="font-family: 宋体;">的</span><span style="font-family: Consolas;">type</span><span style="font-family: 宋体;">命名冲突，此时要单独存放在</span><span style="font-family: Consolas;">const</span><span style="font-family: 宋体;">文件夹中：</span></strong></span></p>
<p><strong>app\constants\COUNTER.js</strong></p>
<div class="cnblogs_code">
<pre><code>export const ADD = "ADD_COUNTER"<span style="color: #000000;">;
export const MINUS </span>= "MINUS_COUNTER"<span style="color: #000000;">;
export const CHENG </span>= "CHENG_COUNTER"<span style="color: #000000;">;
export const CHU </span>= "CHU_COUNTER";</pre>
</div>
<p><strong>app\constants\TODO.js</strong></p>
<div class="cnblogs_code">
<pre><code>export const ADD = "ADD_TODO"<span style="color: #000000;">;
export const DEL </span>= "DEL_TODO";</pre>
</div>
<p class="16"><span style="font-family: 宋体;">然后就可以在以下文件中，引入以上常量，然后使用大写的常量替换</span>type<span style="font-family: 宋体;">字符串</span></p>
<p class="16">l&nbsp;actions<span style="font-family: 宋体;">中的</span><span style="font-family: Consolas;">counterActions.js</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">todoActions.js</span></p>
<p class="16">l&nbsp;reducers<span style="font-family: 宋体;">中的</span><span style="font-family: Consolas;">todo.js</span><span style="font-family: 宋体;">和</span><span style="font-family: Consolas;">counter.js</span></p>
<p>&nbsp;</p>
<p><strong>actions/TodoActions.js</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #ff0000;">import {ADD , DEL} from "../constants/TODO.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
export const add </span>= (title) =&gt; ({"type"<span style="color: #000000;"> : <span style="color: #ff0000;">ADD</span>, title});
export const del </span>= (id) =&gt; ({"type" : <span style="color: #ff0000;">DEL</span>, id});</pre>
</div>
<p><strong>actions/counterActions.js<span style="font-family: 宋体;">：</span></strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #ff0000;">import {ADD , MINUS , CHENG , CHU} from "../constants/COUNTER.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
export const add </span>= () =&gt; ({"type"<span style="color: #000000;"> : <span style="color: #ff0000;">ADD</span>});
export const minus </span>= () =&gt; ({"type"<span style="color: #000000;"> : <span style="color: #ff0000;">MINUS</span>});
export const cheng </span>= () =&gt; ({"type"<span style="color: #000000;"> : <span style="color: #ff0000;">CHENG</span>});
export const chu </span>= (n) =&gt; ({"type" : <span style="color: #ff0000;">CHU</span> , n});</pre>
</div>
<p>&nbsp;</p>
<p><strong>reducers/todo.js</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #ff0000;">import {ADD , DEL} from "../constants/TODO.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>
const initObj </span>=<span style="color: #000000;"> {
    </span>"todos"<span style="color: #000000;"> : [
        {</span>"id" : 1 , "title" : "吃饭" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
        {</span>"id" : 2 , "title" : "睡觉" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">},
        {</span>"id" : 3 , "title" : "打豆豆" , "done" : <span style="color: #0000ff;">false</span><span style="color: #000000;">}
    ]
}
export </span><span style="color: #0000ff;">default</span> (state = initObj , action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"><span style="color: #ff0000;"> ADD</span>){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state ,
            </span>"todos"<span style="color: #000000;"> : [
                ...state.todos ,
                {
                    </span>"id" : state.todos.reduce((a,b)=&gt;{<span style="color: #0000ff;">return</span> b.id &gt; a ? b.id : a},0) + 1<span style="color: #000000;">,
                    </span>"title"<span style="color: #000000;">: action.title,
                    </span>"done"<span style="color: #000000;"> : action.done
                }
            ]
        }
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"><span style="color: #ff0000;"> DEL</span>){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state ,
            </span>"todos" : state.todos.filter(item =&gt; item.id !=<span style="color: #000000;"> action.id)
        }
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>reducers/counter.js</strong></p>
<div class="cnblogs_code">
<pre><code><span style="color: #ff0000;">import {ADD , MINUS , CHENG , CHU} from "../constants/COUNTER.js"</span><span style="color: #000000;"><span style="color: #ff0000;">;</span>

export </span><span style="color: #0000ff;">default</span> (state = {"v" : 0} , action) =&gt;<span style="color: #000000;"> {
    </span><span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"><span style="color: #ff0000;"> ADD</span>){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state , 
            </span>"v" : state.v + 1<span style="color: #000000;">
        }
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"><span style="color: #ff0000;"> MINUS</span>){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state , 
            </span>"v" : state.v - 1<span style="color: #000000;">
        }
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"><span style="color: #ff0000;"> CHENG</span>){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state , 
            </span>"v" : state.v * 2<span style="color: #000000;">
        }
    }</span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span>(action.type ==<span style="color: #000000;"><span style="color: #ff0000;"> CHU</span>){
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> {
            ...state , 
            </span>"v" : state.v /<span style="color: #000000;"> action.n
        }
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> state;
}</span></pre>
</div>
<hr />
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>