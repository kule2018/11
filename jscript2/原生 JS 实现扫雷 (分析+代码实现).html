<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修原生 JS 实现扫雷 (分析+代码实现)' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>原生 JS 实现扫雷 (分析+代码实现)</center></div><div class='banquan'>原文出处:本文由博客园博主kilomChou提供。<br/>
原文连接:https://www.cnblogs.com/kilomChou/p/10652405.html</div><br>
    <p><span style="font-family: 'Microsoft YaHei';">阅读这篇文章需要掌握的基础知识：Html5、CSS、JavaScript</span></p>
<p><span style="font-family: 'Microsoft YaHei';">在线Demo：<a href="http://jsrun.net/XdXKp" target="_blank">查看</a></span></p>
<h2><span style="font-family: 'Microsoft YaHei';">扫雷规则</span></h2>
<p><span style="font-family: 'Microsoft YaHei';">在写扫雷之前，我们先了解下它的游戏规则</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><img src="./images/原生 JS 实现扫雷 (分析+代码实现)0.png" alt="" /></span></p>
<p><span style="font-family: 'Microsoft YaHei';">● 扫雷是一个矩阵，地雷随机分布在方格上。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">●&nbsp;方格上的数字代表着这个方格所在的九宫格内有多少个地雷。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">● 方格上的旗帜为玩家所作标记。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">●&nbsp;踩到地雷，游戏失败。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">● 打开所有非雷方格，游戏胜利。</span></p>
<p>&nbsp;</p>
<h2><span style="font-family: 'Microsoft YaHei';">功能实现思路分析</span></h2>
<h3><span style="font-family: 'Microsoft YaHei';">矩阵的生成</span></h3>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">矩阵的生成有多种方式可以实现，我们这里使用&lt;table&gt;+&lt;span&gt;标签。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">通过 js 给定行数与列数在&lt;table&gt;的 innerHtml 写入&lt;span&gt;标签来动态生成矩阵。</span></li>
</ul>
<h3><span style="font-family: 'Microsoft YaHei';">方格的打开与标记</span></h3>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">通过 onmousedown 事件，传入点击的方格的坐标及event，判断event为左键还是右键。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">左键打开方格，右键标记方格。</span></li>
</ul>
<h3><span style="font-family: 'Microsoft YaHei';">地雷的随机分布</span></h3>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">由于第一次打开的方格不能为地雷所以我们把生成地雷的函数放在第一次点击方格时。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">我们通过循环用 Math.random() 函数来随机生成地雷的二维坐标。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">判断坐标是否不为第一次点击方格的坐标以及没有雷存在。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">是则将方格设置为地雷，当前地雷数+1，并且将九宫格内的方格的计雷数+1。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">否则跳过进入下个循环，直到地雷的数量达到设定的最大雷数，结束循环。</span></li>
</ul>
<h3><span style="font-family: 'Microsoft YaHei';">踩到地雷游戏结束</span></h3>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">打开方格为地雷时，提示游戏结束。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">通过遍历矩阵来打开所有地雷</span></li>
</ul>
<h3><span style="font-family: 'Microsoft YaHei';">连锁打开方格</span></h3>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">当打开的方格为计雷数为0的方格，自动打开九宫格内的非雷方格。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">如果打开的非雷方格九宫格内仍有非雷方格，继续打开九宫格内的非雷方格，直到没有为止。</span></li>
</ul>
<h3><span style="font-family: 'Microsoft YaHei';">游戏胜利条件</span></h3>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">当所有非雷方格被打开即为游戏胜利。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">在每次打开方格函数中都遍历一遍矩阵，当找到有未打开的非雷方格时则结束遍历。</span></li>
<li><span style="font-family: 'Microsoft YaHei';">当遍历完未找到未打开的非雷方格则提示游戏胜利。</span></li>
</ul>
<h3><span style="font-family: 'Microsoft YaHei';">剩余地雷数与计时器</span></h3>
<ul>
<li><span style="font-family: 'Microsoft YaHei';">地雷的总数减去玩家标记的方格数即为剩余地雷数</span></li>
<li><span style="font-family: 'Microsoft YaHei';">计时器可以用setInterval()函数实现</span></li>
</ul>
<p>&nbsp;</p>
<h2><span style="font-family: 'Microsoft YaHei';">代码实现</span></h2>
<h3><span style="font-family: 'Microsoft YaHei';">生成矩阵</span></h3>
<p><span style="font-family: 'Microsoft YaHei';">我们先在&lt;body&gt;里写一个&lt;table&gt;标签，设定个 id='grid'</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-family: 'Microsoft YaHei';"><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">table </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='grid'</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">table</span><span style="color: #0000ff;">&gt;</span><span style="color: #0000ff;"><br /></span></span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei';">然后在&lt;script&gt;里 定义两个变量 row--行数 col--列数</span></p>
<p><span style="font-family: 'Microsoft YaHei';">通过两个for循环把 (方格)&lt;span&gt; 写入到 (矩阵)&lt;table&gt; 里，通过&lt;td&gt;&lt;tr&gt;标签控制行列。</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-family: 'Microsoft YaHei';"><span style="color: #0000ff;">var</span> row = 10; <span style="color: #008000;">//</span><span style="color: #008000;">行数</span>
<span style="color: #0000ff;">var</span> col = 10; <span style="color: #008000;">//</span><span style="color: #008000;">列数</span>

<span style="color: #008000;">//</span><span style="color: #008000;">生成矩阵html  &lt;tr&gt;--行标签 &lt;td&gt;--列标签</span>
<span style="color: #0000ff;">let</span> gridHtml = ''<span style="color: #000000;">;
</span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = 0; i &lt; row; i++<span style="color: #000000;">) {
　　gridHtml </span>+= '&lt;tr&gt;'
　　<span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> j = 0; j &lt; col; j++<span style="color: #000000;">) {
　　　　gridHtml </span>+= '&lt;td&gt;&lt;span class="blocks"&gt;&lt;/span&gt;&lt;/td&gt;'<span style="color: #000000;">;
　　}
　　gridHtml </span>+= '&lt;tr&gt;'<span style="color: #000000;">
}
</span><span style="color: #008000;">//</span><span style="color: #008000;">写入html</span>
document.getElementById('grid').innerHTML = gridHtml;</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei';">&nbsp;写一下矩阵和方格的CSS样式。</span></p>
<div class="cnblogs_code">
<pre><code><span style="font-family: 'Microsoft YaHei';"><span style="color: #800000;">#grid </span>{<span style="color: #ff0000;">
    margin</span>:<span style="color: #0000ff;"> auto</span>;  <span style="color: #008000;">/*</span><span style="color: #008000;"> 让矩阵居中显示于页面 </span><span style="color: #008000;">*/</span>
}<span style="color: #800000;">

.blocks </span>{<span style="color: #ff0000;">
    width</span>:<span style="color: #0000ff;"> 30px</span>;<span style="color: #ff0000;">
    height</span>:<span style="color: #0000ff;"> 30px</span>;<span style="color: #ff0000;">
    line-height</span>:<span style="color: #0000ff;"> 30px</span>;<span style="color: #ff0000;">
    display</span>:<span style="color: #0000ff;"> block</span>;   <span style="color: #008000;">/*</span><span style="color: #008000;"> 让span以block方式显示 </span><span style="color: #008000;">*/</span><span style="color: #ff0000;">
    text-align</span>:<span style="color: #0000ff;"> center</span>;<span style="color: #ff0000;">
    border</span>:<span style="color: #0000ff;"> solid 1px #000</span>;<span style="color: #ff0000;">
    user-select</span>:<span style="color: #0000ff;"> none</span>;  <span style="color: #008000;">/*</span><span style="color: #008000;"> 设置不可拖拽选中 </span><span style="color: #008000;">*/</span><span style="color: #ff0000;">
    cursor</span>:<span style="color: #0000ff;"> pointer</span>;  <span style="color: #008000;">/*</span><span style="color: #008000;"> 设置鼠标停留样式 </span><span style="color: #008000;">*/</span>
}<span style="color: #800000;">

.blocks:hover </span>{<span style="color: #ff0000;">
    background</span>:<span style="color: #0000ff;"> #0af</span>;  <span style="color: #008000;">/*</span><span style="color: #008000;"> 鼠标停留时背景颜色变化 </span><span style="color: #008000;">*/</span>
}</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei';">至此打开页面，矩阵就初步显示出来了。</span></p>
<p><span style="font-family: 'Microsoft YaHei';"><img src="./images/原生 JS 实现扫雷 (分析+代码实现)1.png" alt="" /></span></p>
<h3><span style="font-family: 'Microsoft YaHei';">把矩阵的方格放入二维数组中</span></h3>
<p><span style="font-family: 'Microsoft YaHei';">我们先定义一个全局变量grid。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">把刚才写的生成矩阵的代码写成一个函数 function init_grid()</span></p>
<p><span style="font-family: 'Microsoft YaHei';">document.getElementsByClassName('blocks') 返回的是一个一维数组，我们把它通过两个for循环转化为二维数组。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">给每个方格定义一个属性 count 计雷数 ---&nbsp; blocks[i].count = 0;</span></p>
<p><span style="font-family: 'Microsoft YaHei';">然后把返回值赋值给grid ---&nbsp; grid = init_grid();</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> row = 10; <span style="color: #008000;">//</span><span style="color: #008000;">行数</span>
<span style="color: #0000ff;">var</span> col = 10; <span style="color: #008000;">//</span><span style="color: #008000;">列数</span>
<span style="color: #0000ff;">var</span> grid =<span style="color: #000000;"> init_grid();

</span><span style="color: #008000;">//</span><span style="color: #008000;">初始化矩阵 (row-行数 col-列数)</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> init_grid() {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">生成矩阵html &lt;tr&gt;--行标签 &lt;td&gt;--列标签</span>
    <span style="color: #0000ff;">let</span> gridHtml = ''<span style="color: #000000;">;
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let </span>i = 0; i &lt; row; i++<span style="color: #000000;">) {
        gridHtml </span>+= '&lt;tr&gt;'
        <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> j = 0; j &lt; col; j++<span style="color: #000000;">) {
            gridHtml </span>+=
                '&lt;td&gt;&lt;span class="blocks"&gt;&lt;/span&gt;&lt;/td&gt;'<span style="color: #000000;">;
        }
        gridHtml </span>+= '&lt;tr&gt;'<span style="color: #000000;">
    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;">写入html</span>
    document.getElementById('grid').innerHTML =<span style="color: #000000;"> gridHtml;

    </span><span style="color: #008000;">//</span><span style="color: #008000;">返回矩阵二维数组</span>
    <span style="color: #0000ff;">let</span> blocks = document.getElementsByClassName('blocks'<span style="color: #000000;">);
    <span style="color: #0000ff;">let</span> grid </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> Array();
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = 0; i &lt; blocks.length; i++<span style="color: #000000;">) {
        </span><span style="color: #0000ff;">if</span> (i % col === 0<span style="color: #000000;">) {
            grid.push(</span><span style="color: #0000ff;">new</span><span style="color: #000000;"> Array());
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;">初始化计雷数</span>
        blocks[i].count = 0<span style="color: #000000;">;
        grid[parseInt(i </span>/<span style="color: #000000;"> col)].push(blocks[i]);
    }
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> grid;
}</span></pre>
</div>
<p><span style="font-family: 'Microsoft YaHei';">写完了这段我们先写一段代码测试下grid有没有赋值成功，遍历grid把方格的值改为对应的坐标。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = 0; i &lt; row; i++<span style="color: #000000;">) {
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> j = 0; j &lt; col; j++<span style="color: #000000;">) {
        grid[i][j].innerHTML </span>= i + ',' +<span style="color: #000000;"> j;
    }
}</span></pre>
</div>
<p>可以看到 grid 已经赋值成功！没成功的回去检查下代码。(Tip:测试完记得把测试代码删除)</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)2.png" alt="" /></p>
<h3><span style="font-family: 'Microsoft YaHei';">方格的点击事件</span></h3>
<p><span style="font-family: 'Microsoft YaHei';">定义一个函数 function&nbsp;block_click( _i, _j, e) 的大致框架</span></p>
<p><span style="font-family: 'Microsoft YaHei';">e为传入的鼠标事件，e.button ( 0为左键，2为右键 )。</span></p>
<p><span style="font-family: 'Microsoft YaHei';">isOpen属性为自定义属性，用来判断方格是否打开。</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方格点击事件 _i：坐标i _j:坐标j e:鼠标事件</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> block_click(_i, _j, e) {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">跳过已打开的方格</span>
    <span style="color: #0000ff;">if</span><span style="color: #000000;"> (grid[_i][_j].isOpen) {
        </span><span style="color: #0000ff;">return</span><span style="color: #000000;">;
    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;">鼠标左键打开方格</span>
    <span style="color: #0000ff;">if</span> (e.button === 0<span style="color: #000000;">) {

    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;">鼠标右键标记方格</span>
    <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (e.button === 2<span style="color: #000000;">) {

    }
}</span></pre>
</div>
<p>然后修改下之前写在 init_grid 函数里的&lt;span&gt;的属性，绑定 onmousedown 事件,传入 i,j 坐标，和鼠标事件 event</p>
<div class="cnblogs_code">
<pre><code>gridHtml += '&lt;td&gt;&lt;span class="blocks" onmousedown="block_click(' + i + ',' + j + ',event)"&gt;&lt;/span&gt;&lt;/td&gt;';</pre>
</div>
<p>修改下body的属性 加入防拖拽生成新页面和屏蔽右键菜单。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> ondragstart:防拖拽生成新页面 oncontextmenu:屏蔽右键菜单</span><span style="color: #008000;">--&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body </span><span style="color: #ff0000;">ondragstart</span><span style="color: #0000ff;">='return </span><span style="color: #ff0000;">false' oncontextmenu</span><span style="color: #0000ff;">='self.event.returnValue=false'</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>我们在鼠标左键事件里面写下测试代码，当左键方格时显示它的坐标。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">鼠标左键打开方格</span>
<span style="color: #0000ff;">if</span> (e.button === 0<span style="color: #000000;">) {
    grid[_i][_j].innerHTML </span>= _i + ',' +<span style="color: #000000;"> _j;
}</span></pre>
</div>
<p>&nbsp;效果如下,没成功的回去检查下代码。(Tip:测试完记得把测试代码删除)</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)3.png" alt="" /></p>
<h3>方格的标记</h3>
<p>在鼠标右键事件写标记代码，这里用 ▲ 来作为标记。</p>
<p>右击一次添加标记，再次右击删除标记。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">鼠标右键标记方格</span>
<span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (e.button === 2<span style="color: #000000;">) {

    <span style="color: #0000ff;">let</span> block </span>=<span style="color: #000000;"> grid[_i][_j];
    </span><span style="color: #0000ff;">if</span> (block.innerHTML !== '▲'<span style="color: #000000;">) {
        block.innerHTML </span>= '▲'<span style="color: #000000;">;
    } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
        block.innerHTML </span>= ''<span style="color: #000000;">;
    }
}</span></pre>
</div>
<p>效果如下：</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)4.png" alt="" /></p>
<h3>随机生成地雷</h3>
<p>由于第一次打开的方格不能为地雷所以我们把生成地雷的函数放在第一次点击方格时。</p>
<p>先定义全局变量 maxCount --- 最大地雷数&nbsp; isFirstOpen --- 是否第一次打开方格。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> row = 10; <span style="color: #008000;">//</span><span style="color: #008000;">行数</span>
<span style="color: #0000ff;">var</span> col = 10; <span style="color: #008000;">//</span><span style="color: #008000;">列数</span>
<span style="color: #0000ff;">var</span> grid =<span style="color: #000000;"> init_grid();
</span><span style="color: #0000ff;">var</span> maxCount = 10; <span style="color: #008000;">//</span><span style="color: #008000;">最大地雷数量</span>
<span style="color: #0000ff;">var</span> isFirstOpen = <span style="color: #0000ff;">true</span>; <span style="color: #008000;">//</span><span style="color: #008000;">第一次打开方格</span></pre>
</div>
<p>在鼠标左键事件里面写第一次打开方格生成地雷的代码的大致框架。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">鼠标左键打开方格</span>
<span style="color: #0000ff;">if</span> (e.button === 0<span style="color: #000000;">) {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">第一次打开</span>
    <span style="color: #0000ff;">if</span><span style="color: #000000;"> (isFirstOpen) {

        isFirstOpen </span>= <span style="color: #0000ff;">false</span><span style="color: #000000;">;
        <span style="color: #0000ff;">let</span> count </span>= 0; <span style="color: #008000;">//</span><span style="color: #008000;">当前地雷数</span>

        <span style="color: #008000;">//</span><span style="color: #008000;">生成地雷</span>
        <span style="color: #0000ff;">while</span> (count &lt;<span style="color: #000000;"> maxCount) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">........</span>
<span style="color: #000000;">        }
    }
}</span></pre>
</div>
<p>完善生成地雷代码：</p>
<p>生成随机坐标 ri，rj，判断该坐标不等于第一次点击方格的坐标以及该坐标表方格不为地雷。</p>
<p>条件成立，将坐标对应方格的 isMine 设置为true，当前地雷数+1，并使九宫格内非雷方格的计雷数 count +1</p>
<p>自定义属性isMine代表方格为地雷。</p>
<p>自定义属性count为计雷数。</p>
<p>当地雷数大于最大地雷数，结束循环。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">生成地雷</span>
<span style="color: #0000ff;">while</span> (count &lt;<span style="color: #000000;"> maxCount) {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">生成随机坐标</span>
    <span style="color: #0000ff;">let</span> ri = Math.floor(Math.random() *<span style="color: #000000;"> row);
    <span style="color: #0000ff;">let</span> rj </span>= Math.floor(Math.random() *<span style="color: #000000;"> col);

    </span><span style="color: #008000;">//</span><span style="color: #008000;">坐标不等于第一次点击方格的坐标 &amp;&amp; 非雷方格</span>
    <span style="color: #0000ff;">if</span> (!(ri === _i &amp;&amp; rj === _j) &amp;&amp; !<span style="color: #000000;">grid[ri][rj].isMine) {
        grid[ri][rj].isMine </span>= <span style="color: #0000ff;">true</span>; <span style="color: #008000;">//</span><span style="color: #008000;">自定义属性isMine代表方格为地雷</span>
        count++; <span style="color: #008000;">//</span><span style="color: #008000;">当前地雷数+1</span>

        <span style="color: #008000;">//</span><span style="color: #008000;">更新九宫格内非雷方格的计雷数</span>
        <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = ri - 1; i &lt; ri + 2; i++<span style="color: #000000;">) {
            </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> j = rj - 1; j &lt; rj + 2; j++<span style="color: #000000;">) {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">判断坐标防越界</span>
                <span style="color: #0000ff;">if</span> (i &gt; -1 &amp;&amp; j &gt; -1 &amp;&amp; i &lt; row &amp;&amp; j &lt;<span style="color: #000000;"> col) {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;">计雷数+1</span>
                    grid[i][j].count++<span style="color: #000000;">;
                }
            }
        }
    }
}</span></pre>
</div>
<p>写个测试代码在生成地雷后显示所有方格的状态。(Tip:测试完记得把测试代码删除)</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = 0; i &lt; row; i++<span style="color: #000000;">) {
    </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> j = 0; j &lt; col; j++<span style="color: #000000;">) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">判断方格是否为雷</span>
        <span style="color: #0000ff;">if</span><span style="color: #000000;"> (grid[i][j].isMine) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">显示为雷</span>
            grid[i][j].innerHTML = '雷'<span style="color: #000000;">;
        } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">否则显示计雷数</span>
            grid[i][j].innerHTML =<span style="color: #000000;"> grid[i][j].count;
        }
    }
}</span></pre>
</div>
<p>效果如下：可以看到已经随机生成了雷，计雷数也正确显示了。</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)5.png" alt="" /></p>
<h3>方格的打开事件</h3>
<p>在生成地雷的代码下，加入方格打开代码函数 block_open(_i,_j) 的大致框架。</p>
<p>定义 function op(block) 函数设定打开方格的状态与样式。</p>
<p>判定打开的方格的类型</p>
<p>block.isMine 为打开地雷方格 --&gt; 游戏结束</p>
<p>block.count === 0 为打开计雷数为0的方格&nbsp;--&gt; 连锁打开非雷方格</p>
<p>else 为打开计雷数大于0的方格&nbsp;--&gt; 显示方格计雷数</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">鼠标左键打开方格</span>
<span style="color: #0000ff;">if</span> (e.button === 0<span style="color: #000000;">) {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">第一次打开</span>
    <span style="color: #0000ff;">if</span><span style="color: #000000;"> (isFirstOpen) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">.......</span>
<span style="color: #000000;">    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;">执行打开方格函数</span>
<span style="color: #000000;">    block_open(_i, _j);

    </span><span style="color: #008000;">//</span><span style="color: #008000;">打开方格函数</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> block_open(_i, _j) {

        <span style="color: #0000ff;">let</span> block </span>=<span style="color: #000000;"> grid[_i][_j];
        op(block);

        </span><span style="color: #008000;">//</span><span style="color: #008000;">设定打开方格的状态与样式</span>
        <span style="color: #0000ff;">function</span><span style="color: #000000;"> op(block) {
            block.isOpen </span>= <span style="color: #0000ff;">true</span>; <span style="color: #008000;">//</span><span style="color: #008000;">isOpen为自定义属性，设置为true代表已打开</span>
            block.style.background = '#ccc'; <span style="color: #008000;">//</span><span style="color: #008000;">将背景设置为灰色</span>
            block.style.cursor = 'default'; <span style="color: #008000;">//</span><span style="color: #008000;">将鼠标停留样式设置为默认</span>
<span style="color: #000000;">        }

        </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (block.isMine) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">踩雷</span>
        } <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (block.count === 0<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">打开计雷数为0的方格</span>
        } <span style="color: #0000ff;">else</span><span style="color: #000000;"> {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">打开计雷数不为0的方格</span>
<span style="color: #000000;">        }
    }
}</span></pre>
</div>
<h3>打开非雷方格显示计雷数</h3>
<p>&nbsp;我们先把最简单的显示方格计雷数搞定。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">打开计雷数不为0的方格</span>
    block.innerHTML = block.count;  <span style="color: #008000;">//</span><span style="color: #008000;">显示计雷数</span>
}</pre>
</div>
<p>效果如下：</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)6.png" alt="" /></p>
<h3>踩雷游戏结束</h3>
<p>接下来写踩雷代码，当打开的方格为雷时，将其显示为'雷'，并打开所有的地雷，提示游戏结束。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">if</span><span style="color: #000000;"> (block.isMine) {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">踩雷</span>
    block.innerHTML = '雷'; <span style="color: #008000;">//</span><span style="color: #008000;">显示为 '雷'</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">遍历矩阵打开所有的地雷方格</span>
    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = 0; i &lt; row; i++<span style="color: #000000;">) {
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> j = 0; j &lt; col; j++<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">找到地雷</span>
            block =<span style="color: #000000;"> grid[i][j];
            </span><span style="color: #0000ff;">if</span> (!block.isOpen &amp;&amp;<span style="color: #000000;"> block.isMine) {
                op(block); </span><span style="color: #008000;">//</span><span style="color: #008000;">设置打开状态和样式</span>
                block.innerHTML = '雷'; <span style="color: #008000;">//</span><span style="color: #008000;">显示为 '雷'</span>
<span style="color: #000000;">            }
        }
    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;">提示游戏结束</span>
    alert("游戏结束"<span style="color: #000000;">);
}</span></pre>
</div>
<p>效果如下：</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)7.png" alt="" /></p>
<h3>连锁打开方格</h3>
<p>打开的方格为计雷数为0的方格，自动打开九宫格内的非雷方格，循环递归到没有为止。</p>
<p>计雷数为0就没必要让innerHtml显示0了，保持空白就行。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (block.count === 0<span style="color: #000000;">) {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">打开计雷数为0的方格</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">遍历九宫格内的方格</span>
    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = _i - 1; i &lt; _i + 2; i++<span style="color: #000000;">) {
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> j = _j - 1; j &lt; _j + 2; j++<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">判断是否越界&amp;&amp;跳过已打开的方格&amp;&amp;非雷</span>
            <span style="color: #0000ff;">if</span> (i &gt; -1 &amp;&amp; j &gt; -1 &amp;&amp; i &lt; row &amp;&amp; j &lt; col &amp;&amp; !grid[i][j].isOpen &amp;&amp; !<span style="color: #000000;">grid[i][j].ismine) {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">递归打开方格函数</span>
<span style="color: #000000;">                block_open(i, j);
            }
        }
    }
}</span></pre>
</div>
<p>效果如下：</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)8.png" alt="" /></p>
<h3>游戏胜利条件</h3>
<p>扫雷大体框架已经出来了，我们现在做胜利条件的判定。</p>
<p>在方格点击函数最后写判断代码。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">方块点击事件 _i：坐标i _j:坐标j e:鼠标事件</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> block_click(_i, _j, e) {

    </span><span style="color: #008000;">//</span><span style="color: #008000;">跳过已打开的方块</span>
    <span style="color: #0000ff;">if</span><span style="color: #000000;"> (grid[_i][_j].isOpen) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">...</span>
<span style="color: #000000;">    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;">鼠标左键打开方块</span>
    <span style="color: #0000ff;">if</span> (e.button === 0<span style="color: #000000;">) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">...</span>
<span style="color: #000000;">    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;">鼠标右键标记方块</span>
    <span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (e.button === 2<span style="color: #000000;">) {
        </span><span style="color: #008000;">//</span><span style="color: #008000;">...</span>
<span style="color: #000000;">    }

    </span><span style="color: #008000;">//</span><span style="color: #008000;">遍历矩阵</span>
    <span style="color: #0000ff;">let</span> isWin = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">for</span> (let i = 0; i &lt; row; i++<span style="color: #000000;">) {
        </span><span style="color: #0000ff;">for</span> (let j = 0; j &lt; col; j++<span style="color: #000000;">) {<br />　　　　　　　<span style="color: #0000ff;">let</span> block = grid[i][j];<br />
            </span><span style="color: #008000;">//</span><span style="color: #008000;">判断游戏胜利条件(所有的非雷方格已打开)</span>
            <span style="color: #0000ff;">if</span> (!block.isMine &amp;&amp; !<span style="color: #000000;">block.isOpen) {
                </span><span style="color: #008000;">//</span><span style="color: #008000;">如果有未打开的非雷方块 条件不成立</span>
                isWin = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
            }
        }
    }
    </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (isWin) {
        alert(</span>"游戏胜利"<span style="color: #000000;">);
    }
}</span></pre>
</div>
<p>效果如下：（还专门玩了一遍^ ^）</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)9.png" alt="" /></p>
<p>游戏部分到这里就完成了！</p>
<h3>剩余地雷数与计时器</h3>
<p>最后，我们做一下剩余地雷数和计时器的显示。</p>
<p>我们写个 &lt;div&gt; 在 &lt;table&gt; 的上面，放两个 &lt;span&gt; 来做显示框，&lt;label&gt; 用来给 js 计数。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='bar'</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">='bar'</span><span style="color: #0000ff;">&gt;</span>剩余雷数：<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">label </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='count'</span><span style="color: #0000ff;">&gt;</span>0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">label</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">='bar'</span><span style="color: #0000ff;">&gt;</span>计时：<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">label </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='time'</span><span style="color: #0000ff;">&gt;</span>0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">label</span><span style="color: #0000ff;">&gt;</span>s<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">table </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='grid'</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">table</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>再写下CSS样式：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #800000;">#bar </span>{<span style="color: #ff0000;">
    text-align</span>:<span style="color: #0000ff;"> center</span>;<span style="color: #ff0000;">
    margin-bottom</span>:<span style="color: #0000ff;"> 20px</span>;
}<span style="color: #800000;">

.bar </span>{<span style="color: #ff0000;">
    height</span>:<span style="color: #0000ff;"> 25px</span>;<span style="color: #ff0000;">
    width</span>:<span style="color: #0000ff;"> 150px</span>;<span style="color: #ff0000;">
    line-height</span>:<span style="color: #0000ff;"> 25px</span>;<span style="color: #ff0000;">
    display</span>:<span style="color: #0000ff;"> inline-block</span>;<span style="color: #ff0000;">
    border</span>:<span style="color: #0000ff;"> solid 1px #000</span>;<span style="color: #ff0000;">
    margin-left</span>:<span style="color: #0000ff;"> 20px</span>;<span style="color: #ff0000;">
    margin-right</span>:<span style="color: #0000ff;"> 20px</span>;
}</pre>
</div>
<p>效果如下：</p>
<p><img src="./images/原生 JS 实现扫雷 (分析+代码实现)10.png" alt="" /></p>
<p>在 js 中定义两个全局变量拿到 &lt;lable&gt; count 和 time</p>
<p>然后让地雷数量等于最大地雷数，设置个100ms定时器，每次+0.1s，保留一位小数。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span> count = document.getElementById('count'); <span style="color: #008000;">//</span><span style="color: #008000;">剩余地雷数</span>
count.innerHTML = maxCount; <span style="color: #008000;">//</span><span style="color: #008000;">初始化剩余雷数</span>

<span style="color: #0000ff;">var</span> time = document.getElementById('time'); <span style="color: #008000;">//</span><span style="color: #008000;">计时器</span>
<span style="color: #0000ff;">var</span> timer = setInterval(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
  let seconds </span>= (parseFloat(time.innerHTML) + 0.1).toFixed(1); <span style="color: #008000;">//</span><span style="color: #008000;">保留一位小数</span>
  time.innerHTML =<span style="color: #000000;"> seconds;
}, </span>100) <span style="color: #008000;">//</span><span style="color: #008000;">定时器 100ms执行一次</span></pre>
</div>
<p>我们修改下方格点击事件中遍历矩阵的代码，更新剩余地雷数，胜利时结束计时。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">遍历矩阵</span>
<span style="color: #0000ff;">let</span> isWin = <span style="color: #0000ff;">true</span><span style="color: #000000;">;
count.innerHTML </span>= maxCount; <span style="color: #008000;">//</span><span style="color: #008000;">重置剩余地雷数</span>
<span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = 0; i &lt; row; i++<span style="color: #000000;">) {
    </span><span style="color: #0000ff;">for</span> (let j = 0; j &lt; col; j++<span style="color: #000000;">) {
        <span style="color: #0000ff;">let</span> block </span>=<span style="color: #000000;"> grid[i][j];

        </span><span style="color: #008000;">//</span><span style="color: #008000;">找到标记</span>
        <span style="color: #0000ff;">if</span> (block.innerHTML === '▲'<span style="color: #000000;">) {
            count.innerHTML </span>= parseInt(count.innerHTML) - 1; <span style="color: #008000;">//</span><span style="color: #008000;">剩余地雷数-1</span>
<span style="color: #000000;">        }

        </span><span style="color: #008000;">//</span><span style="color: #008000;">判断游戏胜利条件(所有的非雷方格已打开)</span>
        <span style="color: #0000ff;">if</span> (!block.isMine &amp;&amp; !<span style="color: #000000;">block.isOpen) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">如果有未打开的非雷方块 条件不成立</span>
            isWin = <span style="color: #0000ff;">false</span><span style="color: #000000;">;
        }
    }
}
</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (isWin) {
    clearInterval(timer); </span><span style="color: #008000;">//</span><span style="color: #008000;">游戏胜利结束计时，清除定时器</span>
    alert("游戏胜利"<span style="color: #000000;">);
}</span></pre>
</div>
<p>再修改踩雷的代码，结束计时。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">if</span><span style="color: #000000;"> (block.isMine) {
    </span><span style="color: #008000;">//</span><span style="color: #008000;">踩雷</span>
    block.innerHTML = '雷'; <span style="color: #008000;">//</span><span style="color: #008000;">显示为 '雷'</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">遍历矩阵打开所有的地雷方格</span>
    <span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> i = 0; i &lt; row; i++<span style="color: #000000;">) {
        </span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">let</span> j = 0; j &lt; col; j++<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;">找到地雷</span>
            block =<span style="color: #000000;"> grid[i][j];
            </span><span style="color: #0000ff;">if</span> (!block.isOpen &amp;&amp;<span style="color: #000000;"> block.isMine) {
                op(block); </span><span style="color: #008000;">//</span><span style="color: #008000;">设置打开状态和样式</span>
                block.innerHTML = '雷'; <span style="color: #008000;">//</span><span style="color: #008000;">显示为 '雷'</span>
<span style="color: #000000;">            }
        }
    }
    clearInterval(timer); </span><span style="color: #008000;">//</span><span style="color: #008000;">游戏结束停止计时，清除定时器</span>
    <span style="color: #008000;">//</span><span style="color: #008000;">提示游戏结束</span>
    alert("游戏结束"<span style="color: #000000;">);
}</span></pre>
</div>
<p>OK，大功告成！！！后续还可以加入选择难度的功能，重新开始按钮，动画效果等等，这个就看你们发挥了！！</p>
<p>&nbsp;<img src="./images/原生 JS 实现扫雷 (分析+代码实现)11.png" alt="" /></p>
<p>&nbsp;</p>
<h2>完整代码</h2>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;!</span><span style="color: #ff00ff;">DOCTYPE html</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>扫雷<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">title</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span><span style="background-color: #f5f5f5; color: #800000;">
    #bar </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;">
      text-align</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> center</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      margin-bottom</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;">20px</span><span style="background-color: #f5f5f5; color: #000000;">;</span>
    <span style="background-color: #f5f5f5; color: #000000;">}</span><span style="background-color: #f5f5f5; color: #800000;">

    .bar </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;">
      height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 25px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 150px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      line-height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 25px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      display</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> inline-block</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> solid 1px #000</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      margin-left</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 20px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      margin-right</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 20px</span><span style="background-color: #f5f5f5; color: #000000;">;</span>
    <span style="background-color: #f5f5f5; color: #000000;">}</span><span style="background-color: #f5f5f5; color: #800000;">

    #grid </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;">
      margin</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> auto</span><span style="background-color: #f5f5f5; color: #000000;">;</span>
    <span style="background-color: #f5f5f5; color: #000000;">}</span><span style="background-color: #f5f5f5; color: #800000;">

    .blocks </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;">
      width</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 30px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 30px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      line-height</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> 30px</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      display</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> block</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      text-align</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> center</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      border</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> solid 1px #000</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      user-select</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> none</span><span style="background-color: #f5f5f5; color: #000000;">;</span><span style="background-color: #f5f5f5; color: #ff0000;">
      cursor</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> pointer</span><span style="background-color: #f5f5f5; color: #000000;">;</span>
    <span style="background-color: #f5f5f5; color: #000000;">}</span><span style="background-color: #f5f5f5; color: #800000;">

    .blocks:hover </span><span style="background-color: #f5f5f5; color: #000000;">{</span><span style="background-color: #f5f5f5; color: #ff0000;">
      background</span><span style="background-color: #f5f5f5; color: #000000;">:</span><span style="background-color: #f5f5f5; color: #0000ff;"> #0af</span><span style="background-color: #f5f5f5; color: #000000;">;</span>
    <span style="background-color: #f5f5f5; color: #000000;">}</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">style</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">head</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #008000;">&lt;!--</span><span style="color: #008000;"> ondragstart:防拖拽生成新页面 oncontextmenu:屏蔽右键菜单</span><span style="color: #008000;">--&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">body </span><span style="color: #ff0000;">ondragstart</span><span style="color: #0000ff;">='return </span><span style="color: #ff0000;">false' oncontextmenu</span><span style="color: #0000ff;">='self.event.returnValue=false'</span><span style="color: #0000ff;">&gt;</span>

  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='bar'</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">='bar'</span><span style="color: #0000ff;">&gt;</span>剩余雷数：<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">label </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='count'</span><span style="color: #0000ff;">&gt;</span>0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">label</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">span </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">='bar'</span><span style="color: #0000ff;">&gt;</span>计时：<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">label </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='time'</span><span style="color: #0000ff;">&gt;</span>0<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">label</span><span style="color: #0000ff;">&gt;</span>s<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">span</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">table </span><span style="color: #ff0000;">id</span><span style="color: #0000ff;">='grid'</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">table</span><span style="color: #0000ff;">&gt;</span>

  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> row </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">10</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">行数</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> col </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">10</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">列数</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> maxCount </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">10</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">最大地雷数量</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> isFirstOpen </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">第一次打开方格</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> grid </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> init_grid(); </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">初始化</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> count </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">count</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">); </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">剩余雷数</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">var</span><span style="background-color: #f5f5f5; color: #000000;"> time </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">time</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">); </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">计时</span>

    <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">初始化矩阵 (row-行数 col-列数)</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> init_grid() {

      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">生成矩阵html &lt;tr&gt;--行标签 &lt;td&gt;--列标签</span>
<span style="background-color: #f5f5f5; color: #000000;"><span style="color: #0000ff;">      let</span> gridHtml </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">''</span><span style="background-color: #f5f5f5; color: #000000;">;
      </span><span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> i </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> row; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
        gridHtml </span><span style="background-color: #f5f5f5; color: #000000;">+=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;tr&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span>
        <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> j </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; j </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> col; j</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
          gridHtml </span><span style="background-color: #f5f5f5; color: #000000;">+=</span>
            <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;td&gt;&lt;span class="blocks" onmousedown="block_click(</span><span style="background-color: #f5f5f5; color: #000000;">'</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> i </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">,</span><span style="background-color: #f5f5f5; color: #000000;">'</span> <span style="background-color: #f5f5f5; color: #000000;">+</span><span style="background-color: #f5f5f5; color: #000000;"> j </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">,event)"&gt;&lt;/span&gt;&lt;/td&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
        }
        gridHtml </span><span style="background-color: #f5f5f5; color: #000000;">+=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">&lt;tr&gt;</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">
      }
      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">写入html</span>
<span style="background-color: #f5f5f5; color: #000000;">      document.getElementById(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">grid</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">).innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> gridHtml;

      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">返回矩阵二维数组</span>
<span style="background-color: #f5f5f5; color: #000000;"><span style="color: #0000ff;">      let</span> blocks </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> document.getElementsByClassName(</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">blocks</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">);
      <span style="color: #0000ff;">let</span> grid </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Array();
      </span><span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> i </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> blocks.length; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
        </span><span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (i </span><span style="background-color: #f5f5f5; color: #000000;">%</span><span style="background-color: #f5f5f5; color: #000000;"> col </span><span style="background-color: #f5f5f5; color: #000000;">===</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">) {
          grid.push(</span><span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Array());
        }
        </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">初始化计雷数</span>
<span style="background-color: #f5f5f5; color: #000000;">        blocks[i].count </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">;
        grid[parseInt(i </span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;"> col)].push(blocks[i]);
      }
      </span><span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> grid;
    }

    </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">方格点击事件 _i：坐标i _j:坐标j e:鼠标事件</span>
    <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> block_click(_i, _j, e) {

      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">跳过已打开的方格</span>
      <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (grid[_i][_j].isOpen) {
        </span><span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;">;
      }

      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">鼠标左键打开方格</span>
      <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (e.button </span><span style="background-color: #f5f5f5; color: #000000;">===</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">) {

        </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">第一次打开</span>
        <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (isFirstOpen) {

          isFirstOpen </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">false</span><span style="background-color: #f5f5f5; color: #000000;">;
          <span style="color: #0000ff;">let</span> count </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">当前地雷数</span>

          <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">生成地雷</span>
          <span style="background-color: #f5f5f5; color: #0000ff;">while</span><span style="background-color: #f5f5f5; color: #000000;"> (count </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> maxCount) {

            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">生成随机坐标</span>
<span style="background-color: #f5f5f5; color: #000000;"><span style="color: #0000ff;">            let</span> ri </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> Math.floor(Math.random() </span><span style="background-color: #f5f5f5; color: #000000;">*</span><span style="background-color: #f5f5f5; color: #000000;"> row);
            <span style="color: #0000ff;">let</span> rj </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> Math.floor(Math.random() </span><span style="background-color: #f5f5f5; color: #000000;">*</span><span style="background-color: #f5f5f5; color: #000000;"> col);

            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">坐标不等于第一次点击方格的坐标 &amp;&amp; 非雷方格</span>
            <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (</span><span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">(ri </span><span style="background-color: #f5f5f5; color: #000000;">===</span><span style="background-color: #f5f5f5; color: #000000;"> _i </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> rj </span><span style="background-color: #f5f5f5; color: #000000;">===</span><span style="background-color: #f5f5f5; color: #000000;"> _j) </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span> <span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">grid[ri][rj].isMine) {
              grid[ri][rj].isMine </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">自定义属性isMine代表方格为地雷</span>
<span style="background-color: #f5f5f5; color: #000000;">              count</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">当前地雷数+1</span>

              <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">更新九宫格内非雷方格的计雷数</span>
              <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> i </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> ri </span><span style="background-color: #f5f5f5; color: #000000;">-</span> <span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> ri </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">2</span><span style="background-color: #f5f5f5; color: #000000;">; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
                </span><span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> j </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> rj </span><span style="background-color: #f5f5f5; color: #000000;">-</span> <span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">; j </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> rj </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">2</span><span style="background-color: #f5f5f5; color: #000000;">; j</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
                  </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">判断坐标防越界</span>
                  <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (i </span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span> <span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;">1</span> <span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> j </span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span> <span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;">1</span> <span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> row </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> j </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> col) {
                    </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">计雷数+1</span>
<span style="background-color: #f5f5f5; color: #000000;">                    grid[i][j].count</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">;
                  }
                }
              }
            }
          }
        }

        </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">执行打开方格函数</span>
<span style="background-color: #f5f5f5; color: #000000;">        block_open(_i, _j);

        </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">打开方格函数</span>
        <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> block_open(_i, _j) {

          <span style="color: #0000ff;">let</span> block </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> grid[_i][_j];
          op(block);

          </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">设定打开方格的状态与样式</span>
          <span style="background-color: #f5f5f5; color: #0000ff;">function</span><span style="background-color: #f5f5f5; color: #000000;"> op(block) {
            block.isOpen </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">isOpen为自定义属性，设置为true代表已打开</span>
<span style="background-color: #f5f5f5; color: #000000;">            block.style.background </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">#ccc</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">将背景设置为灰色</span>
<span style="background-color: #f5f5f5; color: #000000;">            block.style.cursor </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">default</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">将鼠标停留样式设置为默认</span>
<span style="background-color: #f5f5f5; color: #000000;">          }

          </span><span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (block.isMine) {
            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">踩雷</span>
<span style="background-color: #f5f5f5; color: #000000;">            block.innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">雷</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">显示为 '雷'</span>
            <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">遍历矩阵打开所有的地雷方格</span>
            <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> i </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> row; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
              </span><span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> j </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; j </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> col; j</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
                </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">找到地雷</span>
<span style="background-color: #f5f5f5; color: #000000;">                block </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> grid[i][j];
                </span><span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (</span><span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">block.isOpen </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> block.isMine) {
                  op(block); </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">设置打开状态和样式</span>
<span style="background-color: #f5f5f5; color: #000000;">                  block.innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">雷</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">显示为 '雷'</span>
<span style="background-color: #f5f5f5; color: #000000;">                }
              }
            }
            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">提示游戏结束</span>
<span style="background-color: #f5f5f5; color: #000000;">            alert(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">游戏结束</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">);
          } </span><span style="background-color: #f5f5f5; color: #0000ff;">else</span> <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (block.count </span><span style="background-color: #f5f5f5; color: #000000;">===</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">) {
            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">打开计雷数为0的方格</span>
            <span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">遍历九宫格内的方格</span>
            <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> i </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _i </span><span style="background-color: #f5f5f5; color: #000000;">-</span> <span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> _i </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">2</span><span style="background-color: #f5f5f5; color: #000000;">; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
              </span><span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> j </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> _j </span><span style="background-color: #f5f5f5; color: #000000;">-</span> <span style="background-color: #f5f5f5; color: #000000;">1</span><span style="background-color: #f5f5f5; color: #000000;">; j </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> _j </span><span style="background-color: #f5f5f5; color: #000000;">+</span> <span style="background-color: #f5f5f5; color: #000000;">2</span><span style="background-color: #f5f5f5; color: #000000;">; j</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
                </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">判断是否越界&amp;&amp;跳过已打开的方格&amp;&amp;非雷</span>
                <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (i </span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span> <span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;">1</span> <span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> j </span><span style="background-color: #f5f5f5; color: #000000;">&gt;</span> <span style="background-color: #f5f5f5; color: #000000;">-</span><span style="background-color: #f5f5f5; color: #000000;">1</span> <span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> row </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> j </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> col </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span> <span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">grid[i][j].isOpen </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span> <span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">grid[i][j].ismine) {
                  </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">递归打开方格函数</span>
<span style="background-color: #f5f5f5; color: #000000;">                  block_open(i, j);
                }
              }
            }
          } </span><span style="background-color: #f5f5f5; color: #0000ff;">else</span><span style="background-color: #f5f5f5; color: #000000;"> {
            </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">打开计雷数不为0的方格</span>
<span style="background-color: #f5f5f5; color: #000000;">            block.innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> block.count; </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">显示计雷数</span>
<span style="background-color: #f5f5f5; color: #000000;">          }

        }
      }
      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">鼠标右键标记方格</span>
      <span style="background-color: #f5f5f5; color: #0000ff;">else</span> <span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (e.button </span><span style="background-color: #f5f5f5; color: #000000;">===</span> <span style="background-color: #f5f5f5; color: #000000;">2</span><span style="background-color: #f5f5f5; color: #000000;">) {

        <span style="color: #0000ff;">let</span> block </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> grid[_i][_j];
        </span><span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (block.innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">!==</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">▲</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">) {
          block.innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">▲</span><span style="background-color: #f5f5f5; color: #000000;">'</span><span style="background-color: #f5f5f5; color: #000000;">;
        } </span><span style="background-color: #f5f5f5; color: #0000ff;">else</span><span style="background-color: #f5f5f5; color: #000000;"> {
          block.innerHTML </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">''</span><span style="background-color: #f5f5f5; color: #000000;">;
        }
      }

      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;">判断游戏是否结束(所有的非雷方格已打开)</span>
      <span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> i </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; i </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> row; i</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
        </span><span style="background-color: #f5f5f5; color: #0000ff;">for</span><span style="background-color: #f5f5f5; color: #000000;"> (<span style="color: #0000ff;">let</span> j </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">0</span><span style="background-color: #f5f5f5; color: #000000;">; j </span><span style="background-color: #f5f5f5; color: #000000;">&lt;</span><span style="background-color: #f5f5f5; color: #000000;"> col; j</span><span style="background-color: #f5f5f5; color: #000000;">++</span><span style="background-color: #f5f5f5; color: #000000;">) {
          </span><span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (</span><span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">grid[i][j].isMine </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span> <span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">grid[i][j].isOpen) {
            </span><span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;">;
          }
        }
      }
      alert(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">游戏胜利</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">);
    }
  </span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">body</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">html</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>