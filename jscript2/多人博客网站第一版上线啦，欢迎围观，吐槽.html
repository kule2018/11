<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修多人博客网站第一版上线啦，欢迎围观，吐槽' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>多人博客网站第一版上线啦，欢迎围观，吐槽</center></div><div class='banquan'>原文出处:本文由博客园博主蜀北乔少恭提供。<br/>
原文连接:https://www.cnblogs.com/ww-ervin-72/p/11319795.html</div><br>
    <p><strong><span style="background-color: #ffff00; font-size: 14px;"><a title="微识" href="http://129.204.39.6/" target="_blank"><span style="background-color: #ffff00;">网站地址</span></a></span></strong></p>
<p><span style="background-color: #ffff00;"><strong><span style="font-size: 14px;"><a href="https://github.com/wwervin72/weshier" target="_blank"><span style="background-color: #ffff00;">代码开源地址</span></a></span></strong></span></p>
<p>时间大概是在两年前吧，那时候刚接触到 nodejs，立志成为一名优秀全栈攻城狮的我，心心念着得有一个属于自己的网站。于是说干就干，一边学着一边捣鼓的各种花样。</p>
<p>曾梦想仗剑走天涯，然而后面因为工作忙就没去成，我的这个网站也因为各种原因迟迟没能上线，这其中也做过了好几个版本，一开始是前后端分离的，前端使用 angularjs（后面又改成了 vue），后端是 nodejs + mongodb，等这一版的也差不多做好的时候，感觉不是自己想要的样子，所以也就没上线。到后面觉得 golang 好玩，又去用它写了一些后端的接口。</p>
<p>到了今年三月份的时候，终于发现网站这个目标确实是拖了很长时间了。抽时间好好想了下自己想要做什么，决定抛弃之前的那套代码，不用自己比较熟悉的 前后端分离，vue 等技术，而使用 ejs 模板渲染，nodejs 的 Sequelize orm 库，使用 session 而不是 jwt 来持久化用户登录等。</p>
<p>代码基本上是晚上抽时间写的，后面因为加班，也停了一段时间。中途如果遇到一些问题，有时候进度也会耽搁个几天。再加上一些设计以及前端展示上的修修补补，导致整个项目也是花了比较长的时间。好在是一个萝卜一个坑的慢慢踩了过来，现在觉得网站终于可以上线了，后面要做的工作就是完善网站的一些没有功能（包括后端的管理界面等），修改一些的实现方式（准确的说就是优化代码），以及更重要的是丰富网站内容，也就是写博客记录一些成长路上的风景吧。</p>
<p>到此为止，废话也不多说了，代码也开源到了<a href="https://github.com/wwervin72/weshier" target="_blank">GitHub</a>上，有兴趣的朋友可以去围观一下，欢迎 start，也欢迎在 issue 里提出，指正各种问题。</p>
<p>说一下项目的运行方式吧，首先要 nodejs 环境，需要全局安装 gulp、nodemon 等包，然后数据存储使用的 mysql + redis。等环境准备好了之后，就需要添加一些配置文件，比如在 config/env/ 下创建 development.js 文件，里面需要提供发邮箱的邮件地址，以及 github 第三方登录的 clientID 等。</p>
<div class="cnblogs_Highlighter">
<pre><code>module.exports = {
	email: {
		account: '',
		pwd: ''
	},
    github: {
        clientID: '',
        clientSecret: '',
        callbackUrl: ``
    }
};</pre>
</div>
<pre><code><br />接下来就是安装开发运行所需要的各种依赖包吧，跑一下 <span style="font-size: 14px;"><strong><span style="background-color: #ffff00;">yarn install</span></strong></span> 就行了，这个过程可能需要花个几分钟时间。<br />等到所有的包都安装完毕后，直接跑 <span style="background-color: #ffff00;"><strong><span style="font-size: 14px;">npm start</span></strong></span> 命令，看到 终端上显示 所有的 gulp 任务 finished，Server is running at port 3000 的时候，就可以打开浏览器访问 localhost:3000 了。<br />接下来贴上一些项目里面的代码吧，如果上不了首页就悲剧了。<br /><br /></pre>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;"> 1</span> require('dotenv'<span style="color: #000000;">).config()
</span><span style="color: #008080;"> 2</span> 
<span style="color: #008080;"> 3</span> const express = require('express'<span style="color: #000000;">)
</span><span style="color: #008080;"> 4</span> const passport = require('passport'<span style="color: #000000;">)
</span><span style="color: #008080;"> 5</span> const models = require('./config/db/model'<span style="color: #000000;">)
</span><span style="color: #008080;"> 6</span> const port =<span style="color: #000000;"> process.env.PORT
</span><span style="color: #008080;"> 7</span> 
<span style="color: #008080;"> 8</span> const app =<span style="color: #000000;"> express()
</span><span style="color: #008080;"> 9</span> 
<span style="color: #008080;">10</span> require('./config/passport'<span style="color: #000000;">)(passport)
</span><span style="color: #008080;">11</span> require('./config/express'<span style="color: #000000;">)(app, passport)
</span><span style="color: #008080;">12</span> require('./config/routes'<span style="color: #000000;">)(app, passport)
</span><span style="color: #008080;">13</span> 
<span style="color: #008080;">14</span> <span style="color: #000000;">models
</span><span style="color: #008080;">15</span> <span style="color: #000000;">    .sequelize
</span><span style="color: #008080;">16</span> <span style="color: #000000;">    .sync()
</span><span style="color: #008080;">17</span>     .then(() =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">18</span>         app.listen(port, () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">19</span> <span style="color: #000000;">            console.log(`Server is running at port ${port}`)
</span><span style="color: #008080;">20</span> <span style="color: #000000;">        })
</span><span style="color: #008080;">21</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">22</span> 
<span style="color: #008080;">23</span> module.exports = app</pre>
</div>
<p>&nbsp;</p>
<pre><code><br /><br /></pre>
<p>Gulp 的打包配置</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008080;">  1</span> <span style="color: #008000;">//</span><span style="color: #008000;"> vinyl 是一个简单的描述文件的元数据对象</span>
<span style="color: #008080;">  2</span> <span style="color: #008000;">//</span><span style="color: #008000;"> https://github.com/gulpjs/vinyl</span>
<span style="color: #008080;">  3</span> const path = require('path'<span style="color: #000000;">)
</span><span style="color: #008080;">  4</span> const gulp = require('gulp'<span style="color: #000000;">)
</span><span style="color: #008080;">  5</span> const del = require('del'<span style="color: #000000;">)
</span><span style="color: #008080;">  6</span> const glob = require('glob'<span style="color: #000000;">)
</span><span style="color: #008080;">  7</span> const babelify = require('babelify'<span style="color: #000000;">)
</span><span style="color: #008080;">  8</span> const runSequence = require('run-sequence'<span style="color: #000000;">)
</span><span style="color: #008080;">  9</span> const plumber = require('gulp-plumber'<span style="color: #000000;">)
</span><span style="color: #008080;"> 10</span> const notify = require('gulp-notify'<span style="color: #000000;">)
</span><span style="color: #008080;"> 11</span> const gulpif = require('gulp-if'<span style="color: #000000;">)
</span><span style="color: #008080;"> 12</span> const sass = require('gulp-sass'<span style="color: #000000;">)
</span><span style="color: #008080;"> 13</span> const debug = require('gulp-debug'<span style="color: #000000;">)
</span><span style="color: #008080;"> 14</span> const cached = require('gulp-cached'<span style="color: #000000;">)
</span><span style="color: #008080;"> 15</span> const remember = require('gulp-remember'<span style="color: #000000;">)
</span><span style="color: #008080;"> 16</span> const autoprefixer = require('gulp-autoprefixer'<span style="color: #000000;">)
</span><span style="color: #008080;"> 17</span> const sourcemaps = require('gulp-sourcemaps'<span style="color: #000000;">);
</span><span style="color: #008080;"> 18</span> const size = require('gulp-size'<span style="color: #000000;">);
</span><span style="color: #008080;"> 19</span> const cssnano = require('gulp-cssnano'<span style="color: #000000;">)
</span><span style="color: #008080;"> 20</span> const uglify = require('gulp-uglify'<span style="color: #000000;">)
</span><span style="color: #008080;"> 21</span> const rename = require('gulp-rename'<span style="color: #000000;">)
</span><span style="color: #008080;"> 22</span> const htmlmin = require('gulp-htmlmin'<span style="color: #000000;">)
</span><span style="color: #008080;"> 23</span> const imagemin = require('gulp-imagemin'<span style="color: #000000;">)
</span><span style="color: #008080;"> 24</span> const browserify = require('browserify'<span style="color: #000000;">)
</span><span style="color: #008080;"> 25</span> const source = require('vinyl-source-stream'<span style="color: #000000;">);
</span><span style="color: #008080;"> 26</span> const buffer = require('vinyl-buffer'<span style="color: #000000;">);
</span><span style="color: #008080;"> 27</span> const rev = require('gulp-rev'<span style="color: #000000;">);
</span><span style="color: #008080;"> 28</span> const watchify = require('watchify'<span style="color: #000000;">)
</span><span style="color: #008080;"> 29</span> const lazypipe = require('lazypipe'<span style="color: #000000;">)
</span><span style="color: #008080;"> 30</span> const revCollector = require('gulp-rev-collector'<span style="color: #000000;">);
</span><span style="color: #008080;"> 31</span> const es = require('event-stream'<span style="color: #000000;">)
</span><span style="color: #008080;"> 32</span> const argv = require('yargs'<span style="color: #000000;">).argv
</span><span style="color: #008080;"> 33</span> 
<span style="color: #008080;"> 34</span> <span style="color: #008000;">//</span><span style="color: #008000;"> 将打包后的静态资源 放到nginx服务器上</span>
<span style="color: #008080;"> 35</span> const bundleAssetsDir = argv.build_mode === 'deploy' &amp;&amp; argv.assets_path ? argv.assets_path : './public/static/'
<span style="color: #008080;"> 36</span> const jsAssetsDir = path.join(bundleAssetsDir, 'js'<span style="color: #000000;">)
</span><span style="color: #008080;"> 37</span> const cssAssetsDir = path.join(bundleAssetsDir, 'css'<span style="color: #000000;">)
</span><span style="color: #008080;"> 38</span> const imgAssetsDir = path.join(bundleAssetsDir, 'image'<span style="color: #000000;">)
</span><span style="color: #008080;"> 39</span> const revAssetsDir = path.join(bundleAssetsDir, 'rev'<span style="color: #000000;">)
</span><span style="color: #008080;"> 40</span> const htmlAssetsDir = path.join('./app/view'<span style="color: #000000;">)
</span><span style="color: #008080;"> 41</span> 
<span style="color: #008080;"> 42</span> const AUTOPREFIXER_BROWSERS =<span style="color: #000000;"> [
</span><span style="color: #008080;"> 43</span>     'ie &gt;= 10'<span style="color: #000000;">,
</span><span style="color: #008080;"> 44</span>     'ff &gt;= 30'<span style="color: #000000;">,
</span><span style="color: #008080;"> 45</span>     'chrome &gt;= 34'<span style="color: #000000;">,
</span><span style="color: #008080;"> 46</span>     'safari &gt;= 7'<span style="color: #000000;">,
</span><span style="color: #008080;"> 47</span>     'opera &gt;= 23'
<span style="color: #008080;"> 48</span> <span style="color: #000000;">];
</span><span style="color: #008080;"> 49</span> 
<span style="color: #008080;"> 50</span> const jsChannel =<span style="color: #000000;"> lazypipe()
</span><span style="color: #008080;"> 51</span> <span style="color: #000000;">    .pipe(uglify)
</span><span style="color: #008080;"> 52</span> <span style="color: #000000;">    .pipe(gulp.dest, jsAssetsDir)
</span><span style="color: #008080;"> 53</span> 
<span style="color: #008080;"> 54</span> let watch = <span style="color: #0000ff;">false</span>
<span style="color: #008080;"> 55</span> 
<span style="color: #008080;"> 56</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> getEntryFiles (path, option) {
</span><span style="color: #008080;"> 57</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> glob.sync(path, option)
</span><span style="color: #008080;"> 58</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 59</span> 
<span style="color: #008080;"> 60</span> <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 61</span> <span style="color: #008000;"> * 打包js任务
</span><span style="color: #008080;"> 62</span> <span style="color: #008000;"> * @param {Object} bundle 各入口文件的browserify对象
</span><span style="color: #008080;"> 63</span> <span style="color: #008000;"> * @param {string} filename 入口文件名
</span><span style="color: #008080;"> 64</span> <span style="color: #008000;"> * @return {stream} stream 对象
</span><span style="color: #008080;"> 65</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 66</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> jsTask ({ bundle, filename }) {
</span><span style="color: #008080;"> 67</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> bundle
</span><span style="color: #008080;"> 68</span> <span style="color: #000000;">    .bundle()
</span><span style="color: #008080;"> 69</span> <span style="color: #000000;">    .pipe(plumber({
</span><span style="color: #008080;"> 70</span>         errorHandler: notify.onError('Error: &lt;%= error.message %&gt;'<span style="color: #000000;">)
</span><span style="color: #008080;"> 71</span> <span style="color: #000000;">    }))
</span><span style="color: #008080;"> 72</span> <span style="color: #000000;">    .pipe(source(filename))
</span><span style="color: #008080;"> 73</span>     <span style="color: #008000;">//</span><span style="color: #008000;"> 代替 gulp-streamify，来转换 vinyl 流</span>
<span style="color: #008080;"> 74</span> <span style="color: #000000;">    .pipe(buffer())
</span><span style="color: #008080;"> 75</span>     .pipe(rename({ dirname: ''<span style="color: #000000;"> }))
</span><span style="color: #008080;"> 76</span> <span style="color: #000000;">    .pipe(sourcemaps.init())
</span><span style="color: #008080;"> 77</span>     .pipe(debug({ title: 'script'<span style="color: #000000;"> }))
</span><span style="color: #008080;"> 78</span>     .pipe(size({ title: 'script'<span style="color: #000000;"> }))
</span><span style="color: #008080;"> 79</span>     .pipe(sourcemaps.write(''<span style="color: #000000;">))
</span><span style="color: #008080;"> 80</span> <span style="color: #000000;">    .pipe(gulp.dest(jsAssetsDir))
</span><span style="color: #008080;"> 81</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 82</span> 
<span style="color: #008080;"> 83</span> <span style="color: #008000;">/*</span><span style="color: #008000;">*
</span><span style="color: #008080;"> 84</span> <span style="color: #008000;"> * 如果一个文件被删除了，则将其忘记
</span><span style="color: #008080;"> 85</span> <span style="color: #008000;"> * @param {*} event
</span><span style="color: #008080;"> 86</span>  <span style="color: #008000;">*/</span>
<span style="color: #008080;"> 87</span> <span style="color: #0000ff;">function</span><span style="color: #000000;"> watchDel (event) {
</span><span style="color: #008080;"> 88</span>     <span style="color: #0000ff;">if</span> (event.type === 'deleted'<span style="color: #000000;">) {
</span><span style="color: #008080;"> 89</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> gulp-cached 的删除 api</span>
<span style="color: #008080;"> 90</span>         <span style="color: #0000ff;">delete</span><span style="color: #000000;"> cached.caches.scripts[event.path]
</span><span style="color: #008080;"> 91</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> gulp-remember 的删除 api</span>
<span style="color: #008080;"> 92</span>         remember.forget('scripts'<span style="color: #000000;">, event.path)
</span><span style="color: #008080;"> 93</span> <span style="color: #000000;">    }
</span><span style="color: #008080;"> 94</span> <span style="color: #000000;">}
</span><span style="color: #008080;"> 95</span> 
<span style="color: #008080;"> 96</span> gulp.task('style', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;"> 97</span>     <span style="color: #0000ff;">return</span> gulp.src('./src/scss/*.scss'<span style="color: #000000;">)
</span><span style="color: #008080;"> 98</span> <span style="color: #000000;">        .pipe(plumber({
</span><span style="color: #008080;"> 99</span>             errorHandler: notify.onError('Error: &lt;%= error.message %&gt;'<span style="color: #000000;">)
</span><span style="color: #008080;">100</span> <span style="color: #000000;">        }))
</span><span style="color: #008080;">101</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> .pipe(cached('style-task'))</span>
<span style="color: #008080;">102</span> <span style="color: #000000;">        .pipe(sourcemaps.init())
</span><span style="color: #008080;">103</span> <span style="color: #000000;">        .pipe(sass())
</span><span style="color: #008080;">104</span> <span style="color: #000000;">        .pipe(cssnano({
</span><span style="color: #008080;">105</span>             <span style="color: #008000;">//</span><span style="color: #008000;"> 不修改 z-index</span>
<span style="color: #008080;">106</span>             safe: <span style="color: #0000ff;">true</span>
<span style="color: #008080;">107</span> <span style="color: #000000;">        }))
</span><span style="color: #008080;">108</span> <span style="color: #000000;">        .pipe(autoprefixer(AUTOPREFIXER_BROWSERS))
</span><span style="color: #008080;">109</span>         .pipe(debug({ title: 'style'<span style="color: #000000;"> }))
</span><span style="color: #008080;">110</span>         <span style="color: #008000;">//</span><span style="color: #008000;"> .pipe(remember('style-task'))</span>
<span style="color: #008080;">111</span>         .pipe(size({ title: 'style'<span style="color: #000000;"> }))
</span><span style="color: #008080;">112</span>         .pipe(sourcemaps.write(''<span style="color: #000000;">))
</span><span style="color: #008080;">113</span> <span style="color: #000000;">        .pipe(gulp.dest(cssAssetsDir))
</span><span style="color: #008080;">114</span> <span style="color: #000000;">})
</span><span style="color: #008080;">115</span> 
<span style="color: #008080;">116</span> gulp.task('script', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">117</span>     let entryJs = getEntryFiles('./src/js/*.js'<span style="color: #000000;">)
</span><span style="color: #008080;">118</span>     let bundleTasks = entryJs.map(filename =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">119</span>         const bundle =<span style="color: #000000;"> browserify({
</span><span style="color: #008080;">120</span> <span style="color: #000000;">            entries: [filename],
</span><span style="color: #008080;">121</span> <span style="color: #000000;">            cache: {},
</span><span style="color: #008080;">122</span> <span style="color: #000000;">            packageCache: {},
</span><span style="color: #008080;">123</span>             plugin: [watch ? watchify : <span style="color: #0000ff;">null</span><span style="color: #000000;">],
</span><span style="color: #008080;">124</span> <span style="color: #000000;">            transform: babelify
</span><span style="color: #008080;">125</span> <span style="color: #000000;">        })
</span><span style="color: #008080;">126</span>         <span style="color: #0000ff;">if</span><span style="color: #000000;"> (watch) {
</span><span style="color: #008080;">127</span>             bundle.on('update', <span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
</span><span style="color: #008080;">128</span>                 jsTask.call(<span style="color: #0000ff;">null</span><span style="color: #000000;">, { bundle, filename })
</span><span style="color: #008080;">129</span> <span style="color: #000000;">            })
</span><span style="color: #008080;">130</span> <span style="color: #000000;">        }
</span><span style="color: #008080;">131</span>         <span style="color: #0000ff;">return</span><span style="color: #000000;"> { bundle, filename }
</span><span style="color: #008080;">132</span> <span style="color: #000000;">    })
</span><span style="color: #008080;">133</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> es.merge(bundleTasks.map(jsTask));
</span><span style="color: #008080;">134</span> <span style="color: #000000;">})
</span><span style="color: #008080;">135</span> 
<span style="color: #008080;">136</span> gulp.task('image', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">137</span>     <span style="color: #0000ff;">return</span> gulp.src(['./src/image/*', './src/image/**/*'<span style="color: #000000;">])
</span><span style="color: #008080;">138</span>         .pipe(cached('image-task'<span style="color: #000000;">))
</span><span style="color: #008080;">139</span> <span style="color: #000000;">        .pipe(imagemin([
</span><span style="color: #008080;">140</span>             imagemin.gifsicle({ interlaced: <span style="color: #0000ff;">true</span><span style="color: #000000;"> }),
</span><span style="color: #008080;">141</span>             imagemin.jpegtran({ progressive: <span style="color: #0000ff;">true</span><span style="color: #000000;"> }),
</span><span style="color: #008080;">142</span>             imagemin.optipng({ optimizationLevel: 5<span style="color: #000000;"> }),
</span><span style="color: #008080;">143</span> <span style="color: #000000;">            imagemin.svgo({
</span><span style="color: #008080;">144</span> <span style="color: #000000;">                plugins: [
</span><span style="color: #008080;">145</span>                     { removeViewBox: <span style="color: #0000ff;">true</span><span style="color: #000000;"> },
</span><span style="color: #008080;">146</span>                     { cleanupIDs: <span style="color: #0000ff;">false</span><span style="color: #000000;"> }
</span><span style="color: #008080;">147</span> <span style="color: #000000;">                ]
</span><span style="color: #008080;">148</span> <span style="color: #000000;">            })
</span><span style="color: #008080;">149</span> <span style="color: #000000;">        ]))
</span><span style="color: #008080;">150</span>         .pipe(debug({ title: 'image'<span style="color: #000000;"> }))
</span><span style="color: #008080;">151</span>         .pipe(remember('image-task'<span style="color: #000000;">))
</span><span style="color: #008080;">152</span>         .pipe(size({ title: 'image'<span style="color: #000000;"> }))
</span><span style="color: #008080;">153</span> <span style="color: #000000;">        .pipe(gulp.dest(imgAssetsDir))
</span><span style="color: #008080;">154</span> <span style="color: #000000;">})
</span><span style="color: #008080;">155</span> 
<span style="color: #008080;">156</span> gulp.task('html', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">157</span>     <span style="color: #0000ff;">return</span> gulp.src('./src/page/**/*.html'<span style="color: #000000;">)
</span><span style="color: #008080;">158</span>         .pipe(cached('html-task'<span style="color: #000000;">))
</span><span style="color: #008080;">159</span>         .pipe(debug({ title: 'html'<span style="color: #000000;"> }))
</span><span style="color: #008080;">160</span>         .pipe(remember('html-task'<span style="color: #000000;">))
</span><span style="color: #008080;">161</span> <span style="color: #000000;">        .pipe(gulp.dest(htmlAssetsDir))
</span><span style="color: #008080;">162</span> 
<span style="color: #008080;">163</span> <span style="color: #000000;">})
</span><span style="color: #008080;">164</span> 
<span style="color: #008080;">165</span> gulp.task('rev', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">166</span>     <span style="color: #0000ff;">return</span> gulp.src([path.join(jsAssetsDir, '*.js'), path.join(cssAssetsDir, '*.css'<span style="color: #000000;">)])
</span><span style="color: #008080;">167</span> <span style="color: #000000;">        .pipe(rev())
</span><span style="color: #008080;">168</span>         .pipe(gulpif('*.js'<span style="color: #000000;">, jsChannel()))
</span><span style="color: #008080;">169</span>         .pipe(gulpif('*.css'<span style="color: #000000;">, gulp.dest(cssAssetsDir)))
</span><span style="color: #008080;">170</span> <span style="color: #000000;">        .pipe(rev.manifest({
</span><span style="color: #008080;">171</span>             merge: <span style="color: #0000ff;">true</span>
<span style="color: #008080;">172</span> <span style="color: #000000;">        }))
</span><span style="color: #008080;">173</span> <span style="color: #000000;">        .pipe(gulp.dest(revAssetsDir))
</span><span style="color: #008080;">174</span> <span style="color: #000000;">})
</span><span style="color: #008080;">175</span> 
<span style="color: #008080;">176</span> gulp.task('rev-collector', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">177</span>     <span style="color: #0000ff;">return</span> gulp.src([path.join(revAssetsDir, '*.json'), path.join(htmlAssetsDir, '*.html'<span style="color: #000000;">)])
</span><span style="color: #008080;">178</span> <span style="color: #000000;">        .pipe(revCollector({
</span><span style="color: #008080;">179</span>             replaceReved: <span style="color: #0000ff;">true</span>
<span style="color: #008080;">180</span> <span style="color: #000000;">        }))
</span><span style="color: #008080;">181</span> <span style="color: #000000;">        .pipe(htmlmin({
</span><span style="color: #008080;">182</span>             removeComments: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">183</span>             collapseWhitespace: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">184</span>             collapseBooleanAttributes: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">185</span>             removeAttributeQuotes: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">186</span>             removeRedundantAttributes: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">187</span>             removeEmptyAttributes: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">188</span>             removeScriptTypeAttributes: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">189</span>             removeStyleLinkTypeAttributes: <span style="color: #0000ff;">true</span><span style="color: #000000;">,
</span><span style="color: #008080;">190</span>             removeOptionalTags: <span style="color: #0000ff;">true</span>
<span style="color: #008080;">191</span> <span style="color: #000000;">        }))
</span><span style="color: #008080;">192</span>         .pipe(size({ title: 'html'<span style="color: #000000;"> }))
</span><span style="color: #008080;">193</span> <span style="color: #000000;">        .pipe(gulp.dest(htmlAssetsDir))
</span><span style="color: #008080;">194</span> <span style="color: #000000;">})
</span><span style="color: #008080;">195</span> 
<span style="color: #008080;">196</span> gulp.task('clean', () =&gt; del([bundleAssetsDir, htmlAssetsDir], { force: <span style="color: #0000ff;">true</span><span style="color: #000000;"> }))
</span><span style="color: #008080;">197</span> 
<span style="color: #008080;">198</span> gulp.task('style:watch', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">199</span>     const watcher = gulp.watch(['./src/scss/**/*.scss'], ['style'<span style="color: #000000;">])
</span><span style="color: #008080;">200</span>     watcher.on('change'<span style="color: #000000;">, watchDel)
</span><span style="color: #008080;">201</span> <span style="color: #000000;">})
</span><span style="color: #008080;">202</span> 
<span style="color: #008080;">203</span> gulp.task('image:watch', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">204</span>     const watcher = gulp.watch(['./src/image/**/*'], ['image'<span style="color: #000000;">])
</span><span style="color: #008080;">205</span>     watcher.on('change'<span style="color: #000000;">, watchDel)
</span><span style="color: #008080;">206</span> <span style="color: #000000;">}
</span><span style="color: #008080;">207</span> <span style="color: #000000;">)
</span><span style="color: #008080;">208</span> gulp.task('html:watch', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">209</span>     const watcher = gulp.watch(['./src/page/**/*.html'], ['html'<span style="color: #000000;">])
</span><span style="color: #008080;">210</span>     watcher.on('change'<span style="color: #000000;">, watchDel)
</span><span style="color: #008080;">211</span> <span style="color: #000000;">})
</span><span style="color: #008080;">212</span> 
<span style="color: #008080;">213</span> gulp.task('watch', () =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">214</span>     watch = <span style="color: #0000ff;">true</span>
<span style="color: #008080;">215</span> <span style="color: #000000;">    runSequence(
</span><span style="color: #008080;">216</span>         'clean'<span style="color: #000000;">,
</span><span style="color: #008080;">217</span>         ['script', 'style', 'html', 'image'<span style="color: #000000;">],
</span><span style="color: #008080;">218</span>         ['style:watch', 'html:watch', 'image:watch'<span style="color: #000000;">]
</span><span style="color: #008080;">219</span> <span style="color: #000000;">    )
</span><span style="color: #008080;">220</span> <span style="color: #000000;">})
</span><span style="color: #008080;">221</span> 
<span style="color: #008080;">222</span> gulp.task('build', cb =&gt;<span style="color: #000000;"> {
</span><span style="color: #008080;">223</span>     watch = <span style="color: #0000ff;">false</span>
<span style="color: #008080;">224</span>     <span style="color: #0000ff;">return</span><span style="color: #000000;"> runSequence(
</span><span style="color: #008080;">225</span>         'clean'<span style="color: #000000;">,
</span><span style="color: #008080;">226</span>         ['script', 'style', 'html', 'image'<span style="color: #000000;">],
</span><span style="color: #008080;">227</span>         'rev'<span style="color: #000000;">,
</span><span style="color: #008080;">228</span>         'rev-collector'<span style="color: #000000;">,
</span><span style="color: #008080;">229</span> <span style="color: #000000;">        cb
</span><span style="color: #008080;">230</span> <span style="color: #000000;">    )
</span><span style="color: #008080;">231</span> <span style="color: #000000;">})
</span><span style="color: #008080;">232</span> 
<span style="color: #008080;">233</span> gulp.task('default', ['build'])</pre>
</div>
<p>最后再一次贴上网站以及开源地址，欢迎各路大佬围观，吐槽，指正。</p>
<p><span style="background-color: #ffff00;"><strong><a title="微识" href="http://129.204.39.6/" target="_blank"><span style="background-color: #ffff00;">网站地址</span></a></strong></span></p>
<p><span style="background-color: #ffff00;"><strong><a href="https://github.com/wwervin72/weshier" target="_blank"><span style="background-color: #ffff00;">代码开源地址</span></a></strong></span></p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>