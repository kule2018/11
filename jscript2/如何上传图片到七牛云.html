<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修如何上传图片到七牛云' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>如何上传图片到七牛云</center></div><div class='banquan'>原文出处:本文由博客园博主逗伴不是瓣提供。<br/>
原文连接:https://www.cnblogs.com/-walker/p/11838319.html</div><br>
    <p>下面介绍Element-ui中Upload组件如何把图片上传的七牛云(免费版本，有流量限制)</p>
<p>一、准备工作</p>
<p>1.去七牛云注册账号，并实名认证，不认证无法创建存储空间</p>
<p><img src="./images/如何上传图片到七牛云0.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>2.了解Element-ui组件</p>
<p>二、创建上传页面(这里直接使用官方的代码片段)</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">&lt;</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">div </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="editor"</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">h3</span><span style="color: #0000ff;">&gt;</span>上传图片<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">h3</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">el-form </span><span style="color: #ff0000;">label-width</span><span style="color: #0000ff;">="70px"</span><span style="color: #ff0000;"> @submit.native.prevent</span><span style="color: #0000ff;">="save"</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">el-form-item </span><span style="color: #ff0000;">label</span><span style="color: #0000ff;">="图标"</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">el-upload
          </span><span style="color: #ff0000;">class</span><span style="color: #0000ff;">="avatar-uploader"</span><span style="color: #ff0000;">
          :action</span><span style="color: #0000ff;">="qiniuDomain"</span><span style="color: #ff0000;">
          :http-request</span><span style="color: #0000ff;">="upLoadToQiniu"</span><span style="color: #ff0000;">
          :show-file-list</span><span style="color: #0000ff;">="false"</span><span style="color: #ff0000;">
          :before-upload</span><span style="color: #0000ff;">="beforeUpload"</span>
        <span style="color: #0000ff;">&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">img </span><span style="color: #ff0000;">v-if</span><span style="color: #0000ff;">="model.icon"</span><span style="color: #ff0000;"> :src</span><span style="color: #0000ff;">="model.icon"</span><span style="color: #ff0000;"> class</span><span style="color: #0000ff;">="avatar"</span> <span style="color: #0000ff;">/&gt;</span>
          <span style="color: #0000ff;">&lt;</span><span style="color: #800000;">i </span><span style="color: #ff0000;">v-else class</span><span style="color: #0000ff;">="el-icon-plus avatar-uploader-icon"</span><span style="color: #0000ff;">&gt;&lt;/</span><span style="color: #800000;">i</span><span style="color: #0000ff;">&gt;</span>
        <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">el-upload</span><span style="color: #0000ff;">&gt;</span>
      <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">el-form-item</span><span style="color: #0000ff;">&gt;</span>
    <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">el-form</span><span style="color: #0000ff;">&gt;</span>
  <span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">div</span><span style="color: #0000ff;">&gt;</span>
<span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">template</span><span style="color: #0000ff;">&gt;</span>

<span style="color: #0000ff;">&lt;</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span><span style="background-color: #f5f5f5; color: #000000;">
export </span><span style="background-color: #f5f5f5; color: #0000ff;">default</span><span style="background-color: #f5f5f5; color: #000000;"> {
  data() {
    </span><span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> {<br />　　  // 实名认证后创建的存储空间对应的上传地址(华东，华南等等不一样：<a href="https://developer.qiniu.com/kodo/manual/1671/region-endpoint">https://developer.qiniu.com/kodo/manual/1671/region-endpoint</a>)
      qiniuDomain: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">https://upload-z2.qiniup.com</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,<br />　　　// 创建成功后官方随机分配的公开图片地址前缀，即上传成功后对应的公用图片地址前缀
      qiniuViewHost: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">http://q0sm6ce42.bkt.clouddn.com</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
      model: {
        name: </span><span style="background-color: #f5f5f5; color: #000000;">""</span><span style="background-color: #f5f5f5; color: #000000;">,
        icon: </span><span style="background-color: #f5f5f5; color: #000000;">""</span><span style="background-color: #f5f5f5; color: #000000;">
      }
    };
  },
  methods: {
    async upLoadToQiniu(req) {
      const config </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> {
        headers: { </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">Content-Type</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">multipart/form-data</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;"> }
      };
      let fileType </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">""</span><span style="background-color: #f5f5f5; color: #000000;">;
      </span><span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (req.file.type </span><span style="background-color: #f5f5f5; color: #000000;">===</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">image/png</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">) {
        fileType </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">png</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;
      } </span><span style="background-color: #f5f5f5; color: #0000ff;">else</span><span style="background-color: #f5f5f5; color: #000000;"> {
        fileType </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">jpg</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;
      }
      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 重命名要上传的文件</span>
<span style="background-color: #f5f5f5; color: #000000;">      const keyname </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> `${</span><span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> Date().getTime()}${Math.random().toString(</span><span style="background-color: #f5f5f5; color: #000000;">36</span><span style="background-color: #f5f5f5; color: #000000;">).slice(</span><span style="background-color: #f5f5f5; color: #000000;">2</span><span style="background-color: #f5f5f5; color: #000000;">)}.${fileType}`;
      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 上传时候的Token,可前端自己生成,安全起见后端生成！<br /></span>　　　 // 这里是express后端生成的Token
<span style="background-color: #f5f5f5; color: #000000;">      const res </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> await </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$http.get(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">/token</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">);
      const token </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> res.data.uploadToken;
      const formdata </span><span style="background-color: #f5f5f5; color: #000000;">=</span> <span style="background-color: #f5f5f5; color: #0000ff;">new</span><span style="background-color: #f5f5f5; color: #000000;"> FormData();
      formdata.append(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">file</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, req.file);
      formdata.append(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">token</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, token);
      formdata.append(</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">key</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">, keyname);
      const result </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> await </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$http.post(</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.qiniuDomain, formdata, config);
      </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.model.icon </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> `${</span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.qiniuViewHost}</span><span style="background-color: #f5f5f5; color: #000000;">/</span><span style="background-color: #f5f5f5; color: #000000;">${result.data.key}`;</span>
<span style="background-color: #f5f5f5; color: #000000;">    },
    beforeUpload(file) {
      </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> debugger</span>
<span style="background-color: #f5f5f5; color: #000000;">      const isJPG </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> file.type </span><span style="background-color: #f5f5f5; color: #000000;">===</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">image/jpeg</span><span style="background-color: #f5f5f5; color: #000000;">"</span> <span style="background-color: #f5f5f5; color: #000000;">||</span><span style="background-color: #f5f5f5; color: #000000;"> file.type </span><span style="background-color: #f5f5f5; color: #000000;">===</span> <span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">image/png</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">;
      const isLt10M </span><span style="background-color: #f5f5f5; color: #000000;">=</span><span style="background-color: #f5f5f5; color: #000000;"> file.size </span><span style="background-color: #f5f5f5; color: #000000;">/</span> <span style="background-color: #f5f5f5; color: #000000;">1024</span> <span style="background-color: #f5f5f5; color: #000000;">/</span> <span style="background-color: #f5f5f5; color: #000000;">1024</span> <span style="background-color: #f5f5f5; color: #000000;">&lt;</span> <span style="background-color: #f5f5f5; color: #000000;">10</span><span style="background-color: #f5f5f5; color: #000000;">;

      </span><span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (</span><span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">isJPG) {
        </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$message({
          showClose: </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">,
          message: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">上传图片只能是JPG/PNG 格式!</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
          type: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">error</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">
        });
      }
      </span><span style="background-color: #f5f5f5; color: #0000ff;">if</span><span style="background-color: #f5f5f5; color: #000000;"> (</span><span style="background-color: #f5f5f5; color: #000000;">!</span><span style="background-color: #f5f5f5; color: #000000;">isLt10M) {
        </span><span style="background-color: #f5f5f5; color: #0000ff;">this</span><span style="background-color: #f5f5f5; color: #000000;">.$message({
          showClose: </span><span style="background-color: #f5f5f5; color: #0000ff;">true</span><span style="background-color: #f5f5f5; color: #000000;">,
          message: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">上传头像图片大小不能超过 10MB!</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">,
          type: </span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">error</span><span style="background-color: #f5f5f5; color: #000000;">"</span><span style="background-color: #f5f5f5; color: #000000;">
        });
      }
      </span><span style="background-color: #f5f5f5; color: #0000ff;">return</span><span style="background-color: #f5f5f5; color: #000000;"> isJPG </span><span style="background-color: #f5f5f5; color: #000000;">&amp;&amp;</span><span style="background-color: #f5f5f5; color: #000000;"> isLt10M;
    },
  },
  created() {
    </span><span style="background-color: #f5f5f5; color: #008000;">//</span><span style="background-color: #f5f5f5; color: #008000;"> 其他ajax</span>
<span style="background-color: #f5f5f5; color: #000000;">  }
};
</span><span style="color: #0000ff;">&lt;/</span><span style="color: #800000;">script</span><span style="color: #0000ff;">&gt;</span></pre>
</div>
<p>&nbsp;</p>
<p>三、上传凭证（Token）如何获得：<a href="https://developer.qiniu.com/kodo/manual/1208/upload-token">https://developer.qiniu.com/kodo/manual/1208/upload-token</a></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;"> 七牛云官方node.js CDK</span>
const qiniu = require('qiniu'<span style="color: #000000;">);

const config </span>=<span style="color: #000000;"> {
  </span><span style="color: #008000;">//</span><span style="color: #008000;"> 个人中心-&gt;秘钥管理-&gt;AccessKey</span>
  "AK": "xxxxxx你自己的"<span style="color: #000000;">,
  </span><span style="color: #008000;">//</span><span style="color: #008000;"> 个人中心-&gt;秘钥管理-&gt;SecretKey</span>
  "SK": "xxxxxx你自己的"<span style="color: #000000;">,
  </span><span style="color: #008000;">//</span><span style="color: #008000;"> 对象存储-&gt;新建存储空间的名字：(你自己创建时候空间名字)，这里我创建的是：jiuchengjsfront</span>
  "Bucket": "jiuchengjsfront"<span style="color: #000000;">
}
  </span><span style="color: #008000;">//</span><span style="color: #008000;"> 这里是根据express定义的接口返回给客户端的:token</span>
  app.get('/admin/api/token', async(req, res)=&gt;<span style="color: #000000;"> {
    const mac </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> qiniu.auth.digest.Mac(config.AK, config.SK);
    const options </span>=<span style="color: #000000;"> {
        scope: config.Bucket,
        expires: </span>3600 * 24<span style="color: #000000;">
    };
    const putPolicy </span>=  <span style="color: #0000ff;">new</span><span style="color: #000000;"> qiniu.rs.PutPolicy(options);
    const uploadToken</span>=<span style="color: #000000;"> putPolicy.uploadToken(mac);
    res.send({
      uploadToken
    })
  })</span></pre>
</div>
<p>也可以不从接口获取，自己定义成功的方法。安全起见别暴露给别人</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;"> 七牛云官方node.js CDK</span>
const qiniu = require('qiniu'<span style="color: #000000;">);

const config </span>=<span style="color: #000000;"> {
  </span><span style="color: #008000;">//</span><span style="color: #008000;"> 个人中心-&gt;秘钥管理-&gt;AccessKey</span>
  "AK": "你自己的Accesskey"<span style="color: #000000;">,
  </span><span style="color: #008000;">//</span><span style="color: #008000;"> 个人中心-&gt;秘钥管理-&gt;SecretKey</span>
  "SK": "你自己的Secretkey"<span style="color: #000000;">,
  </span><span style="color: #008000;">//</span><span style="color: #008000;"> 对象存储-&gt;新建存储空间的名字：(你自己创建时候空间名字)</span>
  "Bucket": "jiuchengjsfront"<span style="color: #000000;">
}
</span><span style="color: #008000;">//</span><span style="color: #008000;"> 官方文档：https://developer.qiniu.com/kodo/manual/1208/upload-token</span>
const mac = <span style="color: #0000ff;">new</span><span style="color: #000000;"> qiniu.auth.digest.Mac(config.AK, config.SK);
const options </span>=<span style="color: #000000;"> {
  scope: config.Bucket,
  expires: </span>3600 * 24<span style="color: #000000;">
};
const putPolicy </span>= <span style="color: #0000ff;">new</span><span style="color: #000000;"> qiniu.rs.PutPolicy(options);
const uploadToken </span>=<span style="color: #000000;"> putPolicy.uploadToken(mac);

export </span><span style="color: #0000ff;">default</span><span style="color: #000000;"> uploadToken

</span><span style="color: #008000;">//</span><span style="color: #008000;"> 使用的时候替换为</span></pre>
<div>　formdata.append("token", uploadToken);</div>
<pre><code><span style="color: #000000;">const result </span>= await <span style="color: #0000ff;">this</span>.$http.post(<span style="color: #0000ff;">this</span><span style="color: #000000;">.qiniuDomain, formdata, config);
</span><span style="color: #0000ff;">this</span>.model.icon = `${<span style="color: #0000ff;">this</span>.qiniuViewHost}/${result.data.key}`;</pre>
</div>
<p>四、上传成功之后如：</p>
<p><img src="./images/如何上传图片到七牛云1.png" alt="" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><img src="./images/如何上传图片到七牛云2.png" alt="" /></p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>