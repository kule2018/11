<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修网页播放器开发（四）代码精炼提纯' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>网页播放器开发（四）代码精炼提纯</center></div><div class='banquan'>原文出处:本文由博客园博主相信神话提供。<br/>
原文连接:https://www.cnblogs.com/agoodlife/p/10741432.html</div><br>
    <h1>四、精简提炼</h1>
<p>我们的播放器基本实现了，但是代码复用不高，所以我们要进行封装，以插件的形式体现。</p>
<h2><strong>1.插件的基本运行代码如下：</strong><strong>&nbsp;</strong></h2>
<div class="cnblogs_code">
<pre><code>;(<span style="color: #0000ff;">function</span><span style="color: #000000;">(undefined){

</span>'use strict'<span style="color: #000000;">;

... ...

})()</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;上述代码就是基本的插件代码，下面详细记录这段代码所表示的意思。</p>
<p><span style="font-family: 仿宋_GB2312;">前面的分号，可以解决插件与其它</span>js合并时，别的代码可能会产生的错误问题；</p>
<p>&ldquo;(function(){})()&rdquo;<span style="font-family: 仿宋_GB2312;">这个结构表示立即执行第一个括号内的函数</span>,其实立即执行函数还有另一种写法，&ldquo;(function(){}())&rdquo;。看大家的喜好，我一般喜欢用第一种；</p>
<p>&ldquo;undefined&rdquo;<span style="font-family: 仿宋_GB2312;">做为参数传入，因为在老一辈的浏览器是不被支持的，直接使用会报错，</span>js框架要考虑到兼容性，因此增加一个形参undefined，就算有人把外面的&nbsp;undefined&nbsp;定义了，插件<span style="font-family: 仿宋_GB2312;">里面的</span> undefined 依然不受影响。</p>
<h3>严格模式开发</h3>
<p>下面进一步补充代码函数内代码：</p>
<p>'use strict';</p>
<p>这行代码表示严格模式，<span style="font-family: 仿宋_GB2312;">顾名思义，严格模式就是使得</span> Javascript 在更严格的条件下运行，有助于我们更规范的开发。如果在语法检测时发现语法问题，则整个代码块失效，并导致一个语法异常。如果在运行期出现了违反严格模式的代码，则抛出执行异常。</p>
<h3>定义我们的播放器插件&ldquo;playMythology&rdquo;</h3>
<p>下面我们真正开始我们的插件代码了，目前整个代码如下：</p>
<div class="cnblogs_code">
<pre><code>;(<span style="color: #0000ff;">function</span><span style="color: #000000;">(undefined){
</span>'use strict'<span style="color: #000000;">;
</span><span style="color: #0000ff;">var</span><span style="color: #000000;"> _global;
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> playMythology(opt) {
... ...
}
playMythology.prototype </span>=<span style="color: #000000;"> {}；
</span><span style="color: #008000;">//</span><span style="color: #008000;">将插件对象暴露给全局对象</span><span style="color: #000000;">
_global </span>= (<span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span> || (0, eval)('this'<span style="color: #000000;">);
}());
</span><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> module !== "undefined" &amp;&amp;<span style="color: #000000;"> module.exports) {
module.exports </span>=<span style="color: #000000;"> playMythology;
} </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> define === "function" &amp;&amp;<span style="color: #000000;"> define.amd) {
define(</span><span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> playMythology;
});
} </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
</span>!('playMythology' <span style="color: #0000ff;">in</span> _global) &amp;&amp; (_global.playMythology =<span style="color: #000000;"> playMythology);
}
})()</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 仿宋_GB2312;">定义</span>&ldquo;_global&rdquo;，并把<span style="font-family: 仿宋_GB2312;">全局环境赋值给一个</span>_global。</p>
<p>并把当前顶级对象赋值给这个变量，代码如下：</p>
<div class="cnblogs_code">
<pre><code>_global = (<span style="color: #0000ff;">function</span><span style="color: #000000;">() {
</span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">this</span> || (0, eval)('this'<span style="color: #000000;">);
}());</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">看这段代码又是个立即执行函数，不是上面提到的第一种的立即执行函数，而是这种第二种立即执行函数：（</span>functiong(){}<span style="font-family: 宋体;">）结构；首先先介绍一下</span><span style="font-family: Verdana;">eval()</span><span style="font-family: 宋体;">函数的作用：</span>eval() <span style="font-family: 宋体;">函数计算 </span><span style="font-family: Verdana;">JavaScript </span><span style="font-family: 宋体;">字符串，并把它作为脚本代码来执行</span><span style="font-family: 宋体;">，</span><span style="font-family: 宋体;">如果参数是一个表达式，</span>eval() <span style="font-family: 宋体;">函数将执行表达式</span><span style="font-family: 宋体;">，</span><span style="font-family: 宋体;">如果参数是</span>Javascript<span style="font-family: 宋体;">语句，</span><span style="font-family: Verdana;">eval()</span><span style="font-family: 宋体;">将执行 </span><span style="font-family: Verdana;">Javascript </span><span style="font-family: 宋体;">语句。</span><span style="font-family: 宋体;">然后在逐一分析语句：</span>return this<span style="font-family: 宋体;">表示返回当前对象；第一个括号内的</span><span style="font-family: 宋体;">逗号操作符</span> <span style="font-family: 宋体;">对它的每个操作数求值（从左到右），并返回最后一个操作数的值</span><span style="font-family: 宋体;">，</span><span style="font-family: 宋体;">那么这个</span>(0, eval)('this')<span style="font-family: 宋体;">相当于</span>eval<span style="font-family: 宋体;">（</span>&lsquo;<span style="font-family: Verdana;">this</span><span style="font-family: 宋体;">&rsquo;），那么为什么不用</span>eval<span style="font-family: 宋体;">（</span>&lsquo;<span style="font-family: Verdana;">this</span><span style="font-family: 宋体;">&rsquo;），而用</span>(0, eval)('this')<span style="font-family: 宋体;">呢？</span><span style="font-family: 宋体;">在严格模式下，如果没有给</span>&nbsp;this<span style="font-family: 宋体;">指定值的话，它就是未定义的</span><span style="font-family: 宋体;">，</span><span style="font-family: 宋体;">为了防止在严格模式下</span>window<span style="font-family: 宋体;">变量被赋予</span><span style="font-family: Verdana;">undefined</span><span style="font-family: 宋体;">，使用</span><span style="font-family: Verdana;">(0, eval)(</span><span style="font-family: 宋体;">&lsquo;</span><span style="font-family: Verdana;">this</span><span style="font-family: 宋体;">&rsquo;</span><span style="font-family: Verdana;">)</span><span style="font-family: 宋体;">就可以把</span><span style="font-family: Verdana;">this</span><span style="font-family: 宋体;">重新指向</span><span style="font-family: 宋体;">全局环境</span><span style="font-family: 宋体;">对象</span><span style="font-family: 宋体;">。</span><span style="font-family: 宋体;">因为</span>(0, eval)(<span style="font-family: 宋体;">&lsquo;</span><span style="font-family: Verdana;">this</span><span style="font-family: 宋体;">&rsquo;</span><span style="font-family: Verdana;">)</span><span style="font-family: 宋体;">通过逗号表达式对它的操作数执行了</span><span style="font-family: Verdana;">GetValue</span><span style="font-family: 宋体;">，计算出一个值</span><span style="font-family: 宋体;">，</span><span style="font-family: 宋体;">让</span>this<span style="font-family: 宋体;">的值指向了全局对象</span><span style="font-family: 宋体;">；</span><span style="font-family: 宋体;">而</span>eval<span style="font-family: 宋体;">（&lsquo;</span><span style="font-family: Verdana;">this</span><span style="font-family: 宋体;">&rsquo;）</span><span style="font-family: 宋体;">计算出的是一个引用</span><span style="font-family: 宋体;">，</span><span style="font-family: 宋体;">是一个直接调用，方法中的</span>this<span style="font-family: 宋体;">值是</span><span style="font-family: Verdana;">obj</span><span style="font-family: 宋体;">的引用</span><span style="font-family: 宋体;">。</span></p>
<p>&nbsp;</p>
<p><span style="font-family: 仿宋_GB2312;">定义</span>&ldquo;playMythology&rdquo;，表示我们插件的名称。然后我们给这个函数添加属性，通过prototype<span style="font-family: 宋体;">来添加，简单解释一下</span>prototype<span style="font-family: 宋体;">是函数的一个属性，并且是函数的原型对象。</span><span style="font-family: Verdana;">prototype</span><span style="font-family: 宋体;">只能够被函数调用</span><span style="font-family: 宋体;">。</span></p>
<p><span style="font-family: Arial;">为了实现插件的模块化并且让我们的插件也是一个模块，就得让我们的插件也实现模块化的机制。</span><span style="font-family: 宋体;">这</span><span style="font-family: Arial;">只</span><span style="font-family: 宋体;">需</span><span style="font-family: Arial;">要判断是否存在加载器，如果存在加载器，我们就使用加载器，如果不存在加载器。我们就使用顶级域对象。</span><span style="font-family: 宋体;">下面代码就实现了这个功能</span><span style="font-family: 宋体;">：</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> module !== "undefined" &amp;&amp;<span style="color: #000000;"> module.exports) {

module.exports </span>=<span style="color: #000000;"> playMythology;

} </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (<span style="color: #0000ff;">typeof</span> define === "function" &amp;&amp;<span style="color: #000000;"> define.amd) {

define(</span><span style="color: #0000ff;">function</span><span style="color: #000000;">() {

</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> playMythology;

});

} </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {

</span>!('playMythology' <span style="color: #0000ff;">in</span> _global) &amp;&amp; (_global.playMythology =<span style="color: #000000;"> playMythology);

}</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><span style="font-family: 宋体;">介绍一下主要的运算符：</span>&ldquo;<span style="font-family: Verdana;">==</span><span style="font-family: 宋体;">&rdquo;表示相等；&ldquo;</span><span style="font-family: Verdana;">===</span><span style="font-family: 宋体;">&rdquo;</span><span style="font-family: 宋体;">表示绝对相等</span><span style="font-family: 宋体;">；</span>&ldquo;!=&rdquo;<span style="font-family: 宋体;">表示不相等；</span>&ldquo;!==&rdquo;，<span style="font-family: 宋体;">表示严格不相等</span><span style="font-family: 宋体;">。</span>JavaScript<span style="font-family: 宋体;">中，</span><span style="font-family: Verdana;">unll</span><span style="font-family: 宋体;">与</span><span style="font-family: Verdana;">undefined</span><span style="font-family: 宋体;">并不相同</span><span style="font-family: 宋体;">，</span><span style="font-family: 宋体;">但是</span>null==undefined<span style="font-family: 宋体;">为真，</span><span style="font-family: Verdana;">null===undefined</span><span style="font-family: 宋体;">为假</span><span style="font-family: Verdana;">,</span><span style="font-family: 宋体;">所以</span><span style="font-family: Verdana;">null !== undefined&nbsp;</span><span style="font-family: 宋体;">为真。</span></p>
<p class="p">&ldquo;typeof &rdquo;表示返回数据类型，<span style="font-family: 宋体;">有</span>2<span style="font-family: 宋体;">种使用方式：</span><span style="font-family: Verdana;">typeof(</span><span style="font-family: 宋体;">表达式</span><span style="font-family: Verdana;">)</span><span style="font-family: 宋体;">和</span><span style="font-family: Verdana;">typeof </span><span style="font-family: 宋体;">变量名，第一种是对表达式做运算，第二种是对变量做运算。</span><span style="font-family: 宋体;">返</span><span style="font-family: 宋体;">回类型为字符串，值包括如下几种：</span></p>
<p class="p">&nbsp; &nbsp; &nbsp; &nbsp;1. 'undefined'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --<span style="font-family: 宋体;">未定义的变量或值</span></p>
<p class="p">&nbsp; &nbsp; &nbsp; &nbsp; 2. 'boolean'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--<span style="font-family: 宋体;">布尔类型的变量或值</span></p>
<p class="p">&nbsp; &nbsp; &nbsp; &nbsp; 3. 'string'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--<span style="font-family: 宋体;">字符串类型的变量或值</span></p>
<p class="p">&nbsp; &nbsp; &nbsp; &nbsp; 4. 'number'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;--<span style="font-family: 宋体;">数字类型的变量或值</span></p>
<p class="p">&nbsp; &nbsp; &nbsp; &nbsp; 5. 'object'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; --<span style="font-family: 宋体;">对象类型的变量或值，或者</span><span style="font-family: Verdana;">null(</span><span style="font-family: 宋体;">这个是</span><span style="font-family: Verdana;">js</span><span style="font-family: 宋体;">历史遗留问题，将</span><span style="font-family: Verdana;">null</span><span style="font-family: 宋体;">作为</span><span style="font-family: Verdana;">object</span><span style="font-family: 宋体;">类型处理</span><span style="font-family: Verdana;">)</span></p>
<p class="p">&nbsp; &nbsp; &nbsp; &nbsp; 6. 'function'&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;--<span style="font-family: 宋体;">函数类型的变量或值</span>module.exports 对象是由模块系统创建的。在我们自己写模块的时候，需要在模块最后写好模块接口，声明这个模块对外暴露什么内容，module.exports 提供了暴露接口的方法。这种方法可以返回全局共享的变量或者方法。</p>
<p><span style="font-family: 宋体;">介绍一下</span>AMD,AMD<span style="font-family: 宋体;">是一种</span><span style="font-family: 宋体;">规范就是其中比较著名一个，全称是</span>Asynchronous Module Definition<span style="font-family: 宋体;">，即异步模块加载机制。从它的规范描述页面看，</span><span style="font-family: Verdana;">AMD</span><span style="font-family: 宋体;">很短也很简单，但它却完整描述了模块的定义，依赖关系，引用关系以及加载机制。</span><span style="font-family: 宋体;">感兴趣的朋友可以认真研究一下，</span>requireJS<span style="font-family: 宋体;">，</span><span style="font-family: Verdana;">NodeJs</span><span style="font-family: 宋体;">，</span><span style="font-family: Verdana;">Dojo</span><span style="font-family: 宋体;">，</span><span style="font-family: Verdana;">JQuery</span><span style="font-family: 宋体;">全部在使用，可见它的</span><span style="font-family: 宋体;">价值</span><span style="font-family: 宋体;">。</span></p>
<p>&nbsp;</p>
<h2>2.基本函数</h2>
<p><strong><span style="font-family: 仿宋_GB2312;">引入</span>CSS文件函数：</strong><span style="font-family: 仿宋_GB2312;">前端开发引入</span>CSS文件是必不可少的，css主要功能是对页面布局进行美化，我希望开发的插件的皮肤可以动态设置，所以要动态引入CSS文件，定义了引入CSS文件函数，具体代码如下：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">path表示引入CSS文件路径</span>

<span style="color: #0000ff;">function</span><span style="color: #000000;"> cssinto(path) {

</span><span style="color: #008000;">//</span><span style="color: #008000;">如果CSS文件错误，抛出错误异常</span>

<span style="color: #0000ff;">if</span> (!path || path.length === 0<span style="color: #000000;">) {

</span><span style="color: #0000ff;">throw</span> <span style="color: #0000ff;">new</span> Error('argument "path" is required !'<span style="color: #000000;">);

}

</span><span style="color: #008000;">//</span><span style="color: #008000;">获取head 对象</span>

<span style="color: #0000ff;">var</span> head = document.getElementsByTagName('head')[0<span style="color: #000000;">];

</span><span style="color: #008000;">//</span><span style="color: #008000;">创建link标签并插入到head标签内</span>

<span style="color: #0000ff;">var</span> link = document.createElement('link'<span style="color: #000000;">);

link.href </span>=<span style="color: #000000;"> path;

link.rel </span>= 'stylesheet'<span style="color: #000000;">;

link.type </span>= 'text/css'<span style="color: #000000;">;

head.appendChild(link);

}</span></pre>
</div>
<p>&nbsp;</p>
<p><strong>时间转换函数：</strong><span style="font-family: 仿宋_GB2312;">主要功能，讲</span>audio currentTime 时间戳转换转化成&ldquo;分:秒&rdquo;显示格式。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">path表示引入CSS文件路径</span>

<span style="color: #008000;">//</span><span style="color: #008000;">时间显示转换</span>

<span style="color: #0000ff;">function</span><span style="color: #000000;"> conversion(value) {

let minute </span>= Math.floor(value / 60<span style="color: #000000;">)

minute </span>= minute.toString().length === 1 ? ('0' +<span style="color: #000000;"> minute) : minute

let second </span>= Math.round(value % 60<span style="color: #000000;">)

second </span>= second.toString().length === 1 ? ('0' +<span style="color: #000000;"> second) : second

</span><span style="color: #0000ff;">return</span> minute+":"+<span style="color: #000000;">second

}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 仿宋_GB2312;">引入</span>json文件函数：file值json文件路径，callback只得是回调函数，当文件加载完毕就调用该函数。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> readTextFile(file, callback) {

</span><span style="color: #0000ff;">var</span> rawFile = <span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLHttpRequest();

rawFile.overrideMimeType(</span>"application/json"<span style="color: #000000;">);

rawFile.open(</span>"GET", file, <span style="color: #0000ff;">true</span><span style="color: #000000;">);

rawFile.onreadystatechange </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">() {

</span><span style="color: #0000ff;">if</span> (rawFile.readyState === 4 &amp;&amp; rawFile.status == "200"<span style="color: #000000;">) {

callback(rawFile.responseText);

}

}

rawFile.send(</span><span style="color: #0000ff;">null</span><span style="color: #000000;">);

}</span></pre>
</div>
<p>&nbsp;</p>
<p>getElementsByClass<span style="font-family: 宋体;">：</span><span style="font-family: 仿宋_GB2312;">因为我们未讲</span>window传入插件，所以有些方法我们是不能使用的，所以我们定义下面方法实现，通过class查找html中dom对象。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">判断插件是否存在&ldquo;getElementsByClass&rdquo;，没存在，将使用下面方法实现该功能。</span>

<span style="color: #0000ff;">if</span> (!('getElementsByClass' <span style="color: #0000ff;">in</span><span style="color: #000000;"> HTMLElement)) {

</span><span style="color: #008000;">//</span><span style="color: #008000;">prototype在前面已经提到过了，通过&ldquo;prototype&rdquo;给HTMLElement添加属性方法&ldquo;getElementsByClass&rdquo;</span>
<span style="color: #000000;">
HTMLElement.prototype.getElementsByClass </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">(n) {

</span><span style="color: #0000ff;">var</span> el =<span style="color: #000000;"> [],

_el </span>= <span style="color: #0000ff;">this</span>.getElementsByTagName('*'<span style="color: #000000;">);

</span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; _el.length; i++<span style="color: #000000;">) {

</span><span style="color: #0000ff;">if</span> (!!_el[i].className &amp;&amp; (<span style="color: #0000ff;">typeof</span> _el[i].className == 'string') &amp;&amp; _el[i].className.indexOf(n) &gt; -1<span style="color: #000000;">) {

el[el.length] </span>=<span style="color: #000000;"> _el[i];

}

}

</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> el;

};

((</span><span style="color: #0000ff;">typeof</span> HTMLDocument !== 'undefined') ? HTMLDocument : Document).prototype.getElementsByClass =<span style="color: #000000;"> HTMLElement.prototype

.getElementsByClass;

}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 仿宋_GB2312;">参数合并函数：</span> <span style="font-family: 仿宋_GB2312;">对象合并，这个主要用于插件默认参数赋值操作，如果设置就使用新的参数，如果不设置就使用默认参数</span></p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">表示原有参数，n表示新参数，override表示是否进行覆盖</span>

<span style="color: #0000ff;">function</span><span style="color: #000000;"> extend(o, n, override) {

</span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> key <span style="color: #0000ff;">in</span><span style="color: #000000;"> n) {

</span><span style="color: #0000ff;">if</span> (n.hasOwnProperty(key) &amp;&amp; (!o.hasOwnProperty(key) ||<span style="color: #000000;"> override)) {

o[key] </span>=<span style="color: #000000;"> n[key];

}

}

</span><span style="color: #0000ff;">return</span><span style="color: #000000;"> o;

}</span></pre>
</div>
<p>&nbsp;</p>
<p>3.基本功能</p>
<p><span style="font-family: 仿宋_GB2312;">参数初始化</span>,里面有详细的注释。</p>
<div class="cnblogs_code">
<pre><code>_initial: <span style="color: #0000ff;">function</span><span style="color: #000000;">(opt) {

</span><span style="color: #008000;">//</span><span style="color: #008000;"> 默认参数</span>

<span style="color: #0000ff;">var</span> def =<span style="color: #000000;"> {

skinID: </span>"default", <span style="color: #008000;">//</span><span style="color: #008000;">默认皮肤路径</span>
<span style="color: #000000;">
domID: </span>"musicbox" <span style="color: #008000;">//</span><span style="color: #008000;">设置播放器容器ID</span>
<span style="color: #000000;">
};

</span><span style="color: #008000;">//</span><span style="color: #008000;">如果函数初始化时，设置参数时，进行合并，如果没有设置使用默认参数</span>

<span style="color: #0000ff;">this</span>.def = extend(def, opt, <span style="color: #0000ff;">true</span><span style="color: #000000;">);

</span><span style="color: #008000;">//</span><span style="color: #008000;">用于JSON文件存储数据</span>

<span style="color: #0000ff;">this</span>.data =<span style="color: #000000;"> {};

</span><span style="color: #008000;">//</span><span style="color: #008000;">播放器初始音量为0.3</span>

<span style="color: #0000ff;">this</span>.sound = 0.3<span style="color: #000000;">;

</span><span style="color: #0000ff;">this</span>.currentID = 0<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">创建audion</span>

<span style="color: #0000ff;">this</span>.audion = document.createElement("AUDIO"<span style="color: #000000;">);

</span><span style="color: #008000;">//</span><span style="color: #008000;">获取播放器dom对象</span>

<span style="color: #0000ff;">this</span>.dom =<span style="color: #000000;"> document.getElementById(def.domID);

</span><span style="color: #008000;">//</span><span style="color: #008000;">播放器初始音量</span>

<span style="color: #0000ff;">this</span>.audion.volume = <span style="color: #0000ff;">this</span><span style="color: #000000;">.sound;

</span><span style="color: #008000;">//</span><span style="color: #008000;">定义定时器，用于进度条调整，歌曲滚动等功能</span>

<span style="color: #0000ff;">this</span><span style="color: #000000;">.timecolick;

</span><span style="color: #008000;">//</span><span style="color: #008000;">歌曲容器</span>

<span style="color: #0000ff;">this</span><span style="color: #000000;">.songBox;

</span><span style="color: #008000;">//</span><span style="color: #008000;">播放器状态，0表示顺序播放；1表示循环播放；2表示随机播放。</span>

<span style="color: #0000ff;">this</span>.isPlayState = 0<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">歌曲列表用于存储歌曲数据</span>

<span style="color: #0000ff;">this</span><span style="color: #000000;">.songList;

</span><span style="color: #008000;">//</span><span style="color: #008000;">歌曲播放进度条</span>

<span style="color: #0000ff;">this</span><span style="color: #000000;">.songProgress;

</span><span style="color: #008000;">//</span><span style="color: #008000;">播放进度条上的播放头</span>

<span style="color: #0000ff;">this</span><span style="color: #000000;">.songPlayHead;

</span><span style="color: #008000;">//</span><span style="color: #008000;">判断歌曲是否允许滚动，0表示允许，1表示不允许</span>

<span style="color: #0000ff;">this</span>.isSlide = 0<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">播放进度，0表示初始位置</span>

<span style="color: #0000ff;">this</span>.playprogress = 0<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">最大</span>

<span style="color: #0000ff;">this</span>.playMax = 0<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">播放器是否在播放，0表示正在播放，1表示暂停</span>

<span style="color: #0000ff;">this</span>.isPlaying = 0<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">歌曲列表滚动距离</span>

<span style="color: #0000ff;">this</span>.scollHeight = 20<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">初始化播放器，并开始播放</span>

<span style="color: #0000ff;">this</span><span style="color: #000000;">._GetData();

},</span></pre>
</div>
<p>&nbsp;</p>
<p>播放器界面初始化，并播放歌曲</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">设置播放器界面</span>

<span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span>;<span style="color: #008000;">//</span><span style="color: #008000;">把当前对象存到_this</span>

<span style="color: #008000;">//</span><span style="color: #008000;">初始化CSS文件</span>
<span style="color: #000000;">
cssinto(</span>"skin/" + <span style="color: #0000ff;">this</span>.def.skinID + "/css/music.css"<span style="color: #000000;">);

</span><span style="color: #008000;">//</span><span style="color: #008000;">读取json数据</span>
<span style="color: #000000;">
readTextFile(</span>"skin/" + <span style="color: #0000ff;">this</span>.def.skinID + "/data.json", <span style="color: #0000ff;">function</span><span style="color: #000000;">(text) {

</span><span style="color: #008000;">//</span><span style="color: #008000;">数据读取到data</span>
<span style="color: #000000;">
_this.data </span>=<span style="color: #000000;"> JSON.parse(text);

</span><span style="color: #008000;">//</span><span style="color: #008000;">把界面HTML代码插入容器，界面初始化</span>
<span style="color: #000000;">
_this.dom.innerHTML </span>= _this.data[0<span style="color: #000000;">].MusicHtml;

</span><span style="color: #008000;">//</span><span style="color: #008000;">设置歌曲列表</span>

<span style="color: #0000ff;">var</span> htmlinsert = ""<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">过去歌曲容器dom对象</span>
<span style="color: #000000;">
_this.songBox </span>= _this.dom.getElementsByClass(_this.data[0].musiclistbox)[0<span style="color: #000000;">];

</span><span style="color: #008000;">//</span><span style="color: #008000;">存储歌曲数据</span>
<span style="color: #000000;">
_this.songList </span>= _this.data[0<span style="color: #000000;">].Songlist;

</span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; _this.songList.length; i++<span style="color: #000000;">) {

htmlinsert </span>+= '&lt;li&gt;&lt;span&gt;' + _this.songList[i].songname + '&lt;/span&gt;&lt;/li&gt;'<span style="color: #000000;">;

}

_this.songBox.innerHTML </span>=<span style="color: #000000;"> htmlinsert;

</span><span style="color: #008000;">//</span><span style="color: #008000;">设置音乐列表单击事件</span>

<span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; _this.songBox.childNodes.length; i++<span style="color: #000000;">) {

(

</span><span style="color: #0000ff;">function</span><span style="color: #000000;">(j) {

_this.songBox.childNodes[j].onclick </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">() {

_this._PlaySong(j);

}

})(i)

}

</span><span style="color: #008000;">//</span><span style="color: #008000;">所有数据加载完毕，开始播放歌曲</span>
<span style="color: #000000;">
_this._PlaySong(</span>0);</pre>
</div>
<p>&nbsp;</p>
<p>暂停播放功能。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">播放停止按钮事件 _this.dom.getElementsByClass(_this.data[0].playBT)[0].onclick = function(e) {</span>

<span style="color: #008000;">//</span><span style="color: #008000;">如果正在播放则停止播放</span>

<span style="color: #0000ff;">if</span> (_this.isPlaying == 0<span style="color: #000000;">) {

</span><span style="color: #0000ff;">this</span>.className = "playbutton"<span style="color: #000000;">;

_this.isPlaying </span>= 1<span style="color: #000000;">;

_this.audion.pause()

} </span><span style="color: #0000ff;">else</span> <span style="color: #008000;">//</span><span style="color: #008000;">如果停止播放则开始播放</span>
<span style="color: #000000;">
{

</span><span style="color: #0000ff;">this</span>.className = "pausebutton"<span style="color: #000000;">;

_this.isPlaying </span>= 0<span style="color: #000000;">;

_this.audion.play();

}

}</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>歌曲切换功能，上一首，下一首切换。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">上一首按钮</span>
<span style="color: #000000;">
_this.dom.getElementsByClass(_this.data[</span>0].preBton)[0].onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">if</span> (_this.currentID &gt; 0<span style="color: #000000;">) {

_this.currentID</span>--<span style="color: #000000;">;

} </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {

_this.currentID </span>= _this.songList.length - 1<span style="color: #000000;">;

}

_this._PlaySong(_this.currentID)

}

</span><span style="color: #008000;">//</span><span style="color: #008000;">下一首按钮</span>
<span style="color: #000000;">
_this.dom.getElementsByClass(_this.data[</span>0].nextBton)[0].onclick = <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">if</span> (_this.currentID &lt; _this.songList.length - 1<span style="color: #000000;">) {

_this.currentID</span>++<span style="color: #000000;">;

} </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {

_this.currentID </span>= 0<span style="color: #000000;">;

}

_this._PlaySong(_this.currentID)

}</span></pre>
</div>
<p>&nbsp;</p>
<p>随机播放功能，按钮点击后歌曲将实现随机播放。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">随机播放按钮</span>

<span style="color: #0000ff;">var</span> randombtn = _this.dom.getElementsByClass(_this.data[0].randombtn)[0<span style="color: #000000;">];

randombtn.onclick </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">if</span> (_this.isPlayState == 1<span style="color: #000000;">) {

_this.isPlayState </span>= 0<span style="color: #000000;">;

</span><span style="color: #0000ff;">this</span>.className = _this.data[0<span style="color: #000000;">].shuffle;

</span><span style="color: #0000ff;">return</span><span style="color: #000000;">;

}

</span><span style="color: #0000ff;">if</span> (_this.isPlayState == 2<span style="color: #000000;">) {

onereplay.className </span>= _this.data[0<span style="color: #000000;">].replay;

}

_this.isPlayState </span>= 1<span style="color: #000000;">;

</span><span style="color: #0000ff;">this</span>.className = _this.data[0<span style="color: #000000;">].shuffleon;

}</span></pre>
</div>
<p>&nbsp;</p>
<p>单曲循环功能，按钮点击后歌曲将实现单曲循环播放。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">单曲循环按钮</span>

<span style="color: #0000ff;">var</span> onereplay = _this.dom.getElementsByClass(_this.data[0].onereplay)[0<span style="color: #000000;">];

onereplay.onclick </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">if</span> (_this.isPlayState == 2<span style="color: #000000;">) {

_this.isPlayState </span>= 0<span style="color: #000000;">;

</span><span style="color: #0000ff;">this</span>.className = _this.data[0<span style="color: #000000;">].replay;

</span><span style="color: #0000ff;">return</span><span style="color: #000000;">;

}

</span><span style="color: #0000ff;">if</span> (_this.isPlayState == 1<span style="color: #000000;">) {

randombtn.className </span>= _this.data[0<span style="color: #000000;">].shuffleon;

}

_this.isPlayState </span>= 2<span style="color: #000000;">;

</span><span style="color: #0000ff;">this</span>.className =  _this.data[0<span style="color: #000000;">].replay;

 

}</span></pre>
</div>
<p>&nbsp;</p>
<p><span style="font-family: 仿宋_GB2312;">音量调节功能</span>,拖放调节音量功能。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">音量调节按钮</span>

<span style="color: #0000ff;">var</span> soundHead = _this.dom.getElementsByClass(_this.data[0].soundHead)[0<span style="color: #000000;">];

</span><span style="color: #0000ff;">var</span> soundBox = _this.dom.getElementsByClass(_this.data[0].soundBox)[0<span style="color: #000000;">];

</span><span style="color: #0000ff;">var</span> soundCurrentTime = _this.dom.getElementsByClass(_this.data[0].soundCurrentTime)[0<span style="color: #000000;">];

soundHead.style.left </span>= _this.sound * 100 + 'px'<span style="color: #000000;">;

soundCurrentTime.style.width </span>= _this.sound * 100 + '%'<span style="color: #000000;">;

soundHead.onmousedown </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">var</span> x = (e ||<span style="color: #000000;"> window.event).clientX;

</span><span style="color: #0000ff;">var</span> l = <span style="color: #0000ff;">this</span><span style="color: #000000;">.offsetLeft;

</span><span style="color: #0000ff;">var</span> max = soundBox.offsetWidth - <span style="color: #0000ff;">this</span><span style="color: #000000;">.offsetWidth;

document.onmousemove </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">var</span> thisX = (e ||<span style="color: #000000;"> window.event).clientX;

</span><span style="color: #0000ff;">var</span> to = Math.min(max, Math.max(-2, l + (thisX -<span style="color: #000000;"> x)));

</span><span style="color: #0000ff;">if</span> (to &lt; 0<span style="color: #000000;">) {

to </span>= 0<span style="color: #000000;">;

}

soundHead.style.left </span>= to + 'px'<span style="color: #000000;">;

</span><span style="color: #008000;">//</span><span style="color: #008000;">此句代码可以除去选中效果</span>
<span style="color: #000000;">
window.getSelection </span>?<span style="color: #000000;"> window.getSelection().removeAllRanges() : document.selection.empty();

_this.audion.volume </span>= to /<span style="color: #000000;"> max;

</span><span style="color: #008000;">//</span><span style="color: #008000;">document.querySelector('.now')</span>
<span style="color: #000000;">
soundCurrentTime.style.width </span>= to / max * 100 + '%'<span style="color: #000000;">;

}

</span><span style="color: #008000;">//</span><span style="color: #008000;">注意此处是document 才能有好的拖动效果</span>
<span style="color: #000000;">
document.onmouseup </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">() {

document.onmousemove </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;

};

}</span></pre>
</div>
<p>&nbsp;</p>
<p>进度条功能。</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">获取进度条dom</span>
<span style="color: #000000;">
_this.songProgress </span>= _this.dom.getElementsByClass(_this.data[0].SongProgress)[0<span style="color: #000000;">];

</span><span style="color: #008000;">//</span><span style="color: #008000;">获取进度条上的播放头</span>
<span style="color: #000000;">
_this.songPlayHead </span>= _this.dom.getElementsByClass(_this.data[0].playHead)[0<span style="color: #000000;">];

</span><span style="color: #008000;">//</span><span style="color: #008000;">单击进度条 调整发播放进度</span>
<span style="color: #000000;">
_this.songProgress.onclick </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">var</span> x = (e ||<span style="color: #000000;"> window.event).clientX;

</span><span style="color: #0000ff;">var</span> left = x - <span style="color: #0000ff;">this</span>.offsetLeft -<span style="color: #000000;"> _this.songPlayHead.offsetWidth;

</span><span style="color: #0000ff;">var</span> maxwidth =<span style="color: #000000;"> _this.songProgress.offsetWidth;

_this.dom.getElementsByClass(_this.data[</span>0].playHead)[0].style.left = left + 'px'<span style="color: #000000;">;

</span><span style="color: #0000ff;">var</span> currenttime = _this.audion.duration * (left /<span style="color: #000000;"> maxwidth)

</span><span style="color: #0000ff;">var</span> p = left /<span style="color: #000000;"> maxwidth

_this.audion.currentTime </span>= p *<span style="color: #000000;"> _this.audion.duration;

_this.audion.play();

};

</span><span style="color: #008000;">//</span><span style="color: #008000;">拖动播放头，调整播放进度</span>
<span style="color: #000000;">
_this.songPlayHead.onmousedown </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">var</span> x = (e ||<span style="color: #000000;"> window.event).clientX;

</span><span style="color: #0000ff;">var</span> l = <span style="color: #0000ff;">this</span><span style="color: #000000;">.offsetLeft;

</span><span style="color: #0000ff;">var</span> max = _this.songProgress.offsetWidth - <span style="color: #0000ff;">this</span><span style="color: #000000;">.offsetWidth;

_this.playMax </span>=<span style="color: #000000;"> max;

document.onmousemove </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">(e) {

</span><span style="color: #0000ff;">var</span> thisX = (e ||<span style="color: #000000;"> window.event).clientX;

</span><span style="color: #0000ff;">var</span> to = Math.min(max, Math.max(-2, l + (thisX -<span style="color: #000000;"> x)));

</span><span style="color: #0000ff;">if</span> (to &lt; 0<span style="color: #000000;">) {

to </span>= 0<span style="color: #000000;">;

}

_this.playprogress </span>=<span style="color: #000000;"> to;

_this.isSlide </span>= 1<span style="color: #000000;">;

_this.songPlayHead.style.left </span>= to + 'px'<span style="color: #000000;">;

_this.dom.getElementsByClass(_this.data[</span>0].SingerCurrentTime)[0].innerHTML = conversion(_this.audion.duration *<span style="color: #000000;"> (_this

.playprogress </span>/<span style="color: #000000;"> _this.playMax));

</span><span style="color: #008000;">//</span><span style="color: #008000;">此句代码可以除去选中效果</span>
<span style="color: #000000;">
window.getSelection </span>?<span style="color: #000000;"> window.getSelection().removeAllRanges() : document.selection.empty();

</span><span style="color: #008000;">//</span><span style="color: #008000;"> _this.audion.currentTime = to / max;</span>
<span style="color: #000000;">
 

}

</span><span style="color: #008000;">//</span><span style="color: #008000;">注意此处是document 才能有好的拖动效果</span>
<span style="color: #000000;">
document.onmouseup </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">() {

_this.isSlide </span>= 0<span style="color: #000000;">;

_this.audion.currentTime </span>= (_this.playprogress / _this.playMax) *<span style="color: #000000;"> _this.audion.duration;

_this.audion.play();

document.onmousemove </span>= <span style="color: #0000ff;">null</span><span style="color: #000000;">;

};</span></pre>
</div>
<p>&nbsp;</p>
<p>定时函数功能</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;">定时函数</span>
<span style="color: #000000;">
_this.timecolick </span>= setInterval(<span style="color: #0000ff;">function</span><span style="color: #000000;">() {

</span><span style="color: #0000ff;">if</span> (_this.isSlide == 1<span style="color: #000000;">) {

</span><span style="color: #0000ff;">return</span><span style="color: #000000;">;

}

</span><span style="color: #008000;">//</span><span style="color: #008000;">设置进度条</span>

<span style="color: #0000ff;">var</span> percent = Math.floor(_this.audion.currentTime / _this.audion.duration * 10000) / 100 + "%"<span style="color: #000000;">;

_this.songPlayHead.style.left </span>=<span style="color: #000000;"> percent;

</span><span style="color: #008000;">//</span><span style="color: #008000;">设置当前播放时间</span>
<span style="color: #000000;">
_this.dom.getElementsByClass(_this.data[</span>0].SingerCurrentTime)[0].innerHTML =<span style="color: #000000;"> conversion(_this.audion.currentTime);

</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (_this.audion.ended) {

</span><span style="color: #0000ff;">if</span> (_this.isPlayState == 0) <span style="color: #008000;">//</span><span style="color: #008000;">顺序播放</span>
<span style="color: #000000;">
{

</span><span style="color: #0000ff;">if</span> (_this.currentID &lt; _this.songList.length - 1<span style="color: #000000;">) {

_this.currentID</span>++<span style="color: #000000;">;

} </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {

_this.currentID </span>= 0<span style="color: #000000;">;

}

} </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (_this.isPlayState == 1) <span style="color: #008000;">//</span><span style="color: #008000;">随机播放</span>
<span style="color: #000000;">
{

_this.currentID </span>= Math.floor(Math.random() * _this.songList.length - 1<span style="color: #000000;">)

} </span><span style="color: #0000ff;">else</span> <span style="color: #008000;">//</span><span style="color: #008000;">单曲循环</span>
<span style="color: #000000;">
{

_this.currentID </span>=<span style="color: #000000;"> _this.currentID;

}

console.log(_this.currentID)

_this._PlaySong(_this.currentID);

}

}, </span>100)</pre>
</div>
<p>&nbsp;</p>
<p>歌曲播放功能</p>
<div class="cnblogs_code">
<pre><code>__PlaySong: <span style="color: #0000ff;">function</span><span style="color: #000000;">(songID) {

</span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;

</span><span style="color: #0000ff;">this</span>.audion.setAttribute("src", <span style="color: #0000ff;">this</span>.data[0<span style="color: #000000;">].Songlist[songID].songurl);

</span><span style="color: #0000ff;">this</span>.dom.getElementsByClass(<span style="color: #0000ff;">this</span>.data[0].SongName)[0].innerHTML = _this.data[0<span style="color: #000000;">].Songlist[songID].songname;

_this.dom.getElementsByClass(</span><span style="color: #0000ff;">this</span>.data[0].Singer)[0].innerHTML = <span style="color: #0000ff;">this</span>.data[0<span style="color: #000000;">].Songlist[songID].songer;

_this.audion.onloadedmetadata </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;">() {

_this.dom.getElementsByClass(</span><span style="color: #0000ff;">this</span>.data[0].SingerCurrentTime)[0].innerHTML =<span style="color: #000000;"> conversion(_this.audion.currentTime);

_this.dom.getElementsByClass(</span><span style="color: #0000ff;">this</span>.data[0].showalltime)[0].innerHTML =<span style="color: #000000;"> conversion(_this.audion.duration)

}

</span><span style="color: #0000ff;">this</span><span style="color: #000000;">.audion.play();

</span><span style="color: #0000ff;">var</span> Songlist =<span style="color: #000000;"> _this.songBox.childNodes;

</span><span style="color: #0000ff;">for</span> (<span style="color: #0000ff;">var</span> i = 0; i &lt; Songlist.length; i++<span style="color: #000000;">) {

</span><span style="color: #0000ff;">if</span> (songID ==<span style="color: #000000;"> i) {

Songlist.item(i).setAttribute(</span>"class", <span style="color: #0000ff;">this</span>.data[0<span style="color: #000000;">].currentSong);

} </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {

Songlist.item(i).setAttribute(</span>"class", ""<span style="color: #000000;">)

}

}

</span><span style="color: #008000;">//</span><span style="color: #008000;">console.log(_this.scollHeight*songID)</span>
<span style="color: #000000;">
_this._scollToMusiclist(songID, _this.dom.getElementsByClass(</span><span style="color: #0000ff;">this</span>.data[0].MusicList)[0<span style="color: #000000;">])

 

}</span></pre>
</div>
<p>&nbsp;</p>
<p>歌曲滚动功能。</p>
<div class="cnblogs_code">
<pre><code>_scollToMusiclist: <span style="color: #0000ff;">function</span><span style="color: #000000;">(singID, wmusicbox) {

</span><span style="color: #008000;">//</span><span style="color: #008000;">ok  2019年4月5日，终于调试成功，长时间不开发真的不行，好多事情想不到，刚才不停的滚动现象是由于我没有对最大值进行判断，如果超过最大值，我们需要把最大值赋给变量，那样就不会不停的闪烁了。</span>

<span style="color: #0000ff;">var</span> gundong = singID * 20<span style="color: #000000;">;

</span><span style="color: #0000ff;">var</span> maxgundong = wmusicbox.scrollHeight -<span style="color: #000000;"> wmusicbox.offsetHeight;

</span><span style="color: #0000ff;">if</span> (gundong &gt;<span style="color: #000000;"> maxgundong) {

gundong </span>=<span style="color: #000000;"> maxgundong;

}

</span><span style="color: #0000ff;">var</span> scollTime = setInterval(<span style="color: #0000ff;">function</span><span style="color: #000000;">() {

console.log(wmusicbox.scrollTop)

</span><span style="color: #0000ff;">if</span> (wmusicbox.scrollTop &lt;<span style="color: #000000;"> gundong) {

wmusicbox.scrollTop </span>= wmusicbox.scrollTop + 1<span style="color: #000000;">;

console.log(gundong)

} </span><span style="color: #0000ff;">else</span> <span style="color: #0000ff;">if</span> (wmusicbox.scrollTop &gt;<span style="color: #000000;"> gundong) {

wmusicbox.scrollTop </span>= wmusicbox.scrollTop - 1<span style="color: #000000;">;

console.log(</span>"2"<span style="color: #000000;">)

} </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {

console.log(</span>"="<span style="color: #000000;">)

clearInterval(scollTime);

}

})

}</span></pre>
</div>
<p>&nbsp;</p>
<p>ok,这网我们的网页播放器已经全部编写完毕，我把源代码打包，提供大家下载，多提宝贵意见。 单击<a href="http://agoodlife.cn/down/" target="_blank">下载</a></p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>