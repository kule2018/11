<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='ç”µè„‘,ç”µè„‘è®²è§£,ç”µè„‘æŠ€æœ¯,ç¼–ç¨‹,ç”µè„‘æ•…éšœç»´ä¿®è‡ªå·±å†™ä¸€ä¸ªPromise' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>é¦–é¡µ</a></li>
</div><div onclick='hidden1()' >åˆ†äº«</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>è‡ªå·±å†™ä¸€ä¸ªPromise</center></div><div class='banquan'>åŸæ–‡å‡ºå¤„:æœ¬æ–‡ç”±åšå®¢å›­åšä¸»åˆå¿ƒï¼Œä½ å¥½å—æä¾›ã€‚<br/>
åŸæ–‡è¿æ¥:https://www.cnblogs.com/LHLVS/p/10796751.html</div><br>
    <p>å‚è€ƒPromise çš„&nbsp; å®˜æ–¹è§„èŒƒ&nbsp;&nbsp;<a href="https://promisesaplus.com/">https://promisesaplus.com/</a></p>
<p>Promise å…¶å®å°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœº</p>
<p>å®ƒåªæœ‰ä¸¤ç§çŠ¶æ€å˜åŒ– pending&nbsp; &nbsp; =ã€‹&nbsp; &nbsp;fulfilled</p>
<p>ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€pending&nbsp; &nbsp; =ã€‹&nbsp; &nbsp;rejected</p>
<p>å¹¶ä¸”çŠ¶æ€ä¸€æ—¦å‘ç”Ÿå˜åŒ–åå°±ä¸ä¼šå†æ”¹å˜</p>
<p>æˆ‘ä»¬ç”¨es5æ¥å®ç°ä¸‹</p>
<p>å…ˆå†™ä¸ªæ¶å­ï¼Œ å¹¶æµ‹è¯•ä¸‹ï¼š</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> myPromise(executor) {
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span>; <span style="color: #008000;">//</span><span style="color: #008000;"> ä¿å­˜å½“å‰çš„å‡½æ•°ä¸Šä¸‹æ–‡</span>
    _this.status = 'pending'; <span style="color: #008000;">//</span><span style="color: #008000;"> åˆå§‹çŠ¶æ€</span>
    _this.resolveValue = <span style="color: #0000ff;">null</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> resolveåˆå§‹å€¼</span>
    _this.rejectValue = <span style="color: #0000ff;">null</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> rejectåˆå§‹å€¼</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> resolve(value) {
        </span><span style="color: #0000ff;">if</span> (_this.status ==  'pending'<span style="color: #000000;">) {
            _this.status </span>= 'Fulfilled'<span style="color: #000000;">;
            _this.resolveValue </span>=<span style="color: #000000;"> value;
        }
    }
    </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> reject(reason) {
        </span><span style="color: #0000ff;">if</span> (_this.status ==  'pending'<span style="color: #000000;">) {
            _this.status </span>= 'Fulfilled'<span style="color: #000000;">;
            _this.rejectValue </span>=<span style="color: #000000;"> reason;
        }
    }
    </span><span style="color: #0000ff;">try</span> {    <span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
<span style="color: #000000;">        executor(resolve, reject)
    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e){
        reject(e);
    }
}
myPromise.prototype.then </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (onFulfilled, onRejected) {
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">if</span> (_this.status == 'Fulfilled'<span style="color: #000000;">) {
        onFulfilled(_this.resolveValue)
    }
    </span><span style="color: #0000ff;">if</span> (_this.status == 'Rejected'<span style="color: #000000;">) {
        onRejected(_this.rejectValue)
    }
};

</span><span style="color: #0000ff;">var</span> p = <span style="color: #0000ff;">new</span> myPromise((resolve, reject) =&gt;<span style="color: #000000;"> {
    resolve(</span>'I am handsome'<span style="color: #000000;">);
    </span><span style="color: #0000ff;">throw</span> Error('æ•è·é”™è¯¯'<span style="color: #000000;">)
});
p.then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data)
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err)
} );</span></pre>
</div>
<p>ç»“æœï¼š</p>
<p><img src="./images/è‡ªå·±å†™ä¸€ä¸ªPromise0.png" alt="" /></p>
<p>å®ƒå…ˆæ‰§è¡Œresolve&nbsp; &nbsp;çŠ¶æ€ å˜ä¸º&nbsp; &nbsp;Fulfilled&nbsp; &nbsp; ï¼Œ</p>
<p>ç„¶åæŠ¥é”™ ï¼Œæ‰§è¡Œreject ï¼Œ ç”±äºæ­¤æ—¶çŠ¶æ€ä¸æ˜¯pendingï¼Œ çŠ¶æ€è¿˜æ˜¯Fulfilled</p>
<p>Promiseçš„æ ¸å¿ƒæ˜¯å¤„ç†å¼‚æ­¥ï¼Œ</p>
<p>ç°åœ¨æˆ‘ä»¬çš„ä»£ç å¹¶ä¸èƒ½ç­‰å¾…çŠ¶æ€çš„æ”¹å˜ï¼Œ</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åŠ ä¸Šå¤„ç†å¼‚æ­¥æ“ä½œçš„åŠŸèƒ½ï¼Œ å¹¶æµ‹è¯•ä¸‹</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> myPromise(executor) {
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span>; <span style="color: #008000;">//</span><span style="color: #008000;"> ä¿å­˜å½“å‰çš„å‡½æ•°ä¸Šä¸‹æ–‡</span>
    _this.status = 'pending'; <span style="color: #008000;">//</span><span style="color: #008000;"> åˆå§‹çŠ¶æ€</span>
    _this.resolveValue = <span style="color: #0000ff;">null</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> resolveåˆå§‹å€¼</span>
    _this.rejectValue = <span style="color: #0000ff;">null</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> rejectåˆå§‹å€¼</span>
    _this.resolveCallbackList = []; <span style="color: #008000;">//</span><span style="color: #008000;"> å­˜resolveçš„å›è°ƒ</span>
    _this.rejectCallbackList = []; <span style="color: #008000;">//</span><span style="color: #008000;"> å­˜rejectçš„å›è°ƒ</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> resolve(value) {
        </span><span style="color: #0000ff;">if</span> (_this.status ==  'pending'<span style="color: #000000;">) {
            _this.status </span>= 'Fulfilled'<span style="color: #000000;">;
            _this.resolveValue </span>=<span style="color: #000000;"> value;
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> çŠ¶æ€æ”¹å˜æ‰§è¡Œå­˜çš„å›è°ƒ</span>
            _this.resolveCallbackList.forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(ele){
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ele) {
                    ele();
                }
            })
        }
    }
    </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> reject(reason) {
        </span><span style="color: #0000ff;">if</span> (_this.status ==  'pending'<span style="color: #000000;">) {
            _this.status </span>= 'Rejected'<span style="color: #000000;">;
            _this.rejectValue </span>=<span style="color: #000000;"> reason;
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> çŠ¶æ€æ”¹å˜æ‰§è¡Œå­˜çš„å›è°ƒ</span>
            _this.rejectCallbackList.forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(ele){
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ele) {
                    ele();
                }
            })
        }
    }
    </span><span style="color: #0000ff;">try</span> {    <span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
<span style="color: #000000;">        executor(resolve, reject)
    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e){
        reject(e);
    }
}
myPromise.prototype.then </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (onFulfilled, onRejected) {
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
    </span><span style="color: #0000ff;">if</span> (_this.status == 'Fulfilled'<span style="color: #000000;">) {
        onFulfilled(_this.resolveValue)
    }
    </span><span style="color: #0000ff;">if</span> (_this.status == 'Rejected'<span style="color: #000000;">) {
        onRejected(_this.rejectValue)
    }
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç­‰å¾…çŠ¶æ€æ—¶æŠŠå›è°ƒå­˜èµ·æ¥ï¼ŒçŠ¶æ€æ”¹å˜å†è§¦å‘</span>
    <span style="color: #0000ff;">if</span> (_this.status == 'pending'<span style="color: #000000;">) {
        _this.resolveCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            onFulfilled(_this.resolveValue)
        });
        _this.rejectCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
            onRejected(_this.rejectValue)
        });
    }
};

</span><span style="color: #0000ff;">var</span> p = <span style="color: #0000ff;">new</span> myPromise((resolve, reject) =&gt;<span style="color: #000000;"> {
    setTimeout(() </span>=&gt;<span style="color: #000000;"> {
        resolve(</span>'I am handsome'<span style="color: #000000;">);
    }, </span>0<span style="color: #000000;">);
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> throw Error('æ•è·é”™è¯¯')</span>
<span style="color: #000000;">});
p.then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data)
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err)
} );</span></pre>
</div>
<p>ç»“æœï¼š</p>
<p><img src="./images/è‡ªå·±å†™ä¸€ä¸ªPromise1.png" alt="" width="429" height="47" /></p>
<p>&nbsp;</p>
<p>&nbsp;ğŸ†—&nbsp; å®ƒå·²ç»èƒ½å¤„ç†å¼‚æ­¥æ“ä½œäº†</p>
<p>&nbsp;</p>
<p>æ¥ä¸‹æ¥å®ç°é“¾å¼æ“ä½œï¼Œ å†æµ‹è¯•ä¸‹</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> myPromise(executor) {
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span>; <span style="color: #008000;">//</span><span style="color: #008000;"> ä¿å­˜å½“å‰çš„å‡½æ•°ä¸Šä¸‹æ–‡</span>
    _this.status = 'pending'; <span style="color: #008000;">//</span><span style="color: #008000;"> åˆå§‹çŠ¶æ€</span>
    _this.resolveValue = <span style="color: #0000ff;">null</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> resolveåˆå§‹å€¼</span>
    _this.rejectValue = <span style="color: #0000ff;">null</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> rejectåˆå§‹å€¼</span>
    _this.resolveCallbackList = []; <span style="color: #008000;">//</span><span style="color: #008000;"> å­˜resolveçš„å›è°ƒ</span>
    _this.rejectCallbackList = []; <span style="color: #008000;">//</span><span style="color: #008000;"> å­˜rejectçš„å›è°ƒ</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> resolve(value) {
        </span><span style="color: #0000ff;">if</span> (_this.status ==  'pending'<span style="color: #000000;">) {
            _this.status </span>= 'Fulfilled'<span style="color: #000000;">;
            _this.resolveValue </span>=<span style="color: #000000;"> value;
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> çŠ¶æ€æ”¹å˜æ‰§è¡Œå­˜çš„å›è°ƒ</span>
            _this.resolveCallbackList.forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(ele){
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ele) {
                    ele();
                }
            })
        }
    }
    </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> reject(reason) {
        </span><span style="color: #0000ff;">if</span> (_this.status ==  'pending'<span style="color: #000000;">) {
            _this.status </span>= 'Rejected'<span style="color: #000000;">;
            _this.rejectValue </span>=<span style="color: #000000;"> reason;
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> çŠ¶æ€æ”¹å˜æ‰§è¡Œå­˜çš„å›è°ƒ</span>
            _this.rejectCallbackList.forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(ele){
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ele) {
                    ele();
                }
            })
        }
    }
    </span><span style="color: #0000ff;">try</span> {    <span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
<span style="color: #000000;">        executor(resolve, reject)
    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e){
        reject(e);
    }
}
myPromise.prototype.then </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (onFulfilled, onRejected) {
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç”¨äºé“¾å¼è°ƒç”¨</span>
    <span style="color: #0000ff;">var</span> nextPromise = <span style="color: #0000ff;">new</span> myPromise(<span style="color: #0000ff;">function</span><span style="color: #000000;">(res, rej) {
        </span><span style="color: #0000ff;">if</span> (_this.status == 'Fulfilled'<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
            <span style="color: #0000ff;">var</span> nextResolveValue =<span style="color: #000000;"> onFulfilled(_this.resolveValue);
            res(nextResolveValue);
        }
        </span><span style="color: #0000ff;">if</span> (_this.status == 'Rejected'<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
            <span style="color: #0000ff;">var</span> nextRejectValue =<span style="color: #000000;"> onRejected(_this.rejectValue);
            rej(nextRejectValue);
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç­‰å¾…çŠ¶æ€æ—¶æŠŠå›è°ƒå­˜èµ·æ¥ï¼ŒçŠ¶æ€æ”¹å˜å†è§¦å‘</span>
        <span style="color: #0000ff;">if</span> (_this.status == 'pending'<span style="color: #000000;">) {
            _this.resolveCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
                <span style="color: #0000ff;">var</span> nextResolveValue =<span style="color: #000000;"> onFulfilled(_this.resolveValue);
                res(nextResolveValue);
            });
            _this.rejectCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #0000ff;">var</span> nextRejectValue =<span style="color: #000000;"> onRejected(_this.rejectValue);
                rej(nextRejectValue);
            });
        }
    });
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> nextPromise
};

</span><span style="color: #0000ff;">var</span> p = <span style="color: #0000ff;">new</span> myPromise((resolve, reject) =&gt;<span style="color: #000000;"> {
    setTimeout(() </span>=&gt;<span style="color: #000000;"> {
        resolve(</span>'I am handsome'<span style="color: #000000;">);
    }, </span>0<span style="color: #000000;">);
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> throw Error('æ•è·é”™è¯¯')</span>
<span style="color: #000000;">});
p.then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data </span>+ ' suc' + ' 1'<span style="color: #000000;">)
    </span><span style="color: #0000ff;">return</span> 222<span style="color: #000000;">
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err)
} ).then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data </span>+ ' suc' + ' 2'<span style="color: #000000;">)
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err)
} );</span></pre>
</div>
<p>ç»“æœ ï¼š</p>
<p><img src="./images/è‡ªå·±å†™ä¸€ä¸ªPromise2.png" alt="" width="471" height="66" /></p>
<p>æ²¡æ¯›ç—…ï¼Œ å¯ä»¥é“¾å¼è°ƒç”¨thenäº†&nbsp; ï¼Œ å…ˆä¸å¤„ç†è¿”å›å€¼ä¸ºPromise&nbsp; çš„ æƒ…å†µ&nbsp; ï¼Œ</p>
<p>åŸç”Ÿçš„Promise æ‰§è¡Œæ–¹æ³•éƒ½æ˜¯å¼‚æ­¥çš„&nbsp; ï¼Œ å¹¶ä¸”æ‰§è¡Œæ–¹æ³•æ˜¯èƒ½æ•æ‰é”™è¯¯ï¼Œ</p>
<p>æˆ‘ä»¬åŠ ä¸Šè¿™ä¸ªåŠŸèƒ½ ï¼Œ å¹¶ä¸”æµ‹è¯•ä¸‹</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> myPromise(executor) {
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span>; <span style="color: #008000;">//</span><span style="color: #008000;"> ä¿å­˜å½“å‰çš„å‡½æ•°ä¸Šä¸‹æ–‡</span>
    _this.status = 'pending'; <span style="color: #008000;">//</span><span style="color: #008000;"> åˆå§‹çŠ¶æ€</span>
    _this.resolveValue = <span style="color: #0000ff;">null</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> resolveåˆå§‹å€¼</span>
    _this.rejectValue = <span style="color: #0000ff;">null</span>;  <span style="color: #008000;">//</span><span style="color: #008000;"> rejectåˆå§‹å€¼</span>
    _this.resolveCallbackList = []; <span style="color: #008000;">//</span><span style="color: #008000;"> å­˜resolveçš„å›è°ƒ</span>
    _this.rejectCallbackList = []; <span style="color: #008000;">//</span><span style="color: #008000;"> å­˜rejectçš„å›è°ƒ</span>
    <span style="color: #0000ff;">function</span><span style="color: #000000;"> resolve(value) {
        </span><span style="color: #0000ff;">if</span> (_this.status ==  'pending'<span style="color: #000000;">) {
            _this.status </span>= 'Fulfilled'<span style="color: #000000;">;
            _this.resolveValue </span>=<span style="color: #000000;"> value;
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> çŠ¶æ€æ”¹å˜æ‰§è¡Œå­˜çš„å›è°ƒ</span>
            _this.resolveCallbackList.forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(ele){
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ele) {
                    ele();
                }
            })
        }
    }
    </span><span style="color: #0000ff;">function</span><span style="color: #000000;"> reject(reason) {
        </span><span style="color: #0000ff;">if</span> (_this.status ==  'pending'<span style="color: #000000;">) {
            _this.status </span>= 'Rejected'<span style="color: #000000;">;
            _this.rejectValue </span>=<span style="color: #000000;"> reason;
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> çŠ¶æ€æ”¹å˜æ‰§è¡Œå­˜çš„å›è°ƒ</span>
            _this.rejectCallbackList.forEach(<span style="color: #0000ff;">function</span><span style="color: #000000;">(ele){
                </span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (ele) {
                    ele();
                }
            })
        }
    }
    </span><span style="color: #0000ff;">try</span> {    <span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
<span style="color: #000000;">        executor(resolve, reject)
    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e){
        reject(e);
    }
}
myPromise.prototype.then </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (onFulfilled, onRejected) {
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç”¨äºé“¾å¼è°ƒç”¨</span>
    <span style="color: #0000ff;">var</span> nextPromise = <span style="color: #0000ff;">new</span> myPromise(<span style="color: #0000ff;">function</span><span style="color: #000000;">(res, rej) {
        </span><span style="color: #0000ff;">if</span> (_this.status == 'Fulfilled'<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
            setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    </span><span style="color: #0000ff;">var</span> nextResolveValue =<span style="color: #000000;"> onFulfilled(_this.resolveValue);
                    res(nextResolveValue);
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                    rej(e)
                }

            },</span>0<span style="color: #000000;">)
        }
        </span><span style="color: #0000ff;">if</span> (_this.status == 'Rejected'<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
            setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    </span><span style="color: #0000ff;">var</span> nextRejectValue =<span style="color: #000000;"> onRejected(_this.rejectValue);
                    rej(nextRejectValue);
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                    rej(e)
                }
            },</span>0<span style="color: #000000;">)
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç­‰å¾…çŠ¶æ€æ—¶æŠŠå›è°ƒå­˜èµ·æ¥ï¼ŒçŠ¶æ€æ”¹å˜å†è§¦å‘</span>
        <span style="color: #0000ff;">if</span> (_this.status == 'pending'<span style="color: #000000;">) {
            _this.resolveCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
                setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                    <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                        </span><span style="color: #0000ff;">var</span> nextResolveValue =<span style="color: #000000;"> onFulfilled(_this.resolveValue);
                        res(nextResolveValue);
                    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                        rej(e)
                    }
                },</span>0<span style="color: #000000;">)
            });
            _this.rejectCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                setTimeout(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                    <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                        </span><span style="color: #0000ff;">var</span> nextRejectValue =<span style="color: #000000;"> onRejected(_this.rejectValue);
                        rej(nextRejectValue);
                    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                        rej(e)
                    }
                },</span>0<span style="color: #000000;">)
            });
        }
    });
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> nextPromise
};

</span><span style="color: #0000ff;">var</span> p = <span style="color: #0000ff;">new</span> myPromise((resolve, reject) =&gt;<span style="color: #000000;"> {
    setTimeout(() </span>=&gt;<span style="color: #000000;"> {
        resolve(</span>'I am handsome'<span style="color: #000000;">);
        console.log(</span>111<span style="color: #000000;">)
    }, </span>0<span style="color: #000000;">);
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> throw Error('æ•è·é”™è¯¯')</span>
<span style="color: #000000;">});
p.then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data </span>+ ' suc' + ' 1'<span style="color: #000000;">);
    </span><span style="color: #0000ff;">throw</span> Error('bao cuo'<span style="color: #000000;">)
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err </span>+ ' err' + ' 1'<span style="color: #000000;">)
} ).then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data </span>+ ' suc' + ' 2'<span style="color: #000000;">)
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err </span>+ ' err' + ' 2'<span style="color: #000000;">)
} );
console.log(</span>222);</pre>
</div>
<p>é¢„æœŸç»“æœ&nbsp; 222&nbsp; =ã€‹ 111 =ã€‹&nbsp;I am handsome suc 1&nbsp; &nbsp; =ã€‹&nbsp; &nbsp;Error: bao cuo err 2</p>
<p>å®é™…ç»“æœï¼š</p>
<p><img src="./images/è‡ªå·±å†™ä¸€ä¸ªPromise3.png" alt="" width="353" height="79" /></p>
<p>&nbsp;</p>
<p>&nbsp;æ²¡æ¯›ç—…ï¼Œ å¼‚æ­¥å¹¶ä¸”æ•è·åˆ°é”™è¯¯äº†</p>
<p>æˆ‘ä»¬å†æ¥å¤„ç† ç©º then()&nbsp; &nbsp; å°±æ˜¯thené‡Œé¢ä¸ä¼ å‚æ•°çš„æƒ…å†µï¼Œ å¹¶æµ‹è¯•</p>
<div class="cnblogs_code">
<pre><code>myPromise.prototype.then = <span style="color: #0000ff;">function</span><span style="color: #000000;"> (onFulfilled, onRejected) {
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> å‚æ•°ä¸ºç©ºæŠŠå€¼ç›´æ¥ä¼ ç»™ä¸‹ä¸€ä¸ªthen</span>
    <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">onFulfilled) {
        onFulfilled </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (val) {
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> val;
        }
    }
    </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">onRejected) {
        onRejected </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (val) {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> Error(val)
        }
    }
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç”¨äºé“¾å¼è°ƒç”¨</span>
    <span style="color: #0000ff;">var</span> nextPromise = <span style="color: #0000ff;">new</span> myPromise(<span style="color: #0000ff;">function</span><span style="color: #000000;">(res, rej) {
        </span><span style="color: #0000ff;">if</span> (_this.status == 'Fulfilled'<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
            setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    </span><span style="color: #0000ff;">var</span> nextResolveValue =<span style="color: #000000;"> onFulfilled(_this.resolveValue);
                    res(nextResolveValue);
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                    rej(e)
                }

            },</span>0<span style="color: #000000;">)
        }
        </span><span style="color: #0000ff;">if</span> (_this.status == 'Rejected'<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
            setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    </span><span style="color: #0000ff;">var</span> nextRejectValue =<span style="color: #000000;"> onRejected(_this.rejectValue);
                    rej(nextRejectValue);
                } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                    rej(e)
                }
            },</span>0<span style="color: #000000;">)
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç­‰å¾…çŠ¶æ€æ—¶æŠŠå›è°ƒå­˜èµ·æ¥ï¼ŒçŠ¶æ€æ”¹å˜å†è§¦å‘</span>
        <span style="color: #0000ff;">if</span> (_this.status == 'pending'<span style="color: #000000;">) {
            _this.resolveCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
                setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                    <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                        </span><span style="color: #0000ff;">var</span> nextResolveValue =<span style="color: #000000;"> onFulfilled(_this.resolveValue);
                        res(nextResolveValue);
                    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                        rej(e)
                    }
                },</span>0<span style="color: #000000;">)
            });
            _this.rejectCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                setTimeout(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                    <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                        </span><span style="color: #0000ff;">var</span> nextRejectValue =<span style="color: #000000;"> onRejected(_this.rejectValue);
                        rej(nextRejectValue);
                    } </span><span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                        rej(e)
                    }
                },</span>0<span style="color: #000000;">)
            });
        }
    });
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> nextPromise
};

</span><span style="color: #0000ff;">var</span> p = <span style="color: #0000ff;">new</span> myPromise((resolve, reject) =&gt;<span style="color: #000000;"> {
    setTimeout(() </span>=&gt;<span style="color: #000000;"> {
        resolve(</span>'I am handsome'<span style="color: #000000;">);
    }, </span>0<span style="color: #000000;">);
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> throw Error('æ•è·é”™è¯¯')</span>
<span style="color: #000000;">});
p.then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data </span>+ ' suc' + ' 1'<span style="color: #000000;">);
    </span><span style="color: #0000ff;">throw</span> Error('bao cuo'<span style="color: #000000;">)
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err </span>+ ' err' + ' 1'<span style="color: #000000;">)
} ).then( ).then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data </span>+ ' suc' + ' 3'<span style="color: #000000;">)
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err </span>+ ' err' + ' 3'<span style="color: #000000;">)
} );</span></pre>
</div>
<p>ç»“æœï¼š</p>
<p><img src="./images/è‡ªå·±å†™ä¸€ä¸ªPromise4.png" alt="" /></p>
<p>&nbsp;</p>
<p>ğŸ†—&nbsp; ç¬¬ä¸€ä¸ªthené‡ŒæŠ›å‡ºçš„é”™è¯¯è¢«ç¬¬ä¸‰ä¸ªthen æ¥å—åˆ°äº†ï¼Œ æ²¡æ¯›ç—…</p>
<p>æ¥ä¸‹æ¥å¤„ç† è¿”å›å€¼ä¸ºpromiseçš„æƒ…å†µï¼Œ å¹¶æµ‹è¯•</p>
<p>å¦‚æœè¿”å›å€¼ä¸ºpromiseï¼Œåé¢çš„thenå°±å–å†³äºè¿”å›çš„promiseçš„çŠ¶æ€</p>
<div class="cnblogs_code">
<pre><code><span style="color: #008000;">//</span><span style="color: #008000;"> å¤„ç†è¿”å›å€¼çš„å‡½æ•°</span>
<span style="color: #0000ff;">function</span><span style="color: #000000;"> ResolutionRetrunPromise (nextPromise, returnValue, res, rej) {
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> è¿”å›å€¼æ˜¯å¦æ˜¯promise</span>
    <span style="color: #0000ff;">if</span> (returnValue <span style="color: #0000ff;">instanceof</span><span style="color: #000000;">  myPromise) {
        returnValue.then(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (val) {
            res(val)
        },</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> (reason) {
            rej(reason)
        })
    } </span><span style="color: #0000ff;">else</span><span style="color: #000000;"> {
        res(returnValue)
    }
}
myPromise.prototype.then </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (onFulfilled, onRejected) {
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> å‚æ•°ä¸ºç©ºæŠŠå€¼ç›´æ¥ä¼ ç»™ä¸‹ä¸€ä¸ªthen</span>
    <span style="color: #0000ff;">if</span> (!<span style="color: #000000;">onFulfilled) {
        onFulfilled </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (val) {
            </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> val;
        }
    }
    </span><span style="color: #0000ff;">if</span> (!<span style="color: #000000;">onRejected) {
        onRejected </span>= <span style="color: #0000ff;">function</span><span style="color: #000000;"> (reason) {
            </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span><span style="color: #000000;"> Error(reason)
        }
    }
    </span><span style="color: #0000ff;">var</span> _this = <span style="color: #0000ff;">this</span><span style="color: #000000;">;
    </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç”¨äºé“¾å¼è°ƒç”¨</span>
    <span style="color: #0000ff;">var</span> nextPromise = <span style="color: #0000ff;">new</span> myPromise(<span style="color: #0000ff;">function</span><span style="color: #000000;">(res, rej) {
        </span><span style="color: #0000ff;">if</span> (_this.status == 'Fulfilled'<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
            setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    </span><span style="color: #0000ff;">var</span> nextResolveValue =<span style="color: #000000;"> onFulfilled(_this.resolveValue);
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> å¤„ç†è¿”å›å€¼</span>
<span style="color: #000000;">                    ResolutionRetrunPromise(nextPromise, nextResolveValue, res, rej)
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> res(nextResolveValue);</span>
                } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                    rej(e)
                }

            },</span>0<span style="color: #000000;">)
        }
        </span><span style="color: #0000ff;">if</span> (_this.status == 'Rejected'<span style="color: #000000;">) {
            </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
            setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                    </span><span style="color: #0000ff;">var</span> nextRejectValue =<span style="color: #000000;"> onRejected(_this.rejectValue);
                    ResolutionRetrunPromise(nextPromise, nextRejectValue, res, rej)
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> rej(nextRejectValue);</span>
                } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                    rej(e)
                }
            },</span>0<span style="color: #000000;">)
        }
        </span><span style="color: #008000;">//</span><span style="color: #008000;"> ç­‰å¾…çŠ¶æ€æ—¶æŠŠå›è°ƒå­˜èµ·æ¥ï¼ŒçŠ¶æ€æ”¹å˜å†è§¦å‘</span>
        <span style="color: #0000ff;">if</span> (_this.status == 'pending'<span style="color: #000000;">) {
            _this.resolveCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                </span><span style="color: #008000;">//</span><span style="color: #008000;"> å­˜ä¸€ä¸‹å›è°ƒæ‰§è¡Œçš„ç»“æœï¼Œä¼ ç»™ä¸‹ä¸€ä¸ª.then</span>
                setTimeout(<span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                    <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                        </span><span style="color: #0000ff;">var</span> nextResolveValue =<span style="color: #000000;"> onFulfilled(_this.resolveValue);
                        ResolutionRetrunPromise(nextPromise, nextResolveValue, res, rej)
                        </span><span style="color: #008000;">//</span><span style="color: #008000;"> res(nextResolveValue);</span>
                    } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                        rej(e)
                    }
                },</span>0<span style="color: #000000;">)
            });
            _this.rejectCallbackList.push(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                setTimeout(</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> () {
                    </span><span style="color: #008000;">//</span><span style="color: #008000;"> æ•è·é”™è¯¯</span>
                    <span style="color: #0000ff;">try</span><span style="color: #000000;"> {
                        </span><span style="color: #0000ff;">var</span> nextRejectValue =<span style="color: #000000;"> onRejected(_this.rejectValue);
                        ResolutionRetrunPromise(nextPromise, nextRejectValue, res, rej)
                        </span><span style="color: #008000;">//</span><span style="color: #008000;"> rej(nextRejectValue);</span>
                    } <span style="color: #0000ff;">catch</span><span style="color: #000000;"> (e) {
                        rej(e)
                    }
                },</span>0<span style="color: #000000;">)
            });
        }
    });
    </span><span style="color: #0000ff;">return</span><span style="color: #000000;"> nextPromise
};

</span><span style="color: #0000ff;">var</span> p = <span style="color: #0000ff;">new</span> myPromise((resolve, reject) =&gt;<span style="color: #000000;"> {
    setTimeout(() </span>=&gt;<span style="color: #000000;"> {
        resolve(</span>'I am handsome'<span style="color: #000000;">);
    }, </span>1000<span style="color: #000000;">);
});
p.then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data </span>+ ' suc' + ' 1'<span style="color: #000000;">);
    </span><span style="color: #0000ff;">return</span> <span style="color: #0000ff;">new</span> myPromise((resolve, reject) =&gt;<span style="color: #000000;"> {
        reject(</span>'promise'<span style="color: #000000;">)
    })
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err </span>+ ' err' + ' 1'<span style="color: #000000;">)
} ).then((data) </span>=&gt;<span style="color: #000000;"> {
    console.log(data </span>+ ' suc' + ' 3'<span style="color: #000000;">)
}, (err) </span>=&gt;<span style="color: #000000;"> {
    console.log(err </span>+ ' err' + ' 3'<span style="color: #000000;">)
} );</span></pre>
</div>
<p>&nbsp;</p>
<p>&nbsp;ç»“æœï¼š<img src="./images/è‡ªå·±å†™ä¸€ä¸ªPromise5.png" alt="" /></p>
<p>åˆ°æ­¤ Promise çš„ åŸºæœ¬åŠŸèƒ½å°±å®ç°äº†&nbsp; ï¼Œ&nbsp;</p>
<p>æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥åŸºäºæ­¤ è‡ªå·±å®ç°ä¸€ä¸‹Promise çš„&nbsp; &nbsp;é™æ€æ–¹æ³• ã€‚ ã€‚ ã€‚ ã€‚ã€‚ ã€‚&nbsp;</p>
<p>&nbsp;</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>