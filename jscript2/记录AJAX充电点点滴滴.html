<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修记录AJAX充电点点滴滴' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>记录AJAX充电点点滴滴</center></div><div class='banquan'>原文出处:本文由博客园博主军刀、提供。<br/>
原文连接:https://www.cnblogs.com/Army-Knife/p/12035884.html</div><br>
    <h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">首先要明白什么是 AJAX ？</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; font-weight: 400; background-color: #fdfcf8;">AJAX = 异步 JavaScript 和 XML。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; font-weight: 400; background-color: #fdfcf8;">AJAX 是一种用于创建快速动态网页的技术。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; font-weight: 400; background-color: #fdfcf8;">通过在后台与服务器进行少量数据交换，AJAX 可以使网页实现异步更新。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; font-weight: 400; background-color: #fdfcf8;">传统的网页（不使用 AJAX）如果需要更新内容，必需重载整个网页面。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; font-weight: 400; background-color: #fdfcf8;">有很多使用 AJAX 的应用程序案例：新浪微博、Google 地图、开心网等等。</p>
<h2>1、AJAX - 创建 XMLHttpRequest 对象</h2>
<h2>XMLHttpRequest 对象</h2>
<p>&nbsp;所有现代浏览器都支持 XMLHttpRequest 对象 （IE5 和IE6 使用AcActiveXObject）。</p>
<p>XMLHttpRequest 用于在后台与服务器交换数据。这意味着可以在不重新加载整个网页的情况下，对网页的某部分进行更新。</p>
<p>所有现代浏览器（IE7+、Firefox、Chrome、Safari 以及 Opera）均内建 XMLHttpRequest 对象。</p>
<h3>创建 XMLHttpRequest 对象的语法：</h3>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px; font-family: 隶书;">variable = <span style="color: #0000ff;">new</span> XMLHttpRequest();</span></pre>
</div>
<h3>老版本的 Internet Explorer （IE5 和 IE6）使用 ActiveX 对象：</h3>
<div class="cnblogs_code">
<pre><code><span style="font-size: 16px; font-family: 隶书;">variable=<span style="color: #0000ff;">new</span> ActiveXObject( "Microsoft.XMLHTTP" );</span></pre>
</div>
<p>为了应对所有的现代浏览器，包括 IE5 和 IE6，请检查浏览器是否支持 XMLHttpRequest 对象。如果支持，则创建 XMLHttpRequest 对象。如果不支持，则创建 ActiveXObject ：</p>
<h2 id="blogTitle1" class="postTitle js-evernote-checked" data-evernote-id="495">1.1&nbsp; XHR创建对象：</h2>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">var</span><span style="color: #000000;"> xmlhttp;
</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> ( window.XMLHttpRequest )
   {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE7+, Firefox, Chrom, Safari, Opera</span>
    xmlhttp = <span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLHttpRequest();    
}
</span><span style="color: #0000ff;">else</span><span style="color: #000000;">
   {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE5, IE6</span>
   xmlhttp = <span style="color: #0000ff;">new</span> ActiveXObject( "Microsoft.XMLHTTP"<span style="color: #000000;"> );
}</span></pre>
</div>
<h2>1.2、AJAX - 向服务器发送请求</h2>
<p><strong style="margin: 0px; padding: 0px; border: 0px; color: #3f3f3f; font-family: 微软雅黑; font-size: 16px; background-color: #fdfcf8;">XMLHttpRequest 对象用于和服务器交换数据。</strong></p>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">向服务器发送请求</h2>
<p>&nbsp;</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">如需将请求发送到服务器，我们使用 XMLHttpRequest 对象的 open() 和 send() 方法：</p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 15px;">xmlhttp.open("GET","test1.txt",</span><span style="color: #0000ff;">true</span><span style="color: #000000;"><span style="font-size: 15px;">);  <span style="color: #339966;">//规定请求的类型、URL 以及是否异步处理请求。</span>
xmlhttp.send();  </span></span><span style="font-size: 15px; color: #339966;">//将请求发送到服务器。</span></pre>
</div>
<table class="dataintable" style="margin-top: 15px; margin-right: 0px; margin-left: 0px; padding: 0px; border-color: #aaaaaa; width: 809px; color: #000000; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; background-color: #fdfcf8;">
<tbody style="margin: 0px; padding: 0px; border: 0px;">
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #f5f5f5;"><th style="margin: 0px; padding: 10px; border-color: #3f3f3f; vertical-align: baseline; background-color: #3f3f3f; text-align: left; color: #ffffff; width: 302px;">方法</th><th style="margin: 0px; padding: 10px; border-color: #3f3f3f; vertical-align: baseline; background-color: #3f3f3f; text-align: left; color: #ffffff;">描述</th></tr>
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #ffffff;">
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">open(<em style="margin: 0px; padding: 0px; border: 0px;">method</em>,<em style="margin: 0px; padding: 0px; border: 0px;">url</em>,<em style="margin: 0px; padding: 0px; border: 0px;">async</em>)</td>
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">
<p style="margin: 0px; padding: 0px; border: 0px; line-height: 21px;">规定请求的类型、URL 以及是否异步处理请求。</p>
<ul class="listintable" style="margin: 20px; padding: 0px; border: 0px; line-height: 21px; list-style-type: none;">
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;"><em style="margin: 0px; padding: 0px; border: 0px;">method</em>：请求的类型；GET 或 POST</li>
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;"><em style="margin: 0px; padding: 0px; border: 0px;">url</em>：文件在服务器上的位置</li>
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;"><em style="margin: 0px; padding: 0px; border: 0px;">async</em>：true（异步）或 false（同步）</li>
</ul>
</td>
</tr>
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #f5f5f5;">
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">send(<em style="margin: 0px; padding: 0px; border: 0px;">string</em>)</td>
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">
<p style="margin: 0px; padding: 0px; border: 0px; line-height: 21px;">将请求发送到服务器。</p>
<ul class="listintable" style="margin: 20px; padding: 0px; border: 0px; line-height: 21px; list-style-type: none;">
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;"><em style="margin: 0px; padding: 0px; border: 0px;">string</em>：仅用于 POST 请求</li>
</ul>
</td>
</tr>
</tbody>
</table>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">&nbsp;</h2>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">GET 还是 POST？</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">与 POST 相比，GET 更简单也更快，并且在大部分情况下都能用。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">然而，在以下情况中，请使用 POST 请求：</p>
<ul style="margin: 15px 0px 20px 35px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">
<li style="margin-top: 3px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px;">无法使用缓存文件（更新服务器上的文件或数据库）</li>
<li style="margin-top: 3px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px;">向服务器发送大量数据（POST 没有数据量限制）</li>
<li style="margin-top: 3px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px;">发送包含未知字符的用户输入时，POST 比 GET 更稳定也更可靠</li>
</ul>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">GET 请求</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">一个简单的 GET 请求：</p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 15px;">xmlhttp.open("GET","demo_get.asp",<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();<br /></span></span></pre>
</div>
<p>在上面的例子中，您可能得到的是缓存的结果。</p>
<p><span style="color: #eebe24;">------解决方案--------------------</span></p>
<p>ajax请求 如果两次请求地址一样 服务器只会处理第一次请求<br />第二次请求返回内容和第一次一样&nbsp;&nbsp;<br />加 Math.random() 使每次请求地址不相同 服务器每次都去做不同的响应&nbsp;<br /><span style="color: #e78608;">------解决方案--------------------</span><br />Math.random()是调用javascript语法中的数学函数，能够产生随机数。<br />在Ajax请求中作为URL参数传递，能够有效的避免&ldquo;ajax缓存&rdquo;<br />在IE 6系列的浏览器中，默认提交给一个地址例如：aa.aspx ,将自动缓存，第二次再请求aa.aspx时候，就不会再重复请求了。当然，也可以使用new date () 时间戳的形式作为参数传递。</p>
<p>为了避免这种情况，请向 URL 添加一个唯一的 ID：</p>
<div class="cnblogs_code">
<pre><code>xmlhttp.open("GET","demo_get.asp?t=" + <span style="color: #e4321a;">Math.random()</span>,<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();</span></pre>
</div>
<p>如果您希望通过 GET 方法发送信息，请向 URL 添加信息：</p>
<div class="cnblogs_code">
<pre><code>xmlhttp.open("GET","demo_get2.asp?fname=Bill&amp;lname=Gates",<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();</span></pre>
</div>
<p>&nbsp;</p>
<h2>POST 请求</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">一个简单 POST 请求：</p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 15px;">xmlhttp.open("POST","demo_post.asp",<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();</span></span></pre>
</div>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">如果需要像 HTML 表单那样 POST 数据，请使用 setRequestHeader() 来添加 HTTP 头。然后在 send() 方法中规定您希望发送的数据：</p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 15px;">xmlhttp.open("POST","ajax_test.asp",<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.setRequestHeader(</span>"Content-type","application/x-www-form-urlencoded");  <span style="color: #008000;">//</span><span style="color: #008000;">向请求中添加 TTTP 头;</span>
xmlhttp.send("fname=Bill&amp;lname=Gates");</span></pre>
</div>
<table class="dataintable" style="margin-top: 15px; margin-right: 0px; margin-left: 0px; padding: 0px; border-color: #aaaaaa; width: 809px; color: #000000; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; background-color: #fdfcf8;">
<tbody style="margin: 0px; padding: 0px; border: 0px;">
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #f5f5f5;"><th style="margin: 0px; padding: 10px; border-color: #3f3f3f; vertical-align: baseline; background-color: #3f3f3f; text-align: left; color: #ffffff; width: 302px;">方法</th><th style="margin: 0px; padding: 10px; border-color: #3f3f3f; vertical-align: baseline; background-color: #3f3f3f; text-align: left; color: #ffffff;">描述</th></tr>
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #ffffff;">
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">setRequestHeader(<em style="margin: 0px; padding: 0px; border: 0px;">header</em>,<em style="margin: 0px; padding: 0px; border: 0px;">value</em>)</td>
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">
<p style="margin: 0px; padding: 0px; border: 0px; line-height: 21px;">向请求添加 HTTP 头。</p>
<ul class="listintable" style="margin: 20px; padding: 0px; border: 0px; line-height: 21px; list-style-type: none;">
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;"><em style="margin: 0px; padding: 0px; border: 0px;">header</em>: 规定头的名称</li>
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;"><em style="margin: 0px; padding: 0px; border: 0px;">value</em>: 规定头的值</li>
</ul>
</td>
</tr>
</tbody>
</table>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">&nbsp;</h2>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">url - 服务器上的文件</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">open() 方法的&nbsp;<em style="margin: 0px; padding: 0px; border: 0px;">url</em>&nbsp;参数是服务器上文件的地址：</p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 15px;">xmlhttp.open("GET","ajax_test.asp",<span style="color: #0000ff;">true</span>);</span></pre>
</div>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">该文件可以是任何类型的文件，比如 .txt 和 .xml，或者服务器脚本文件，比如 .asp 和 .php （在传回响应之前，能够在服务器上执行任务）。</p>
<p>&nbsp;</p>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">异步 - True 或 False？</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">AJAX 指的是异步 JavaScript 和 XML（Asynchronous JavaScript and XML）。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">XMLHttpRequest 对象如果要用于 AJAX 的话，其 open() 方法的 async 参数必须设置为 true：</p>
<div class="cnblogs_code">
<pre><code>xmlhttp.open("GET","ajax_test.asp",<span style="color: #0000ff;">true</span>);</pre>
</div>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">对于 web 开发人员来说，发送异步请求是一个巨大的进步。很多在服务器执行的任务都相当费时。AJAX 出现之前，这可能会引起应用程序挂起或停止。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">通过 AJAX，JavaScript 无需等待服务器的响应，而是：</p>
<ul style="margin: 15px 0px 20px 35px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">
<li style="margin-top: 3px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px;">在等待服务器响应时执行其他脚本</li>
<li style="margin-top: 3px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px;">当响应就绪后对响应进行处理</li>
</ul>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">Async = true</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">当使用 async=true 时，请规定在响应处于 onreadystatechange 事件中的就绪状态时执行的函数：</p>
<div class="cnblogs_code">
<pre><code><span style="font-size: 15px;">xmlhttp.onreadystatechange=<span style="color: #0000ff;">function</span><span style="color: #000000;">()
  {
  </span><span style="color: #0000ff;">if</span> (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200)   <span style="color: #008000;">//</span><span style="color: #008000;"> 请求完成并成功返回</span>
<span style="color: #000000;">    {
    document.getElementById(</span>"myDiv").innerHTML=<span style="color: #000000;">xmlhttp.responseText;
    }
  }
xmlhttp.open(</span>"GET","test1.txt",<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();</span></span></pre>
</div>
<p>&nbsp;</p>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">Async = false</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">如需使用 async=false，请将 open() 方法中的第三个参数改为 false：</p>
<div class="cnblogs_code">
<pre><code>xmlhttp.open("GET","test1.txt",<span style="color: #0000ff;">false</span>);</pre>
</div>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">我们不推荐使用 async=false，但是对于一些小型的请求，也是可以的。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">请记住，JavaScript 会等到服务器响应就绪才继续执行。如果服务器繁忙或缓慢，应用程序会挂起或停止。</p>
<p class="note" style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;"><span style="margin: 0px; padding: 0px; border: 0px; font-weight: bold;">注释：</span>当您使用 async=false 时，请不要编写 onreadystatechange 函数 - 把代码放到 send() 语句后面即可：</p>
<div class="cnblogs_code">
<pre><code>xmlhttp.open("GET","test1.txt",<span style="color: #0000ff;">false</span><span style="color: #000000;">);
xmlhttp.send();
document.getElementById(</span>"myDiv").innerHTML=xmlhttp.responseText;</pre>
</div>
<p>&nbsp;</p>
<h2>1.3 AJAX - 服务器响应</h2>
<p><span style="font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">如需获得来自服务器的响应，请使用 XMLHttpRequest 对象的 responseText 或 responseXML 属性。</span></p>
<table class="dataintable" style="margin-top: 15px; margin-right: 0px; margin-left: 0px; padding: 0px; border-color: #aaaaaa; width: 809px; color: #000000; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; background-color: #fdfcf8;">
<tbody style="margin: 0px; padding: 0px; border: 0px;">
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #f5f5f5;"><th style="margin: 0px; padding: 10px; border-color: #3f3f3f; vertical-align: baseline; background-color: #3f3f3f; text-align: left; color: #ffffff; width: 181px;">属性</th><th style="margin: 0px; padding: 10px; border-color: #3f3f3f; vertical-align: baseline; background-color: #3f3f3f; text-align: left; color: #ffffff;">描述</th></tr>
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #ffffff;">
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">responseText</td>
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">获得字符串形式的响应数据。</td>
</tr>
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #f5f5f5;">
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">responseXML</td>
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">获得 XML 形式的响应数据。</td>
</tr>
</tbody>
</table>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">responseText 属性</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">如果来自服务器的响应并非 XML，请使用 responseText 属性。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">responseText 属性返回字符串形式的响应，因此您可以这样使用：</p>
<div class="cnblogs_code">
<pre><code>document.getElementById("myDiv").innerHTML=xmlhttp.responseText;</pre>
</div>
<p><strong>例：</strong></p>
<div class="cnblogs_code">
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
<span style="color: #0000ff;">function</span><span style="color: #000000;"> loadXMLDoc()
{
</span><span style="color: #0000ff;">var</span><span style="color: #000000;"> xmlhttp;
</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (window.XMLHttpRequest)
  {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE7+, Firefox, Chrome, Opera, Safari</span>
  xmlhttp=<span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLHttpRequest();
  }
</span><span style="color: #0000ff;">else</span><span style="color: #000000;">
  {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE6, IE5</span>
  xmlhttp=<span style="color: #0000ff;">new</span> ActiveXObject("Microsoft.XMLHTTP"<span style="color: #000000;">);
  }
xmlhttp.onreadystatechange</span>=<span style="color: #0000ff;">function</span><span style="color: #000000;">()
  {
  </span><span style="color: #0000ff;">if</span> (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200<span style="color: #000000;">)
    {
    <span style="color: #fc615e;">document.getElementById(</span></span><span style="color: #fc615e;">"myDiv").innerHTML=</span><span style="color: #000000;"><span style="color: #fc615e;">xmlhttp.responseText;</span>
    }
  }
xmlhttp.open(</span>"GET","/ajax/test1.txt",<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();
}
</span>&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div id="myDiv"&gt;&lt;h2&gt;Let AJAX change <span style="color: #0000ff;">this</span> text&lt;/h2&gt;&lt;/div&gt;
&lt;button type="button" onclick="loadXMLDoc()"&gt;通过 AJAX 改变内容&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">responseXML 属性</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">如果来自服务器的响应是 XML，而且需要作为 XML 对象进行解析，请使用 responseXML 属性：</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">请求&nbsp;<a style="margin: 0px; padding: 0px; border-width: 0px 0px 1px; border-top-style: initial; border-right-style: initial; border-bottom-style: solid; border-left-style: initial; border-top-color: initial; border-right-color: initial; border-bottom-color: #900b09; border-left-color: initial; border-image: initial; text-decoration-line: none; color: #900b09; background: transparent;" href="https://www.w3school.com.cn/example/xmle/books.xml">books.xml</a>&nbsp;文件，并解析响应：</p>
<div class="cnblogs_code">
<pre><code>xmlDoc=<span style="color: #000000;">xmlhttp.responseXML;
txt</span>=""<span style="color: #000000;">;
x</span>=xmlDoc.getElementsByTagName("ARTIST"<span style="color: #000000;">);
</span><span style="color: #0000ff;">for</span> (i=0;i&lt;x.length;i++<span style="color: #000000;">)
  {
  txt</span>=txt + x[i].childNodes[0].nodeValue + "&lt;br /&gt;"<span style="color: #000000;">;
  }
document.getElementById(</span>"myDiv").innerHTML=txt;</pre>
</div>
<p><strong>例：</strong></p>
<div class="cnblogs_code">
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
<span style="color: #0000ff;">function</span><span style="color: #000000;"> loadXMLDoc()
{
</span><span style="color: #0000ff;">var</span><span style="color: #000000;"> xmlhttp;
</span><span style="color: #0000ff;">var</span><span style="color: #000000;"> txt,x,i;
</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (window.XMLHttpRequest)
  {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE7+, Firefox, Chrome, Opera, Safari</span>
  xmlhttp=<span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLHttpRequest();
  }
</span><span style="color: #0000ff;">else</span><span style="color: #000000;">
  {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE6, IE5</span>
  xmlhttp=<span style="color: #0000ff;">new</span> ActiveXObject("Microsoft.XMLHTTP"<span style="color: #000000;">);
  }
xmlhttp.onreadystatechange</span>=<span style="color: #0000ff;">function</span><span style="color: #000000;">()
  {
  </span><span style="color: #0000ff;">if</span> (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200<span style="color: #000000;">)
    {
    <span style="color: #fc615e;">xmlDoc</span></span><span style="color: #fc615e;">=xmlhttp.responseXML;
    txt="";
    x=xmlDoc.getElementsByTagName("title");
    for (i=0;i&lt;x.length;i++)
      {
      txt=txt + x[i].childNodes[0].nodeValue + "&lt;br /&gt;";
      }
    document.getElementById("myDiv").innerHTML=</span><span style="color: #000000;"><span style="color: #fc615e;">txt;</span>
    }
  }
xmlhttp.open(</span>"GET","/example/xmle/books.xml",<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();
}
</span>&lt;/script&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;h2&gt;My Book Collection:&lt;/h2&gt;
&lt;div id="myDiv"&gt;&lt;/div&gt;
&lt;button type="button" onclick="loadXMLDoc()"&gt;获得我的图书收藏列表&lt;/button&gt;
 
&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>&nbsp;</p>
<h2>1.4&nbsp; AJAX -&nbsp;onreadystatechange 事件</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">当请求被发送到服务器时，我们需要执行一些基于响应的任务。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">每当 readyState 改变时，就会触发 onreadystatechange 事件。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">readyState 属性存有 XMLHttpRequest 的状态信息。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">下面是 XMLHttpRequest 对象的三个重要的属性：</p>
<table class="dataintable" style="margin-top: 15px; margin-right: 0px; margin-left: 0px; padding: 0px; border-color: #aaaaaa; width: 809px; color: #000000; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; font-size: 14px; background-color: #fdfcf8;">
<tbody style="margin: 0px; padding: 0px; border: 0px;">
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #f5f5f5;"><th style="margin: 0px; padding: 10px; border-color: #3f3f3f; vertical-align: baseline; background-color: #3f3f3f; text-align: left; color: #ffffff; width: 181px;">属性</th><th style="margin: 0px; padding: 10px; border-color: #3f3f3f; vertical-align: baseline; background-color: #3f3f3f; text-align: left; color: #ffffff;">描述</th></tr>
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #ffffff;">
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">onreadystatechange</td>
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">存储函数（或函数名），每当 readyState 属性改变时，就会调用该函数。</td>
</tr>
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #f5f5f5;">
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">readyState</td>
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">
<p style="margin: 0px; padding: 0px; border: 0px; line-height: 21px;">存有 XMLHttpRequest 的状态。从 0 到 4 发生变化。</p>
<ul class="listintable" style="margin: 20px; padding: 0px; border: 0px; line-height: 21px; list-style-type: none;">
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;">0: 请求未初始化</li>
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;">1: 服务器连接已建立</li>
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;">2: 请求已接收</li>
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;">3: 请求处理中</li>
<li style="margin-top: 0px; margin-right: 0px; margin-bottom: 0px; padding-top: 0px; padding-right: 0px; padding-bottom: 0px; border: 0px; list-style-type: disc;">4: 请求已完成，且响应已就绪</li>
</ul>
</td>
</tr>
<tr style="margin: 0px; padding: 0px; border: 0px; background-color: #ffffff;">
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">status</td>
<td style="margin: 0px; padding: 9px; border-color: #aaaaaa; vertical-align: text-top;">
<p style="margin: 0px; padding: 0px; border: 0px; line-height: 21px;">200: "OK"</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px;">404: 未找到页面</p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">在 onreadystatechange 事件中，我们规定当服务器响应已做好被处理的准备时所执行的任务。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">当 readyState 等于 4 且状态为 200 时，表示响应已就绪：</p>
<div class="cnblogs_code">
<pre><code>xmlhttp.onreadystatechange=<span style="color: #0000ff;">function</span><span style="color: #000000;">()
  {
  </span><span style="color: #0000ff;">if</span> (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200<span style="color: #000000;">)
    {
    document.getElementById(</span>"myDiv").innerHTML=<span style="color: #000000;">xmlhttp.responseText;
    }
  }</span></pre>
</div>
<p><strong>例：</strong></p>
<div class="cnblogs_code">
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
<span style="color: #0000ff;">function</span><span style="color: #000000;"> loadXMLDoc()
{
</span><span style="color: #0000ff;">var</span><span style="color: #000000;"> xmlhttp;
</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (window.XMLHttpRequest)
  {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE7+, Firefox, Chrome, Opera, Safari</span>
  xmlhttp=<span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLHttpRequest();
  }
</span><span style="color: #0000ff;">else</span><span style="color: #000000;">
  {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE6, IE5</span>
  xmlhttp=<span style="color: #0000ff;">new</span> ActiveXObject("Microsoft.XMLHTTP"<span style="color: #000000;">);
  }
xmlhttp.onreadystatechange</span>=<span style="color: #0000ff;">function</span><span style="color: #000000;">()
  {
  </span><span style="color: #0000ff;">if</span> (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200<span style="color: #000000;">)
    {
    document.getElementById(</span>"myDiv").innerHTML=<span style="color: #000000;">xmlhttp.responseText;
    }
  }
xmlhttp.open(</span>"GET","/ajax/test1.txt",<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();
}
</span>&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div id="myDiv"&gt;&lt;h2&gt;Let AJAX change <span style="color: #0000ff;">this</span> text&lt;/h2&gt;&lt;/div&gt;
&lt;button type="button" onclick="loadXMLDoc()"&gt;通过 AJAX 改变内容&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p><span style="margin: 0px; padding: 0px; border: 0px; font-weight: bold; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">注释：</span><span style="font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">onreadystatechange 事件被触发 5 次（0 - 4），对应着 readyState 的每个变化。</span></p>
<h2 style="margin: 0px; padding: 0px; border: 0px; font-size: 18px; color: #3f3f3f; font-family: 微软雅黑; background-color: #fdfcf8;">使用 Callback 函数</h2>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">callback 函数是一种以参数形式传递给另一个函数的函数。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">如果您的网站上存在多个 AJAX 任务，那么您应该为创建 XMLHttpRequest 对象编写一个<span style="margin: 0px; padding: 0px; border: 0px; font-weight: bold;">标准</span>的函数，并为每个 AJAX 任务调用该函数。</p>
<p style="margin: 15px 0px 0px; padding: 0px; border: 0px; line-height: 21px; font-family: PingFangSC-Regular, Verdana, Arial, 微软雅黑, 宋体; background-color: #fdfcf8;">该函数调用应该包含 URL 以及发生 onreadystatechange 事件时执行的任务（每次调用可能不尽相同）：</p>
<div class="cnblogs_code">
<pre><code><span style="color: #0000ff;">function</span><span style="color: #000000;"> myFunction()
{
loadXMLDoc(</span>"ajax_info.txt",<span style="color: #0000ff;">function</span><span style="color: #000000;">()
  {
  </span><span style="color: #0000ff;">if</span> (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200<span style="color: #000000;">)
    {
    document.getElementById(</span>"myDiv").innerHTML=<span style="color: #000000;">xmlhttp.responseText;
    }
  });
}</span></pre>
</div>
<p><strong>例：</strong></p>
<div class="cnblogs_code">
<pre><code>&lt;html&gt;
&lt;head&gt;
&lt;script type="text/javascript"&gt;
<span style="color: #0000ff;">var</span><span style="color: #000000;"> xmlhttp;
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> loadXMLDoc(<span style="color: #e24c1d;">url,cfunc</span>)
{
</span><span style="color: #0000ff;">if</span><span style="color: #000000;"> (window.XMLHttpRequest)
  {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE7+, Firefox, Chrome, Opera, Safari</span>
  xmlhttp=<span style="color: #0000ff;">new</span><span style="color: #000000;"> XMLHttpRequest();
  }
</span><span style="color: #0000ff;">else</span><span style="color: #000000;">
  {</span><span style="color: #008000;">//</span><span style="color: #008000;"> code for IE6, IE5</span>
  xmlhttp=<span style="color: #0000ff;">new</span> ActiveXObject("Microsoft.XMLHTTP"<span style="color: #000000;">);
  }
<span style="color: #e24c1d;">xmlhttp.onreadystatechange</span></span><span style="color: #e24c1d;">=</span><span style="color: #000000;"><span style="color: #e24c1d;">cfunc;</span>
xmlhttp.open(</span>"GET",url,<span style="color: #0000ff;">true</span><span style="color: #000000;">);
xmlhttp.send();
}
</span><span style="color: #0000ff;">function</span><span style="color: #000000;"> myFunction()
{
loadXMLDoc(</span>"/ajax/test1.txt",<span style="color: #0000ff;">function</span><span style="color: #000000;">()
  {
  </span><span style="color: #0000ff;">if</span> (xmlhttp.readyState==4 &amp;&amp; xmlhttp.status==200<span style="color: #000000;">)
    {
    document.getElementById(</span>"myDiv").innerHTML=<span style="color: #000000;">xmlhttp.responseText;
    }
  });
}
</span>&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;div id="myDiv"&gt;&lt;h2&gt;Let AJAX change <span style="color: #0000ff;">this</span> text&lt;/h2&gt;&lt;/div&gt;
&lt;button type="button" onclick="myFunction()"&gt;通过 AJAX 改变内容&lt;/button&gt;

&lt;/body&gt;
&lt;/html&gt;</pre>
</div>
<p>&nbsp;</p>
<pre><code><span style="margin: 0px; padding: 0px; border: 0px; color: #999999;">// code for IE7+, Firefox, Chrome, Opera, Safari</span></pre>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>