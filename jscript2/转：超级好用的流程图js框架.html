<html><head><meta charset='utf-8'><meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='applicable-device' content='pc'><meta name='keywords' content='电脑,电脑讲解,电脑技术,编程,电脑故障维修转：超级好用的流程图js框架' />
<script src='../../highlight/highlight.pack.js'></script>
<link rel='stylesheet' type='text/css' href='../../highlight/styles/monokai.css'/>

<link rel='stylesheet' href='../../fenxiang/dist/css/share.min.css'>
<script src='../../fenxiang/src/js/social-share.js'></script>
<script src='../../fenxiang/src/js/qrcode.js'></script>

</head><body><script>hljs.initHighlightingOnLoad();</script><script>
var system ={};  
var p = navigator.platform;       
system.win = p.indexOf('Win') == 0;  
system.mac = p.indexOf('Mac') == 0;  
system.x11 = (p == 'X11') || (p.indexOf('Linux') == 0);     
if(system.win||system.mac||system.xll){
document.write("<link href='../css/3.css' rel='stylesheet' type='text/css'>");}else{ document.write("<link href='../css/3wap.css' rel='stylesheet' type='text/css'>");}</script><script src='../../js/3.js'></script><div class='div2'><div class='heading_nav'><ul><div><li><a href='../../index.html'>首页</a></li>
</div><div onclick='hidden1()' >分享</div>
</ul></div></div>
<div id='heading_nav2'> 
<li class='row' >
<div class='social-share' data-mode='prepend'><a href='javascript:' class='social-share-icon icon-heart'></a></div></li></div><script charset='utf-8' src='../../3/js/hengfu.js'></script><script charset='utf-8' src='../../3/js/hengfu2.js'></script><hr><div class='div1'><div class='biaoti'><center>转：超级好用的流程图js框架</center></div><div class='banquan'>原文出处:本文由博客园博主cnplayboy提供。<br/>
原文连接:https://www.cnblogs.com/dragon2017/p/10716587.html</div><br>
    <p>支叫<a href="http://zh.wikipedia.org/zh/%E5%9B%BE%E8%AE%BA" rel="nofollow" target="_blank">图论</a>（Graph Theroy）。利用图我们可以做很多工具，比如思维导图，流程图，状态机，组织架构图，等等。今天我要做的是用开源的HTML5工具来快速构造一个做图的工具。</p>
<h3><a name="t0"></a>工具选择</h3>
<p>预先善其事，必先利其器。第一件事是选择一件合适的工具，开源时代，程序员还是很幸福的，选择很多。</p>
<ul class="list-paddingleft-2">
<li>
<p>flowchart.js &nbsp;<a href="http://adrai.github.io/flowchart.js/," rel="nofollow" target="_blank">http://adrai.github.io/flowchart.js/</a>&nbsp;, 基于SVG创建Flow Chart</p>
</li>
<li>
<p>go.js&nbsp;<a href="http://www.gojs.net/latest/index.html" rel="nofollow" target="_blank">http://www.gojs.net/latest/index.html</a>&nbsp; go.js 提供一整套的JS工具&nbsp;，支持各种交互式图表的创建。有免费版和收费版</p>
</li>
<li>
<p>joint.js&nbsp;<a href="http://www.jointjs.com/" rel="nofollow" target="_blank">http://www.jointjs.com/</a>&nbsp;joint.js 是另一个创建图标库的工具，也提供免费版和商业版</p>
</li>
<li>
<p>jsPlumb&nbsp;<a href="http://www.jsplumb.org/" rel="nofollow" target="_blank">http://www.jsplumb.org/</a>&nbsp; jsPlumb是一套开源的流程图创建工具&nbsp;，小巧精悍，使用简单</p>
</li>
<li>
<p>d3&nbsp;<a href="http://d3js.org/" rel="nofollow" target="_blank">http://d3js.org</a>&nbsp;在html5领域，d3可谓是最好的可视化基础库，提供方面的DOM操作，非常强大。</p>
</li>
</ul>
<p>最终，我选择了jsPlumb，因为它完全开源，使用很简单，用D3的话可能会多花很多功夫。joint.js也不错。大家可以根据自己的需要选择。</p>
<h3><a name="t1"></a>构建静态应用</h3>
<p>下面我们一步一步的来使用jsPlumb来创建我们的流程图工具。</p>
<p>第一步是等待DOM和jsPlumb初始化完毕，类似document.ready()和jquery.ready(), 要使用jsPlumb, 需要把代码放在这个函数里：</p>
<div>
<div id="highlighter_6428" class="syntaxhighlighter  js">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code>jsPlumb.ready(</code><code class="js keyword">function</code><code>() {</code></div>
<div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">// ... your code goes here ...</code></div>
<div class="line number3 index2 alt2"><code>}</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>创建一个jsPlumb的实例，并初始化jsPlumb的配置参数：</p>
<div>
<div id="highlighter_501222" class="syntaxhighlighter  js">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="js comments">//Initialize JsPlumb</code></div>
<div class="line number2 index1 alt1"><code class="js keyword">var</code>&nbsp;<code>color = </code><code class="js string">"#E8C870"</code><code>;</code></div>
<div class="line number3 index2 alt2"><code class="js keyword">var</code>&nbsp;<code>instance = jsPlumb.getInstance({</code></div>
<div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">// notice the 'curviness' argument to this Bezier curve.&nbsp; the curves on this page are far smoother</code></div>
<div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js comments">// than the curves on the first demo, which use the default curviness value.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </code></div>
<div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Connector : [ </code><code class="js string">"Bezier"</code><code>, { curviness:50 } ],</code></div>
<div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>DragOptions : { cursor: </code><code class="js string">"pointer"</code><code>, zIndex:2000 },</code></div>
<div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>PaintStyle : { strokeStyle:color, lineWidth:2 },</code></div>
<div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>EndpointStyle : { radius:5, fillStyle:color },</code></div>
<div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>HoverPaintStyle : {strokeStyle:</code><code class="js string">"#7073EB"</code>&nbsp;<code>},</code></div>
<div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>EndpointHoverStyle : {fillStyle:</code><code class="js string">"#7073EB"</code>&nbsp;<code>},</code></div>
<div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>Container:</code><code class="js string">"container-id"</code></div>
<div class="line number13 index12 alt2"><code class="js spaces">&nbsp;</code><code>});</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>这里给给出了一些配置包括，连接线（这里配置了一个贝塞尔曲线），线的风格，连接点得风格。Container需要配置一个对应的DIV容器的id。（这里也可以使用setContainer的方法）</p>
<p>下面我们要创建一个节点（node），每一个节点可以用一个DIV来实现。我这里提供了一个函数来创建节点。</p>
<div>
<div id="highlighter_807709" class="syntaxhighlighter  js ">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="js keyword">function</code>&nbsp;<code>addNode(parentId, nodeId, nodeLable, position) {</code></div>
<div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>panel = d3.select(</code><code class="js string">"#"</code>&nbsp;<code>+ parentId);</code></div>
<div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code>panel.append(</code><code class="js string">'div'</code><code>).style(</code><code class="js string">'width'</code><code>,</code><code class="js string">'120px'</code><code>).style(</code><code class="js string">'height'</code><code>,</code><code class="js string">'50px'</code><code>)</code></div>
<div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.style(</code><code class="js string">'position'</code><code>,</code><code class="js string">'absolute'</code><code>)</code></div>
<div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.style(</code><code class="js string">'top'</code><code>,position.y).style(</code><code class="js string">'left'</code><code>,position.x)</code></div>
<div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.style(</code><code class="js string">'border'</code><code>,</code><code class="js string">'2px #9DFFCA solid'</code><code>).attr(</code><code class="js string">'align'</code><code>,</code><code class="js string">'center'</code><code>)</code></div>
<div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.attr(</code><code class="js string">'id'</code><code>,nodeId).classed(</code><code class="js string">'node'</code><code>,</code><code class="js keyword">true</code><code>)</code></div>
<div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>.text(nodeLable);</code></div>
<div class="line number9 index8 alt2">&nbsp;</div>
<div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">return</code>&nbsp;<code>jsPlumb.getSelector(</code><code class="js string">'#'</code>&nbsp;<code>+ nodeId)[0];</code></div>
<div class="line number11 index10 alt2"><code>}</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>这里做的事情就是创建了一个DIV元素，并放在对应的容器的制定位置上，注意为了支持拖拽的功能，必须使用position:absolute 。</p>
<p>我使用D3来操作DOM，大家可能会更习惯JQuery，这纯属个人喜好的问题。</p>
<p>最后返回创建节点的实例引用，这是的selector使用了jsPlumb.getSelector()方法，它和JQuery的selector是一样的，这样用的好处是你可以使用不同的DOM操作库，例如Vanilla</p>
<p>下面我使用一个函数来创建端点/锚点（anchor），锚点就是节点上的连接点，用于连接不同的节点。</p>
<div>
<div id="highlighter_122732" class="syntaxhighlighter  js   ">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
<div class="line number27 index26 alt2">27</div>
<div class="line number28 index27 alt1">28</div>
<div class="line number29 index28 alt2">29</div>
<div class="line number30 index29 alt1">30</div>
<div class="line number31 index30 alt2">31</div>
<div class="line number32 index31 alt1">32</div>
<div class="line number33 index32 alt2">33</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="js keyword">function</code>&nbsp;<code>addPorts(instance, node, ports, type) {</code></div>
<div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//Assume horizental layout</code></div>
<div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>number_of_ports = ports.length;</code></div>
<div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>i = 0;</code></div>
<div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>height = $(node).height();&nbsp; </code><code class="js comments">//Note, jquery does not include border for height</code></div>
<div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>y_offset = 1 / ( number_of_ports + 1);</code></div>
<div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>y = 0;</code></div>
<div class="line number8 index7 alt1">&nbsp;</div>
<div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">for</code>&nbsp;<code>( ; i &lt; number_of_ports; i++ ) {</code></div>
<div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>anchor = [0,0,0,0];</code></div>
<div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>paintStyle = { radius:5, fillStyle:</code><code class="js string">'#FF8891'</code>&nbsp;<code>};</code></div>
<div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>isSource = </code><code class="js keyword">false</code><code>, isTarget = </code><code class="js keyword">false</code><code>;</code></div>
<div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">if</code>&nbsp;<code>( type === </code><code class="js string">'output'</code>&nbsp;<code>) {</code></div>
<div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>anchor[0] = 1;</code></div>
<div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>paintStyle.fillStyle = </code><code class="js string">'#D4FFD6'</code><code>;</code></div>
<div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>isSource = </code><code class="js keyword">true</code><code>;</code></div>
<div class="line number17 index16 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>} </code><code class="js keyword">else</code>&nbsp;<code>{</code></div>
<div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>isTarget =</code><code class="js keyword">true</code><code>;</code></div>
<div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></div>
<div class="line number20 index19 alt1">&nbsp;</div>
<div class="line number21 index20 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>anchor[1] = y + y_offset;</code></div>
<div class="line number22 index21 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>y = anchor[1];</code></div>
<div class="line number23 index22 alt2">&nbsp;</div>
<div class="line number24 index23 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>instance.addEndpoint(node, {</code></div>
<div class="line number25 index24 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>uuid:node.getAttribute(</code><code class="js string">"id"</code><code>) + </code><code class="js string">"-"</code>&nbsp;<code>+ ports[i],</code></div>
<div class="line number26 index25 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>paintStyle: paintStyle,</code></div>
<div class="line number27 index26 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>anchor:anchor,</code></div>
<div class="line number28 index27 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>maxConnections:-1,</code></div>
<div class="line number29 index28 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>isSource:isSource,</code></div>
<div class="line number30 index29 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>isTarget:isTarget</code></div>
<div class="line number31 index30 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>});</code></div>
<div class="line number32 index31 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>}</code></div>
<div class="line number33 index32 alt2"><code>}</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>instance是jsPlumb的实例</p>
<p>node是我们用addNode方法创建的Node实例</p>
<p>ports，是一个string的数组，指定端点的个数和名字</p>
<p>type，可能是output或者input，指定端点的种类，一个节点的输出端口可以连接另一个节点的输入端口。</p>
<p>这里anchor是一个四维数组，0维和1维分别是锚点在节点x轴和y轴的偏移百分比。我这里希望把端口画在节点的左右两侧，并按照端口的数量均匀分布。</p>
<p>最后使用instance.addEndpoint来创建端点。注意这里只要指定isSource和isTarget就可以用drag&amp;drop的方式来连接端点，非常方便。</p>
<p>下面一步我们提供一个函数来连接端点：</p>
<div>
<div id="highlighter_805451" class="syntaxhighlighter  js">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="js keyword">function</code>&nbsp;<code>connectPorts(instance, node1, port1, node2 , port2) {</code></div>
<div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">// declare some common values:</code></div>
<div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>color = </code><code class="js string">"gray"</code><code>;</code></div>
<div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>arrowCommon = { foldback:0.8, fillStyle:color, width:5 },</code></div>
<div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">// use three-arg spec to create two different arrows with the common values:</code></div>
<div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>overlays = [</code></div>
<div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[ </code><code class="js string">"Arrow"</code><code>, { location:0.8 }, arrowCommon ],</code></div>
<div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>[ </code><code class="js string">"Arrow"</code><code>, { location:0.2, direction:-1 }, arrowCommon ]</code></div>
<div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code>];</code></div>
<div class="line number10 index9 alt1">&nbsp;</div>
<div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>uuid_source = node1.getAttribute(</code><code class="js string">"id"</code><code>) + </code><code class="js string">"-"</code>&nbsp;<code>+ port1;</code></div>
<div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>uuid_target = node2.getAttribute(</code><code class="js string">"id"</code><code>) + </code><code class="js string">"-"</code>&nbsp;<code>+ port2;</code></div>
<div class="line number13 index12 alt2">&nbsp;</div>
<div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>instance.connect({uuids:[uuid_source, uuid_target]});</code></div>
<div class="line number15 index14 alt2"><code>}</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>node1和node2是源节点和目标节点的引用，port1和port2是源端口和目标端口的名字。</p>
<p>使用instance.connect方法来创建连接。 overlays用来添加连接线的箭头效果或者其他风格，我这里没有使用，因为觉得都不是很好看。大家如果要用，只要把overlays加入到instance.connect的方法参数就可以了。</p>
<p>调用以上方法来创建节点，端点和连接线。</p>
<div>
<div id="highlighter_30092" class="syntaxhighlighter  js">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="js keyword">var</code>&nbsp;<code>node1 = addNode(</code><code class="js string">'container-id'</code><code>,</code><code class="js string">'node1'</code><code>, </code><code class="js string">'node1'</code><code>, {x:</code><code class="js string">'80px'</code><code>,y:</code><code class="js string">'20px'</code><code>});</code></div>
<div class="line number2 index1 alt1"><code class="js keyword">var</code>&nbsp;<code>node2 = addNode(</code><code class="js string">'container-id'</code><code>,</code><code class="js string">'node2'</code><code>, </code><code class="js string">'node2'</code><code>, {x:</code><code class="js string">'280px'</code><code>,y:</code><code class="js string">'20px'</code><code>});</code></div>
<div class="line number3 index2 alt2">&nbsp;</div>
<div class="line number4 index3 alt1"><code>addPorts(instance, node1, [</code><code class="js string">'out1'</code><code>,</code><code class="js string">'out2'</code><code>],</code><code class="js string">'output'</code><code>);</code></div>
<div class="line number5 index4 alt2"><code>addPorts(instance, node2, [</code><code class="js string">'in'</code><code>,</code><code class="js string">'in1'</code><code>,</code><code class="js string">'in2'</code><code>],</code><code class="js string">'input'</code><code>);</code></div>
<div class="line number6 index5 alt1">&nbsp;</div>
<div class="line number7 index6 alt2"><code>connectPorts(instance, node1, </code><code class="js string">'out2'</code><code>, node2, </code><code class="js string">'in'</code><code>);</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>这里我们创建了两个节点，第一个节点有两个输出端口，第二个节点有三个输入端口，然后把第一个节点的out2端口连接到第二个端点的in端口。效果如下：</p>
<p></p>
<p>最后我们给节点增加drag&amp;drop的功能，这样我们就可以拖动这些节点来改变图的布局了。</p>
<div>
<div id="highlighter_65226" class="syntaxhighlighter  js">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code>instance.draggable($(</code><code class="js string">'.node'</code><code>));</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>这里似乎依赖于JQuery-UI,我还不是很清楚。</p>
<h3><a name="t2"></a>交互式创建节点</h3>
<p>我们已经初步具有了创建图的功能，可是节点的创建必须通过程序，我们希望用交互的方式来创建节点。</p>
<p>通常我们希望有一个tree view的控件，让后通过拖拽来创建对应类型的节点。这里我使用了这个开源的tree view，基于bootstrap&nbsp;<a href="https://github.com/jonmiles/bootstrap-treeview" rel="nofollow" target="_blank">https://github.com/jonmiles/bootstrap-treeview</a></p>
<p>我们先创建一个tree view：</p>
<div>
<div id="highlighter_701545" class="syntaxhighlighter  js">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="js keyword">function</code>&nbsp;<code>getTreeData() {</code></div>
<div class="line number2 index1 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>tree = [</code></div>
<div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></div>
<div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>text: </code><code class="js string">"Nodes"</code><code>,</code></div>
<div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>nodes: [</code></div>
<div class="line number6 index5 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></div>
<div class="line number7 index6 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>text: </code><code class="js string">"Node1"</code><code>,</code></div>
<div class="line number8 index7 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>},</code></div>
<div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>{</code></div>
<div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>text: </code><code class="js string">"Node2"</code></div>
<div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></div>
<div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code>]</code></div>
<div class="line number13 index12 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code>}</code></div>
<div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>]; </code></div>
<div class="line number15 index14 alt2">&nbsp;</div>
<div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">return</code>&nbsp;<code>tree;</code></div>
<div class="line number17 index16 alt2"><code>}</code></div>
<div class="line number18 index17 alt1"><code class="js comments">//Initialize Control Tree View</code></div>
<div class="line number19 index18 alt2"><code>$(</code><code class="js string">'#control-panel'</code><code>).treeview({data: getTreeData()});</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>树上有两个节点:</p>
<p></p>
<p>然后我实现从树上拖拽对应的节点，到流程图上的逻辑。</p>
<div>
<div id="highlighter_223629" class="syntaxhighlighter  js">
<div class="table-box">
<table border="0" cellspacing="0" cellpadding="0">
<tbody>
<tr>
<td class="gutter">
<div class="line number1 index0 alt2">1</div>
<div class="line number2 index1 alt1">2</div>
<div class="line number3 index2 alt2">3</div>
<div class="line number4 index3 alt1">4</div>
<div class="line number5 index4 alt2">5</div>
<div class="line number6 index5 alt1">6</div>
<div class="line number7 index6 alt2">7</div>
<div class="line number8 index7 alt1">8</div>
<div class="line number9 index8 alt2">9</div>
<div class="line number10 index9 alt1">10</div>
<div class="line number11 index10 alt2">11</div>
<div class="line number12 index11 alt1">12</div>
<div class="line number13 index12 alt2">13</div>
<div class="line number14 index13 alt1">14</div>
<div class="line number15 index14 alt2">15</div>
<div class="line number16 index15 alt1">16</div>
<div class="line number17 index16 alt2">17</div>
<div class="line number18 index17 alt1">18</div>
<div class="line number19 index18 alt2">19</div>
<div class="line number20 index19 alt1">20</div>
<div class="line number21 index20 alt2">21</div>
<div class="line number22 index21 alt1">22</div>
<div class="line number23 index22 alt2">23</div>
<div class="line number24 index23 alt1">24</div>
<div class="line number25 index24 alt2">25</div>
<div class="line number26 index25 alt1">26</div>
<div class="line number27 index26 alt2">27</div>
</td>
<td class="code">
<div class="container">
<div class="line number1 index0 alt2"><code class="js comments">//Handle drag and drop</code></div>
<div class="line number2 index1 alt1"><code>$(</code><code class="js string">'.list-group-item'</code><code>).attr(</code><code class="js string">'draggable'</code><code>,</code><code class="js string">'true'</code><code>).on(</code><code class="js string">'dragstart'</code><code>, </code><code class="js keyword">function</code><code>(ev){</code></div>
<div class="line number3 index2 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//ev.dataTransfer.setData("text", ev.target.id);</code></div>
<div class="line number4 index3 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>ev.originalEvent.dataTransfer.setData(</code><code class="js string">'text'</code><code>,ev.target.textContent);</code></div>
<div class="line number5 index4 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code>console.log(</code><code class="js string">'drag start'</code><code>);</code></div>
<div class="line number6 index5 alt1"><code>});</code></div>
<div class="line number7 index6 alt2">&nbsp;</div>
<div class="line number8 index7 alt1"><code>$(</code><code class="js string">'#container-id'</code><code>).on(</code><code class="js string">'drop'</code><code>, </code><code class="js keyword">function</code><code>(ev){</code></div>
<div class="line number9 index8 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js comments">//avoid event conlict for jsPlumb</code></div>
<div class="line number10 index9 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">if</code>&nbsp;<code>(ev.target.className.indexOf(</code><code class="js string">'_jsPlumb'</code><code>) &gt;= 0 ) {</code></div>
<div class="line number11 index10 alt2"><code class="js spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="js keyword">return</code><code>;</code></div>
<div class="line number12 index11 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>}</code></div>
<div class="line number13 index12 alt2">&nbsp;</div>
<div class="line number14 index13 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>ev.preventDefault();</code></div>
<div class="line number15 index14 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>mx = </code><code class="js string">''</code>&nbsp;<code>+ ev.originalEvent.offsetX + </code><code class="js string">'px'</code><code>;</code></div>
<div class="line number16 index15 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>my = </code><code class="js string">''</code>&nbsp;<code>+ ev.originalEvent.offsetY + </code><code class="js string">'px'</code><code>;</code></div>
<div class="line number17 index16 alt2">&nbsp;</div>
<div class="line number18 index17 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>console.log(</code><code class="js string">'on drop : '</code>&nbsp;<code>+ ev.originalEvent.dataTransfer.getData(</code><code class="js string">'text'</code><code>));</code></div>
<div class="line number19 index18 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>uid = </code><code class="js keyword">new</code>&nbsp;<code>Date().getTime();</code></div>
<div class="line number20 index19 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code class="js keyword">var</code>&nbsp;<code>node = addNode(</code><code class="js string">'flow-panel'</code><code>,</code><code class="js string">'node'</code>&nbsp;<code>+ uid, </code><code class="js string">'node'</code><code>, {x:mx,y:my});</code></div>
<div class="line number21 index20 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code>addPorts(instance, node, [</code><code class="js string">'out'</code><code>],</code><code class="js string">'output'</code><code>);</code></div>
<div class="line number22 index21 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>addPorts(instance, node, [</code><code class="js string">'in1'</code><code>,</code><code class="js string">'in2'</code><code>],</code><code class="js string">'input'</code><code>);</code></div>
<div class="line number23 index22 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code>instance.draggable($(node));</code></div>
<div class="line number24 index23 alt1"><code>}).on(</code><code class="js string">'dragover'</code><code>, </code><code class="js keyword">function</code><code>(ev){</code></div>
<div class="line number25 index24 alt2"><code class="js spaces">&nbsp;&nbsp;</code><code>ev.preventDefault();</code></div>
<div class="line number26 index25 alt1"><code class="js spaces">&nbsp;&nbsp;</code><code>console.log(</code><code class="js string">'on drag over'</code><code>);</code></div>
<div class="line number27 index26 alt2"><code>});</code></div>
</div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>这里要注意的是要避免和jsPlumb拖拽端点的逻辑冲突，当检测到target是jsPlumb对象是需要直接从drop方法中退出以执行对应的jsPlumb的drop逻辑。</p>
<p>好了，一个绘制流程图的软件工具初步完工。</p>
<p></p>
<p>我把代码放在oschina的代码托管服务上了， 大家有兴趣可以下来试试&nbsp;<a href="http://git.oschina.net/gangtao/FlowChart-Builder" rel="nofollow" target="_blank">http://git.oschina.net/gangtao/FlowChart-Builder</a></p>
<p>转至:http://gangtao.is-programmer.com/posts/71082.html</p>
</div>
</div><hr><script charset='utf-8' src='../../js/sming.js'></script></body></html>